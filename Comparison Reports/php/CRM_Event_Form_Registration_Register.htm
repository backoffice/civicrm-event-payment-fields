<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
	"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>WinMerge File Compare Report</title>
<style type="text/css">
<!--
td,th {font-size: 12pt;}
.ln {text-align: right; background-color: lightgrey;}
.title {color: white; background-color: blue; vertical-align: top;}
.sf3b2 {color: #000000; background-color: #ffffff; }
.sf3b5 {color: #000000; background-color: #000000; }
.sf3b14 {color: #000000; background-color: #ffa0a0; }
.sf3b16 {color: #000000; background-color: #f1e2ad; }
.sf6b2 {color: #ffffff; background-color: #ffffff; }
.sf6b5 {color: #ffffff; background-color: #000000; }
.sf6b14 {color: #ffffff; background-color: #ffa0a0; }
.sf6b16 {color: #ffffff; background-color: #f1e2ad; }
.sf7b2 {color: #0000ff; background-color: #ffffff; font-weight: bold; }
.sf7b5 {color: #0000ff; background-color: #000000; font-weight: bold; }
.sf7b14 {color: #0000ff; background-color: #ffa0a0; font-weight: bold; }
.sf7b16 {color: #0000ff; background-color: #f1e2ad; font-weight: bold; }
.sf8b2 {color: #800080; background-color: #ffffff; }
.sf8b5 {color: #800080; background-color: #000000; }
.sf8b14 {color: #800080; background-color: #ffa0a0; }
.sf8b16 {color: #800080; background-color: #f1e2ad; }
.sf9b2 {color: #008000; background-color: #ffffff; }
.sf9b5 {color: #008000; background-color: #000000; }
.sf9b14 {color: #008000; background-color: #ffa0a0; }
.sf9b16 {color: #008000; background-color: #f1e2ad; }
.sf10b2 {color: #ff0000; background-color: #ffffff; }
.sf10b5 {color: #ff0000; background-color: #000000; }
.sf10b14 {color: #ff0000; background-color: #ffa0a0; }
.sf10b16 {color: #ff0000; background-color: #f1e2ad; }
.sf11b2 {color: #606060; background-color: #ffffff; }
.sf11b5 {color: #606060; background-color: #000000; }
.sf11b14 {color: #606060; background-color: #ffa0a0; }
.sf11b16 {color: #606060; background-color: #f1e2ad; }
.sf12b2 {color: #800000; background-color: #ffffff; }
.sf12b5 {color: #800000; background-color: #000000; }
.sf12b14 {color: #800000; background-color: #ffa0a0; }
.sf12b16 {color: #800000; background-color: #f1e2ad; }
.sf13b2 {color: #0080c0; background-color: #ffffff; }
.sf13b5 {color: #0080c0; background-color: #000000; }
.sf13b14 {color: #0080c0; background-color: #ffa0a0; }
.sf13b16 {color: #0080c0; background-color: #f1e2ad; }
.sf15b2 {color: #000000; background-color: #ffffff; }
.sf15b5 {color: #000000; background-color: #000000; }
.sf15b14 {color: #000000; background-color: #ffa0a0; }
.sf15b16 {color: #000000; background-color: #f1e2ad; }
.sf17b2 {color: #000000; background-color: #ffffff; }
.sf17b5 {color: #000000; background-color: #000000; }
.sf17b14 {color: #000000; background-color: #ffa0a0; }
.sf17b16 {color: #000000; background-color: #f1e2ad; }
.sf18b2 {color: #000080; background-color: #ffffff; }
.sf18b5 {color: #000080; background-color: #000000; }
.sf18b14 {color: #000080; background-color: #ffa0a0; }
.sf18b16 {color: #000080; background-color: #f1e2ad; }
.sf19b2 {color: #0080c0; background-color: #ffffff; }
.sf19b5 {color: #0080c0; background-color: #000000; }
.sf19b14 {color: #0080c0; background-color: #ffa0a0; }
.sf19b16 {color: #0080c0; background-color: #f1e2ad; }
-->
</style>
</head>
<body>
<table cellspacing="0" cellpadding="0" style="width: 100%; margin: 0; border: none;">
<thead>
<tr>
<th class="title" style="width:1%"></th><th class="title" style="width:49.000000%">Original\Event\Form\Registration\Register.php</th>
<th class="title" style="width:1%"></th><th class="title" style="width:49.000000%">Custom\Event\Form\Registration\Register.php</th>
</tr>
</thead>
<tbody>
<tr valign="top">
<td class="ln">1</td><td class="sf3b2"><code><span class="sf3b2">&lt;?php</span></code></td>
<td class="ln">1</td><td class="sf3b2"><code><span class="sf3b2">&lt;?php</span></code></td>
</tr>
<tr valign="top">
<td class="ln">2</td><td class="sf3b2"><code><span class="sf9b2">/*</span></code></td>
<td class="ln">2</td><td class="sf3b2"><code><span class="sf9b2">/*</span></code></td>
</tr>
<tr valign="top">
<td class="ln">3</td><td class="sf3b2"><code><span class="sf9b2"> +--------------------------------------------------<wbr>------------------+</span></code></td>
<td class="ln">3</td><td class="sf3b2"><code><span class="sf9b2"> +--------------------------------------------------<wbr>------------------+</span></code></td>
</tr>
<tr valign="top">
<td class="ln">4</td><td class="sf3b2"><code><span class="sf9b2"> | CiviCRM version 4.2 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|</span></code></td>
<td class="ln">4</td><td class="sf3b2"><code><span class="sf9b2"> | CiviCRM version 4.2 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|</span></code></td>
</tr>
<tr valign="top">
<td class="ln">5</td><td class="sf3b2"><code><span class="sf9b2"> +--------------------------------------------------<wbr>------------------+</span></code></td>
<td class="ln">5</td><td class="sf3b2"><code><span class="sf9b2"> +--------------------------------------------------<wbr>------------------+</span></code></td>
</tr>
<tr valign="top">
<td class="ln">6</td><td class="sf3b2"><code><span class="sf9b2"> | Copyright CiviCRM LLC (c) 2004-2012 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|</span></code></td>
<td class="ln">6</td><td class="sf3b2"><code><span class="sf9b2"> | Copyright CiviCRM LLC (c) 2004-2012 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|</span></code></td>
</tr>
<tr valign="top">
<td class="ln">7</td><td class="sf3b2"><code><span class="sf9b2"> +--------------------------------------------------<wbr>------------------+</span></code></td>
<td class="ln">7</td><td class="sf3b2"><code><span class="sf9b2"> +--------------------------------------------------<wbr>------------------+</span></code></td>
</tr>
<tr valign="top">
<td class="ln">8</td><td class="sf3b2"><code><span class="sf9b2"> | This file is a part of CiviCRM. &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|</span></code></td>
<td class="ln">8</td><td class="sf3b2"><code><span class="sf9b2"> | This file is a part of CiviCRM. &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|</span></code></td>
</tr>
<tr valign="top">
<td class="ln">9</td><td class="sf3b2"><code><span class="sf9b2"> | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|</span></code></td>
<td class="ln">9</td><td class="sf3b2"><code><span class="sf9b2"> | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|</span></code></td>
</tr>
<tr valign="top">
<td class="ln">10</td><td class="sf3b2"><code><span class="sf9b2"> | CiviCRM is free software; you can copy, modify, and distribute it &nbsp;|</span></code></td>
<td class="ln">10</td><td class="sf3b2"><code><span class="sf9b2"> | CiviCRM is free software; you can copy, modify, and distribute it &nbsp;|</span></code></td>
</tr>
<tr valign="top">
<td class="ln">11</td><td class="sf3b2"><code><span class="sf9b2"> | under the terms of the GNU Affero General Public License &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |</span></code></td>
<td class="ln">11</td><td class="sf3b2"><code><span class="sf9b2"> | under the terms of the GNU Affero General Public License &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |</span></code></td>
</tr>
<tr valign="top">
<td class="ln">12</td><td class="sf3b2"><code><span class="sf9b2"> | Version 3, 19 November 2007 and the CiviCRM Licensing Exception. &nbsp; |</span></code></td>
<td class="ln">12</td><td class="sf3b2"><code><span class="sf9b2"> | Version 3, 19 November 2007 and the CiviCRM Licensing Exception. &nbsp; |</span></code></td>
</tr>
<tr valign="top">
<td class="ln">13</td><td class="sf3b2"><code><span class="sf9b2"> | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|</span></code></td>
<td class="ln">13</td><td class="sf3b2"><code><span class="sf9b2"> | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|</span></code></td>
</tr>
<tr valign="top">
<td class="ln">14</td><td class="sf3b2"><code><span class="sf9b2"> | CiviCRM is distributed in the hope that it will be useful, but &nbsp; &nbsp; |</span></code></td>
<td class="ln">14</td><td class="sf3b2"><code><span class="sf9b2"> | CiviCRM is distributed in the hope that it will be useful, but &nbsp; &nbsp; |</span></code></td>
</tr>
<tr valign="top">
<td class="ln">15</td><td class="sf3b2"><code><span class="sf9b2"> | WITHOUT ANY WARRANTY; without even the implied warranty of &nbsp; &nbsp; &nbsp; &nbsp; |</span></code></td>
<td class="ln">15</td><td class="sf3b2"><code><span class="sf9b2"> | WITHOUT ANY WARRANTY; without even the implied warranty of &nbsp; &nbsp; &nbsp; &nbsp; |</span></code></td>
</tr>
<tr valign="top">
<td class="ln">16</td><td class="sf3b2"><code><span class="sf9b2"> | MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |</span></code></td>
<td class="ln">16</td><td class="sf3b2"><code><span class="sf9b2"> | MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |</span></code></td>
</tr>
<tr valign="top">
<td class="ln">17</td><td class="sf3b2"><code><span class="sf9b2"> | See the GNU Affero General Public License for more details. &nbsp; &nbsp; &nbsp; &nbsp;|</span></code></td>
<td class="ln">17</td><td class="sf3b2"><code><span class="sf9b2"> | See the GNU Affero General Public License for more details. &nbsp; &nbsp; &nbsp; &nbsp;|</span></code></td>
</tr>
<tr valign="top">
<td class="ln">18</td><td class="sf3b2"><code><span class="sf9b2"> | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|</span></code></td>
<td class="ln">18</td><td class="sf3b2"><code><span class="sf9b2"> | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|</span></code></td>
</tr>
<tr valign="top">
<td class="ln">19</td><td class="sf3b2"><code><span class="sf9b2"> | You should have received a copy of the GNU Affero General Public &nbsp; |</span></code></td>
<td class="ln">19</td><td class="sf3b2"><code><span class="sf9b2"> | You should have received a copy of the GNU Affero General Public &nbsp; |</span></code></td>
</tr>
<tr valign="top">
<td class="ln">20</td><td class="sf3b2"><code><span class="sf9b2"> | License and the CiviCRM Licensing Exception along &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|</span></code></td>
<td class="ln">20</td><td class="sf3b2"><code><span class="sf9b2"> | License and the CiviCRM Licensing Exception along &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|</span></code></td>
</tr>
<tr valign="top">
<td class="ln">21</td><td class="sf3b2"><code><span class="sf9b2"> | with this program; if not, contact CiviCRM LLC &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |</span></code></td>
<td class="ln">21</td><td class="sf3b2"><code><span class="sf9b2"> | with this program; if not, contact CiviCRM LLC &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |</span></code></td>
</tr>
<tr valign="top">
<td class="ln">22</td><td class="sf3b2"><code><span class="sf9b2"> | at info[AT]civicrm[DOT]org. If you have questions about the &nbsp; &nbsp; &nbsp; &nbsp;|</span></code></td>
<td class="ln">22</td><td class="sf3b2"><code><span class="sf9b2"> | at info[AT]civicrm[DOT]org. If you have questions about the &nbsp; &nbsp; &nbsp; &nbsp;|</span></code></td>
</tr>
<tr valign="top">
<td class="ln">23</td><td class="sf3b2"><code><span class="sf9b2"> | GNU Affero General Public License or the licensing of CiviCRM, &nbsp; &nbsp; |</span></code></td>
<td class="ln">23</td><td class="sf3b2"><code><span class="sf9b2"> | GNU Affero General Public License or the licensing of CiviCRM, &nbsp; &nbsp; |</span></code></td>
</tr>
<tr valign="top">
<td class="ln">24</td><td class="sf3b2"><code><span class="sf9b2"> | see the CiviCRM license FAQ at http://civicrm.org/licensing &nbsp; &nbsp; &nbsp; &nbsp;|</span></code></td>
<td class="ln">24</td><td class="sf3b2"><code><span class="sf9b2"> | see the CiviCRM license FAQ at http://civicrm.org/licensing &nbsp; &nbsp; &nbsp; &nbsp;|</span></code></td>
</tr>
<tr valign="top">
<td class="ln">25</td><td class="sf3b2"><code><span class="sf9b2"> +--------------------------------------------------<wbr>------------------+</span></code></td>
<td class="ln">25</td><td class="sf3b2"><code><span class="sf9b2"> +--------------------------------------------------<wbr>------------------+</span></code></td>
</tr>
<tr valign="top">
<td class="ln">26</td><td class="sf3b2"><code><span class="sf9b2">*/</span>&nbsp;</code></td>
<td class="ln">26</td><td class="sf3b2"><code><span class="sf9b2">*/</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">27</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">27</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">28</td><td class="sf3b2"><code><span class="sf9b2">/**</span></code></td>
<td class="ln">28</td><td class="sf3b2"><code><span class="sf9b2">/**</span></code></td>
</tr>
<tr valign="top">
<td class="ln">29</td><td class="sf3b2"><code><span class="sf9b2"> *</span></code></td>
<td class="ln">29</td><td class="sf3b2"><code><span class="sf9b2"> *</span></code></td>
</tr>
<tr valign="top">
<td class="ln">30</td><td class="sf3b2"><code><span class="sf9b2"> *</span></code></td>
<td class="ln">30</td><td class="sf3b2"><code><span class="sf9b2"> *</span></code></td>
</tr>
<tr valign="top">
<td class="ln">31</td><td class="sf3b2"><code><span class="sf9b2"> * @package CRM</span></code></td>
<td class="ln">31</td><td class="sf3b2"><code><span class="sf9b2"> * @package CRM</span></code></td>
</tr>
<tr valign="top">
<td class="ln">32</td><td class="sf3b2"><code><span class="sf9b2"> * @copyright CiviCRM LLC (c) 2004-2012</span></code></td>
<td class="ln">32</td><td class="sf3b2"><code><span class="sf9b2"> * @copyright CiviCRM LLC (c) 2004-2012</span></code></td>
</tr>
<tr valign="top">
<td class="ln">33</td><td class="sf3b2"><code><span class="sf9b2"> * $Id$</span></code></td>
<td class="ln">33</td><td class="sf3b2"><code><span class="sf9b2"> * $Id$</span></code></td>
</tr>
<tr valign="top">
<td class="ln">34</td><td class="sf3b2"><code><span class="sf9b2"> *</span></code></td>
<td class="ln">34</td><td class="sf3b2"><code><span class="sf9b2"> *</span></code></td>
</tr>
<tr valign="top">
<td class="ln">35</td><td class="sf3b2"><code><span class="sf9b2"> */</span>&nbsp;</code></td>
<td class="ln">35</td><td class="sf3b2"><code><span class="sf9b2"> */</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">36</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">36</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">37</td><td class="sf3b2"><code><span class="sf9b2">/**</span></code></td>
<td class="ln">37</td><td class="sf3b2"><code><span class="sf9b2">/**</span></code></td>
</tr>
<tr valign="top">
<td class="ln">38</td><td class="sf3b2"><code><span class="sf9b2"> * This class generates form components for processing Event</span></code></td>
<td class="ln">38</td><td class="sf3b2"><code><span class="sf9b2"> * This class generates form components for processing Event</span></code></td>
</tr>
<tr valign="top">
<td class="ln">39</td><td class="sf3b2"><code><span class="sf9b2"> *</span></code></td>
<td class="ln">39</td><td class="sf3b2"><code><span class="sf9b2"> *</span></code></td>
</tr>
<tr valign="top">
<td class="ln">40</td><td class="sf3b2"><code><span class="sf9b2"> */</span>&nbsp;</code></td>
<td class="ln">40</td><td class="sf3b2"><code><span class="sf9b2"> */</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">41</td><td class="sf3b2"><code><span class="sf7b2">class</span><span class="sf3b2"> CRM_Event_Form_Registration_Register extends CRM_Event_Form_Registration {</span></code></td>
<td class="ln">41</td><td class="sf3b2"><code><span class="sf7b2">class</span><span class="sf3b2"> CRM_Event_Form_Registration_Register extends CRM_Event_Form_Registration {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">42</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">42</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">43</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf9b2">/**</span></code></td>
<td class="ln">43</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf9b2">/**</span></code></td>
</tr>
<tr valign="top">
<td class="ln">44</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * The fields involved in this page</span></code></td>
<td class="ln">44</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * The fields involved in this page</span></code></td>
</tr>
<tr valign="top">
<td class="ln">45</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; *</span></code></td>
<td class="ln">45</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; *</span></code></td>
</tr>
<tr valign="top">
<td class="ln">46</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; */</span>&nbsp;</code></td>
<td class="ln">46</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; */</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">47</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;public $</span><span class="sf18b2">_fields;</span></code></td>
<td class="ln">47</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;public $</span><span class="sf18b2">_fields;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">48</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">48</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">49</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf9b2">/**</span></code></td>
<td class="ln">49</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf9b2">/**</span></code></td>
</tr>
<tr valign="top">
<td class="ln">50</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * The defaults involved in this page</span></code></td>
<td class="ln">50</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * The defaults involved in this page</span></code></td>
</tr>
<tr valign="top">
<td class="ln">51</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; *</span></code></td>
<td class="ln">51</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; *</span></code></td>
</tr>
<tr valign="top">
<td class="ln">52</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; */</span>&nbsp;</code></td>
<td class="ln">52</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; */</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">53</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;public $</span><span class="sf18b2">_defaults;</span></code></td>
<td class="ln">53</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;public $</span><span class="sf18b2">_defaults;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">54</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">54</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">55</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf9b2">/**</span></code></td>
<td class="ln">55</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf9b2">/**</span></code></td>
</tr>
<tr valign="top">
<td class="ln">56</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * The status message that user view.</span></code></td>
<td class="ln">56</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * The status message that user view.</span></code></td>
</tr>
<tr valign="top">
<td class="ln">57</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; *</span></code></td>
<td class="ln">57</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; *</span></code></td>
</tr>
<tr valign="top">
<td class="ln">58</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; */</span>&nbsp;</code></td>
<td class="ln">58</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; */</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">59</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;protected $</span><span class="sf18b2">_waitlistMsg = NULL;</span></code></td>
<td class="ln">59</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;protected $</span><span class="sf18b2">_waitlistMsg = NULL;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">60</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;protected $</span><span class="sf18b2">_requireApprovalMsg = NULL;</span></code></td>
<td class="ln">60</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;protected $</span><span class="sf18b2">_requireApprovalMsg = NULL;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">61</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">61</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">62</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;public $</span><span class="sf18b2">_quickConfig = NULL;</span></code></td>
<td class="ln">62</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;public $</span><span class="sf18b2">_quickConfig = NULL;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">63</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">63</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">64</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf9b2">/**</span></code></td>
<td class="ln">64</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf9b2">/**</span></code></td>
</tr>
<tr valign="top">
<td class="ln">65</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * Allow deveopera to use hook_civicrm_buildForm()</span></code></td>
<td class="ln">65</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * Allow deveopera to use hook_civicrm_buildForm()</span></code></td>
</tr>
<tr valign="top">
<td class="ln">66</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * to override the registration dupe check</span></code></td>
<td class="ln">66</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * to override the registration dupe check</span></code></td>
</tr>
<tr valign="top">
<td class="ln">67</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * CRM-7604</span></code></td>
<td class="ln">67</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * CRM-7604</span></code></td>
</tr>
<tr valign="top">
<td class="ln">68</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; */</span>&nbsp;</code></td>
<td class="ln">68</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; */</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">69</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;public $</span><span class="sf18b2">_skipDupeRegistrationCheck = FALSE;</span></code></td>
<td class="ln">69</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;public $</span><span class="sf18b2">_skipDupeRegistrationCheck = FALSE;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">70</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">70</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">71</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;protected $</span><span class="sf18b2">_ppType;</span></code></td>
<td class="ln">71</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;protected $</span><span class="sf18b2">_ppType;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">72</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">72</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">73</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf9b2">/**</span></code></td>
<td class="ln">73</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf9b2">/**</span></code></td>
</tr>
<tr valign="top">
<td class="ln">74</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * Function to set variables up before form is built</span></code></td>
<td class="ln">74</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * Function to set variables up before form is built</span></code></td>
</tr>
<tr valign="top">
<td class="ln">75</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; *</span></code></td>
<td class="ln">75</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; *</span></code></td>
</tr>
<tr valign="top">
<td class="ln">76</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @return void</span></code></td>
<td class="ln">76</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @return void</span></code></td>
</tr>
<tr valign="top">
<td class="ln">77</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @access public</span></code></td>
<td class="ln">77</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @access public</span></code></td>
</tr>
<tr valign="top">
<td class="ln">78</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; */</span>&nbsp;</code></td>
<td class="ln">78</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; */</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">79</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf7b2">function</span><span class="sf3b2"> </span><span class="sf8b2">preProcess</span><span class="sf3b2">() {</span></code></td>
<td class="ln">79</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf7b2">function</span><span class="sf3b2"> </span><span class="sf8b2">preProcess</span><span class="sf3b2">() {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">80</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">parent::preProcess</span><span style="color: #000000; background-color: #efcb05; ">();</span><span class="sf17b16">
</span>&nbsp;</code></td>
<td class="ln">80</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">parent::preProcess</span><span style="color: #000000; background-color: #efcb05; ">();</span><span class="sf17b16"> &nbsp; &nbsp;
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">81</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16">
</span>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">82</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">_ppType = CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'type'</span><span class="sf3b2">, $</span><span class="sf18b2">_GET);</span></code></td>
<td class="ln">81</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">_ppType = CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'type'</span><span class="sf3b2">, $</span><span class="sf18b2">_GET);</span></code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">82</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp;
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">83</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">assign</span><span class="sf3b2">(</span><span class="sf12b2">'ppType'</span><span class="sf3b2">, FALSE);</span></code></td>
<td class="ln">83</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">assign</span><span class="sf3b2">(</span><span class="sf12b2">'ppType'</span><span class="sf3b2">, FALSE);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">84</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">this-&gt;_ppType) {</span></code></td>
<td class="ln">84</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">this-&gt;_ppType) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">85</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">assign</span><span class="sf3b2">(</span><span class="sf12b2">'ppType'</span><span class="sf3b2">, TRUE);</span></code></td>
<td class="ln">85</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">assign</span><span class="sf3b2">(</span><span class="sf12b2">'ppType'</span><span class="sf3b2">, TRUE);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">86</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">return</span><span class="sf3b2"> </span><span class="sf8b2">CRM_Core_Payment_ProcessorForm::preProcess</span><span class="sf3b2">($</span><span class="sf18b2">this);</span></code></td>
<td class="ln">86</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">return</span><span class="sf3b2"> </span><span class="sf8b2">CRM_Core_Payment_ProcessorForm::preProcess</span><span class="sf3b2">($</span><span class="sf18b2">this);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">87</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">87</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">88</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">88</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">89</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">//get payPal express id and make it available to template</span></code></td>
<td class="ln">89</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">//get payPal express id and make it available to template</span></code></td>
</tr>
<tr valign="top">
<td class="ln">90</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">paymentProcessors = $</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">get</span><span class="sf3b2">(</span><span class="sf12b2">'paymentProcessors'</span><span class="sf3b2">);</span></code></td>
<td class="ln">90</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">paymentProcessors = $</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">get</span><span class="sf3b2">(</span><span class="sf12b2">'paymentProcessors'</span><span class="sf3b2">);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">91</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">assign</span><span class="sf3b2">(</span><span class="sf12b2">'payPalExpressId'</span><span class="sf3b2">, </span><span class="sf10b2">0</span><span class="sf3b2">);</span></code></td>
<td class="ln">91</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">assign</span><span class="sf3b2">(</span><span class="sf12b2">'payPalExpressId'</span><span class="sf3b2">, </span><span class="sf10b2">0</span><span class="sf3b2">);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">92</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!</span><span class="sf7b2">empty</span><span class="sf3b2">($</span><span class="sf18b2">paymentProcessors)) {</span></code></td>
<td class="ln">92</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!</span><span class="sf7b2">empty</span><span class="sf3b2">($</span><span class="sf18b2">paymentProcessors)) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">93</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">foreach</span><span class="sf3b2"> ($</span><span class="sf18b2">paymentProcessors </span><span class="sf7b2">as</span><span class="sf3b2"> $</span><span class="sf18b2">ppId =&gt; $</span><span class="sf18b2">values) {</span></code></td>
<td class="ln">93</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">foreach</span><span class="sf3b2"> ($</span><span class="sf18b2">paymentProcessors </span><span class="sf7b2">as</span><span class="sf3b2"> $</span><span class="sf18b2">ppId =&gt; $</span><span class="sf18b2">values) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">94</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">payPalExpressId = ($</span><span class="sf18b2">values[</span><span class="sf12b2">'payment_processor_type'</span><span class="sf3b2">] == </span><span class="sf12b2">'PayPal_Express'</span><span class="sf3b2">) ? $</span><span class="sf18b2">values[</span><span class="sf12b2">'id'</span><span class="sf3b2">] : </span><span class="sf10b2">0</span><span class="sf3b2">;</span></code></td>
<td class="ln">94</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">payPalExpressId = ($</span><span class="sf18b2">values[</span><span class="sf12b2">'payment_processor_type'</span><span class="sf3b2">] == </span><span class="sf12b2">'PayPal_Express'</span><span class="sf3b2">) ? $</span><span class="sf18b2">values[</span><span class="sf12b2">'id'</span><span class="sf3b2">] : </span><span class="sf10b2">0</span><span class="sf3b2">;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">95</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">assign</span><span class="sf3b2">(</span><span class="sf12b2">'payPalExpressId'</span><span class="sf3b2">, $</span><span class="sf18b2">payPalExpressId);</span></code></td>
<td class="ln">95</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">assign</span><span class="sf3b2">(</span><span class="sf12b2">'payPalExpressId'</span><span class="sf3b2">, $</span><span class="sf18b2">payPalExpressId);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">96</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">payPalExpressId) {</span></code></td>
<td class="ln">96</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">payPalExpressId) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">97</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">break</span><span class="sf3b2">;</span></code></td>
<td class="ln">97</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">break</span><span class="sf3b2">;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">98</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">98</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">99</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">99</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">100</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">100</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">101</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">101</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">102</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">//CRM-4320.</span></code></td>
<td class="ln">102</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">//CRM-4320.</span></code></td>
</tr>
<tr valign="top">
<td class="ln">103</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">//here we can't use parent $this-&gt;_allowWaitlist as user might</span></code></td>
<td class="ln">103</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">//here we can't use parent $this-&gt;_allowWaitlist as user might</span></code></td>
</tr>
<tr valign="top">
<td class="ln">104</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">//walk back and we maight set this value in this postProcess.</span></code></td>
<td class="ln">104</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">//walk back and we maight set this value in this postProcess.</span></code></td>
</tr>
<tr valign="top">
<td class="ln">105</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">//(we set when spaces &lt; group count and want to allow become part of waiting )</span></code></td>
<td class="ln">105</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">//(we set when spaces &lt; group count and want to allow become part of waiting )</span></code></td>
</tr>
<tr valign="top">
<td class="ln">106</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">106</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">107</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">eventFull = </span><span class="sf8b2">CRM_Event_BAO_Participant::eventFull</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">_eventI<wbr>d, FALSE, CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'has_waitlist'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">]));</span></code></td>
<td class="ln">107</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">eventFull = </span><span class="sf8b2">CRM_Event_BAO_Participant::eventFull</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">_eventI<wbr>d, FALSE, CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'has_waitlist'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">]));</span></code></td>
</tr>
<tr valign="top">
<td class="ln">108</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">108</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">109</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_allowWaitlist = FALSE;</span></code></td>
<td class="ln">109</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_allowWaitlist = FALSE;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">110</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">eventFull &amp;&amp; !$</span><span class="sf18b2">this-&gt;_allowConfirmation &amp;&amp;</span></code></td>
<td class="ln">110</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">eventFull &amp;&amp; !$</span><span class="sf18b2">this-&gt;_allowConfirmation &amp;&amp;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">111</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'has_waitlist'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">])</span></code></td>
<td class="ln">111</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'has_waitlist'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">])</span></code></td>
</tr>
<tr valign="top">
<td class="ln">112</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;) {</span></code></td>
<td class="ln">112</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">113</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_allowWaitlist = TRUE;</span></code></td>
<td class="ln">113</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_allowWaitlist = TRUE;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">114</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">_waitlistMsg = CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'waitlist_text'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">]);</span></code></td>
<td class="ln">114</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">_waitlistMsg = CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'waitlist_text'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">]);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">115</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!$</span><span class="sf18b2">this-&gt;_waitlistMsg) {</span></code></td>
<td class="ln">115</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!$</span><span class="sf18b2">this-&gt;_waitlistMsg) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">116</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">_waitlistMsg = ts</span><span class="sf3b2">(</span><span class="sf12b2">'This event is currently full. However you can register now and get added to a waiting list. You will be notified if spaces become available.'</span><span class="sf3b2">);</span></code></td>
<td class="ln">116</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">_waitlistMsg = ts</span><span class="sf3b2">(</span><span class="sf12b2">'This event is currently full. However you can register now and get added to a waiting list. You will be notified if spaces become available.'</span><span class="sf3b2">);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">117</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">117</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">118</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">118</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">119</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">set</span><span class="sf3b2">(</span><span class="sf12b2">'allowWaitlist'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_allowWaitlist);</span></code></td>
<td class="ln">119</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">set</span><span class="sf3b2">(</span><span class="sf12b2">'allowWaitlist'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_allowWaitlist);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">120</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">120</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">121</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">//To check if the user is already registered for the event(CRM-2426)</span></code></td>
<td class="ln">121</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">//To check if the user is already registered for the event(CRM-2426)</span></code></td>
</tr>
<tr valign="top">
<td class="ln">122</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!$</span><span class="sf18b2">this-&gt;_skipDupeRegistrationCheck) {</span></code></td>
<td class="ln">122</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!$</span><span class="sf18b2">this-&gt;_skipDupeRegistrationCheck) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">123</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">self::checkRegistration</span><span class="sf3b2">(NULL, $</span><span class="sf18b2">this);</span></code></td>
<td class="ln">123</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">self::checkRegistration</span><span class="sf3b2">(NULL, $</span><span class="sf18b2">this);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">124</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">124</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">125</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">125</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">126</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">assign</span><span class="sf3b2">(</span><span class="sf12b2">'availableRegistrations'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_availableRegistrations);</span></code></td>
<td class="ln">126</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">assign</span><span class="sf3b2">(</span><span class="sf12b2">'availableRegistrations'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_availableRegistrations);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">127</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">127</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">128</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// get the participant values from EventFees.php, CRM-4320</span></code></td>
<td class="ln">128</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// get the participant values from EventFees.php, CRM-4320</span></code></td>
</tr>
<tr valign="top">
<td class="ln">129</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">this-&gt;_allowConfirmation) {</span></code></td>
<td class="ln">129</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">this-&gt;_allowConfirmation) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">130</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">CRM_Event_Form_EventFees::preProcess</span><span class="sf3b2">($</span><span class="sf18b2">this);</span></code></td>
<td class="ln">130</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">CRM_Event_Form_EventFees::preProcess</span><span class="sf3b2">($</span><span class="sf18b2">this);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">131</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">131</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">132</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">132</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">133</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'hidden_processor'</span><span class="sf3b2">, $</span><span class="sf18b2">_POST)) {</span></code></td>
<td class="ln">133</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'hidden_processor'</span><span class="sf3b2">, $</span><span class="sf18b2">_POST)) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">134</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">134</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">135</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">set</span><span class="sf3b2">(</span><span class="sf12b2">'type'</span><span class="sf3b2">, </span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'payment_processor'</span><span class="sf3b2">, $</span><span class="sf18b2">_POST));</span></code></td>
<td class="ln">135</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">set</span><span class="sf3b2">(</span><span class="sf12b2">'type'</span><span class="sf3b2">, </span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'payment_processor'</span><span class="sf3b2">, $</span><span class="sf18b2">_POST));</span></code></td>
</tr>
<tr valign="top">
<td class="ln">136</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">set</span><span class="sf3b2">(</span><span class="sf12b2">'mode'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_mode);</span></code></td>
<td class="ln">136</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">set</span><span class="sf3b2">(</span><span class="sf12b2">'mode'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_mode);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">137</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">set</span><span class="sf3b2">(</span><span class="sf12b2">'paymentProcessor'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_paymentProcessor);</span></code></td>
<td class="ln">137</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">set</span><span class="sf3b2">(</span><span class="sf12b2">'paymentProcessor'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_paymentProcessor);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">138</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16">
</span>&nbsp;</code></td>
<td class="ln">138</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp;
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">139</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">CRM_Core_Payment_ProcessorForm::preProcess</span><span class="sf3b2">($</span><span class="sf18b2">this);</span></code></td>
<td class="ln">139</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">CRM_Core_Payment_ProcessorForm::preProcess</span><span class="sf3b2">($</span><span class="sf18b2">this);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">140</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">CRM_Core_Payment_ProcessorForm::buildQuickForm</span><span class="sf3b2">($</span><span class="sf18b2">thi<wbr>s);</span></code></td>
<td class="ln">140</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">CRM_Core_Payment_ProcessorForm::buildQuickForm</span><span class="sf3b2">($</span><span class="sf18b2">thi<wbr>s);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">141</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">141</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">142</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;}</span></code></td>
<td class="ln">142</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">143</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">143</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">144</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf9b2">/**</span></code></td>
<td class="ln">144</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf9b2">/**</span></code></td>
</tr>
<tr valign="top">
<td class="ln">145</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * This function sets the default values for the form. For edit/view mode</span></code></td>
<td class="ln">145</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * This function sets the default values for the form. For edit/view mode</span></code></td>
</tr>
<tr valign="top">
<td class="ln">146</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * the default values are retrieved from the database</span></code></td>
<td class="ln">146</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * the default values are retrieved from the database</span></code></td>
</tr>
<tr valign="top">
<td class="ln">147</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; *</span></code></td>
<td class="ln">147</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; *</span></code></td>
</tr>
<tr valign="top">
<td class="ln">148</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @access public</span></code></td>
<td class="ln">148</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @access public</span></code></td>
</tr>
<tr valign="top">
<td class="ln">149</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; *</span></code></td>
<td class="ln">149</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; *</span></code></td>
</tr>
<tr valign="top">
<td class="ln">150</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @return None</span></code></td>
<td class="ln">150</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @return None</span></code></td>
</tr>
<tr valign="top">
<td class="ln">151</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; */</span>&nbsp;</code></td>
<td class="ln">151</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; */</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">152</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf7b2">function</span><span class="sf3b2"> </span><span class="sf8b2">setDefaultValues</span><span class="sf3b2">() {</span></code></td>
<td class="ln">152</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf7b2">function</span><span class="sf3b2"> </span><span class="sf8b2">setDefaultValues</span><span class="sf3b2">() {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">153</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">contactID = </span><span class="sf8b2">parent::getContactID</span><span class="sf3b2">();</span></code></td>
<td class="ln">153</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">contactID = </span><span class="sf8b2">parent::getContactID</span><span class="sf3b2">();</span></code></td>
</tr>
<tr valign="top">
<td class="ln">154</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">contactID) {</span></code></td>
<td class="ln">154</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">contactID) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">155</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">options = </span><span class="sf7b2">array</span><span class="sf3b2">();</span></code></td>
<td class="ln">155</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">options = </span><span class="sf7b2">array</span><span class="sf3b2">();</span></code></td>
</tr>
<tr valign="top">
<td class="ln">156</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">fields = </span><span class="sf7b2">array</span><span class="sf3b2">();</span></code></td>
<td class="ln">156</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">fields = </span><span class="sf7b2">array</span><span class="sf3b2">();</span></code></td>
</tr>
<tr valign="top">
<td class="ln">157</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">157</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">158</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!</span><span class="sf7b2">empty</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;_fields)) {</span></code></td>
<td class="ln">158</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!</span><span class="sf7b2">empty</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;_fields)) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">159</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">removeCustomFieldTypes = </span><span class="sf7b2">array</span><span class="sf3b2">(</span><span class="sf12b2">'Participant'</span><span class="sf3b2">);</span></code></td>
<td class="ln">159</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">removeCustomFieldTypes = </span><span class="sf7b2">array</span><span class="sf3b2">(</span><span class="sf12b2">'Participant'</span><span class="sf3b2">);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">160</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">foreach</span><span class="sf3b2"> ($</span><span class="sf18b2">this-&gt;_fields as $</span><span class="sf18b2">name =&gt; $</span><span class="sf18b2">dontCare) {</span></code></td>
<td class="ln">160</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">foreach</span><span class="sf3b2"> ($</span><span class="sf18b2">this-&gt;_fields as $</span><span class="sf18b2">name =&gt; $</span><span class="sf18b2">dontCare) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">161</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">substr</span><span class="sf3b2">($</span><span class="sf18b2">name, </span><span class="sf10b2">0</span><span class="sf3b2">, </span><span class="sf10b2">7</span><span class="sf3b2">) == </span><span class="sf12b2">'custom_'</span><span class="sf3b2">) {</span></code></td>
<td class="ln">161</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">substr</span><span class="sf3b2">($</span><span class="sf18b2">name, </span><span class="sf10b2">0</span><span class="sf3b2">, </span><span class="sf10b2">7</span><span class="sf3b2">) == </span><span class="sf12b2">'custom_'</span><span class="sf3b2">) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">162</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">id = </span><span class="sf8b2">substr</span><span class="sf3b2">($</span><span class="sf18b2">name, </span><span class="sf10b2">7</span><span class="sf3b2">);</span></code></td>
<td class="ln">162</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">id = </span><span class="sf8b2">substr</span><span class="sf3b2">($</span><span class="sf18b2">name, </span><span class="sf10b2">7</span><span class="sf3b2">);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">163</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!$</span><span class="sf18b2">this-&gt;_allowConfirmation &amp;&amp;</span></code></td>
<td class="ln">163</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!$</span><span class="sf18b2">this-&gt;_allowConfirmation &amp;&amp;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">164</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;!</span><span class="sf8b2">CRM_Core_BAO_CustomGroup::checkCustomField</span><span class="sf3b2">($</span><span class="sf18b2">id, $</span><span class="sf18b2">removeCustomFieldTypes)</span></code></td>
<td class="ln">164</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;!</span><span class="sf8b2">CRM_Core_BAO_CustomGroup::checkCustomField</span><span class="sf3b2">($</span><span class="sf18b2">id, $</span><span class="sf18b2">removeCustomFieldTypes)</span></code></td>
</tr>
<tr valign="top">
<td class="ln">165</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;) {</span></code></td>
<td class="ln">165</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">166</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">continue</span><span class="sf3b2">;</span></code></td>
<td class="ln">166</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">continue</span><span class="sf3b2">;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">167</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">167</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">168</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">// ignore component fields</span></code></td>
<td class="ln">168</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">// ignore component fields</span></code></td>
</tr>
<tr valign="top">
<td class="ln">169</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">169</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">170</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">elseif</span><span class="sf3b2"> ((</span><span class="sf8b2">substr</span><span class="sf3b2">($</span><span class="sf18b2">name, </span><span class="sf10b2">0</span><span class="sf3b2">, </span><span class="sf10b2">12</span><span class="sf3b2">) == </span><span class="sf12b2">'participant_'</span><span class="sf3b2">)) {</span></code></td>
<td class="ln">170</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">elseif</span><span class="sf3b2"> ((</span><span class="sf8b2">substr</span><span class="sf3b2">($</span><span class="sf18b2">name, </span><span class="sf10b2">0</span><span class="sf3b2">, </span><span class="sf10b2">12</span><span class="sf3b2">) == </span><span class="sf12b2">'participant_'</span><span class="sf3b2">)) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">171</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">continue</span><span class="sf3b2">;</span></code></td>
<td class="ln">171</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">continue</span><span class="sf3b2">;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">172</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">172</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">173</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">fields[$</span><span class="sf18b2">name] = </span><span class="sf10b2">1</span><span class="sf3b2">;</span></code></td>
<td class="ln">173</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">fields[$</span><span class="sf18b2">name] = </span><span class="sf10b2">1</span><span class="sf3b2">;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">174</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">174</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">175</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">175</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">176</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">176</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">177</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">names = </span><span class="sf7b2">array</span><span class="sf3b2">(</span></code></td>
<td class="ln">177</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">names = </span><span class="sf7b2">array</span><span class="sf3b2">(</span></code></td>
</tr>
<tr valign="top">
<td class="ln">178</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'first_name'</span><span class="sf3b2">, </span><span class="sf12b2">'middle_name'</span><span class="sf3b2">, </span><span class="sf12b2">'last_name'</span><span class="sf3b2">,</span></code></td>
<td class="ln">178</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'first_name'</span><span class="sf3b2">, </span><span class="sf12b2">'middle_name'</span><span class="sf3b2">, </span><span class="sf12b2">'last_name'</span><span class="sf3b2">,</span></code></td>
</tr>
<tr valign="top">
<td class="ln">179</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">"street_address-{$this-&gt;_bltID}"</span><span class="sf3b2">, </span><span class="sf12b2">"city-{$this-&gt;_bltID}"</span><span class="sf3b2">, </span><span class="sf12b2">"postal_code-{$this-&gt;_bltID}"</span><span class="sf3b2">,</span></code></td>
<td class="ln">179</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">"street_address-{$this-&gt;_bltID}"</span><span class="sf3b2">, </span><span class="sf12b2">"city-{$this-&gt;_bltID}"</span><span class="sf3b2">, </span><span class="sf12b2">"postal_code-{$this-&gt;_bltID}"</span><span class="sf3b2">,</span></code></td>
</tr>
<tr valign="top">
<td class="ln">180</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">"country_id-{$this-&gt;_bltID}"</span><span class="sf3b2">, </span><span class="sf12b2">"state_province_id-{$this-&gt;_bltID}"</span><span class="sf3b2">,</span></code></td>
<td class="ln">180</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">"country_id-{$this-&gt;_bltID}"</span><span class="sf3b2">, </span><span class="sf12b2">"state_province_id-{$this-&gt;_bltID}"</span><span class="sf3b2">,</span></code></td>
</tr>
<tr valign="top">
<td class="ln">181</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;);</span></code></td>
<td class="ln">181</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">182</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">182</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">183</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">foreach</span><span class="sf3b2"> ($</span><span class="sf18b2">names </span><span class="sf7b2">as</span><span class="sf3b2"> $</span><span class="sf18b2">name) {</span></code></td>
<td class="ln">183</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">foreach</span><span class="sf3b2"> ($</span><span class="sf18b2">names </span><span class="sf7b2">as</span><span class="sf3b2"> $</span><span class="sf18b2">name) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">184</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">fields[$</span><span class="sf18b2">name] = </span><span class="sf10b2">1</span><span class="sf3b2">;</span></code></td>
<td class="ln">184</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">fields[$</span><span class="sf18b2">name] = </span><span class="sf10b2">1</span><span class="sf3b2">;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">185</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">185</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">186</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">fields[</span><span class="sf12b2">"state_province-{$this-&gt;_bltID}"</span><span class="sf3b2">] = </span><span class="sf10b2">1</span><span class="sf3b2">;</span></code></td>
<td class="ln">186</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">fields[</span><span class="sf12b2">"state_province-{$this-&gt;_bltID}"</span><span class="sf3b2">] = </span><span class="sf10b2">1</span><span class="sf3b2">;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">187</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">fields[</span><span class="sf12b2">"country-{$this-&gt;_bltID}"</span><span class="sf3b2">] = </span><span class="sf10b2">1</span><span class="sf3b2">;</span></code></td>
<td class="ln">187</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">fields[</span><span class="sf12b2">"country-{$this-&gt;_bltID}"</span><span class="sf3b2">] = </span><span class="sf10b2">1</span><span class="sf3b2">;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">188</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">fields[</span><span class="sf12b2">"email-{$this-&gt;_bltID}"</span><span class="sf3b2">] = </span><span class="sf10b2">1</span><span class="sf3b2">;</span></code></td>
<td class="ln">188</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">fields[</span><span class="sf12b2">"email-{$this-&gt;_bltID}"</span><span class="sf3b2">] = </span><span class="sf10b2">1</span><span class="sf3b2">;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">189</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">fields[</span><span class="sf12b2">'email-Primary'</span><span class="sf3b2">] = </span><span class="sf10b2">1</span><span class="sf3b2">;</span></code></td>
<td class="ln">189</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">fields[</span><span class="sf12b2">'email-Primary'</span><span class="sf3b2">] = </span><span class="sf10b2">1</span><span class="sf3b2">;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">190</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">190</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">191</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">CRM_Core_BAO_UFGroup::setProfileDefaults</span><span class="sf3b2">($</span><span class="sf18b2">contactID<wbr>, $</span><span class="sf18b2">fields, $</span><span class="sf18b2">this-&gt;_defaults);</span></code></td>
<td class="ln">191</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">CRM_Core_BAO_UFGroup::setProfileDefaults</span><span class="sf3b2">($</span><span class="sf18b2">contactID<wbr>, $</span><span class="sf18b2">fields, $</span><span class="sf18b2">this-&gt;_defaults);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">192</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">192</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">193</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">// use primary email address if billing email address is empty</span></code></td>
<td class="ln">193</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">// use primary email address if billing email address is empty</span></code></td>
</tr>
<tr valign="top">
<td class="ln">194</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf7b2">empty</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;_defaults[</span><span class="sf12b2">"email-{$this-&gt;_bltID}"</span><span class="sf3b2">]) &amp;&amp;</span></code></td>
<td class="ln">194</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf7b2">empty</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;_defaults[</span><span class="sf12b2">"email-{$this-&gt;_bltID}"</span><span class="sf3b2">]) &amp;&amp;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">195</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;!</span><span class="sf7b2">empty</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;_defaults[</span><span class="sf12b2">'email-Primary'</span><span class="sf3b2">])</span></code></td>
<td class="ln">195</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;!</span><span class="sf7b2">empty</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;_defaults[</span><span class="sf12b2">'email-Primary'</span><span class="sf3b2">])</span></code></td>
</tr>
<tr valign="top">
<td class="ln">196</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;) {</span></code></td>
<td class="ln">196</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">197</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_defaults[</span><span class="sf12b2">"email-{$this-&gt;_bltID}"</span><span class="sf3b2">] = $</span><span class="sf18b2">this-&gt;_defaults[</span><span class="sf12b2">'email-Primary'</span><span class="sf3b2">];</span></code></td>
<td class="ln">197</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_defaults[</span><span class="sf12b2">"email-{$this-&gt;_bltID}"</span><span class="sf3b2">] = $</span><span class="sf18b2">this-&gt;_defaults[</span><span class="sf12b2">'email-Primary'</span><span class="sf3b2">];</span></code></td>
</tr>
<tr valign="top">
<td class="ln">198</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">198</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">199</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">199</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">200</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">foreach</span><span class="sf3b2"> ($</span><span class="sf18b2">names </span><span class="sf7b2">as</span><span class="sf3b2"> $</span><span class="sf18b2">name) {</span></code></td>
<td class="ln">200</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">foreach</span><span class="sf3b2"> ($</span><span class="sf18b2">names </span><span class="sf7b2">as</span><span class="sf3b2"> $</span><span class="sf18b2">name) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">201</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf7b2">isset</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;_defaults[$</span><span class="sf18b2">name])) {</span></code></td>
<td class="ln">201</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf7b2">isset</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;_defaults[$</span><span class="sf18b2">name])) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">202</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_defaults[</span><span class="sf12b2">'billing_'</span><span class="sf3b2"> . $</span><span class="sf18b2">name] = $</span><span class="sf18b2">this-&gt;_defaults[$</span><span class="sf18b2">name];</span></code></td>
<td class="ln">202</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_defaults[</span><span class="sf12b2">'billing_'</span><span class="sf3b2"> . $</span><span class="sf18b2">name] = $</span><span class="sf18b2">this-&gt;_defaults[$</span><span class="sf18b2">name];</span></code></td>
</tr>
<tr valign="top">
<td class="ln">203</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">203</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">204</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">204</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">205</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">205</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">206</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">//if event is monetary and pay later is enabled and payment</span></code></td>
<td class="ln">206</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">//if event is monetary and pay later is enabled and payment</span></code></td>
</tr>
<tr valign="top">
<td class="ln">207</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">//processor is not available then freeze the pay later checkbox with</span></code></td>
<td class="ln">207</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">//processor is not available then freeze the pay later checkbox with</span></code></td>
</tr>
<tr valign="top">
<td class="ln">208</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">//default check</span></code></td>
<td class="ln">208</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">//default check</span></code></td>
</tr>
<tr valign="top">
<td class="ln">209</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'is_pay_later'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">]) &amp;&amp;</span></code></td>
<td class="ln">209</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'is_pay_later'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">]) &amp;&amp;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">210</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;!</span><span class="sf8b2">is_array</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;_paymentProcessor)</span></code></td>
<td class="ln">210</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;!</span><span class="sf8b2">is_array</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;_paymentProcessor)</span></code></td>
</tr>
<tr valign="top">
<td class="ln">211</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;) {</span></code></td>
<td class="ln">211</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">212</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_defaults[</span><span class="sf12b2">'is_pay_later'</span><span class="sf3b2">] = 1;</span></code></td>
<td class="ln">212</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_defaults[</span><span class="sf12b2">'is_pay_later'</span><span class="sf3b2">] = 1;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">213</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">213</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">214</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">214</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">215</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">//set custom field defaults</span></code></td>
<td class="ln">215</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">//set custom field defaults</span></code></td>
</tr>
<tr valign="top">
<td class="ln">216</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!</span><span class="sf7b2">empty</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;_fields)) {</span></code></td>
<td class="ln">216</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!</span><span class="sf7b2">empty</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;_fields)) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">217</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">//load default campaign from page.</span></code></td>
<td class="ln">217</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">//load default campaign from page.</span></code></td>
</tr>
<tr valign="top">
<td class="ln">218</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">array_key_exists</span><span class="sf3b2">(</span><span class="sf12b2">'participant_campaign_id'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_fields)) {</span></code></td>
<td class="ln">218</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">array_key_exists</span><span class="sf3b2">(</span><span class="sf12b2">'participant_campaign_id'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_fields)) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">219</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_defaults[</span><span class="sf12b2">'participant_campaign_id'</span><span class="sf3b2">] = CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'campaign_id'</span><span class="sf3b2">,</span></code></td>
<td class="ln">219</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_defaults[</span><span class="sf12b2">'participant_campaign_id'</span><span class="sf3b2">] = CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'campaign_id'</span><span class="sf3b2">,</span></code></td>
</tr>
<tr valign="top">
<td class="ln">220</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">]</span></code></td>
<td class="ln">220</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">]</span></code></td>
</tr>
<tr valign="top">
<td class="ln">221</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;);</span></code></td>
<td class="ln">221</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">222</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">222</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">223</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">223</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">224</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">foreach</span><span class="sf3b2"> ($</span><span class="sf18b2">this-&gt;_fields as $</span><span class="sf18b2">name =&gt; $</span><span class="sf18b2">field) {</span></code></td>
<td class="ln">224</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">foreach</span><span class="sf3b2"> ($</span><span class="sf18b2">this-&gt;_fields as $</span><span class="sf18b2">name =&gt; $</span><span class="sf18b2">field) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">225</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">customFieldID = </span><span class="sf8b2">CRM_Core_BAO_CustomField::getKeyID</span><span class="sf3b2">($</span><span class="sf18b2">name)) {</span></code></td>
<td class="ln">225</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">customFieldID = </span><span class="sf8b2">CRM_Core_BAO_CustomField::getKeyID</span><span class="sf3b2">($</span><span class="sf18b2">name)) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">226</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">// fix for CRM-1743</span></code></td>
<td class="ln">226</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">// fix for CRM-1743</span></code></td>
</tr>
<tr valign="top">
<td class="ln">227</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!</span><span class="sf7b2">isset</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;_defaults[$</span><span class="sf18b2">name])) {</span></code></td>
<td class="ln">227</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!</span><span class="sf7b2">isset</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;_defaults[$</span><span class="sf18b2">name])) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">228</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">CRM_Core_BAO_CustomField::setProfileDefaults</span><span class="sf3b2">($</span><span class="sf18b2">custo<wbr>mFieldID, $</span><span class="sf18b2">name, $</span><span class="sf18b2">this-&gt;_defaults,</span></code></td>
<td class="ln">228</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">CRM_Core_BAO_CustomField::setProfileDefaults</span><span class="sf3b2">($</span><span class="sf18b2">custo<wbr>mFieldID, $</span><span class="sf18b2">name, $</span><span class="sf18b2">this-&gt;_defaults,</span></code></td>
</tr>
<tr valign="top">
<td class="ln">229</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;NULL, CRM_Profile_Form::MODE_REGISTER</span></code></td>
<td class="ln">229</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;NULL, CRM_Profile_Form::MODE_REGISTER</span></code></td>
</tr>
<tr valign="top">
<td class="ln">230</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;);</span></code></td>
<td class="ln">230</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">231</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">231</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">232</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">232</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">233</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">233</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">234</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">234</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">235</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">235</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">236</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">//fix for CRM-3088, default value for discount set.</span></code></td>
<td class="ln">236</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">//fix for CRM-3088, default value for discount set.</span></code></td>
</tr>
<tr valign="top">
<td class="ln">237</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">discountId = NULL;</span></code></td>
<td class="ln">237</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">discountId = NULL;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">238</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!</span><span class="sf7b2">empty</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'discount'</span><span class="sf3b2">])) {</span></code></td>
<td class="ln">238</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!</span><span class="sf7b2">empty</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'discount'</span><span class="sf3b2">])) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">239</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">discountId = </span><span class="sf8b2">CRM_Core_BAO_Discount::findSet</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;_eventId, </span><span class="sf12b2">'civicrm_event'</span><span class="sf3b2">);</span></code></td>
<td class="ln">239</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">discountId = </span><span class="sf8b2">CRM_Core_BAO_Discount::findSet</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;_eventId, </span><span class="sf12b2">'civicrm_event'</span><span class="sf3b2">);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">240</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">discountId) {</span></code></td>
<td class="ln">240</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">discountId) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">241</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf7b2">isset</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">][</span><span class="sf12b2">'default_discount_fe<wbr>e_id'</span><span class="sf3b2">])) {</span></code></td>
<td class="ln">241</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf7b2">isset</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">][</span><span class="sf12b2">'default_discount_fe<wbr>e_id'</span><span class="sf3b2">])) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">242</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">discountKey = </span><span class="sf8b2">CRM_Core_DAO::getFieldValue</span><span class="sf3b2">(</span><span class="sf12b2">'CRM_Core_DAO_OptionVal<wbr>ue'</span><span class="sf3b2">,</span></code></td>
<td class="ln">242</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">discountKey = </span><span class="sf8b2">CRM_Core_DAO::getFieldValue</span><span class="sf3b2">(</span><span class="sf12b2">'CRM_Core_DAO_OptionVal<wbr>ue'</span><span class="sf3b2">,</span></code></td>
</tr>
<tr valign="top">
<td class="ln">243</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">][</span><span class="sf12b2">'default_discount_fee_id'</span><span class="sf3b2">],<wbr></span></code></td>
<td class="ln">243</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">][</span><span class="sf12b2">'default_discount_fee_id'</span><span class="sf3b2">],<wbr></span></code></td>
</tr>
<tr valign="top">
<td class="ln">244</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'weight'</span><span class="sf3b2">, </span><span class="sf12b2">'id'</span>&nbsp;</code></td>
<td class="ln">244</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'weight'</span><span class="sf3b2">, </span><span class="sf12b2">'id'</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">245</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;);</span></code></td>
<td class="ln">245</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">246</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">246</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">247</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_defaults[</span><span class="sf12b2">'amount'</span><span class="sf3b2">] = key</span><span class="sf3b2">(</span><span class="sf8b2">array_slice</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'discount'</span><span class="sf3b2">][$</span><span class="sf18b2">discoun<wbr>tId],</span></code></td>
<td class="ln">247</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_defaults[</span><span class="sf12b2">'amount'</span><span class="sf3b2">] = key</span><span class="sf3b2">(</span><span class="sf8b2">array_slice</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'discount'</span><span class="sf3b2">][$</span><span class="sf18b2">discoun<wbr>tId],</span></code></td>
</tr>
<tr valign="top">
<td class="ln">248</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">discountKey - </span><span class="sf10b2">1</span><span class="sf3b2">, $</span><span class="sf18b2">discountKey, TRUE</span></code></td>
<td class="ln">248</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">discountKey - </span><span class="sf10b2">1</span><span class="sf3b2">, $</span><span class="sf18b2">discountKey, TRUE</span></code></td>
</tr>
<tr valign="top">
<td class="ln">249</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;));</span></code></td>
<td class="ln">249</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;));</span></code></td>
</tr>
<tr valign="top">
<td class="ln">250</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">250</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">251</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">251</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">252</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">252</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">253</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">253</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">254</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">config = </span><span class="sf8b2">CRM_Core_Config::singleton</span><span class="sf3b2">();</span></code></td>
<td class="ln">254</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">config = </span><span class="sf8b2">CRM_Core_Config::singleton</span><span class="sf3b2">();</span></code></td>
</tr>
<tr valign="top">
<td class="ln">255</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// set default country from config if no country set</span></code></td>
<td class="ln">255</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// set default country from config if no country set</span></code></td>
</tr>
<tr valign="top">
<td class="ln">256</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">"billing_country_id-{$this<wbr>-&gt;_bltID}"</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_defaults)) {</span></code></td>
<td class="ln">256</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">"billing_country_id-{$this<wbr>-&gt;_bltID}"</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_defaults)) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">257</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_defaults[</span><span class="sf12b2">"billing_country_id-{$this-&gt;_bltID<wbr>}"</span><span class="sf3b2">] = $</span><span class="sf18b2">config-&gt;defaultContactCountry;</span></code></td>
<td class="ln">257</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_defaults[</span><span class="sf12b2">"billing_country_id-{$this-&gt;_bltID<wbr>}"</span><span class="sf3b2">] = $</span><span class="sf18b2">config-&gt;defaultContactCountry;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">258</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">258</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">259</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">259</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">260</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// now fix all state country selectors</span></code></td>
<td class="ln">260</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// now fix all state country selectors</span></code></td>
</tr>
<tr valign="top">
<td class="ln">261</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf8b2">CRM_Core_BAO_Address::fixAllStateSelects</span><span class="sf3b2">($</span><span class="sf18b2">this, $</span><span class="sf18b2">this-&gt;_defaults);</span></code></td>
<td class="ln">261</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf8b2">CRM_Core_BAO_Address::fixAllStateSelects</span><span class="sf3b2">($</span><span class="sf18b2">this, $</span><span class="sf18b2">this-&gt;_defaults);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">262</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">262</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">263</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// add this event's default participant role to defaults array</span></code></td>
<td class="ln">263</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// add this event's default participant role to defaults array</span></code></td>
</tr>
<tr valign="top">
<td class="ln">264</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// (for cases where participant_role field is included in form via profile)</span></code></td>
<td class="ln">264</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// (for cases where participant_role field is included in form via profile)</span></code></td>
</tr>
<tr valign="top">
<td class="ln">265</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">][</span><span class="sf12b2">'default_role_id'</span><span class="sf3b2">]) {</span></code></td>
<td class="ln">265</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">][</span><span class="sf12b2">'default_role_id'</span><span class="sf3b2">]) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">266</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_defaults[</span><span class="sf12b2">'participant_role'</span><span class="sf3b2">] = $</span><span class="sf18b2">this-&gt;_defaults[</span><span class="sf12b2">'participant_role_id'</span><span class="sf3b2">] = $</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">][</span><span class="sf12b2">'default_role_id'</span><span class="sf3b2">];</span></code></td>
<td class="ln">266</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_defaults[</span><span class="sf12b2">'participant_role'</span><span class="sf3b2">] = $</span><span class="sf18b2">this-&gt;_defaults[</span><span class="sf12b2">'participant_role_id'</span><span class="sf3b2">] = $</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">][</span><span class="sf12b2">'default_role_id'</span><span class="sf3b2">];</span></code></td>
</tr>
<tr valign="top">
<td class="ln">267</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">267</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">268</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">this-&gt;_priceSetId) {</span></code></td>
<td class="ln">268</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">this-&gt;_priceSetId) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">269</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">foreach</span><span class="sf3b2"> ($</span><span class="sf18b2">this-&gt;_feeBlock as $</span><span class="sf18b2">key =&gt; $</span><span class="sf18b2">val) {</span></code></td>
<td class="ln">269</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">foreach</span><span class="sf3b2"> ($</span><span class="sf18b2">this-&gt;_feeBlock as $</span><span class="sf18b2">key =&gt; $</span><span class="sf18b2">val) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">270</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">foreach</span><span class="sf3b2"> ($</span><span class="sf18b2">val[</span><span class="sf12b2">'options'</span><span class="sf3b2">] </span><span class="sf7b2">as</span><span class="sf3b2"> $</span><span class="sf18b2">keys =&gt; $</span><span class="sf18b2">values) {</span></code></td>
<td class="ln">270</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">foreach</span><span class="sf3b2"> ($</span><span class="sf18b2">val[</span><span class="sf12b2">'options'</span><span class="sf3b2">] </span><span class="sf7b2">as</span><span class="sf3b2"> $</span><span class="sf18b2">keys =&gt; $</span><span class="sf18b2">values) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">271</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">values[</span><span class="sf12b2">'is_default'</span><span class="sf3b2">] &amp;&amp;</span></code></td>
<td class="ln">271</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">values[</span><span class="sf12b2">'is_default'</span><span class="sf3b2">] &amp;&amp;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">272</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;!</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'is_full'</span><span class="sf3b2">, $</span><span class="sf18b2">values)</span></code></td>
<td class="ln">272</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;!</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'is_full'</span><span class="sf3b2">, $</span><span class="sf18b2">values)</span></code></td>
</tr>
<tr valign="top">
<td class="ln">273</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;) {</span></code></td>
<td class="ln">273</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">274</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">274</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">275</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">val[</span><span class="sf12b2">'html_type'</span><span class="sf3b2">] == </span><span class="sf12b2">'CheckBox'</span><span class="sf3b2">) {</span></code></td>
<td class="ln">275</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">val[</span><span class="sf12b2">'html_type'</span><span class="sf3b2">] == </span><span class="sf12b2">'CheckBox'</span><span class="sf3b2">) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">276</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_defaults[</span><span class="sf12b2">"price_{$key}"</span><span class="sf3b2">][$</span><span class="sf18b2">keys] = </span><span class="sf10b2">1</span><span class="sf3b2">;</span></code></td>
<td class="ln">276</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_defaults[</span><span class="sf12b2">"price_{$key}"</span><span class="sf3b2">][$</span><span class="sf18b2">keys] = </span><span class="sf10b2">1</span><span class="sf3b2">;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">277</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">277</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">278</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">else</span><span class="sf3b2"> {</span></code></td>
<td class="ln">278</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">else</span><span class="sf3b2"> {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">279</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_defaults[</span><span class="sf12b2">"price_{$key}"</span><span class="sf3b2">] = $</span><span class="sf18b2">keys;</span></code></td>
<td class="ln">279</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_defaults[</span><span class="sf12b2">"price_{$key}"</span><span class="sf3b2">] = $</span><span class="sf18b2">keys;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">280</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">280</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">281</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">281</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">282</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">282</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">283</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">283</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">284</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">284</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">285</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">285</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">286</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">//set default participant fields, CRM-4320.</span></code></td>
<td class="ln">286</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">//set default participant fields, CRM-4320.</span></code></td>
</tr>
<tr valign="top">
<td class="ln">287</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">hasAdditionalParticipants = FALSE;</span></code></td>
<td class="ln">287</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">hasAdditionalParticipants = FALSE;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">288</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">this-&gt;_allowConfirmation) {</span></code></td>
<td class="ln">288</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">this-&gt;_allowConfirmation) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">289</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_contactId = $</span><span class="sf18b2">contactID;</span></code></td>
<td class="ln">289</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_contactId = $</span><span class="sf18b2">contactID;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">290</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_discountId = $</span><span class="sf18b2">discountId;</span></code></td>
<td class="ln">290</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_discountId = $</span><span class="sf18b2">discountId;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">291</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">forcePayLater = </span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'is_pay_later'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_defaults, FALSE);</span></code></td>
<td class="ln">291</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">forcePayLater = </span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'is_pay_later'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_defaults, FALSE);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">292</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">_defaults = array_merge</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">_defaults, CRM_Event_Form_EventFees::setDefaultValues</span><span class="sf3b2">($</span><span class="sf18b2">this));<wbr></span></code></td>
<td class="ln">292</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">_defaults = array_merge</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">_defaults, CRM_Event_Form_EventFees::setDefaultValues</span><span class="sf3b2">($</span><span class="sf18b2">this));<wbr></span></code></td>
</tr>
<tr valign="top">
<td class="ln">293</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_defaults[</span><span class="sf12b2">'is_pay_later'</span><span class="sf3b2">] = $</span><span class="sf18b2">forcePayLater;</span></code></td>
<td class="ln">293</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_defaults[</span><span class="sf12b2">'is_pay_later'</span><span class="sf3b2">] = $</span><span class="sf18b2">forcePayLater;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">294</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">294</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">295</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">this-&gt;_additionalParticipantIds) {</span></code></td>
<td class="ln">295</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">this-&gt;_additionalParticipantIds) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">296</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">hasAdditionalParticipants = TRUE;</span></code></td>
<td class="ln">296</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">hasAdditionalParticipants = TRUE;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">297</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_defaults[</span><span class="sf12b2">'additional_participants'</span><span class="sf3b2">] = count</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;_additionalParticipantIds);</span></code></td>
<td class="ln">297</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_defaults[</span><span class="sf12b2">'additional_participants'</span><span class="sf3b2">] = count</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;_additionalParticipantIds);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">298</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">298</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">299</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">299</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">300</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">assign</span><span class="sf3b2">(</span><span class="sf12b2">'hasAdditionalParticipants'</span><span class="sf3b2">, $</span><span class="sf18b2">hasAdditionalParticipants);</span></code></td>
<td class="ln">300</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">assign</span><span class="sf3b2">(</span><span class="sf12b2">'hasAdditionalParticipants'</span><span class="sf3b2">, $</span><span class="sf18b2">hasAdditionalParticipants);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">301</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">301</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">302</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// &nbsp; &nbsp; &nbsp; &nbsp; //hack to simplify credit card entry for testing</span></code></td>
<td class="ln">302</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// &nbsp; &nbsp; &nbsp; &nbsp; //hack to simplify credit card entry for testing</span></code></td>
</tr>
<tr valign="top">
<td class="ln">303</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// &nbsp; &nbsp; &nbsp; &nbsp; $this-&gt;_defaults['credit_card_type'] &nbsp; &nbsp; = 'Visa';</span></code></td>
<td class="ln">303</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// &nbsp; &nbsp; &nbsp; &nbsp; $this-&gt;_defaults['credit_card_type'] &nbsp; &nbsp; = 'Visa';</span></code></td>
</tr>
<tr valign="top">
<td class="ln">304</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// &nbsp; &nbsp; &nbsp; &nbsp; $this-&gt;_defaults['credit_card_number'] &nbsp; = '4807731747657838';</span></code></td>
<td class="ln">304</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// &nbsp; &nbsp; &nbsp; &nbsp; $this-&gt;_defaults['credit_card_number'] &nbsp; = '4807731747657838';</span></code></td>
</tr>
<tr valign="top">
<td class="ln">305</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// &nbsp; &nbsp; &nbsp; &nbsp; $this-&gt;_defaults['cvv2'] &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; = '000';</span></code></td>
<td class="ln">305</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// &nbsp; &nbsp; &nbsp; &nbsp; $this-&gt;_defaults['cvv2'] &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; = '000';</span></code></td>
</tr>
<tr valign="top">
<td class="ln">306</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// &nbsp; &nbsp; &nbsp; &nbsp; $this-&gt;_defaults['credit_card_exp_date'] = array( 'Y' =&gt; '2010', 'M' =&gt; '05' );</span></code></td>
<td class="ln">306</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// &nbsp; &nbsp; &nbsp; &nbsp; $this-&gt;_defaults['credit_card_exp_date'] = array( 'Y' =&gt; '2010', 'M' =&gt; '05' );</span></code></td>
</tr>
<tr valign="top">
<td class="ln">307</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">307</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">308</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// to process Custom data that are appended to URL</span></code></td>
<td class="ln">308</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// to process Custom data that are appended to URL</span></code></td>
</tr>
<tr valign="top">
<td class="ln">309</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">getDefaults = </span><span class="sf8b2">CRM_Core_BAO_CustomGroup::extractGetParams</span><span class="sf3b2">($</span><span class="sf18b2">this, </span><span class="sf12b2">"'Contact', 'Individual', 'Contribution', 'Participant'"</span><span class="sf3b2">);</span></code></td>
<td class="ln">309</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">getDefaults = </span><span class="sf8b2">CRM_Core_BAO_CustomGroup::extractGetParams</span><span class="sf3b2">($</span><span class="sf18b2">this, </span><span class="sf12b2">"'Contact', 'Individual', 'Contribution', 'Participant'"</span><span class="sf3b2">);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">310</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!</span><span class="sf7b2">empty</span><span class="sf3b2">($</span><span class="sf18b2">getDefaults)) {</span></code></td>
<td class="ln">310</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!</span><span class="sf7b2">empty</span><span class="sf3b2">($</span><span class="sf18b2">getDefaults)) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">311</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">_defaults = array_merge</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;_defaults, $</span><span class="sf18b2">getDefaults);</span></code></td>
<td class="ln">311</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">_defaults = array_merge</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;_defaults, $</span><span class="sf18b2">getDefaults);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">312</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">312</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">313</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">313</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">314</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">return</span><span class="sf3b2"> $</span><span class="sf18b2">this-&gt;_defaults;</span></code></td>
<td class="ln">314</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">return</span><span class="sf3b2"> $</span><span class="sf18b2">this-&gt;_defaults;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">315</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;}</span></code></td>
<td class="ln">315</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">316</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">316</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">317</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf9b2">/**</span></code></td>
<td class="ln">317</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf9b2">/**</span></code></td>
</tr>
<tr valign="top">
<td class="ln">318</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * Function to build the form</span></code></td>
<td class="ln">318</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * Function to build the form</span></code></td>
</tr>
<tr valign="top">
<td class="ln">319</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; *</span></code></td>
<td class="ln">319</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; *</span></code></td>
</tr>
<tr valign="top">
<td class="ln">320</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @return None</span></code></td>
<td class="ln">320</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @return None</span></code></td>
</tr>
<tr valign="top">
<td class="ln">321</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @access public</span></code></td>
<td class="ln">321</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @access public</span></code></td>
</tr>
<tr valign="top">
<td class="ln">322</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; */</span>&nbsp;</code></td>
<td class="ln">322</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; */</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">323</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf8b2">public function buildQuickForm</span><span class="sf3b2">() {</span></code></td>
<td class="ln">323</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf8b2">public function buildQuickForm</span><span class="sf3b2">() {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">324</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">this-&gt;_ppType) {</span></code></td>
<td class="ln">324</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">this-&gt;_ppType) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">325</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp;</span><span class="sf17b16">return</span><span class="sf17b16"> </span><span class="sf17b16">CRM_Core_Payment_ProcessorForm::buildQuickForm</span><span class="sf17b16">($</span><span class="sf17b16">thi<wbr>s);</span>&nbsp;</code></td>
<td class="ln">325</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp;</span><span class="sf17b16">$</span><span class="sf17b16">this-&gt;</span><span class="sf17b16">assign</span><span class="sf17b16">(</span><span class="sf17b16">'display_name'</span><span class="sf17b16">, $</span><span class="sf17b16">display_name);</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">326</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp;</span><span class="sf17b16">CRM_Core_Payment_ProcessorForm::buildQuickForm</span><span class="sf17b16">($</span><span class="sf17b16">thi<wbr>s);
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">327</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp;</span><span class="sf17b16">return</span><span class="sf17b16">;
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">326</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">328</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">327</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">329</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">328</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">contactID = </span><span class="sf8b2">parent::getContactID</span><span class="sf3b2">();</span></code></td>
<td class="ln">330</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">contactID = </span><span class="sf8b2">parent::getContactID</span><span class="sf3b2">();</span></code></td>
</tr>
<tr valign="top">
<td class="ln">329</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">assign</span><span class="sf3b2">(</span><span class="sf12b2">'contact_id'</span><span class="sf3b2">, $</span><span class="sf18b2">contactID);</span></code></td>
<td class="ln">331</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">assign</span><span class="sf3b2">(</span><span class="sf12b2">'contact_id'</span><span class="sf3b2">, $</span><span class="sf18b2">contactID);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">330</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">display_name = </span><span class="sf12b2">''</span><span class="sf3b2">;</span></code></td>
<td class="ln">332</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">display_name = </span><span class="sf12b2">''</span><span class="sf3b2">;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">331</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">contactID) {</span></code></td>
<td class="ln">333</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">contactID) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">332</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">display_name = </span><span class="sf8b2">CRM_Contact_BAO_Contact::displayName</span><span class="sf3b2">($</span><span class="sf18b2">contactID);</span></code></td>
<td class="ln">334</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">display_name = </span><span class="sf8b2">CRM_Contact_BAO_Contact::displayName</span><span class="sf3b2">($</span><span class="sf18b2">contactID);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">333</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">335</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">334</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">assign</span><span class="sf3b2">(</span><span class="sf12b2">'display_name'</span><span class="sf3b2">, $</span><span class="sf18b2">display_name);</span></code></td>
<td class="ln">336</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">assign</span><span class="sf3b2">(</span><span class="sf12b2">'display_name'</span><span class="sf3b2">, $</span><span class="sf18b2">display_name);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">335</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">337</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">336</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">config = </span><span class="sf8b2">CRM_Core_Config::singleton</span><span class="sf3b2">();</span></code></td>
<td class="ln">338</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">config = </span><span class="sf8b2">CRM_Core_Config::singleton</span><span class="sf3b2">();</span></code></td>
</tr>
<tr valign="top">
<td class="ln">337</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">add</span><span class="sf3b2">(</span><span class="sf12b2">'hidden'</span><span class="sf3b2">, </span><span class="sf12b2">'scriptFee'</span><span class="sf3b2">, NULL);</span></code></td>
<td class="ln">339</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">add</span><span class="sf3b2">(</span><span class="sf12b2">'hidden'</span><span class="sf3b2">, </span><span class="sf12b2">'scriptFee'</span><span class="sf3b2">, NULL);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">338</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">add</span><span class="sf3b2">(</span><span class="sf12b2">'hidden'</span><span class="sf3b2">, </span><span class="sf12b2">'scriptArray'</span><span class="sf3b2">, NULL);</span></code></td>
<td class="ln">340</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">add</span><span class="sf3b2">(</span><span class="sf12b2">'hidden'</span><span class="sf3b2">, </span><span class="sf12b2">'scriptArray'</span><span class="sf3b2">, NULL);</span></code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">341</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp;
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">342</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp;$</span><span class="sf17b16">allowGroupOnWaitlist = $</span><span class="sf17b16">isAdditionalParticipants = FALSE;
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">339</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">343</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">340</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp;</span><span class="sf17b16">$</span><span class="sf17b16">bypassPayment</span><span style="color: #000000; background-color: #efcb05; "> = </span><span class="sf17b16">$</span><span class="sf17b16">allowGroupOnWaitlist = $</span><span class="sf17b16">isAdditionalParticipants =</span><span style="color: #000000; background-color: #efcb05; "> FALSE;</span></code></td>
<td class="ln">344</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp;</span><span class="sf17b16">$</span><span class="sf17b16">this-&gt;_bypassPayment</span><span style="color: #000000; background-color: #efcb05; "> = </span><span style="color: #000000; background-color: #efcb05; ">FALSE;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">341</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">][</span><span class="sf12b2">'is_multiple_registrations<wbr>'</span><span class="sf3b2">]) {</span></code></td>
<td class="ln">345</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">][</span><span class="sf12b2">'is_multiple_registrations<wbr>'</span><span class="sf3b2">]) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">342</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">// don't allow to add additional during confirmation if not preregistered.</span></code></td>
<td class="ln">346</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">// don't allow to add additional during confirmation if not preregistered.</span></code></td>
</tr>
<tr valign="top">
<td class="ln">343</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!$</span><span class="sf18b2">this-&gt;_allowConfirmation || $</span><span class="sf18b2">this-&gt;_additionalParticipantIds) {</span></code></td>
<td class="ln">347</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!$</span><span class="sf18b2">this-&gt;_allowConfirmation || $</span><span class="sf18b2">this-&gt;_additionalParticipantIds) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">344</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">// Hardcode maximum number of additional participants here for now. May need to make this configurable per event.</span></code></td>
<td class="ln">348</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">// Hardcode maximum number of additional participants here for now. May need to make this configurable per event.</span></code></td>
</tr>
<tr valign="top">
<td class="ln">345</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">// Label is value + 1, since the code sees this is ADDITIONAL participants (in addition to "self")</span></code></td>
<td class="ln">349</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">// Label is value + 1, since the code sees this is ADDITIONAL participants (in addition to "self")</span></code></td>
</tr>
<tr valign="top">
<td class="ln">346</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">additionalOptions = </span><span class="sf7b2">array</span><span class="sf3b2">(</span><span class="sf12b2">''</span><span class="sf3b2"> =&gt; </span><span class="sf8b2">ts</span><span class="sf3b2">(</span><span class="sf12b2">'1'</span><span class="sf3b2">), </span><span class="sf10b2">1</span><span class="sf3b2"> =&gt; </span><span class="sf8b2">ts</span><span class="sf3b2">(</span><span class="sf12b2">'2'</span><span class="sf3b2">), </span><span class="sf10b2">2</span><span class="sf3b2"> =&gt; </span><span class="sf8b2">ts</span><span class="sf3b2">(</span><span class="sf12b2">'3'</span><span class="sf3b2">), </span><span class="sf10b2">3</span><span class="sf3b2"> =&gt; </span><span class="sf8b2">ts</span><span class="sf3b2">(</span><span class="sf12b2">'4'</span><span class="sf3b2">), </span><span class="sf10b2">4</span><span class="sf3b2"> =&gt; </span><span class="sf8b2">ts</span><span class="sf3b2">(</span><span class="sf12b2">'5'</span><span class="sf3b2">),</span></code></td>
<td class="ln">350</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">additionalOptions = </span><span class="sf7b2">array</span><span class="sf3b2">(</span><span class="sf12b2">''</span><span class="sf3b2"> =&gt; </span><span class="sf8b2">ts</span><span class="sf3b2">(</span><span class="sf12b2">'1'</span><span class="sf3b2">), </span><span class="sf10b2">1</span><span class="sf3b2"> =&gt; </span><span class="sf8b2">ts</span><span class="sf3b2">(</span><span class="sf12b2">'2'</span><span class="sf3b2">), </span><span class="sf10b2">2</span><span class="sf3b2"> =&gt; </span><span class="sf8b2">ts</span><span class="sf3b2">(</span><span class="sf12b2">'3'</span><span class="sf3b2">), </span><span class="sf10b2">3</span><span class="sf3b2"> =&gt; </span><span class="sf8b2">ts</span><span class="sf3b2">(</span><span class="sf12b2">'4'</span><span class="sf3b2">), </span><span class="sf10b2">4</span><span class="sf3b2"> =&gt; </span><span class="sf8b2">ts</span><span class="sf3b2">(</span><span class="sf12b2">'5'</span><span class="sf3b2">),</span></code></td>
</tr>
<tr valign="top">
<td class="ln">347</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf10b2">5</span><span class="sf3b2"> =&gt; </span><span class="sf8b2">ts</span><span class="sf3b2">(</span><span class="sf12b2">'6'</span><span class="sf3b2">), </span><span class="sf10b2">6</span><span class="sf3b2"> =&gt; </span><span class="sf8b2">ts</span><span class="sf3b2">(</span><span class="sf12b2">'7'</span><span class="sf3b2">), </span><span class="sf10b2">7</span><span class="sf3b2"> =&gt; </span><span class="sf8b2">ts</span><span class="sf3b2">(</span><span class="sf12b2">'8'</span><span class="sf3b2">), </span><span class="sf10b2">8</span><span class="sf3b2"> =&gt; </span><span class="sf8b2">ts</span><span class="sf3b2">(</span><span class="sf12b2">'9'</span><span class="sf3b2">), </span><span class="sf10b2">9</span><span class="sf3b2"> =&gt; </span><span class="sf8b2">ts</span><span class="sf3b2">(</span><span class="sf12b2">'10'</span><span class="sf3b2">),</span></code></td>
<td class="ln">351</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf10b2">5</span><span class="sf3b2"> =&gt; </span><span class="sf8b2">ts</span><span class="sf3b2">(</span><span class="sf12b2">'6'</span><span class="sf3b2">), </span><span class="sf10b2">6</span><span class="sf3b2"> =&gt; </span><span class="sf8b2">ts</span><span class="sf3b2">(</span><span class="sf12b2">'7'</span><span class="sf3b2">), </span><span class="sf10b2">7</span><span class="sf3b2"> =&gt; </span><span class="sf8b2">ts</span><span class="sf3b2">(</span><span class="sf12b2">'8'</span><span class="sf3b2">), </span><span class="sf10b2">8</span><span class="sf3b2"> =&gt; </span><span class="sf8b2">ts</span><span class="sf3b2">(</span><span class="sf12b2">'9'</span><span class="sf3b2">), </span><span class="sf10b2">9</span><span class="sf3b2"> =&gt; </span><span class="sf8b2">ts</span><span class="sf3b2">(</span><span class="sf12b2">'10'</span><span class="sf3b2">),</span></code></td>
</tr>
<tr valign="top">
<td class="ln">348</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;);</span></code></td>
<td class="ln">352</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">349</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">element = $</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">add</span><span class="sf3b2">(</span><span class="sf12b2">'select'</span><span class="sf3b2">, </span><span class="sf12b2">'additional_participants'</span><span class="sf3b2">,</span></code></td>
<td class="ln">353</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">element = $</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">add</span><span class="sf3b2">(</span><span class="sf12b2">'select'</span><span class="sf3b2">, </span><span class="sf12b2">'additional_participants'</span><span class="sf3b2">,</span></code></td>
</tr>
<tr valign="top">
<td class="ln">350</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">ts</span><span class="sf3b2">(</span><span class="sf12b2">'How many people are you registering?'</span><span class="sf3b2">),</span></code></td>
<td class="ln">354</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">ts</span><span class="sf3b2">(</span><span class="sf12b2">'How many people are you registering?'</span><span class="sf3b2">),</span></code></td>
</tr>
<tr valign="top">
<td class="ln">351</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">additionalOptions,</span></code></td>
<td class="ln">355</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">additionalOptions,</span></code></td>
</tr>
<tr valign="top">
<td class="ln">352</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;NULL,</span></code></td>
<td class="ln">356</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;NULL,</span></code></td>
</tr>
<tr valign="top">
<td class="ln">353</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">array</span><span class="sf3b2">(</span><span class="sf12b2">'onChange'</span><span class="sf3b2"> =&gt; </span><span class="sf12b2">"allowParticipant()"</span><span class="sf3b2">)</span></code></td>
<td class="ln">357</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">array</span><span class="sf3b2">(</span><span class="sf12b2">'onChange'</span><span class="sf3b2"> =&gt; </span><span class="sf12b2">"allowParticipant()"</span><span class="sf3b2">)</span></code></td>
</tr>
<tr valign="top">
<td class="ln">354</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;);</span></code></td>
<td class="ln">358</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">355</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">isAdditionalParticipants = TRUE;</span></code></td>
<td class="ln">359</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">isAdditionalParticipants = TRUE;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">356</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">360</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">357</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">361</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">358</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">362</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">359</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">//hack to allow group to register w/ waiting</span></code></td>
<td class="ln">363</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">//hack to allow group to register w/ waiting</span></code></td>
</tr>
<tr valign="top">
<td class="ln">360</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ((</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'is_multiple_registrations<wbr>'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">]) ||</span></code></td>
<td class="ln">364</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ((</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'is_multiple_registrations<wbr>'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">]) ||</span></code></td>
</tr>
<tr valign="top">
<td class="ln">361</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_priceSetId</span></code></td>
<td class="ln">365</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_priceSetId</span></code></td>
</tr>
<tr valign="top">
<td class="ln">362</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;) &amp;&amp;</span></code></td>
<td class="ln">366</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;) &amp;&amp;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">363</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;!$</span><span class="sf18b2">this-&gt;_allowConfirmation &amp;&amp;</span></code></td>
<td class="ln">367</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;!$</span><span class="sf18b2">this-&gt;_allowConfirmation &amp;&amp;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">364</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">is_numeric</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;_availableRegistrations)</span></code></td>
<td class="ln">368</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">is_numeric</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;_availableRegistrations)</span></code></td>
</tr>
<tr valign="top">
<td class="ln">365</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;&amp;&amp; </span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'has_waitlist'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">])</span></code></td>
<td class="ln">369</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;&amp;&amp; </span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'has_waitlist'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">])</span></code></td>
</tr>
<tr valign="top">
<td class="ln">366</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;) {</span></code></td>
<td class="ln">370</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">367</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp;</span><span class="sf17b16">$</span><span class="sf17b16">bypassPayment</span><span style="color: #000000; background-color: #efcb05; "> = TRUE;</span></code></td>
<td class="ln">371</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp;</span><span class="sf17b16">$</span><span class="sf17b16">this-&gt;_bypassPayment</span><span style="color: #000000; background-color: #efcb05; "> = TRUE;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">368</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">//case might be group become as a part of waitlist.</span></code></td>
<td class="ln">372</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">//case might be group become as a part of waitlist.</span></code></td>
</tr>
<tr valign="top">
<td class="ln">369</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">//If not waitlist then they require admin approve.</span></code></td>
<td class="ln">373</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">//If not waitlist then they require admin approve.</span></code></td>
</tr>
<tr valign="top">
<td class="ln">370</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">allowGroupOnWaitlist = TRUE;</span></code></td>
<td class="ln">374</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">allowGroupOnWaitlist = TRUE;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">371</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">_waitlistMsg = ts</span><span class="sf3b2">(</span><span class="sf12b2">"This event has only %1 space(s) left. If you continue and register more than %1 people (including yourself ), the whole group will be wait listed. Or, you can reduce the number of people you are registering to %1 to avoid being put on the waiting list."</span><span class="sf3b2">, </span><span class="sf7b2">array</span><span class="sf3b2">(</span><span class="sf10b2">1</span><span class="sf3b2"> =&gt; $</span><span class="sf18b2">this-&gt;_availableRegistrations));</span></code></td>
<td class="ln">375</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">_waitlistMsg = ts</span><span class="sf3b2">(</span><span class="sf12b2">"This event has only %1 space(s) left. If you continue and register more than %1 people (including yourself ), the whole group will be wait listed. Or, you can reduce the number of people you are registering to %1 to avoid being put on the waiting list."</span><span class="sf3b2">, </span><span class="sf7b2">array</span><span class="sf3b2">(</span><span class="sf10b2">1</span><span class="sf3b2"> =&gt; $</span><span class="sf18b2">this-&gt;_availableRegistrations));</span></code></td>
</tr>
<tr valign="top">
<td class="ln">372</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">376</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">373</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">this-&gt;_requireApproval) {</span></code></td>
<td class="ln">377</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">this-&gt;_requireApproval) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">374</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">_requireApprovalMsg = CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'approval_req_text'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">],</span></code></td>
<td class="ln">378</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">_requireApprovalMsg = CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'approval_req_text'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">],</span></code></td>
</tr>
<tr valign="top">
<td class="ln">375</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">ts</span><span class="sf3b2">(</span><span class="sf12b2">'Registration for this event requires approval. Once your registration(s) have been reviewed, you will receive an email with a link to a web page where you can complete the registration process.'</span><span class="sf3b2">)</span></code></td>
<td class="ln">379</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">ts</span><span class="sf3b2">(</span><span class="sf12b2">'Registration for this event requires approval. Once your registration(s) have been reviewed, you will receive an email with a link to a web page where you can complete the registration process.'</span><span class="sf3b2">)</span></code></td>
</tr>
<tr valign="top">
<td class="ln">376</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;);</span></code></td>
<td class="ln">380</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">377</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">381</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">378</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">382</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">379</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">383</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">380</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">//case where only approval needed - no waitlist.</span></code></td>
<td class="ln">384</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">//case where only approval needed - no waitlist.</span></code></td>
</tr>
<tr valign="top">
<td class="ln">381</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">this-&gt;_requireApproval &amp;&amp;</span></code></td>
<td class="ln">385</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">this-&gt;_requireApproval &amp;&amp;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">382</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp;!$</span><span style="color: #000000; background-color: #efcb05; ">this-&gt;_allowWaitlist &amp;&amp; </span><span class="sf17b16">!$bypassPayment</span>&nbsp;</code></td>
<td class="ln">386</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp;!$</span><span style="color: #000000; background-color: #efcb05; ">this-&gt;_allowWaitlist &amp;&amp; </span><span class="sf17b16">!$</span><span class="sf17b16">this-&gt;_bypassPayment</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">383</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;) {</span></code></td>
<td class="ln">387</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">384</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">_requireApprovalMsg = CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'approval_req_text'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">],</span></code></td>
<td class="ln">388</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">_requireApprovalMsg = CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'approval_req_text'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">],</span></code></td>
</tr>
<tr valign="top">
<td class="ln">385</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">ts</span><span class="sf3b2">(</span><span class="sf12b2">'Registration for this event requires approval. Once your registration has been reviewed, you will receive an email with a link to a web page where you can complete the registration process.'</span><span class="sf3b2">)</span></code></td>
<td class="ln">389</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">ts</span><span class="sf3b2">(</span><span class="sf12b2">'Registration for this event requires approval. Once your registration has been reviewed, you will receive an email with a link to a web page where you can complete the registration process.'</span><span class="sf3b2">)</span></code></td>
</tr>
<tr valign="top">
<td class="ln">386</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;);</span></code></td>
<td class="ln">390</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">387</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">391</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">388</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">392</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">389</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">//lets display status to primary page only.</span></code></td>
<td class="ln">393</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">//lets display status to primary page only.</span></code></td>
</tr>
<tr valign="top">
<td class="ln">390</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">assign</span><span class="sf3b2">(</span><span class="sf12b2">'waitlistMsg'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_waitlistMsg);</span></code></td>
<td class="ln">394</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">assign</span><span class="sf3b2">(</span><span class="sf12b2">'waitlistMsg'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_waitlistMsg);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">391</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">assign</span><span class="sf3b2">(</span><span class="sf12b2">'requireApprovalMsg'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_requireApprovalMsg);</span></code></td>
<td class="ln">395</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">assign</span><span class="sf3b2">(</span><span class="sf12b2">'requireApprovalMsg'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_requireApprovalMsg);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">392</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">assign</span><span class="sf3b2">(</span><span class="sf12b2">'allowGroupOnWaitlist'</span><span class="sf3b2">, $</span><span class="sf18b2">allowGroupOnWaitlist);</span></code></td>
<td class="ln">396</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">assign</span><span class="sf3b2">(</span><span class="sf12b2">'allowGroupOnWaitlist'</span><span class="sf3b2">, $</span><span class="sf18b2">allowGroupOnWaitlist);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">393</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">assign</span><span class="sf3b2">(</span><span class="sf12b2">'isAdditionalParticipants'</span><span class="sf3b2">, $</span><span class="sf18b2">isAdditionalParticipants);</span></code></td>
<td class="ln">397</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">assign</span><span class="sf3b2">(</span><span class="sf12b2">'isAdditionalParticipants'</span><span class="sf3b2">, $</span><span class="sf18b2">isAdditionalParticipants);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">394</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">398</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">395</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">buildCustom</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'custom_pre_id'</span><span class="sf3b2">],<wbr> </span><span class="sf12b2">'customPre'</span><span class="sf3b2">);</span></code></td>
<td class="ln">399</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">buildCustom</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'custom_pre_id'</span><span class="sf3b2">],<wbr> </span><span class="sf12b2">'customPre'</span><span class="sf3b2">);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">396</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">buildCustom</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'custom_post_id'</span><span class="sf3b2">]<wbr>, </span><span class="sf12b2">'customPost'</span><span class="sf3b2">);</span></code></td>
<td class="ln">400</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">buildCustom</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'custom_post_id'</span><span class="sf3b2">]<wbr>, </span><span class="sf12b2">'customPost'</span><span class="sf3b2">);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">397</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">401</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">398</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp;</span><span class="sf17b16">//lets get js on two different qf elements.
</span>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">399</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp;$</span><span class="sf17b16">showHidePayfieldName = NULL;
</span>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">400</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp;$</span><span class="sf17b16">showHidePaymentInformation = FALSE;
</span>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">401</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">][</span><span class="sf12b2">'is_monetary'</span><span class="sf3b2">]) {</span></code></td>
<td class="ln">402</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">][</span><span class="sf12b2">'is_monetary'</span><span class="sf3b2">]) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">402</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">self::buildAmount</span><span class="sf3b2">($</span><span class="sf18b2">this);</span></code></td>
<td class="ln">403</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">self::buildAmount</span><span class="sf3b2">($</span><span class="sf18b2">this);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">403</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16">
</span>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">404</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp;$</span><span class="sf17b16">attributes = NULL;
</span>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">405</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp;$</span><span class="sf17b16">freezePayLater = TRUE;
</span>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">406</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp;</span><span class="sf17b16">if</span><span class="sf17b16"> (</span><span class="sf17b16">is_array</span><span class="sf17b16">($</span><span class="sf17b16">this-&gt;_paymentProcessor)) {
</span>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">407</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf17b16">freezePayLater = FALSE;
</span>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">408</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf17b16">if</span><span class="sf17b16"> (!</span><span class="sf17b16">in_array</span><span class="sf17b16">($</span><span class="sf17b16">this-&gt;_paymentProcessor[</span><span class="sf17b16">'billing_mode'</span><span class="sf17b16">]<wbr>, array</span><span class="sf17b16">(
</span>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">409</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf17b16">2</span><span class="sf17b16">, </span><span class="sf17b16">4</span><span class="sf17b16">))) {
</span>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">410</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf17b16">showHidePayfieldName = </span><span class="sf17b16">'billing-payment-block'</span><span class="sf17b16">;
</span>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">411</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf17b16">attributes = </span><span class="sf17b16">array</span><span class="sf17b16">(</span><span class="sf17b16">'onclick'</span><span class="sf17b16"> =&gt; </span><span class="sf17b16">"showHidePaymentInfo( );"</span><span class="sf17b16">);
</span>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">412</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp;}
</span>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">413</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16">
</span>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">414</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf17b16">if</span><span class="sf17b16"> ($</span><span class="sf17b16">this-&gt;_paymentProcessor[</span><span class="sf17b16">'payment_processor_type'</span><span class="sf17b16">]<wbr> == </span><span class="sf17b16">'PayPal_Express'</span><span class="sf17b16">) {
</span>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">415</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf17b16">showHidePayfieldName = </span><span class="sf17b16">'PayPalExpress'</span><span class="sf17b16">;
</span>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">416</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf17b16">attributes = </span><span class="sf17b16">array</span><span class="sf17b16">(</span><span class="sf17b16">'onclick'</span><span class="sf17b16"> =&gt; </span><span class="sf17b16">"showHidePayPalExpressOption();"</span><span class="sf17b16">);
</span>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">417</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp;}
</span>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">418</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp;}
</span>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">419</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16">
</span>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">420</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp;</span><span class="sf17b16">//lets build only when there is no waiting and no required approval.
</span>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">421</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp;</span><span class="sf17b16">/*if ( $this-&gt;_allowConfirmation || ( !$this-&gt;_requireApproval &amp;&amp; !$this-&gt;_allowWaitlist ) ) {
</span>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">422</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16">
</span>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">423</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;CRM_Core_Payment_Form::buildCreditCard( $this );
</span>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">424</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if ( $showHidePayfieldName == 'billing-payment-block' ) {
</span>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">425</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$showHidePaymentInformation = true;
</span>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">426</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}
</span>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">427</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if ( $showHidePayfieldName == 'PayPalExpress' ) {
</span>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">428</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$buildExpressPayBlock = true;
</span>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">429</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}
</span>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">430</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}*/</span><span class="sf17b16">
</span>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">431</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp;}
</span>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">432</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp;$</span><span class="sf17b16">pps = NULL;
</span>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">433</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp;$</span><span class="sf17b16">this-&gt;_paymentProcessors = $</span><span class="sf17b16">this-&gt;</span><span class="sf17b16">get</span><span class="sf17b16">(</span><span class="sf17b16">'paymentProcessors'</span><span class="sf17b16">);
</span>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">434</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp;</span><span class="sf17b16">if</span><span class="sf17b16"> (!</span><span class="sf17b16">empty</span><span class="sf17b16">($</span><span class="sf17b16">this-&gt;_paymentProcessors)) {
</span>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">435</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp;$</span><span class="sf17b16">pps = $</span><span class="sf17b16">this-&gt;_paymentProcessors;
</span>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">436</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp;</span><span class="sf17b16">foreach</span><span class="sf17b16"> ($</span><span class="sf17b16">pps </span><span class="sf17b16">as</span><span class="sf17b16"> $</span><span class="sf17b16">key =&gt; &amp; $</span><span class="sf17b16">name) {
</span>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">437</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf17b16">pps[$</span><span class="sf17b16">key] = $</span><span class="sf17b16">name[</span><span class="sf17b16">'name'</span><span class="sf17b16">];
</span>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">438</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp;}
</span>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">439</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp;}
</span>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">440</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16">
</span>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">441</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp;</span><span class="sf17b16">if</span><span class="sf17b16"> (</span><span class="sf17b16">CRM_Utils_Array::value</span><span class="sf17b16">(</span><span class="sf17b16">'is_pay_later'</span><span class="sf17b16">, $</span><span class="sf17b16">this-&gt;_values[</span><span class="sf17b16">'event'</span><span class="sf17b16">]) &amp;&amp;
</span>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">442</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp;($</span><span class="sf17b16">this-&gt;</span><span class="sf17b16">_allowConfirmation ||</span><span class="sf17b16"> (!$</span><span class="sf17b16">this-&gt;_requireApproval &amp;&amp; !$</span><span class="sf17b16">this-&gt;_allowWaitlist))
</span>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">443</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp;) {
</span>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">444</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp;$</span><span class="sf17b16">pps[</span><span class="sf17b16">0</span><span class="sf17b16">] = $</span><span class="sf17b16">this-&gt;_values[</span><span class="sf17b16">'event'</span><span class="sf17b16">][</span><span class="sf17b16">'pay_later_text'</span><span class="sf17b16">];
</span>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">445</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp;}
</span>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">446</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16">
</span>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">447</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp;</span><span class="sf17b16">if</span><span class="sf17b16"> ($</span><span class="sf17b16">this-&gt;_values[</span><span class="sf17b16">'event'</span><span class="sf17b16">][</span><span class="sf17b16">'is_monetary'</span><span class="sf17b16">]) {
</span>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">448</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp;</span><span class="sf17b16">if</span><span class="sf17b16"> (</span><span class="sf17b16">count</span><span class="sf17b16">($</span><span class="sf17b16">pps) &gt; </span><span class="sf17b16">1</span><span class="sf17b16">) {
</span>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">449</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf17b16">this-&gt;</span><span class="sf17b16">addRadio</span><span class="sf17b16">(</span><span class="sf17b16">'payment_processor'</span><span class="sf17b16">, </span><span class="sf17b16">ts</span><span class="sf17b16">(</span><span class="sf17b16">'Payment Method'</span><span class="sf17b16">), $</span><span class="sf17b16">pps,
</span>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">450</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;NULL, </span><span class="sf17b16">"&amp;nbsp;"</span><span class="sf17b16">, TRUE
</span>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">451</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp;);
</span>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">452</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp;}
</span>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">453</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp;</span><span class="sf17b16">elseif</span><span class="sf17b16"> (!</span><span class="sf17b16">empty</span><span class="sf17b16">($</span><span class="sf17b16">pps)) {
</span>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">454</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf17b16">this-&gt;</span><span class="sf17b16">addElement</span><span class="sf17b16">(</span><span class="sf17b16">'hidden'</span><span class="sf17b16">, </span><span class="sf17b16">'payment_processor'</span><span class="sf17b16">, </span><span class="sf17b16">array_pop</span><span class="sf17b16">(</span><span class="sf17b16">array_keys</span><span class="sf17b16">($</span><span class="sf17b16">pps)));
</span>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">455</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp;}
</span>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">456</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">404</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">457</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">405</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">458</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp;</span><span class="sf17b16">//lets add some qf element to bypass</span><span style="color: #000000; background-color: #efcb05; "> payment </span><span class="sf17b16">validations, CRM-4320</span>&nbsp;</code></td>
<td class="ln">406</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp;</span><span class="sf17b16">//BOT - determine where shall the</span><span style="color: #000000; background-color: #efcb05; "> payment </span><span class="sf17b16">fields be displayed</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">459</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp;</span><span class="sf17b16">if</span><span class="sf17b16"> ($</span><span class="sf17b16">bypassPayment) {</span><span class="sf17b16">
</span>&nbsp;</code></td>
<td class="ln">407</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp;</span><span class="sf17b16">//Moved the payment fields code to a separate function 'buildPaymentFields'</span><span class="sf17b16"> &nbsp; 
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">460</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp;</span><span class="sf17b16"> &nbsp;</span><span class="sf17b16">$</span><span class="sf17b16">attributes</span><span style="color: #000000; background-color: #efcb05; "> = </span><span class="sf17b16">NULL;</span>&nbsp;</code></td>
<td class="ln">408</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp;</span><span class="sf17b16">$</span><span class="sf17b16">this-&gt;_pp</span><span style="color: #000000; background-color: #efcb05; "> = </span><span class="sf17b16">$</span><span class="sf17b16">this-&gt;</span><span class="sf17b16">get</span><span class="sf17b16">(</span><span class="sf17b16">'paymentProcessors'</span><span class="sf17b16">);</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">461</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp;</span><span class="sf17b16"> &nbsp;</span><span class="sf17b16">if</span><span class="sf17b16"> ($</span><span class="sf17b16">showHidePayfieldName == </span><span class="sf17b16">'billing-payment-block'</span><span class="sf17b16"> &amp;&amp; $</span><span class="sf17b16">showHidePaymentInformation) {</span>&nbsp;</code></td>
<td class="ln">409</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp;</span><span class="sf17b16">$</span><span class="sf17b16">this-&gt;_showPaymentFields = TRUE;</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">462</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp;</span><span class="sf17b16"> &nbsp; &nbsp;</span><span class="sf17b16">$</span><span class="sf17b16">attributes = </span><span class="sf17b16">array</span><span class="sf17b16">(</span><span class="sf17b16">'onclick'</span><span class="sf17b16"> =&gt; </span><span class="sf17b16">"showHidePaymentInfo();"</span><span class="sf17b16">);</span>&nbsp;</code></td>
<td class="ln">410</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp;</span><span class="sf17b16">if</span><span class="sf17b16"> ( $</span><span class="sf17b16">this-&gt;_values[</span><span class="sf17b16">'event'</span><span class="sf17b16">][</span><span class="sf17b16">'payment_fields_position'</span><span class="sf17b16">] == </span><span class="sf17b16">'confirm'</span><span class="sf17b16"> &amp;&amp; $</span><span class="sf17b16">this-&gt;_values[</span><span class="sf17b16">'event'</span><span class="sf17b16">][</span><span class="sf17b16">'is_multiple_registrations'<wbr></span><span class="sf17b16">] ) {</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">463</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp;</span><span class="sf17b16">}</span>&nbsp;</code></td>
<td class="ln">411</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp;</span><span class="sf17b16"> &nbsp;</span><span class="sf17b16">$</span><span class="sf17b16">this-&gt;_showPaymentFields = FALSE;</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">464</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp;</span><span class="sf17b16"> &nbsp;</span><span class="sf17b16">if</span><span class="sf17b16"> ($</span><span class="sf17b16">showHidePayfieldName == </span><span class="sf17b16">'PayPalExpress'</span><span class="sf17b16">) {</span>&nbsp;</code></td>
<td class="ln">412</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp;</span><span class="sf17b16">}</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">465</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp;</span><span class="sf17b16"> &nbsp; &nbsp;</span><span class="sf17b16">$</span><span class="sf17b16">attributes = </span><span class="sf17b16">array</span><span class="sf17b16">(</span><span class="sf17b16">'onclick'</span><span class="sf17b16"> =&gt; </span><span class="sf17b16">"showHidePayPalExpressOption();"</span><span class="sf17b16">);</span>&nbsp;</code></td>
<td class="ln">413</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp;</span><span class="sf17b16">$</span><span class="sf17b16">this-&gt;</span><span class="sf17b16">assign</span><span class="sf17b16">(</span><span class="sf17b16">'showPaymentFields'</span><span class="sf17b16">, $</span><span class="sf17b16">this-&gt;_showPaymentFields);</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">466</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp;</span><span class="sf17b16"> &nbsp;}
</span>&nbsp;</code></td>
<td class="ln">414</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp;</span><span class="sf17b16">
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">467</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp;</span><span class="sf17b16"> &nbsp;</span><span class="sf17b16">$</span><span class="sf17b16">this-&gt;</span><span class="sf17b16">addElement</span><span class="sf17b16">(</span><span class="sf17b16">'hidden'</span><span class="sf17b16">, </span><span class="sf17b16">'bypass_payment'</span><span class="sf17b16">, </span><span class="sf17b16">NULL, array</span><span class="sf17b16">(</span><span class="sf17b16">'id'</span><span class="sf17b16"> =&gt; </span><span class="sf17b16">'bypass_payment'</span><span class="sf17b16">));</span>&nbsp;</code></td>
<td class="ln">415</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp;</span><span class="sf17b16">if</span><span class="sf17b16"> ( $</span><span class="sf17b16">this-&gt;_showPaymentFields ) {</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">416</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; </span><span class="sf17b16">self::buildPaymentFields</span><span class="sf17b16">( $</span><span class="sf17b16">this );
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">468</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">417</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">469</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp;</span><span class="sf17b16">$</span><span class="sf17b16">this-&gt;</span><span class="sf17b16">assign</span><span class="sf17b16">(</span><span class="sf17b16">'bypassPayment'</span><span class="sf17b16">, $</span><span class="sf17b16">bypassPayment);</span>&nbsp;</code></td>
<td class="ln">418</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp;</span><span class="sf17b16">//Ends</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">470</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp;</span><span class="sf17b16"> &nbsp;$</span><span class="sf17b16">this-&gt;</span><span class="sf17b16">assign</span><span class="sf17b16">(</span><span class="sf17b16">'showHidePaymentInformation'</span><span class="sf17b16">, $</span><span class="sf17b16">showHidePaymentInformation);
</span>&nbsp;</code></td>
<td class="ln">419</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp;</span><span class="sf17b16">
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">471</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16">
</span>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">472</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">userID = </span><span class="sf8b2">parent::getContactID</span><span class="sf3b2">();</span></code></td>
<td class="ln">420</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">userID = </span><span class="sf8b2">parent::getContactID</span><span class="sf3b2">();</span></code></td>
</tr>
<tr valign="top">
<td class="ln">473</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">421</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">474</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!$</span><span class="sf18b2">userID) {</span></code></td>
<td class="ln">422</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!$</span><span class="sf18b2">userID) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">475</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">createCMSUser = FALSE;</span></code></td>
<td class="ln">423</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">createCMSUser = FALSE;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">476</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">424</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">477</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'custom_pre_id'</span><span class="sf3b2">]) {</span></code></td>
<td class="ln">425</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'custom_pre_id'</span><span class="sf3b2">]) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">478</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">profileID = $</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'custom_pre_id'</span><span class="sf3b2">];</span></code></td>
<td class="ln">426</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">profileID = $</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'custom_pre_id'</span><span class="sf3b2">];</span></code></td>
</tr>
<tr valign="top">
<td class="ln">479</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">createCMSUser = </span><span class="sf8b2">CRM_Core_DAO::getFieldValue</span><span class="sf3b2">(</span><span class="sf12b2">'CRM_Core_DAO_UFGroup'</span><span class="sf3b2">,<wbr> $</span><span class="sf18b2">profileID, </span><span class="sf12b2">'is_cms_user'</span><span class="sf3b2">);</span></code></td>
<td class="ln">427</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">createCMSUser = </span><span class="sf8b2">CRM_Core_DAO::getFieldValue</span><span class="sf3b2">(</span><span class="sf12b2">'CRM_Core_DAO_UFGroup'</span><span class="sf3b2">,<wbr> $</span><span class="sf18b2">profileID, </span><span class="sf12b2">'is_cms_user'</span><span class="sf3b2">);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">480</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">428</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">481</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">429</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">482</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!$</span><span class="sf18b2">createCMSUser &amp;&amp;</span></code></td>
<td class="ln">430</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!$</span><span class="sf18b2">createCMSUser &amp;&amp;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">483</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'custom_post_id'</span><span class="sf3b2">]</span></code></td>
<td class="ln">431</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'custom_post_id'</span><span class="sf3b2">]</span></code></td>
</tr>
<tr valign="top">
<td class="ln">484</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;) {</span></code></td>
<td class="ln">432</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">485</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!</span><span class="sf8b2">is_array</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'custom_post_id'</span><span class="sf3b2">])) {</span></code></td>
<td class="ln">433</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!</span><span class="sf8b2">is_array</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'custom_post_id'</span><span class="sf3b2">])) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">486</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">profileIDs = </span><span class="sf7b2">array</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'custom_post_id'</span><span class="sf3b2">]);</span></code></td>
<td class="ln">434</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">profileIDs = </span><span class="sf7b2">array</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'custom_post_id'</span><span class="sf3b2">]);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">487</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">435</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">488</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">else</span><span class="sf3b2"> {</span></code></td>
<td class="ln">436</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">else</span><span class="sf3b2"> {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">489</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">profileIDs = $</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'custom_post_id'</span><span class="sf3b2">];</span></code></td>
<td class="ln">437</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">profileIDs = $</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'custom_post_id'</span><span class="sf3b2">];</span></code></td>
</tr>
<tr valign="top">
<td class="ln">490</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">438</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">491</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">foreach</span><span class="sf3b2"> ($</span><span class="sf18b2">profileIDs </span><span class="sf7b2">as</span><span class="sf3b2"> $</span><span class="sf18b2">pid) {</span></code></td>
<td class="ln">439</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">foreach</span><span class="sf3b2"> ($</span><span class="sf18b2">profileIDs </span><span class="sf7b2">as</span><span class="sf3b2"> $</span><span class="sf18b2">pid) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">492</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">CRM_Core_DAO::getFieldValue</span><span class="sf3b2">(</span><span class="sf12b2">'CRM_Core_DAO_UFGroup'<wbr></span><span class="sf3b2">, $</span><span class="sf18b2">pid, </span><span class="sf12b2">'is_cms_user'</span><span class="sf3b2">)) {</span></code></td>
<td class="ln">440</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">CRM_Core_DAO::getFieldValue</span><span class="sf3b2">(</span><span class="sf12b2">'CRM_Core_DAO_UFGroup'<wbr></span><span class="sf3b2">, $</span><span class="sf18b2">pid, </span><span class="sf12b2">'is_cms_user'</span><span class="sf3b2">)) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">493</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">profileID = $</span><span class="sf18b2">pid;</span></code></td>
<td class="ln">441</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">profileID = $</span><span class="sf18b2">pid;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">494</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">createCMSUser = TRUE;</span></code></td>
<td class="ln">442</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">createCMSUser = TRUE;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">495</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">break</span><span class="sf3b2">;</span></code></td>
<td class="ln">443</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">break</span><span class="sf3b2">;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">496</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">444</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">497</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">445</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">498</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">446</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">499</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">447</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">500</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">createCMSUser) {</span></code></td>
<td class="ln">448</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">createCMSUser) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">501</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">CRM_Core_BAO_CMSUser::buildForm</span><span class="sf3b2">($</span><span class="sf18b2">this, $</span><span class="sf18b2">profileID, TRUE);</span></code></td>
<td class="ln">449</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">CRM_Core_BAO_CMSUser::buildForm</span><span class="sf3b2">($</span><span class="sf18b2">this, $</span><span class="sf18b2">profileID, TRUE);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">502</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">450</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">503</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">451</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">504</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">452</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">505</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">//we have to load confirm contribution button in template</span></code></td>
<td class="ln">453</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">//we have to load confirm contribution button in template</span></code></td>
</tr>
<tr valign="top">
<td class="ln">506</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">//when multiple payment processor as the user</span></code></td>
<td class="ln">454</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">//when multiple payment processor as the user</span></code></td>
</tr>
<tr valign="top">
<td class="ln">507</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">//can toggle with payment processor selection</span></code></td>
<td class="ln">455</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">//can toggle with payment processor selection</span></code></td>
</tr>
<tr valign="top">
<td class="ln">508</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">billingModePaymentProcessors = </span><span class="sf10b2">0</span><span class="sf3b2">;</span></code></td>
<td class="ln">456</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">billingModePaymentProcessors = </span><span class="sf10b2">0</span><span class="sf3b2">;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">509</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp;</span><span style="color: #000000; background-color: #efcb05; font-weight: bold; ">if</span><span style="color: #000000; background-color: #efcb05; "> </span><span class="sf17b16">(!</span><span class="sf17b16">CRM_Utils_System::isNull</span><span class="sf17b16">($</span><span class="sf17b16">this-&gt;_paymentProcessor<wbr>s))</span><span style="color: #000000; background-color: #efcb05; "> {</span></code></td>
<td class="ln">457</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp;</span><span style="color: #000000; background-color: #efcb05; font-weight: bold; ">if</span><span style="color: #000000; background-color: #efcb05; "> </span><span class="sf17b16">( </span><span class="sf17b16">isset</span><span class="sf17b16">( $</span><span class="sf17b16">this-&gt;_paymentProcessors ) )</span><span style="color: #000000; background-color: #efcb05; "> {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">510</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp;</span><span class="sf17b16">foreach</span><span class="sf17b16"> ($</span><span class="sf17b16">this-&gt;_paymentProcessors as $</span><span class="sf17b16">key =&gt; $</span><span class="sf17b16">values)</span><span style="color: #000000; background-color: #efcb05; "> {</span></code></td>
<td class="ln">458</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp;</span><span class="sf17b16">if</span><span class="sf17b16"> (!</span><span class="sf17b16">CRM_Utils_System::isNull</span><span class="sf17b16">($</span><span class="sf17b16">this-&gt;_paymentProcessor<wbr>s))</span><span style="color: #000000; background-color: #efcb05; "> {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">511</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf17b16">if</span><span class="sf17b16"> ($</span><span class="sf17b16">values[</span><span class="sf17b16">'billing_mode'</span><span class="sf17b16">] == CRM_Core_Payment::BILLING_MODE_BUTTON)</span><span style="color: #000000; background-color: #efcb05; "> {</span></code></td>
<td class="ln">459</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf17b16">foreach</span><span class="sf17b16"> ($</span><span class="sf17b16">this-&gt;_paymentProcessors as $</span><span class="sf17b16">key =&gt; $</span><span class="sf17b16">values)</span><span style="color: #000000; background-color: #efcb05; "> {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">512</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf17b16">$</span><span class="sf17b16">billingModePaymentProcessors++;</span>&nbsp;</code></td>
<td class="ln">460</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf17b16">if</span><span class="sf17b16"> ($</span><span class="sf17b16">values[</span><span class="sf17b16">'billing_mode'</span><span class="sf17b16">] == CRM_Core_Payment::BILLING_MODE_BUTTON) {</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">461</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf17b16">billingModePaymentProcessors++;
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">462</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">513</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">463</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">514</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">464</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">515</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">465</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">516</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">466</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">517</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">billingModePaymentProcessors &amp;&amp; </span><span class="sf8b2">count</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;_paymentProcessors) == $</span><span class="sf18b2">billingModePaymentProcessors) {</span></code></td>
<td class="ln">467</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">billingModePaymentProcessors &amp;&amp; </span><span class="sf8b2">count</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;_paymentProcessors) == $</span><span class="sf18b2">billingModePaymentProcessors) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">518</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">allAreBillingModeProcessors = TRUE;</span></code></td>
<td class="ln">468</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">allAreBillingModeProcessors = TRUE;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">519</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;} </span><span class="sf7b2">else</span><span class="sf3b2"> {</span></code></td>
<td class="ln">469</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;} </span><span class="sf7b2">else</span><span class="sf3b2"> {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">520</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">allAreBillingModeProcessors = FALSE;</span></code></td>
<td class="ln">470</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">allAreBillingModeProcessors = FALSE;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">521</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">471</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">522</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">472</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">523</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!$</span><span class="sf18b2">allAreBillingModeProcessors ||</span></code></td>
<td class="ln">473</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!$</span><span class="sf18b2">allAreBillingModeProcessors ||</span></code></td>
</tr>
<tr valign="top">
<td class="ln">524</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">CRM_Utils_Array::value</span><span style="color: #000000; background-color: #efcb05; ">(</span><span style="color: #000000; background-color: #efcb05; ">'is_pay_later'</span><span style="color: #000000; background-color: #efcb05; ">, $</span><span style="color: #000000; background-color: #efcb05; ">this-&gt;_values[</span><span style="color: #000000; background-color: #efcb05; ">'event'</span><span style="color: #000000; background-color: #efcb05; ">]) || </span><span class="sf17b16">$bypassPayment</span>&nbsp;</code></td>
<td class="ln">474</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">CRM_Utils_Array::value</span><span style="color: #000000; background-color: #efcb05; ">(</span><span style="color: #000000; background-color: #efcb05; ">'is_pay_later'</span><span style="color: #000000; background-color: #efcb05; ">, $</span><span style="color: #000000; background-color: #efcb05; ">this-&gt;_values[</span><span style="color: #000000; background-color: #efcb05; ">'event'</span><span style="color: #000000; background-color: #efcb05; ">]) || </span><span class="sf17b16">$</span><span class="sf17b16">this-&gt;_bypassPayment</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">525</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;) {</span></code></td>
<td class="ln">475</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">526</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">476</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">527</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">//freeze button to avoid multiple calls.</span></code></td>
<td class="ln">477</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">//freeze button to avoid multiple calls.</span></code></td>
</tr>
<tr valign="top">
<td class="ln">528</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">js = NULL;</span></code></td>
<td class="ln">478</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">js = NULL;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">529</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">479</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">530</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'is_monetary'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">])) {</span></code></td>
<td class="ln">480</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'is_monetary'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">])) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">531</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">js = </span><span class="sf7b2">array</span><span class="sf3b2">(</span><span class="sf12b2">'onclick'</span><span class="sf3b2"> =&gt; </span><span class="sf12b2">"return submitOnce(this,'"</span><span class="sf3b2"> . $</span><span class="sf18b2">this-&gt;_name . </span><span class="sf12b2">"','"</span><span class="sf3b2"> . ts</span><span class="sf3b2">(</span><span class="sf12b2">'Processing'</span><span class="sf3b2">) . </span><span class="sf12b2">"');"</span><span class="sf3b2">);</span></code></td>
<td class="ln">481</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">js = </span><span class="sf7b2">array</span><span class="sf3b2">(</span><span class="sf12b2">'onclick'</span><span class="sf3b2"> =&gt; </span><span class="sf12b2">"return submitOnce(this,'"</span><span class="sf3b2"> . $</span><span class="sf18b2">this-&gt;_name . </span><span class="sf12b2">"','"</span><span class="sf3b2"> . ts</span><span class="sf3b2">(</span><span class="sf12b2">'Processing'</span><span class="sf3b2">) . </span><span class="sf12b2">"');"</span><span class="sf3b2">);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">532</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">482</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">533</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">addButtons</span><span class="sf3b2">(</span><span class="sf7b2">array</span><span class="sf3b2">(</span></code></td>
<td class="ln">483</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">addButtons</span><span class="sf3b2">(</span><span class="sf7b2">array</span><span class="sf3b2">(</span></code></td>
</tr>
<tr valign="top">
<td class="ln">534</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">array</span><span class="sf3b2">(</span></code></td>
<td class="ln">484</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">array</span><span class="sf3b2">(</span></code></td>
</tr>
<tr valign="top">
<td class="ln">535</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'type'</span><span class="sf3b2"> =&gt; </span><span class="sf12b2">'upload'</span><span class="sf3b2">,</span></code></td>
<td class="ln">485</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'type'</span><span class="sf3b2"> =&gt; </span><span class="sf12b2">'upload'</span><span class="sf3b2">,</span></code></td>
</tr>
<tr valign="top">
<td class="ln">536</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'name'</span><span class="sf3b2"> =&gt; </span><span class="sf8b2">ts</span><span class="sf3b2">(</span><span class="sf12b2">'Continue &gt;&gt;'</span><span class="sf3b2">),</span></code></td>
<td class="ln">486</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'name'</span><span class="sf3b2"> =&gt; </span><span class="sf8b2">ts</span><span class="sf3b2">(</span><span class="sf12b2">'Continue &gt;&gt;'</span><span class="sf3b2">),</span></code></td>
</tr>
<tr valign="top">
<td class="ln">537</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'spacing'</span><span class="sf3b2"> =&gt; </span><span class="sf12b2">'&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;n<wbr>bsp;'</span><span class="sf3b2">,</span></code></td>
<td class="ln">487</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'spacing'</span><span class="sf3b2"> =&gt; </span><span class="sf12b2">'&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;n<wbr>bsp;'</span><span class="sf3b2">,</span></code></td>
</tr>
<tr valign="top">
<td class="ln">538</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'isDefault'</span><span class="sf3b2"> =&gt; TRUE,</span></code></td>
<td class="ln">488</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'isDefault'</span><span class="sf3b2"> =&gt; TRUE,</span></code></td>
</tr>
<tr valign="top">
<td class="ln">539</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'js'</span><span class="sf3b2"> =&gt; $</span><span class="sf18b2">js,</span></code></td>
<td class="ln">489</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'js'</span><span class="sf3b2"> =&gt; $</span><span class="sf18b2">js,</span></code></td>
</tr>
<tr valign="top">
<td class="ln">540</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;),</span></code></td>
<td class="ln">490</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;),</span></code></td>
</tr>
<tr valign="top">
<td class="ln">541</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;)</span></code></td>
<td class="ln">491</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;)</span></code></td>
</tr>
<tr valign="top">
<td class="ln">542</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;);</span></code></td>
<td class="ln">492</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">543</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">493</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">544</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">494</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">545</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">addFormRule</span><span class="sf3b2">(</span><span class="sf7b2">array</span><span class="sf3b2">(</span><span class="sf12b2">'CRM_Event_Form_Registrati<wbr>on_Register'</span><span class="sf3b2">, </span><span class="sf12b2">'formRule'</span><span class="sf3b2">),</span></code></td>
<td class="ln">495</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">addFormRule</span><span class="sf3b2">(</span><span class="sf7b2">array</span><span class="sf3b2">(</span><span class="sf12b2">'CRM_Event_Form_Registrati<wbr>on_Register'</span><span class="sf3b2">, </span><span class="sf12b2">'formRule'</span><span class="sf3b2">),</span></code></td>
</tr>
<tr valign="top">
<td class="ln">546</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$this</span></code></td>
<td class="ln">496</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$this</span></code></td>
</tr>
<tr valign="top">
<td class="ln">547</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;);</span></code></td>
<td class="ln">497</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">548</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">498</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">549</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// add pcp fields</span></code></td>
<td class="ln">499</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// add pcp fields</span></code></td>
</tr>
<tr valign="top">
<td class="ln">550</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">this-&gt;_pcpId) {</span></code></td>
<td class="ln">500</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">this-&gt;_pcpId) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">551</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">CRM_PCP_BAO_PCP::buildPcp</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;_pcpId, $</span><span class="sf18b2">this);</span></code></td>
<td class="ln">501</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">CRM_PCP_BAO_PCP::buildPcp</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;_pcpId, $</span><span class="sf18b2">this);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">552</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">502</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">553</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;}</span></code></td>
<td class="ln">503</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">554</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">504</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">505</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp;</span><span class="sf17b16">/*
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">506</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; * BOT - Moved the payment fields build form to a new function
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">507</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; * Called based on configuration; payment fields shown on registration or confirmation page &nbsp; * 
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">508</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; */</span><span class="sf17b16">
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">509</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp;</span><span class="sf17b16">static</span><span class="sf17b16"> </span><span class="sf17b16">public function buildPaymentFields</span><span class="sf17b16">( &amp;$</span><span class="sf17b16">form ) {
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">510</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp;</span><span class="sf17b16">//lets get js on two different qf elements.
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">511</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp;$</span><span class="sf17b16">showHidePayfieldName = NULL;
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">512</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp;$</span><span class="sf17b16">showHidePaymentInformation = FALSE;
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">513</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp;</span><span class="sf17b16">if</span><span class="sf17b16"> ($</span><span class="sf17b16">form-&gt;_values[</span><span class="sf17b16">'event'</span><span class="sf17b16">][</span><span class="sf17b16">'is_monetary'</span><span class="sf17b16">]) {
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">514</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; </span><span class="sf17b16">// self::buildAmount($form);
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">515</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp;
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">516</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp;$</span><span class="sf17b16">attributes = NULL;
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">517</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp;$</span><span class="sf17b16">freezePayLater = TRUE;
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">518</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp;</span><span class="sf17b16">if</span><span class="sf17b16"> (</span><span class="sf17b16">is_array</span><span class="sf17b16">($</span><span class="sf17b16">form-&gt;_paymentProcessor)) {
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">519</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf17b16">freezePayLater = FALSE;
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">520</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf17b16">if</span><span class="sf17b16"> (!</span><span class="sf17b16">in_array</span><span class="sf17b16">($</span><span class="sf17b16">form-&gt;_paymentProcessor[</span><span class="sf17b16">'billing_mode'</span><span class="sf17b16">]<wbr>, array</span><span class="sf17b16">(
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">521</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf17b16">2</span><span class="sf17b16">, </span><span class="sf17b16">4</span><span class="sf17b16">))) {
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">522</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf17b16">showHidePayfieldName = </span><span class="sf17b16">'billing-payment-block'</span><span class="sf17b16">;
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">523</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf17b16">attributes = </span><span class="sf17b16">array</span><span class="sf17b16">(</span><span class="sf17b16">'onclick'</span><span class="sf17b16"> =&gt; </span><span class="sf17b16">"showHidePaymentInfo( );"</span><span class="sf17b16">);
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">524</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp;}
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">525</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp;
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">526</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf17b16">if</span><span class="sf17b16"> ($</span><span class="sf17b16">form-&gt;_paymentProcessor[</span><span class="sf17b16">'payment_processor_type'</span><span class="sf17b16">]<wbr> == </span><span class="sf17b16">'PayPal_Express'</span><span class="sf17b16">) {
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">527</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf17b16">showHidePayfieldName = </span><span class="sf17b16">'PayPalExpress'</span><span class="sf17b16">;
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">528</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf17b16">attributes = </span><span class="sf17b16">array</span><span class="sf17b16">(</span><span class="sf17b16">'onclick'</span><span class="sf17b16"> =&gt; </span><span class="sf17b16">"showHidePayPalExpressOption();"</span><span class="sf17b16">);
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">529</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp;}
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">530</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp;}
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">531</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp;
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">532</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp;</span><span class="sf17b16">//lets build only when there is no waiting and no required approval.
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">533</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp;</span><span class="sf17b16">/*if ( $form-&gt;_allowConfirmation || ( !$form-&gt;_requireApproval &amp;&amp; !$form-&gt;_allowWaitlist ) ) {
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">534</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp;
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">535</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp;CRM_Core_Payment_Form::buildCreditCard( $form );
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">536</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp;if ( $showHidePayfieldName == 'billing-payment-block' ) {
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">537</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp;$showHidePaymentInformation = true;
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">538</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp;}
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">539</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp;if ( $showHidePayfieldName == 'PayPalExpress' ) {
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">540</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp;$buildExpressPayBlock = true;
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">541</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp;}
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">542</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp;}*/</span><span class="sf17b16">
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">543</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp;}
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">544</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp;$</span><span class="sf17b16">pps = NULL;
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">545</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp;$</span><span class="sf17b16">form-&gt;_paymentProcessors = $</span><span class="sf17b16">form-&gt;</span><span class="sf17b16">get</span><span class="sf17b16">(</span><span class="sf17b16">'paymentProcessors'</span><span class="sf17b16">);
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">546</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; 
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">547</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp;</span><span class="sf17b16">if</span><span class="sf17b16"> (!</span><span class="sf17b16">empty</span><span class="sf17b16">($</span><span class="sf17b16">form-&gt;_paymentProcessors)) {
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">548</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp;$</span><span class="sf17b16">pps = $</span><span class="sf17b16">form-&gt;_paymentProcessors;
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">549</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp;</span><span class="sf17b16">foreach</span><span class="sf17b16"> ($</span><span class="sf17b16">pps </span><span class="sf17b16">as</span><span class="sf17b16"> $</span><span class="sf17b16">key =&gt; &amp; $</span><span class="sf17b16">name) {
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">550</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf17b16">pps[$</span><span class="sf17b16">key] = $</span><span class="sf17b16">name[</span><span class="sf17b16">'name'</span><span class="sf17b16">];
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">551</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp;}
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">552</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp;}
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">553</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp;
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">554</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp;</span><span class="sf17b16">if</span><span class="sf17b16"> (</span><span class="sf17b16">CRM_Utils_Array::value</span><span class="sf17b16">(</span><span class="sf17b16">'is_pay_later'</span><span class="sf17b16">, $</span><span class="sf17b16">form-&gt;_values[</span><span class="sf17b16">'event'</span><span class="sf17b16">]) &amp;&amp;
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">555</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp;($</span><span class="sf17b16">form-&gt;</span><span class="sf17b16">_allowConfirmation ||</span><span class="sf17b16"> (!$</span><span class="sf17b16">form-&gt;_requireApproval &amp;&amp; !$</span><span class="sf17b16">form-&gt;_allowWaitlist))
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">556</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp;) {
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">557</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp;$</span><span class="sf17b16">pps[</span><span class="sf17b16">0</span><span class="sf17b16">] = $</span><span class="sf17b16">form-&gt;_values[</span><span class="sf17b16">'event'</span><span class="sf17b16">][</span><span class="sf17b16">'pay_later_text'</span><span class="sf17b16">];
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">558</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp;}
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">559</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp;
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">560</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp;</span><span class="sf17b16">if</span><span class="sf17b16"> ($</span><span class="sf17b16">form-&gt;_values[</span><span class="sf17b16">'event'</span><span class="sf17b16">][</span><span class="sf17b16">'is_monetary'</span><span class="sf17b16">]) {
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">561</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp;</span><span class="sf17b16">if</span><span class="sf17b16"> (</span><span class="sf17b16">count</span><span class="sf17b16">($</span><span class="sf17b16">pps) &gt; </span><span class="sf17b16">1</span><span class="sf17b16">) {
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">562</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf17b16">form-&gt;</span><span class="sf17b16">addRadio</span><span class="sf17b16">(</span><span class="sf17b16">'payment_processor'</span><span class="sf17b16">, </span><span class="sf17b16">ts</span><span class="sf17b16">(</span><span class="sf17b16">'Payment Method'</span><span class="sf17b16">), $</span><span class="sf17b16">pps,
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">563</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;NULL, </span><span class="sf17b16">"&amp;nbsp;"</span><span class="sf17b16">, TRUE
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">564</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp;);
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">565</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp;}
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">566</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp;</span><span class="sf17b16">elseif</span><span class="sf17b16"> (!</span><span class="sf17b16">empty</span><span class="sf17b16">($</span><span class="sf17b16">pps)) {
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">567</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf17b16">form-&gt;</span><span class="sf17b16">addElement</span><span class="sf17b16">(</span><span class="sf17b16">'hidden'</span><span class="sf17b16">, </span><span class="sf17b16">'payment_processor'</span><span class="sf17b16">, </span><span class="sf17b16">array_pop</span><span class="sf17b16">(</span><span class="sf17b16">array_keys</span><span class="sf17b16">($</span><span class="sf17b16">pps)));
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">568</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp;}
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">569</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp;}
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">570</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp;
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">571</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp;</span><span class="sf17b16">//lets add some qf element to bypass payment validations, CRM-4320
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">572</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp;</span><span class="sf17b16">if</span><span class="sf17b16"> ($</span><span class="sf17b16">form-&gt;_bypassPayment) {
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">573</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp;$</span><span class="sf17b16">attributes = NULL;
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">574</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp;</span><span class="sf17b16">if</span><span class="sf17b16"> ($</span><span class="sf17b16">showHidePayfieldName == </span><span class="sf17b16">'billing-payment-block'</span><span class="sf17b16"> &amp;&amp; $</span><span class="sf17b16">showHidePaymentInformation) {
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">575</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf17b16">attributes = </span><span class="sf17b16">array</span><span class="sf17b16">(</span><span class="sf17b16">'onclick'</span><span class="sf17b16"> =&gt; </span><span class="sf17b16">"showHidePaymentInfo();"</span><span class="sf17b16">);
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">576</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp;}
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">577</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp;</span><span class="sf17b16">if</span><span class="sf17b16"> ($</span><span class="sf17b16">showHidePayfieldName == </span><span class="sf17b16">'PayPalExpress'</span><span class="sf17b16">) {
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">578</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf17b16">attributes = </span><span class="sf17b16">array</span><span class="sf17b16">(</span><span class="sf17b16">'onclick'</span><span class="sf17b16"> =&gt; </span><span class="sf17b16">"showHidePayPalExpressOption();"</span><span class="sf17b16">);
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">579</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp;}
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">580</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp;$</span><span class="sf17b16">form-&gt;</span><span class="sf17b16">addElement</span><span class="sf17b16">(</span><span class="sf17b16">'hidden'</span><span class="sf17b16">, </span><span class="sf17b16">'bypass_payment'</span><span class="sf17b16">, </span><span class="sf17b16">NULL, array</span><span class="sf17b16">(</span><span class="sf17b16">'id'</span><span class="sf17b16"> =&gt; </span><span class="sf17b16">'bypass_payment'</span><span class="sf17b16">));
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">581</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp;}
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">582</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp;$</span><span class="sf17b16">form-&gt;</span><span class="sf17b16">assign</span><span class="sf17b16">(</span><span class="sf17b16">'bypassPayment'</span><span class="sf17b16">, $</span><span class="sf17b16">form-&gt;_bypassPayment);
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">583</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp;$</span><span class="sf17b16">form-&gt;</span><span class="sf17b16">assign</span><span class="sf17b16">(</span><span class="sf17b16">'showHidePaymentInformation'</span><span class="sf17b16">, $</span><span class="sf17b16">showHidePaymentInformation);
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">584</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp;}
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">585</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp;
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">555</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf9b2">/**</span></code></td>
<td class="ln">586</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf9b2">/**</span></code></td>
</tr>
<tr valign="top">
<td class="ln">556</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * build the radio/text form elements for the amount field</span></code></td>
<td class="ln">587</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * build the radio/text form elements for the amount field</span></code></td>
</tr>
<tr valign="top">
<td class="ln">557</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; *</span></code></td>
<td class="ln">588</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; *</span></code></td>
</tr>
<tr valign="top">
<td class="ln">558</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @param object &nbsp; $form form object</span></code></td>
<td class="ln">589</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @param object &nbsp; $form form object</span></code></td>
</tr>
<tr valign="top">
<td class="ln">559</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @param boolean &nbsp;$required &nbsp;true if you want to add formRule</span></code></td>
<td class="ln">590</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @param boolean &nbsp;$required &nbsp;true if you want to add formRule</span></code></td>
</tr>
<tr valign="top">
<td class="ln">560</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @param int &nbsp; &nbsp; &nbsp;$discountId discount id for the event</span></code></td>
<td class="ln">591</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @param int &nbsp; &nbsp; &nbsp;$discountId discount id for the event</span></code></td>
</tr>
<tr valign="top">
<td class="ln">561</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; *</span></code></td>
<td class="ln">592</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; *</span></code></td>
</tr>
<tr valign="top">
<td class="ln">562</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @return void</span></code></td>
<td class="ln">593</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @return void</span></code></td>
</tr>
<tr valign="top">
<td class="ln">563</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @access public</span></code></td>
<td class="ln">594</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @access public</span></code></td>
</tr>
<tr valign="top">
<td class="ln">564</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @static</span></code></td>
<td class="ln">595</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @static</span></code></td>
</tr>
<tr valign="top">
<td class="ln">565</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; */</span>&nbsp;</code></td>
<td class="ln">596</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; */</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">566</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf7b2">static</span><span class="sf3b2"> </span><span class="sf8b2">public function buildAmount</span><span class="sf3b2">(&amp;$</span><span class="sf18b2">form, $</span><span class="sf18b2">required = TRUE, $</span><span class="sf18b2">discountId = NULL) {</span></code></td>
<td class="ln">597</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf7b2">static</span><span class="sf3b2"> </span><span class="sf8b2">public function buildAmount</span><span class="sf3b2">(&amp;$</span><span class="sf18b2">form, $</span><span class="sf18b2">required = TRUE, $</span><span class="sf18b2">discountId = NULL) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">567</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">//if payment done, no need to build the fee block.</span></code></td>
<td class="ln">598</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">//if payment done, no need to build the fee block.</span></code></td>
</tr>
<tr valign="top">
<td class="ln">568</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf7b2">isset</span><span class="sf3b2">($</span><span class="sf18b2">form-&gt;_paymentId) &amp;&amp; $</span><span class="sf18b2">form-&gt;_paymentId) {</span></code></td>
<td class="ln">599</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf7b2">isset</span><span class="sf3b2">($</span><span class="sf18b2">form-&gt;_paymentId) &amp;&amp; $</span><span class="sf18b2">form-&gt;_paymentId) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">569</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">//fix to diaplay line item in update mode.</span></code></td>
<td class="ln">600</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">//fix to diaplay line item in update mode.</span></code></td>
</tr>
<tr valign="top">
<td class="ln">570</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">form-&gt;</span><span class="sf8b2">assign</span><span class="sf3b2">(</span><span class="sf12b2">'priceSet'</span><span class="sf3b2">, </span><span class="sf7b2">isset</span><span class="sf3b2">($</span><span class="sf18b2">form-&gt;_priceSet) ? $</span><span class="sf18b2">form-&gt;_priceSet : NULL);</span></code></td>
<td class="ln">601</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">form-&gt;</span><span class="sf8b2">assign</span><span class="sf3b2">(</span><span class="sf12b2">'priceSet'</span><span class="sf3b2">, </span><span class="sf7b2">isset</span><span class="sf3b2">($</span><span class="sf18b2">form-&gt;_priceSet) ? $</span><span class="sf18b2">form-&gt;_priceSet : NULL);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">571</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">return</span><span class="sf3b2">;</span></code></td>
<td class="ln">602</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">return</span><span class="sf3b2">;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">572</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">603</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">573</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">604</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">574</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">feeFields = </span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'fee'</span><span class="sf3b2">, $</span><span class="sf18b2">form-&gt;_values);</span></code></td>
<td class="ln">605</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">feeFields = </span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'fee'</span><span class="sf3b2">, $</span><span class="sf18b2">form-&gt;_values);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">575</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">606</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">576</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">is_array</span><span class="sf3b2">($</span><span class="sf18b2">feeFields)) {</span></code></td>
<td class="ln">607</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">is_array</span><span class="sf3b2">($</span><span class="sf18b2">feeFields)) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">577</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">form-&gt;_feeBlock = &amp;$</span><span class="sf18b2">form-&gt;_values[</span><span class="sf12b2">'fee'</span><span class="sf3b2">];</span></code></td>
<td class="ln">608</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">form-&gt;_feeBlock = &amp;$</span><span class="sf18b2">form-&gt;_values[</span><span class="sf12b2">'fee'</span><span class="sf3b2">];</span></code></td>
</tr>
<tr valign="top">
<td class="ln">578</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">609</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">579</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">610</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">580</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">//check for discount.</span></code></td>
<td class="ln">611</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">//check for discount.</span></code></td>
</tr>
<tr valign="top">
<td class="ln">581</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">discountedFee = </span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'discount'</span><span class="sf3b2">, $</span><span class="sf18b2">form-&gt;_values);</span></code></td>
<td class="ln">612</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">discountedFee = </span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'discount'</span><span class="sf3b2">, $</span><span class="sf18b2">form-&gt;_values);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">582</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">is_array</span><span class="sf3b2">($</span><span class="sf18b2">discountedFee) &amp;&amp; !</span><span class="sf7b2">empty</span><span class="sf3b2">($</span><span class="sf18b2">discountedFee)) {</span></code></td>
<td class="ln">613</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">is_array</span><span class="sf3b2">($</span><span class="sf18b2">discountedFee) &amp;&amp; !</span><span class="sf7b2">empty</span><span class="sf3b2">($</span><span class="sf18b2">discountedFee)) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">583</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!$</span><span class="sf18b2">discountId) {</span></code></td>
<td class="ln">614</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!$</span><span class="sf18b2">discountId) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">584</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">form-&gt;_discountId = $</span><span class="sf18b2">discountId = </span><span class="sf8b2">CRM_Core_BAO_Discount::findSet</span><span class="sf3b2">($</span><span class="sf18b2">form-&gt;_eventId, </span><span class="sf12b2">'civicrm_event'</span><span class="sf3b2">);</span></code></td>
<td class="ln">615</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">form-&gt;_discountId = $</span><span class="sf18b2">discountId = </span><span class="sf8b2">CRM_Core_BAO_Discount::findSet</span><span class="sf3b2">($</span><span class="sf18b2">form-&gt;_eventId, </span><span class="sf12b2">'civicrm_event'</span><span class="sf3b2">);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">585</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">616</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">586</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">discountId) {</span></code></td>
<td class="ln">617</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">discountId) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">587</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">form-&gt;_feeBlock = &amp;$</span><span class="sf18b2">form-&gt;_values[</span><span class="sf12b2">'discount'</span><span class="sf3b2">][$</span><span class="sf18b2">discountId];</span></code></td>
<td class="ln">618</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">form-&gt;_feeBlock = &amp;$</span><span class="sf18b2">form-&gt;_values[</span><span class="sf12b2">'discount'</span><span class="sf3b2">][$</span><span class="sf18b2">discountId];</span></code></td>
</tr>
<tr valign="top">
<td class="ln">588</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">619</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">589</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">620</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">590</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!</span><span class="sf8b2">is_array</span><span class="sf3b2">($</span><span class="sf18b2">form-&gt;_feeBlock)) {</span></code></td>
<td class="ln">621</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!</span><span class="sf8b2">is_array</span><span class="sf3b2">($</span><span class="sf18b2">form-&gt;_feeBlock)) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">591</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">form-&gt;</span><span class="sf8b2">_feeBlock = array</span><span class="sf3b2">();</span></code></td>
<td class="ln">622</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">form-&gt;</span><span class="sf8b2">_feeBlock = array</span><span class="sf3b2">();</span></code></td>
</tr>
<tr valign="top">
<td class="ln">592</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">623</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">593</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">624</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">594</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">//its time to call the hook.</span></code></td>
<td class="ln">625</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">//its time to call the hook.</span></code></td>
</tr>
<tr valign="top">
<td class="ln">595</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf8b2">CRM_Utils_Hook::buildAmount</span><span class="sf3b2">(</span><span class="sf12b2">'event'</span><span class="sf3b2">, $</span><span class="sf18b2">form, $</span><span class="sf18b2">form-&gt;_feeBlock);</span></code></td>
<td class="ln">626</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf8b2">CRM_Utils_Hook::buildAmount</span><span class="sf3b2">(</span><span class="sf12b2">'event'</span><span class="sf3b2">, $</span><span class="sf18b2">form, $</span><span class="sf18b2">form-&gt;_feeBlock);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">596</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">627</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">597</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">//reset required if participant is skipped.</span></code></td>
<td class="ln">628</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">//reset required if participant is skipped.</span></code></td>
</tr>
<tr valign="top">
<td class="ln">598</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">button = </span><span class="sf8b2">substr</span><span class="sf3b2">($</span><span class="sf18b2">form-&gt;</span><span class="sf8b2">controller-&gt;getButtonName</span><span class="sf3b2">(), -</span><span class="sf10b2">4</span><span class="sf3b2">);</span></code></td>
<td class="ln">629</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">button = </span><span class="sf8b2">substr</span><span class="sf3b2">($</span><span class="sf18b2">form-&gt;</span><span class="sf8b2">controller-&gt;getButtonName</span><span class="sf3b2">(), -</span><span class="sf10b2">4</span><span class="sf3b2">);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">599</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">required &amp;&amp; $</span><span class="sf18b2">button == </span><span class="sf12b2">'skip'</span><span class="sf3b2">) {</span></code></td>
<td class="ln">630</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">required &amp;&amp; $</span><span class="sf18b2">button == </span><span class="sf12b2">'skip'</span><span class="sf3b2">) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">600</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">required = FALSE;</span></code></td>
<td class="ln">631</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">required = FALSE;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">601</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">632</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">602</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">633</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">603</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">className = </span><span class="sf8b2">CRM_Utils_System::getClassName</span><span class="sf3b2">($</span><span class="sf18b2">form);</span></code></td>
<td class="ln">634</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">className = </span><span class="sf8b2">CRM_Utils_System::getClassName</span><span class="sf3b2">($</span><span class="sf18b2">form);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">604</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">635</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">605</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">//build the priceset fields.</span></code></td>
<td class="ln">636</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">//build the priceset fields.</span></code></td>
</tr>
<tr valign="top">
<td class="ln">606</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf7b2">isset</span><span class="sf3b2">($</span><span class="sf18b2">form-&gt;_priceSetId) &amp;&amp; $</span><span class="sf18b2">form-&gt;_priceSetId) {</span></code></td>
<td class="ln">637</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf7b2">isset</span><span class="sf3b2">($</span><span class="sf18b2">form-&gt;_priceSetId) &amp;&amp; $</span><span class="sf18b2">form-&gt;_priceSetId) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">607</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">638</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">608</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">//format price set fields across option full.</span></code></td>
<td class="ln">639</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">//format price set fields across option full.</span></code></td>
</tr>
<tr valign="top">
<td class="ln">609</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">self::formatFieldsForOptionFull</span><span class="sf3b2">($</span><span class="sf18b2">form);</span></code></td>
<td class="ln">640</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">self::formatFieldsForOptionFull</span><span class="sf3b2">($</span><span class="sf18b2">form);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">610</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">641</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">611</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">form-&gt;</span><span class="sf8b2">add</span><span class="sf3b2">(</span><span class="sf12b2">'hidden'</span><span class="sf3b2">, </span><span class="sf12b2">'priceSetId'</span><span class="sf3b2">, $</span><span class="sf18b2">form-&gt;_priceSetId);</span></code></td>
<td class="ln">642</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">form-&gt;</span><span class="sf8b2">add</span><span class="sf3b2">(</span><span class="sf12b2">'hidden'</span><span class="sf3b2">, </span><span class="sf12b2">'priceSetId'</span><span class="sf3b2">, $</span><span class="sf18b2">form-&gt;_priceSetId);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">612</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">643</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">613</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">foreach</span><span class="sf3b2"> ($</span><span class="sf18b2">form-&gt;_feeBlock as $</span><span class="sf18b2">field) {</span></code></td>
<td class="ln">644</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">foreach</span><span class="sf3b2"> ($</span><span class="sf18b2">form-&gt;_feeBlock as $</span><span class="sf18b2">field) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">614</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'visibility'</span><span class="sf3b2">, $</span><span class="sf18b2">field) == </span><span class="sf12b2">'public'</span><span class="sf3b2"> ||</span></code></td>
<td class="ln">645</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'visibility'</span><span class="sf3b2">, $</span><span class="sf18b2">field) == </span><span class="sf12b2">'public'</span><span class="sf3b2"> ||</span></code></td>
</tr>
<tr valign="top">
<td class="ln">615</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">className == </span><span class="sf12b2">'CRM_Event_Form_Participant'</span>&nbsp;</code></td>
<td class="ln">646</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">className == </span><span class="sf12b2">'CRM_Event_Form_Participant'</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">616</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;) {</span></code></td>
<td class="ln">647</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">617</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">fieldId = $</span><span class="sf18b2">field[</span><span class="sf12b2">'id'</span><span class="sf3b2">];</span></code></td>
<td class="ln">648</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">fieldId = $</span><span class="sf18b2">field[</span><span class="sf12b2">'id'</span><span class="sf3b2">];</span></code></td>
</tr>
<tr valign="top">
<td class="ln">618</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">elementName = </span><span class="sf12b2">'price_'</span><span class="sf3b2"> . $</span><span class="sf18b2">fieldId;</span></code></td>
<td class="ln">649</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">elementName = </span><span class="sf12b2">'price_'</span><span class="sf3b2"> . $</span><span class="sf18b2">fieldId;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">619</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">650</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">620</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">isRequire = </span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'is_required'</span><span class="sf3b2">, $</span><span class="sf18b2">field);</span></code></td>
<td class="ln">651</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">isRequire = </span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'is_required'</span><span class="sf3b2">, $</span><span class="sf18b2">field);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">621</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">button == </span><span class="sf12b2">'skip'</span><span class="sf3b2">) {</span></code></td>
<td class="ln">652</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">button == </span><span class="sf12b2">'skip'</span><span class="sf3b2">) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">622</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">isRequire = FALSE;</span></code></td>
<td class="ln">653</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">isRequire = FALSE;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">623</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">654</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">624</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">655</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">625</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">//user might modified w/ hook.</span></code></td>
<td class="ln">656</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">//user might modified w/ hook.</span></code></td>
</tr>
<tr valign="top">
<td class="ln">626</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">options = </span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'options'</span><span class="sf3b2">, $</span><span class="sf18b2">field);</span></code></td>
<td class="ln">657</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">options = </span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'options'</span><span class="sf3b2">, $</span><span class="sf18b2">field);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">627</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!</span><span class="sf8b2">is_array</span><span class="sf3b2">($</span><span class="sf18b2">options)) {</span></code></td>
<td class="ln">658</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!</span><span class="sf8b2">is_array</span><span class="sf3b2">($</span><span class="sf18b2">options)) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">628</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">continue</span><span class="sf3b2">;</span></code></td>
<td class="ln">659</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">continue</span><span class="sf3b2">;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">629</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">660</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">630</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">661</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">631</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">optionFullIds = </span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'option_full_ids'</span><span class="sf3b2">, $</span><span class="sf18b2">field, </span><span class="sf7b2">array</span><span class="sf3b2">());</span></code></td>
<td class="ln">662</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">optionFullIds = </span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'option_full_ids'</span><span class="sf3b2">, $</span><span class="sf18b2">field, </span><span class="sf7b2">array</span><span class="sf3b2">());</span></code></td>
</tr>
<tr valign="top">
<td class="ln">632</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">663</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">633</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">//soft suppress required rule when option is full.</span></code></td>
<td class="ln">664</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">//soft suppress required rule when option is full.</span></code></td>
</tr>
<tr valign="top">
<td class="ln">634</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!</span><span class="sf7b2">empty</span><span class="sf3b2">($</span><span class="sf18b2">optionFullIds) &amp;&amp; (</span><span class="sf8b2">count</span><span class="sf3b2">($</span><span class="sf18b2">options) == </span><span class="sf8b2">count</span><span class="sf3b2">($</span><span class="sf18b2">optionFullIds))) {</span></code></td>
<td class="ln">665</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!</span><span class="sf7b2">empty</span><span class="sf3b2">($</span><span class="sf18b2">optionFullIds) &amp;&amp; (</span><span class="sf8b2">count</span><span class="sf3b2">($</span><span class="sf18b2">options) == </span><span class="sf8b2">count</span><span class="sf3b2">($</span><span class="sf18b2">optionFullIds))) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">635</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">isRequire = FALSE;</span></code></td>
<td class="ln">666</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">isRequire = FALSE;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">636</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">667</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">637</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">668</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">638</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">//build the element.</span></code></td>
<td class="ln">669</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">//build the element.</span></code></td>
</tr>
<tr valign="top">
<td class="ln">639</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">CRM_Price_BAO_Field::addQuickFormElement</span><span class="sf3b2">($</span><span class="sf18b2">form,</span></code></td>
<td class="ln">670</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">CRM_Price_BAO_Field::addQuickFormElement</span><span class="sf3b2">($</span><span class="sf18b2">form,</span></code></td>
</tr>
<tr valign="top">
<td class="ln">640</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">elementName,</span></code></td>
<td class="ln">671</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">elementName,</span></code></td>
</tr>
<tr valign="top">
<td class="ln">641</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">fieldId,</span></code></td>
<td class="ln">672</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">fieldId,</span></code></td>
</tr>
<tr valign="top">
<td class="ln">642</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;FALSE,</span></code></td>
<td class="ln">673</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;FALSE,</span></code></td>
</tr>
<tr valign="top">
<td class="ln">643</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">isRequire,</span></code></td>
<td class="ln">674</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">isRequire,</span></code></td>
</tr>
<tr valign="top">
<td class="ln">644</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;NULL,</span></code></td>
<td class="ln">675</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;NULL,</span></code></td>
</tr>
<tr valign="top">
<td class="ln">645</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">options,</span></code></td>
<td class="ln">676</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">options,</span></code></td>
</tr>
<tr valign="top">
<td class="ln">646</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$optionFullIds</span></code></td>
<td class="ln">677</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$optionFullIds</span></code></td>
</tr>
<tr valign="top">
<td class="ln">647</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;);</span></code></td>
<td class="ln">678</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">648</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">679</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">649</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">680</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">650</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">form-&gt;</span><span class="sf8b2">assign</span><span class="sf3b2">(</span><span class="sf12b2">'priceSet'</span><span class="sf3b2">, $</span><span class="sf18b2">form-&gt;_priceSet);</span></code></td>
<td class="ln">681</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">form-&gt;</span><span class="sf8b2">assign</span><span class="sf3b2">(</span><span class="sf12b2">'priceSet'</span><span class="sf3b2">, $</span><span class="sf18b2">form-&gt;_priceSet);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">651</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">682</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">652</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">else</span><span class="sf3b2"> {</span></code></td>
<td class="ln">683</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">else</span><span class="sf3b2"> {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">653</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">eventFeeBlockValues = </span><span class="sf7b2">array</span><span class="sf3b2">();</span></code></td>
<td class="ln">684</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">eventFeeBlockValues = </span><span class="sf7b2">array</span><span class="sf3b2">();</span></code></td>
</tr>
<tr valign="top">
<td class="ln">654</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">foreach</span><span class="sf3b2"> ($</span><span class="sf18b2">form-&gt;_feeBlock as $</span><span class="sf18b2">fee) {</span></code></td>
<td class="ln">685</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">foreach</span><span class="sf3b2"> ($</span><span class="sf18b2">form-&gt;_feeBlock as $</span><span class="sf18b2">fee) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">655</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">is_array</span><span class="sf3b2">($</span><span class="sf18b2">fee)) {</span></code></td>
<td class="ln">686</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">is_array</span><span class="sf3b2">($</span><span class="sf18b2">fee)) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">656</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">687</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">657</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">//CRM-7632, CRM-6201</span></code></td>
<td class="ln">688</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">//CRM-7632, CRM-6201</span></code></td>
</tr>
<tr valign="top">
<td class="ln">658</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">totalAmountJs = NULL;</span></code></td>
<td class="ln">689</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">totalAmountJs = NULL;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">659</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">className == </span><span class="sf12b2">'CRM_Event_Form_Participant'</span><span class="sf3b2">) {</span></code></td>
<td class="ln">690</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">className == </span><span class="sf12b2">'CRM_Event_Form_Participant'</span><span class="sf3b2">) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">660</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">totalAmountJs = </span><span class="sf7b2">array</span><span class="sf3b2">(</span><span class="sf12b2">'onClick'</span><span class="sf3b2"> =&gt; </span><span class="sf12b2">"fillTotalAmount("</span><span class="sf3b2"> . $</span><span class="sf18b2">fee[</span><span class="sf12b2">'value'</span><span class="sf3b2">] . </span><span class="sf12b2">")"</span><span class="sf3b2">);</span></code></td>
<td class="ln">691</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">totalAmountJs = </span><span class="sf7b2">array</span><span class="sf3b2">(</span><span class="sf12b2">'onClick'</span><span class="sf3b2"> =&gt; </span><span class="sf12b2">"fillTotalAmount("</span><span class="sf3b2"> . $</span><span class="sf18b2">fee[</span><span class="sf12b2">'value'</span><span class="sf3b2">] . </span><span class="sf12b2">")"</span><span class="sf3b2">);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">661</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">692</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">662</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">693</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">663</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">eventFeeBlockValues[</span><span class="sf12b2">'amount_id_'</span><span class="sf3b2"> . $</span><span class="sf18b2">fee[</span><span class="sf12b2">'amount_id'</span><span class="sf3b2">]] = $</span><span class="sf18b2">fee[</span><span class="sf12b2">'value'</span><span class="sf3b2">];</span></code></td>
<td class="ln">694</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">eventFeeBlockValues[</span><span class="sf12b2">'amount_id_'</span><span class="sf3b2"> . $</span><span class="sf18b2">fee[</span><span class="sf12b2">'amount_id'</span><span class="sf3b2">]] = $</span><span class="sf18b2">fee[</span><span class="sf12b2">'value'</span><span class="sf3b2">];</span></code></td>
</tr>
<tr valign="top">
<td class="ln">664</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">elements[] = &amp;$</span><span class="sf18b2">form-&gt;</span><span class="sf8b2">createElement</span><span class="sf3b2">(</span><span class="sf12b2">'radio'</span><span class="sf3b2">, NULL, </span><span class="sf12b2">''</span><span class="sf3b2">,</span></code></td>
<td class="ln">695</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">elements[] = &amp;$</span><span class="sf18b2">form-&gt;</span><span class="sf8b2">createElement</span><span class="sf3b2">(</span><span class="sf12b2">'radio'</span><span class="sf3b2">, NULL, </span><span class="sf12b2">''</span><span class="sf3b2">,</span></code></td>
</tr>
<tr valign="top">
<td class="ln">665</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">CRM_Utils_Money::format</span><span class="sf3b2">($</span><span class="sf18b2">fee[</span><span class="sf12b2">'value'</span><span class="sf3b2">]) . </span><span class="sf12b2">' '</span><span class="sf3b2"> .</span></code></td>
<td class="ln">696</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">CRM_Utils_Money::format</span><span class="sf3b2">($</span><span class="sf18b2">fee[</span><span class="sf12b2">'value'</span><span class="sf3b2">]) . </span><span class="sf12b2">' '</span><span class="sf3b2"> .</span></code></td>
</tr>
<tr valign="top">
<td class="ln">666</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">fee[</span><span class="sf12b2">'label'</span><span class="sf3b2">],</span></code></td>
<td class="ln">697</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">fee[</span><span class="sf12b2">'label'</span><span class="sf3b2">],</span></code></td>
</tr>
<tr valign="top">
<td class="ln">667</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">fee[</span><span class="sf12b2">'amount_id'</span><span class="sf3b2">],</span></code></td>
<td class="ln">698</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">fee[</span><span class="sf12b2">'amount_id'</span><span class="sf3b2">],</span></code></td>
</tr>
<tr valign="top">
<td class="ln">668</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$totalAmountJs</span></code></td>
<td class="ln">699</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$totalAmountJs</span></code></td>
</tr>
<tr valign="top">
<td class="ln">669</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;);</span></code></td>
<td class="ln">700</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">670</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">701</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">671</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">702</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">672</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">form-&gt;</span><span class="sf8b2">assign</span><span class="sf3b2">(</span><span class="sf12b2">'eventFeeBlockValues'</span><span class="sf3b2">, </span><span class="sf8b2">json_encode</span><span class="sf3b2">($</span><span class="sf18b2">eventFeeBlockValues));</span></code></td>
<td class="ln">703</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">form-&gt;</span><span class="sf8b2">assign</span><span class="sf3b2">(</span><span class="sf12b2">'eventFeeBlockValues'</span><span class="sf3b2">, </span><span class="sf8b2">json_encode</span><span class="sf3b2">($</span><span class="sf18b2">eventFeeBlockValues));</span></code></td>
</tr>
<tr valign="top">
<td class="ln">673</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">704</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">674</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">form-&gt;_defaults[</span><span class="sf12b2">'amount'</span><span class="sf3b2">] = CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'default_fee_id'</span><span class="sf3b2">, $</span><span class="sf18b2">form-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">]);</span></code></td>
<td class="ln">705</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">form-&gt;_defaults[</span><span class="sf12b2">'amount'</span><span class="sf3b2">] = CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'default_fee_id'</span><span class="sf3b2">, $</span><span class="sf18b2">form-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">]);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">675</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">element = &amp;$</span><span class="sf18b2">form-&gt;</span><span class="sf8b2">addGroup</span><span class="sf3b2">($</span><span class="sf18b2">elements, </span><span class="sf12b2">'amount'</span><span class="sf3b2">, </span><span class="sf8b2">ts</span><span class="sf3b2">(</span><span class="sf12b2">'Event Fee(s)'</span><span class="sf3b2">), </span><span class="sf12b2">'&lt;br /&gt;'</span><span class="sf3b2">);</span></code></td>
<td class="ln">706</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">element = &amp;$</span><span class="sf18b2">form-&gt;</span><span class="sf8b2">addGroup</span><span class="sf3b2">($</span><span class="sf18b2">elements, </span><span class="sf12b2">'amount'</span><span class="sf3b2">, </span><span class="sf8b2">ts</span><span class="sf3b2">(</span><span class="sf12b2">'Event Fee(s)'</span><span class="sf3b2">), </span><span class="sf12b2">'&lt;br /&gt;'</span><span class="sf3b2">);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">676</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf7b2">isset</span><span class="sf3b2">($</span><span class="sf18b2">form-&gt;_online) &amp;&amp; $</span><span class="sf18b2">form-&gt;_online) {</span></code></td>
<td class="ln">707</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf7b2">isset</span><span class="sf3b2">($</span><span class="sf18b2">form-&gt;_online) &amp;&amp; $</span><span class="sf18b2">form-&gt;_online) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">677</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">element-&gt;</span><span class="sf8b2">freeze</span><span class="sf3b2">();</span></code></td>
<td class="ln">708</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">element-&gt;</span><span class="sf8b2">freeze</span><span class="sf3b2">();</span></code></td>
</tr>
<tr valign="top">
<td class="ln">678</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">709</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">679</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">required) {</span></code></td>
<td class="ln">710</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">required) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">680</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">form-&gt;</span><span class="sf8b2">addRule</span><span class="sf3b2">(</span><span class="sf12b2">'amount'</span><span class="sf3b2">, </span><span class="sf8b2">ts</span><span class="sf3b2">(</span><span class="sf12b2">'Fee Level is a required field.'</span><span class="sf3b2">), </span><span class="sf12b2">'required'</span><span class="sf3b2">);</span></code></td>
<td class="ln">711</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">form-&gt;</span><span class="sf8b2">addRule</span><span class="sf3b2">(</span><span class="sf12b2">'amount'</span><span class="sf3b2">, </span><span class="sf8b2">ts</span><span class="sf3b2">(</span><span class="sf12b2">'Fee Level is a required field.'</span><span class="sf3b2">), </span><span class="sf12b2">'required'</span><span class="sf3b2">);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">681</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">712</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">682</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">713</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">683</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;}</span></code></td>
<td class="ln">714</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">684</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">715</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">685</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf8b2">public static function formatFieldsForOptionFull</span><span class="sf3b2">(&amp;$</span><span class="sf18b2">form) {</span></code></td>
<td class="ln">716</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf8b2">public static function formatFieldsForOptionFull</span><span class="sf3b2">(&amp;$</span><span class="sf18b2">form) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">686</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">priceSet = $</span><span class="sf18b2">form-&gt;</span><span class="sf8b2">get</span><span class="sf3b2">(</span><span class="sf12b2">'priceSet'</span><span class="sf3b2">);</span></code></td>
<td class="ln">717</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">priceSet = $</span><span class="sf18b2">form-&gt;</span><span class="sf8b2">get</span><span class="sf3b2">(</span><span class="sf12b2">'priceSet'</span><span class="sf3b2">);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">687</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">priceSetId = $</span><span class="sf18b2">form-&gt;</span><span class="sf8b2">get</span><span class="sf3b2">(</span><span class="sf12b2">'priceSetId'</span><span class="sf3b2">);</span></code></td>
<td class="ln">718</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">priceSetId = $</span><span class="sf18b2">form-&gt;</span><span class="sf8b2">get</span><span class="sf3b2">(</span><span class="sf12b2">'priceSetId'</span><span class="sf3b2">);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">688</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!$</span><span class="sf18b2">priceSetId ||</span></code></td>
<td class="ln">719</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!$</span><span class="sf18b2">priceSetId ||</span></code></td>
</tr>
<tr valign="top">
<td class="ln">689</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;!</span><span class="sf8b2">is_array</span><span class="sf3b2">($</span><span class="sf18b2">priceSet) ||</span></code></td>
<td class="ln">720</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;!</span><span class="sf8b2">is_array</span><span class="sf3b2">($</span><span class="sf18b2">priceSet) ||</span></code></td>
</tr>
<tr valign="top">
<td class="ln">690</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">empty</span><span class="sf3b2">($</span><span class="sf18b2">priceSet) ||</span></code></td>
<td class="ln">721</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">empty</span><span class="sf3b2">($</span><span class="sf18b2">priceSet) ||</span></code></td>
</tr>
<tr valign="top">
<td class="ln">691</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;!</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'optionsMaxValueTotal'</span><span class="sf3b2">, $</span><span class="sf18b2">priceSet)</span></code></td>
<td class="ln">722</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;!</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'optionsMaxValueTotal'</span><span class="sf3b2">, $</span><span class="sf18b2">priceSet)</span></code></td>
</tr>
<tr valign="top">
<td class="ln">692</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;) {</span></code></td>
<td class="ln">723</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">693</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">return</span><span class="sf3b2">;</span></code></td>
<td class="ln">724</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">return</span><span class="sf3b2">;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">694</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">725</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">695</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">726</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">696</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">skipParticipants = $</span><span class="sf18b2">formattedPriceSetDefaults = </span><span class="sf7b2">array</span><span class="sf3b2">();</span></code></td>
<td class="ln">727</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">skipParticipants = $</span><span class="sf18b2">formattedPriceSetDefaults = </span><span class="sf7b2">array</span><span class="sf3b2">();</span></code></td>
</tr>
<tr valign="top">
<td class="ln">697</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">form-&gt;</span><span class="sf8b2">_allowConfirmation &amp;&amp;</span><span class="sf3b2"> (</span><span class="sf7b2">isset</span><span class="sf3b2">($</span><span class="sf18b2">form-&gt;</span><span class="sf8b2">_pId) || isset</span><span class="sf3b2">($</span><span class="sf18b2">form-&gt;_additionalParticipantId))) {</span></code></td>
<td class="ln">728</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">form-&gt;</span><span class="sf8b2">_allowConfirmation &amp;&amp;</span><span class="sf3b2"> (</span><span class="sf7b2">isset</span><span class="sf3b2">($</span><span class="sf18b2">form-&gt;</span><span class="sf8b2">_pId) || isset</span><span class="sf3b2">($</span><span class="sf18b2">form-&gt;_additionalParticipantId))) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">698</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">participantId = </span><span class="sf7b2">isset</span><span class="sf3b2">($</span><span class="sf18b2">form-&gt;_pId) ? $</span><span class="sf18b2">form-&gt;_pId : $</span><span class="sf18b2">form-&gt;_additionalParticipantId;</span></code></td>
<td class="ln">729</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">participantId = </span><span class="sf7b2">isset</span><span class="sf3b2">($</span><span class="sf18b2">form-&gt;_pId) ? $</span><span class="sf18b2">form-&gt;_pId : $</span><span class="sf18b2">form-&gt;_additionalParticipantId;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">699</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">pricesetDefaults = </span><span class="sf8b2">CRM_Event_Form_EventFees::setDefaultPriceSet</span><span class="sf3b2">($</span><span class="sf18b2">parti<wbr>cipantId,</span></code></td>
<td class="ln">730</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">pricesetDefaults = </span><span class="sf8b2">CRM_Event_Form_EventFees::setDefaultPriceSet</span><span class="sf3b2">($</span><span class="sf18b2">parti<wbr>cipantId,</span></code></td>
</tr>
<tr valign="top">
<td class="ln">700</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">form-&gt;_eventId</span></code></td>
<td class="ln">731</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">form-&gt;_eventId</span></code></td>
</tr>
<tr valign="top">
<td class="ln">701</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;);</span></code></td>
<td class="ln">732</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">702</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">// modify options full to respect the selected fields</span></code></td>
<td class="ln">733</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">// modify options full to respect the selected fields</span></code></td>
</tr>
<tr valign="top">
<td class="ln">703</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">// options on confirmation.</span></code></td>
<td class="ln">734</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">// options on confirmation.</span></code></td>
</tr>
<tr valign="top">
<td class="ln">704</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">formattedPriceSetDefaults = </span><span class="sf8b2">self::formatPriceSetParams</span><span class="sf3b2">($</span><span class="sf18b2">form, $</span><span class="sf18b2">pricesetDefaultOptions);</span></code></td>
<td class="ln">735</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">formattedPriceSetDefaults = </span><span class="sf8b2">self::formatPriceSetParams</span><span class="sf3b2">($</span><span class="sf18b2">form, $</span><span class="sf18b2">pricesetDefaultOptions);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">705</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">736</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">706</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">// to skip current registered participants fields option count on confirmation.</span></code></td>
<td class="ln">737</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">// to skip current registered participants fields option count on confirmation.</span></code></td>
</tr>
<tr valign="top">
<td class="ln">707</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">skipParticipants[] = $</span><span class="sf18b2">form-&gt;_participantId;</span></code></td>
<td class="ln">738</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">skipParticipants[] = $</span><span class="sf18b2">form-&gt;_participantId;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">708</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!</span><span class="sf7b2">empty</span><span class="sf3b2">($</span><span class="sf18b2">form-&gt;_additionalParticipantIds)) {</span></code></td>
<td class="ln">739</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!</span><span class="sf7b2">empty</span><span class="sf3b2">($</span><span class="sf18b2">form-&gt;_additionalParticipantIds)) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">709</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">skipParticipants = </span><span class="sf8b2">array_merge</span><span class="sf3b2">($</span><span class="sf18b2">skipParticipants, $</span><span class="sf18b2">form-&gt;_additionalParticipantIds);</span></code></td>
<td class="ln">740</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">skipParticipants = </span><span class="sf8b2">array_merge</span><span class="sf3b2">($</span><span class="sf18b2">skipParticipants, $</span><span class="sf18b2">form-&gt;_additionalParticipantIds);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">710</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">741</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">711</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">742</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">712</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">743</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">713</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">className = </span><span class="sf8b2">CRM_Utils_System::getClassName</span><span class="sf3b2">($</span><span class="sf18b2">form);</span></code></td>
<td class="ln">744</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">className = </span><span class="sf8b2">CRM_Utils_System::getClassName</span><span class="sf3b2">($</span><span class="sf18b2">form);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">714</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">745</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">715</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">//get the current price event price set options count.</span></code></td>
<td class="ln">746</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">//get the current price event price set options count.</span></code></td>
</tr>
<tr valign="top">
<td class="ln">716</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">currentOptionsCount = </span><span class="sf8b2">self::getPriceSetOptionCount</span><span class="sf3b2">($</span><span class="sf18b2">form);</span></code></td>
<td class="ln">747</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">currentOptionsCount = </span><span class="sf8b2">self::getPriceSetOptionCount</span><span class="sf3b2">($</span><span class="sf18b2">form);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">717</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">recordedOptionsCount = </span><span class="sf8b2">CRM_Event_BAO_Participant::priceSetOptionsCount</span><span class="sf3b2">($</span><span class="sf18b2">fo<wbr>rm-&gt;_eventId, $</span><span class="sf18b2">skipParticipants);</span></code></td>
<td class="ln">748</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">recordedOptionsCount = </span><span class="sf8b2">CRM_Event_BAO_Participant::priceSetOptionsCount</span><span class="sf3b2">($</span><span class="sf18b2">fo<wbr>rm-&gt;_eventId, $</span><span class="sf18b2">skipParticipants);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">718</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">749</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">719</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">foreach</span><span class="sf3b2"> ($</span><span class="sf18b2">form-&gt;_feeBlock as &amp; $</span><span class="sf18b2">field) {</span></code></td>
<td class="ln">750</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">foreach</span><span class="sf3b2"> ($</span><span class="sf18b2">form-&gt;_feeBlock as &amp; $</span><span class="sf18b2">field) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">720</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">optionFullIds = </span><span class="sf7b2">array</span><span class="sf3b2">();</span></code></td>
<td class="ln">751</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">optionFullIds = </span><span class="sf7b2">array</span><span class="sf3b2">();</span></code></td>
</tr>
<tr valign="top">
<td class="ln">721</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">fieldId = $</span><span class="sf18b2">field[</span><span class="sf12b2">'id'</span><span class="sf3b2">];</span></code></td>
<td class="ln">752</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">fieldId = $</span><span class="sf18b2">field[</span><span class="sf12b2">'id'</span><span class="sf3b2">];</span></code></td>
</tr>
<tr valign="top">
<td class="ln">722</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!</span><span class="sf8b2">is_array</span><span class="sf3b2">($</span><span class="sf18b2">field[</span><span class="sf12b2">'options'</span><span class="sf3b2">])) {</span></code></td>
<td class="ln">753</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!</span><span class="sf8b2">is_array</span><span class="sf3b2">($</span><span class="sf18b2">field[</span><span class="sf12b2">'options'</span><span class="sf3b2">])) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">723</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">continue</span><span class="sf3b2">;</span></code></td>
<td class="ln">754</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">continue</span><span class="sf3b2">;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">724</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">755</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">725</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">foreach</span><span class="sf3b2"> ($</span><span class="sf18b2">field[</span><span class="sf12b2">'options'</span><span class="sf3b2">] </span><span class="sf7b2">as</span><span class="sf3b2"> &amp; $</span><span class="sf18b2">option) {</span></code></td>
<td class="ln">756</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">foreach</span><span class="sf3b2"> ($</span><span class="sf18b2">field[</span><span class="sf12b2">'options'</span><span class="sf3b2">] </span><span class="sf7b2">as</span><span class="sf3b2"> &amp; $</span><span class="sf18b2">option) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">726</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">optId &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; = $</span><span class="sf18b2">option[</span><span class="sf12b2">'id'</span><span class="sf3b2">];</span></code></td>
<td class="ln">757</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">optId &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; = $</span><span class="sf18b2">option[</span><span class="sf12b2">'id'</span><span class="sf3b2">];</span></code></td>
</tr>
<tr valign="top">
<td class="ln">727</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">count &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; = </span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'count'</span><span class="sf3b2">, $</span><span class="sf18b2">option, </span><span class="sf10b2">0</span><span class="sf3b2">);</span></code></td>
<td class="ln">758</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">count &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; = </span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'count'</span><span class="sf3b2">, $</span><span class="sf18b2">option, </span><span class="sf10b2">0</span><span class="sf3b2">);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">728</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">maxValue &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;= </span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'max_value'</span><span class="sf3b2">, $</span><span class="sf18b2">option, </span><span class="sf10b2">0</span><span class="sf3b2">);</span></code></td>
<td class="ln">759</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">maxValue &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;= </span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'max_value'</span><span class="sf3b2">, $</span><span class="sf18b2">option, </span><span class="sf10b2">0</span><span class="sf3b2">);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">729</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">dbTotalCount &nbsp; &nbsp; &nbsp;= </span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">($</span><span class="sf18b2">optId, $</span><span class="sf18b2">recordedOptionsCount, </span><span class="sf10b2">0</span><span class="sf3b2">);</span></code></td>
<td class="ln">760</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">dbTotalCount &nbsp; &nbsp; &nbsp;= </span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">($</span><span class="sf18b2">optId, $</span><span class="sf18b2">recordedOptionsCount, </span><span class="sf10b2">0</span><span class="sf3b2">);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">730</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">currentTotalCount = </span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">($</span><span class="sf18b2">optId, $</span><span class="sf18b2">currentOptionsCount, </span><span class="sf10b2">0</span><span class="sf3b2">);</span></code></td>
<td class="ln">761</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">currentTotalCount = </span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">($</span><span class="sf18b2">optId, $</span><span class="sf18b2">currentOptionsCount, </span><span class="sf10b2">0</span><span class="sf3b2">);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">731</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">762</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">732</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">// Do not consider current count for select field,</span></code></td>
<td class="ln">763</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">// Do not consider current count for select field,</span></code></td>
</tr>
<tr valign="top">
<td class="ln">733</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">// since we are not going to freeze the options.</span></code></td>
<td class="ln">764</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">// since we are not going to freeze the options.</span></code></td>
</tr>
<tr valign="top">
<td class="ln">734</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">field[</span><span class="sf12b2">'html_type'</span><span class="sf3b2">] == </span><span class="sf12b2">'Select'</span><span class="sf3b2">) {</span></code></td>
<td class="ln">765</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">field[</span><span class="sf12b2">'html_type'</span><span class="sf3b2">] == </span><span class="sf12b2">'Select'</span><span class="sf3b2">) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">735</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">totalCount = $</span><span class="sf18b2">dbTotalCount;</span></code></td>
<td class="ln">766</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">totalCount = $</span><span class="sf18b2">dbTotalCount;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">736</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">767</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">737</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">else</span><span class="sf3b2"> {</span></code></td>
<td class="ln">768</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">else</span><span class="sf3b2"> {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">738</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">totalCount = $</span><span class="sf18b2">currentTotalCount + $</span><span class="sf18b2">dbTotalCount;</span></code></td>
<td class="ln">769</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">totalCount = $</span><span class="sf18b2">currentTotalCount + $</span><span class="sf18b2">dbTotalCount;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">739</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">770</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">740</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">771</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">741</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">isFull = FALSE;</span></code></td>
<td class="ln">772</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">isFull = FALSE;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">742</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">maxValue &amp;&amp;</span></code></td>
<td class="ln">773</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">maxValue &amp;&amp;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">743</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;(($</span><span class="sf18b2">totalCount &gt;= $</span><span class="sf18b2">maxValue) || ($</span><span class="sf18b2">totalCount + $</span><span class="sf18b2">count &gt; $</span><span class="sf18b2">maxValue))</span></code></td>
<td class="ln">774</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;(($</span><span class="sf18b2">totalCount &gt;= $</span><span class="sf18b2">maxValue) || ($</span><span class="sf18b2">totalCount + $</span><span class="sf18b2">count &gt; $</span><span class="sf18b2">maxValue))</span></code></td>
</tr>
<tr valign="top">
<td class="ln">744</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;) {</span></code></td>
<td class="ln">775</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">745</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">isFull = TRUE;</span></code></td>
<td class="ln">776</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">isFull = TRUE;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">746</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">optionFullIds[$</span><span class="sf18b2">optId] = $</span><span class="sf18b2">optId;</span></code></td>
<td class="ln">777</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">optionFullIds[$</span><span class="sf18b2">optId] = $</span><span class="sf18b2">optId;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">747</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">778</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">748</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">779</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">749</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">//here option is not full,</span></code></td>
<td class="ln">780</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">//here option is not full,</span></code></td>
</tr>
<tr valign="top">
<td class="ln">750</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">//but we don't want to allow participant to increase</span></code></td>
<td class="ln">781</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">//but we don't want to allow participant to increase</span></code></td>
</tr>
<tr valign="top">
<td class="ln">751</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">//seats at the time of re-walking registration.</span></code></td>
<td class="ln">782</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">//seats at the time of re-walking registration.</span></code></td>
</tr>
<tr valign="top">
<td class="ln">752</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">count &amp;&amp;</span></code></td>
<td class="ln">783</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">count &amp;&amp;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">753</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">form-&gt;_allowConfirmation &amp;&amp;</span></code></td>
<td class="ln">784</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">form-&gt;_allowConfirmation &amp;&amp;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">754</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;!</span><span class="sf7b2">empty</span><span class="sf3b2">($</span><span class="sf18b2">formattedPriceSetDefaults)</span></code></td>
<td class="ln">785</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;!</span><span class="sf7b2">empty</span><span class="sf3b2">($</span><span class="sf18b2">formattedPriceSetDefaults)</span></code></td>
</tr>
<tr valign="top">
<td class="ln">755</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;) {</span></code></td>
<td class="ln">786</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">756</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">"price_{$field}"</span><span class="sf3b2">, $</span><span class="sf18b2">formattedPriceSetDefaults) ||</span></code></td>
<td class="ln">787</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">"price_{$field}"</span><span class="sf3b2">, $</span><span class="sf18b2">formattedPriceSetDefaults) ||</span></code></td>
</tr>
<tr valign="top">
<td class="ln">757</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;!</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">($</span><span class="sf18b2">opId, $</span><span class="sf18b2">formattedPriceSetDefaults[</span><span class="sf12b2">"price_{$fieldId}"</span><span class="sf3b2">])</span></code></td>
<td class="ln">788</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;!</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">($</span><span class="sf18b2">opId, $</span><span class="sf18b2">formattedPriceSetDefaults[</span><span class="sf12b2">"price_{$fieldId}"</span><span class="sf3b2">])</span></code></td>
</tr>
<tr valign="top">
<td class="ln">758</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;) {</span></code></td>
<td class="ln">789</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">759</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">optionFullIds[$</span><span class="sf18b2">optId] = $</span><span class="sf18b2">optId;</span></code></td>
<td class="ln">790</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">optionFullIds[$</span><span class="sf18b2">optId] = $</span><span class="sf18b2">optId;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">760</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">isFull = TRUE;</span></code></td>
<td class="ln">791</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">isFull = TRUE;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">761</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">792</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">762</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">793</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">763</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">option[</span><span class="sf12b2">'is_full'</span><span class="sf3b2">] = $</span><span class="sf18b2">isFull;</span></code></td>
<td class="ln">794</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">option[</span><span class="sf12b2">'is_full'</span><span class="sf3b2">] = $</span><span class="sf18b2">isFull;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">764</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">option[</span><span class="sf12b2">'db_total_count'</span><span class="sf3b2">] = $</span><span class="sf18b2">dbTotalCount;</span></code></td>
<td class="ln">795</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">option[</span><span class="sf12b2">'db_total_count'</span><span class="sf3b2">] = $</span><span class="sf18b2">dbTotalCount;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">765</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">option[</span><span class="sf12b2">'total_option_count'</span><span class="sf3b2">] = $</span><span class="sf18b2">dbTotalCount + $</span><span class="sf18b2">currentTotalCount;</span></code></td>
<td class="ln">796</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">option[</span><span class="sf12b2">'total_option_count'</span><span class="sf3b2">] = $</span><span class="sf18b2">dbTotalCount + $</span><span class="sf18b2">currentTotalCount;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">766</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">797</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">767</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">798</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">768</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">//ignore option full for offline registration.</span></code></td>
<td class="ln">799</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">//ignore option full for offline registration.</span></code></td>
</tr>
<tr valign="top">
<td class="ln">769</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">className == </span><span class="sf12b2">'CRM_Event_Form_Participant'</span><span class="sf3b2">) {</span></code></td>
<td class="ln">800</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">className == </span><span class="sf12b2">'CRM_Event_Form_Participant'</span><span class="sf3b2">) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">770</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">optionFullIds = </span><span class="sf7b2">array</span><span class="sf3b2">();</span></code></td>
<td class="ln">801</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">optionFullIds = </span><span class="sf7b2">array</span><span class="sf3b2">();</span></code></td>
</tr>
<tr valign="top">
<td class="ln">771</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">802</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">772</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">803</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">773</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">//finally get option ids in.</span></code></td>
<td class="ln">804</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">//finally get option ids in.</span></code></td>
</tr>
<tr valign="top">
<td class="ln">774</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">field[</span><span class="sf12b2">'option_full_ids'</span><span class="sf3b2">] = $</span><span class="sf18b2">optionFullIds;</span></code></td>
<td class="ln">805</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">field[</span><span class="sf12b2">'option_full_ids'</span><span class="sf3b2">] = $</span><span class="sf18b2">optionFullIds;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">775</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">806</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">776</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;}</span></code></td>
<td class="ln">807</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">777</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">808</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">778</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf9b2">/**</span></code></td>
<td class="ln">809</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf9b2">/**</span></code></td>
</tr>
<tr valign="top">
<td class="ln">779</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * global form rule</span></code></td>
<td class="ln">810</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * global form rule</span></code></td>
</tr>
<tr valign="top">
<td class="ln">780</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; *</span></code></td>
<td class="ln">811</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; *</span></code></td>
</tr>
<tr valign="top">
<td class="ln">781</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @param array $fields &nbsp;the input form values</span></code></td>
<td class="ln">812</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @param array $fields &nbsp;the input form values</span></code></td>
</tr>
<tr valign="top">
<td class="ln">782</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @param array $files &nbsp; the uploaded files if any</span></code></td>
<td class="ln">813</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @param array $files &nbsp; the uploaded files if any</span></code></td>
</tr>
<tr valign="top">
<td class="ln">783</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @param array $options additional user data</span></code></td>
<td class="ln">814</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @param array $options additional user data</span></code></td>
</tr>
<tr valign="top">
<td class="ln">784</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; *</span></code></td>
<td class="ln">815</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; *</span></code></td>
</tr>
<tr valign="top">
<td class="ln">785</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @return true if no errors, else array of errors</span></code></td>
<td class="ln">816</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @return true if no errors, else array of errors</span></code></td>
</tr>
<tr valign="top">
<td class="ln">786</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @access public</span></code></td>
<td class="ln">817</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @access public</span></code></td>
</tr>
<tr valign="top">
<td class="ln">787</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @static</span></code></td>
<td class="ln">818</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @static</span></code></td>
</tr>
<tr valign="top">
<td class="ln">788</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; */</span>&nbsp;</code></td>
<td class="ln">819</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; */</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">789</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf7b2">static</span><span class="sf3b2"> </span><span class="sf7b2">function</span><span class="sf3b2"> </span><span class="sf8b2">formRule</span><span class="sf3b2">($</span><span class="sf18b2">fields, $</span><span class="sf18b2">files, $</span><span class="sf18b2">self) {</span></code></td>
<td class="ln">820</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf7b2">static</span><span class="sf3b2"> </span><span class="sf7b2">function</span><span class="sf3b2"> </span><span class="sf8b2">formRule</span><span class="sf3b2">($</span><span class="sf18b2">fields, $</span><span class="sf18b2">files, $</span><span class="sf18b2">self) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">790</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">errors = </span><span class="sf7b2">array</span><span class="sf3b2">();</span></code></td>
<td class="ln">821</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">errors = </span><span class="sf7b2">array</span><span class="sf3b2">();</span></code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #e9e9e9; "><code>&nbsp;</code></td>
<td class="ln">822</td><td style="color: #000000; background-color: #fbf2bf; "><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">791</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">//check that either an email or firstname+lastname is included in the form(CRM-9587)</span></code></td>
<td class="ln">823</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">//check that either an email or firstname+lastname is included in the form(CRM-9587)</span></code></td>
</tr>
<tr valign="top">
<td class="ln">792</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf8b2">self::checkProfileComplete</span><span class="sf3b2">($</span><span class="sf18b2">fields, $</span><span class="sf18b2">errors, $</span><span class="sf18b2">self-&gt;_eventId);</span></code></td>
<td class="ln">824</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf8b2">self::checkProfileComplete</span><span class="sf3b2">($</span><span class="sf18b2">fields, $</span><span class="sf18b2">errors, $</span><span class="sf18b2">self-&gt;_eventId);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">793</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">//To check if the user is already registered for the event(CRM-2426)</span></code></td>
<td class="ln">825</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">//To check if the user is already registered for the event(CRM-2426)</span></code></td>
</tr>
<tr valign="top">
<td class="ln">794</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!$</span><span class="sf18b2">self-&gt;_skipDupeRegistrationCheck) {</span></code></td>
<td class="ln">826</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!$</span><span class="sf18b2">self-&gt;_skipDupeRegistrationCheck) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">795</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">self-&gt;</span><span class="sf8b2">checkRegistration</span><span class="sf3b2">($</span><span class="sf18b2">fields, $</span><span class="sf18b2">self);</span></code></td>
<td class="ln">827</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">self-&gt;</span><span class="sf8b2">checkRegistration</span><span class="sf3b2">($</span><span class="sf18b2">fields, $</span><span class="sf18b2">self);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">796</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">828</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">797</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">//check for availability of registrations.</span></code></td>
<td class="ln">829</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">//check for availability of registrations.</span></code></td>
</tr>
<tr valign="top">
<td class="ln">798</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!$</span><span class="sf18b2">self-&gt;_allowConfirmation &amp;&amp;</span></code></td>
<td class="ln">830</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!$</span><span class="sf18b2">self-&gt;_allowConfirmation &amp;&amp;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">799</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;!</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'bypass_payment'</span><span class="sf3b2">, $</span><span class="sf18b2">fields) &amp;&amp;</span></code></td>
<td class="ln">831</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;!</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'bypass_payment'</span><span class="sf3b2">, $</span><span class="sf18b2">fields) &amp;&amp;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">800</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">is_numeric</span><span class="sf3b2">($</span><span class="sf18b2">self-&gt;_availableRegistrations) &amp;&amp;</span></code></td>
<td class="ln">832</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">is_numeric</span><span class="sf3b2">($</span><span class="sf18b2">self-&gt;_availableRegistrations) &amp;&amp;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">801</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'additional_participants'</span><span class="sf3b2">, $</span><span class="sf18b2">fields) &gt;= $</span><span class="sf18b2">self-&gt;_availableRegistrations</span></code></td>
<td class="ln">833</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'additional_participants'</span><span class="sf3b2">, $</span><span class="sf18b2">fields) &gt;= $</span><span class="sf18b2">self-&gt;_availableRegistrations</span></code></td>
</tr>
<tr valign="top">
<td class="ln">802</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;) {</span></code></td>
<td class="ln">834</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">803</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">errors[</span><span class="sf12b2">'additional_participants'</span><span class="sf3b2">] = </span><span class="sf8b2">ts</span><span class="sf3b2">(</span><span class="sf12b2">"There is only enough space left on this event for %1 participant(s)."</span><span class="sf3b2">, </span><span class="sf7b2">array</span><span class="sf3b2">(</span><span class="sf10b2">1</span><span class="sf3b2"> =&gt; $</span><span class="sf18b2">self-&gt;_availableRegistrations));</span></code></td>
<td class="ln">835</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">errors[</span><span class="sf12b2">'additional_participants'</span><span class="sf3b2">] = </span><span class="sf8b2">ts</span><span class="sf3b2">(</span><span class="sf12b2">"There is only enough space left on this event for %1 participant(s)."</span><span class="sf3b2">, </span><span class="sf7b2">array</span><span class="sf3b2">(</span><span class="sf10b2">1</span><span class="sf3b2"> =&gt; $</span><span class="sf18b2">self-&gt;_availableRegistrations));</span></code></td>
</tr>
<tr valign="top">
<td class="ln">804</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">836</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">805</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">837</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">806</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// during confirmation don't allow to increase additional participants, CRM-4320</span></code></td>
<td class="ln">838</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// during confirmation don't allow to increase additional participants, CRM-4320</span></code></td>
</tr>
<tr valign="top">
<td class="ln">807</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">self-&gt;_allowConfirmation &amp;&amp;</span></code></td>
<td class="ln">839</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">self-&gt;_allowConfirmation &amp;&amp;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">808</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'additional_participants'</span><span class="sf3b2">, $</span><span class="sf18b2">fields) &amp;&amp;</span></code></td>
<td class="ln">840</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'additional_participants'</span><span class="sf3b2">, $</span><span class="sf18b2">fields) &amp;&amp;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">809</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">is_array</span><span class="sf3b2">($</span><span class="sf18b2">self-&gt;_additionalParticipantIds) &amp;&amp;</span></code></td>
<td class="ln">841</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">is_array</span><span class="sf3b2">($</span><span class="sf18b2">self-&gt;_additionalParticipantIds) &amp;&amp;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">810</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">fields[</span><span class="sf12b2">'additional_participants'</span><span class="sf3b2">] &gt; </span><span class="sf8b2">count</span><span class="sf3b2">($</span><span class="sf18b2">self-&gt;_additionalParticipantIds)</span></code></td>
<td class="ln">842</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">fields[</span><span class="sf12b2">'additional_participants'</span><span class="sf3b2">] &gt; </span><span class="sf8b2">count</span><span class="sf3b2">($</span><span class="sf18b2">self-&gt;_additionalParticipantIds)</span></code></td>
</tr>
<tr valign="top">
<td class="ln">811</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;) {</span></code></td>
<td class="ln">843</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">812</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">errors[</span><span class="sf12b2">'additional_participants'</span><span class="sf3b2">] = </span><span class="sf8b2">ts</span><span class="sf3b2">(</span><span class="sf12b2">"Oops. It looks like you are trying to increase the number of additional people you are registering for. You can confirm registration for a maximum of %1 additional people."</span><span class="sf3b2">, </span><span class="sf7b2">array</span><span class="sf3b2">(</span><span class="sf10b2">1</span><span class="sf3b2"> =&gt; </span><span class="sf8b2">count</span><span class="sf3b2">($</span><span class="sf18b2">self-&gt;_additionalParticipantIds)));</span></code></td>
<td class="ln">844</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">errors[</span><span class="sf12b2">'additional_participants'</span><span class="sf3b2">] = </span><span class="sf8b2">ts</span><span class="sf3b2">(</span><span class="sf12b2">"Oops. It looks like you are trying to increase the number of additional people you are registering for. You can confirm registration for a maximum of %1 additional people."</span><span class="sf3b2">, </span><span class="sf7b2">array</span><span class="sf3b2">(</span><span class="sf10b2">1</span><span class="sf3b2"> =&gt; </span><span class="sf8b2">count</span><span class="sf3b2">($</span><span class="sf18b2">self-&gt;_additionalParticipantIds)));</span></code></td>
</tr>
<tr valign="top">
<td class="ln">813</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">845</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">814</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">846</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">815</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">//don't allow to register w/ waiting if enough spaces available.</span></code></td>
<td class="ln">847</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">//don't allow to register w/ waiting if enough spaces available.</span></code></td>
</tr>
<tr valign="top">
<td class="ln">816</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'bypass_payment'</span><span class="sf3b2">, $</span><span class="sf18b2">fields)) {</span></code></td>
<td class="ln">848</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'bypass_payment'</span><span class="sf3b2">, $</span><span class="sf18b2">fields)) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">817</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!</span><span class="sf8b2">is_numeric</span><span class="sf3b2">($</span><span class="sf18b2">self-&gt;_availableRegistrations) ||</span></code></td>
<td class="ln">849</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!</span><span class="sf8b2">is_numeric</span><span class="sf3b2">($</span><span class="sf18b2">self-&gt;_availableRegistrations) ||</span></code></td>
</tr>
<tr valign="top">
<td class="ln">818</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;(!</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'priceSetId'</span><span class="sf3b2">, $</span><span class="sf18b2">fields) &amp;&amp; </span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'additional_participants'</span><span class="sf3b2">, $</span><span class="sf18b2">fields) &lt; $</span><span class="sf18b2">self-&gt;_availableRegistrations)</span></code></td>
<td class="ln">850</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;(!</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'priceSetId'</span><span class="sf3b2">, $</span><span class="sf18b2">fields) &amp;&amp; </span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'additional_participants'</span><span class="sf3b2">, $</span><span class="sf18b2">fields) &lt; $</span><span class="sf18b2">self-&gt;_availableRegistrations)</span></code></td>
</tr>
<tr valign="top">
<td class="ln">819</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;) {</span></code></td>
<td class="ln">851</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">820</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">errors[</span><span class="sf12b2">'bypass_payment'</span><span class="sf3b2">] = </span><span class="sf8b2">ts</span><span class="sf3b2">(</span><span class="sf12b2">"Oops. There are enough available spaces in this event. You can not add yourself to the waiting list."</span><span class="sf3b2">);</span></code></td>
<td class="ln">852</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">errors[</span><span class="sf12b2">'bypass_payment'</span><span class="sf3b2">] = </span><span class="sf8b2">ts</span><span class="sf3b2">(</span><span class="sf12b2">"Oops. There are enough available spaces in this event. You can not add yourself to the waiting list."</span><span class="sf3b2">);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">821</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">853</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">822</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">854</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">823</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">855</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">824</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'additional_participants'</span><span class="sf3b2">, $</span><span class="sf18b2">fields) &amp;&amp;</span></code></td>
<td class="ln">856</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'additional_participants'</span><span class="sf3b2">, $</span><span class="sf18b2">fields) &amp;&amp;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">825</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;!</span><span class="sf8b2">CRM_Utils_Rule::positiveInteger</span><span class="sf3b2">($</span><span class="sf18b2">fields[</span><span class="sf12b2">'additiona<wbr>l_participants'</span><span class="sf3b2">])</span></code></td>
<td class="ln">857</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;!</span><span class="sf8b2">CRM_Utils_Rule::positiveInteger</span><span class="sf3b2">($</span><span class="sf18b2">fields[</span><span class="sf12b2">'additiona<wbr>l_participants'</span><span class="sf3b2">])</span></code></td>
</tr>
<tr valign="top">
<td class="ln">826</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;) {</span></code></td>
<td class="ln">858</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">827</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">errors[</span><span class="sf12b2">'additional_participants'</span><span class="sf3b2">] = </span><span class="sf8b2">ts</span><span class="sf3b2">(</span><span class="sf12b2">'Please enter a whole number for Number of additional people.'</span><span class="sf3b2">);</span></code></td>
<td class="ln">859</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">errors[</span><span class="sf12b2">'additional_participants'</span><span class="sf3b2">] = </span><span class="sf8b2">ts</span><span class="sf3b2">(</span><span class="sf12b2">'Please enter a whole number for Number of additional people.'</span><span class="sf3b2">);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">828</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">860</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">829</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">861</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">830</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// priceset validations</span></code></td>
<td class="ln">862</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// priceset validations</span></code></td>
</tr>
<tr valign="top">
<td class="ln">831</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'priceSetId'</span><span class="sf3b2">, $</span><span class="sf18b2">fields)) {</span></code></td>
<td class="ln">863</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'priceSetId'</span><span class="sf3b2">, $</span><span class="sf18b2">fields)) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">832</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">//format params.</span></code></td>
<td class="ln">864</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">//format params.</span></code></td>
</tr>
<tr valign="top">
<td class="ln">833</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">formatted = </span><span class="sf8b2">self::formatPriceSetParams</span><span class="sf3b2">($</span><span class="sf18b2">self, $</span><span class="sf18b2">fields);</span></code></td>
<td class="ln">865</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">formatted = </span><span class="sf8b2">self::formatPriceSetParams</span><span class="sf3b2">($</span><span class="sf18b2">self, $</span><span class="sf18b2">fields);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">834</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">ppParams = </span><span class="sf7b2">array</span><span class="sf3b2">($</span><span class="sf18b2">formatted);</span></code></td>
<td class="ln">866</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">ppParams = </span><span class="sf7b2">array</span><span class="sf3b2">($</span><span class="sf18b2">formatted);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">835</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">priceSetErrors = </span><span class="sf8b2">self::validatePriceSet</span><span class="sf3b2">($</span><span class="sf18b2">self, $</span><span class="sf18b2">ppParams);</span></code></td>
<td class="ln">867</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">priceSetErrors = </span><span class="sf8b2">self::validatePriceSet</span><span class="sf3b2">($</span><span class="sf18b2">self, $</span><span class="sf18b2">ppParams);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">836</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">primaryParticipantCount = </span><span class="sf8b2">self::getParticipantCount</span><span class="sf3b2">($</span><span class="sf18b2">self, $</span><span class="sf18b2">ppParams);</span></code></td>
<td class="ln">868</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">primaryParticipantCount = </span><span class="sf8b2">self::getParticipantCount</span><span class="sf3b2">($</span><span class="sf18b2">self, $</span><span class="sf18b2">ppParams);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">837</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">869</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">838</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">//get price set fields errors in.</span></code></td>
<td class="ln">870</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">//get price set fields errors in.</span></code></td>
</tr>
<tr valign="top">
<td class="ln">839</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">errors = </span><span class="sf8b2">array_merge</span><span class="sf3b2">($</span><span class="sf18b2">errors, </span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf10b2">0</span><span class="sf3b2">, $</span><span class="sf18b2">priceSetErrors, </span><span class="sf7b2">array</span><span class="sf3b2">()));</span></code></td>
<td class="ln">871</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">errors = </span><span class="sf8b2">array_merge</span><span class="sf3b2">($</span><span class="sf18b2">errors, </span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf10b2">0</span><span class="sf3b2">, $</span><span class="sf18b2">priceSetErrors, </span><span class="sf7b2">array</span><span class="sf3b2">()));</span></code></td>
</tr>
<tr valign="top">
<td class="ln">840</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">872</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">841</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">totalParticipants = $</span><span class="sf18b2">primaryParticipantCount;</span></code></td>
<td class="ln">873</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">totalParticipants = $</span><span class="sf18b2">primaryParticipantCount;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">842</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'additional_participants'</span><span class="sf3b2">, $</span><span class="sf18b2">fields)) {</span></code></td>
<td class="ln">874</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'additional_participants'</span><span class="sf3b2">, $</span><span class="sf18b2">fields)) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">843</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">totalParticipants += $</span><span class="sf18b2">fields[</span><span class="sf12b2">'additional_participants'</span><span class="sf3b2">];</span></code></td>
<td class="ln">875</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">totalParticipants += $</span><span class="sf18b2">fields[</span><span class="sf12b2">'additional_participants'</span><span class="sf3b2">];</span></code></td>
</tr>
<tr valign="top">
<td class="ln">844</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">876</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">845</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">877</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">846</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'bypass_payment'</span><span class="sf3b2">, $</span><span class="sf18b2">fields) &amp;&amp;</span></code></td>
<td class="ln">878</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'bypass_payment'</span><span class="sf3b2">, $</span><span class="sf18b2">fields) &amp;&amp;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">847</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;!$</span><span class="sf18b2">self-&gt;_allowConfirmation &amp;&amp;</span></code></td>
<td class="ln">879</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;!$</span><span class="sf18b2">self-&gt;_allowConfirmation &amp;&amp;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">848</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">is_numeric</span><span class="sf3b2">($</span><span class="sf18b2">self-&gt;_availableRegistrations) &amp;&amp;</span></code></td>
<td class="ln">880</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">is_numeric</span><span class="sf3b2">($</span><span class="sf18b2">self-&gt;_availableRegistrations) &amp;&amp;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">849</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">self-&gt;_availableRegistrations &lt; $totalParticipants</span></code></td>
<td class="ln">881</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">self-&gt;_availableRegistrations &lt; $totalParticipants</span></code></td>
</tr>
<tr valign="top">
<td class="ln">850</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;) {</span></code></td>
<td class="ln">882</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">851</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">errors[</span><span class="sf12b2">'_qf_default'</span><span class="sf3b2">] = </span><span class="sf8b2">ts</span><span class="sf3b2">(</span><span class="sf12b2">"Only %1 Registrations available."</span><span class="sf3b2">, </span><span class="sf7b2">array</span><span class="sf3b2">(</span><span class="sf10b2">1</span><span class="sf3b2"> =&gt; $</span><span class="sf18b2">self-&gt;_availableRegistrations));</span></code></td>
<td class="ln">883</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">errors[</span><span class="sf12b2">'_qf_default'</span><span class="sf3b2">] = </span><span class="sf8b2">ts</span><span class="sf3b2">(</span><span class="sf12b2">"Only %1 Registrations available."</span><span class="sf3b2">, </span><span class="sf7b2">array</span><span class="sf3b2">(</span><span class="sf10b2">1</span><span class="sf3b2"> =&gt; $</span><span class="sf18b2">self-&gt;_availableRegistrations));</span></code></td>
</tr>
<tr valign="top">
<td class="ln">852</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">884</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">853</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">885</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">854</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">lineItem = </span><span class="sf7b2">array</span><span class="sf3b2">();</span></code></td>
<td class="ln">886</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">lineItem = </span><span class="sf7b2">array</span><span class="sf3b2">();</span></code></td>
</tr>
<tr valign="top">
<td class="ln">855</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">CRM_Price_BAO_Set::processAmount</span><span class="sf3b2">($</span><span class="sf18b2">self-&gt;_values[</span><span class="sf12b2">'fe<wbr>e'</span><span class="sf3b2">], $</span><span class="sf18b2">fields, $</span><span class="sf18b2">lineItem);</span></code></td>
<td class="ln">887</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">CRM_Price_BAO_Set::processAmount</span><span class="sf3b2">($</span><span class="sf18b2">self-&gt;_values[</span><span class="sf12b2">'fe<wbr>e'</span><span class="sf3b2">], $</span><span class="sf18b2">fields, $</span><span class="sf18b2">lineItem);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">856</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">fields[</span><span class="sf12b2">'amount'</span><span class="sf3b2">] &lt; </span><span class="sf10b2">0</span><span class="sf3b2">) {</span></code></td>
<td class="ln">888</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">fields[</span><span class="sf12b2">'amount'</span><span class="sf3b2">] &lt; </span><span class="sf10b2">0</span><span class="sf3b2">) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">857</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">errors[</span><span class="sf12b2">'_qf_default'</span><span class="sf3b2">] = </span><span class="sf8b2">ts</span><span class="sf3b2">(</span><span class="sf12b2">'Event Fee(s) can not be less than zero. Please select the options accordingly'</span><span class="sf3b2">);</span></code></td>
<td class="ln">889</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">errors[</span><span class="sf12b2">'_qf_default'</span><span class="sf3b2">] = </span><span class="sf8b2">ts</span><span class="sf3b2">(</span><span class="sf12b2">'Event Fee(s) can not be less than zero. Please select the options accordingly'</span><span class="sf3b2">);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">858</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">890</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">859</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">891</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">860</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">892</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">861</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">self-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">][</span><span class="sf12b2">'is_monetary'</span><span class="sf3b2">]) {</span></code></td>
<td class="ln">893</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">self-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">][</span><span class="sf12b2">'is_monetary'</span><span class="sf3b2">]) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">862</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">is_array</span><span class="sf3b2">($</span><span class="sf18b2">self-&gt;_paymentProcessor)) {</span></code></td>
<td class="ln">894</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">is_array</span><span class="sf3b2">($</span><span class="sf18b2">self-&gt;_paymentProcessor)) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">863</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">payment = </span><span class="sf8b2">CRM_Core_Payment::singleton</span><span class="sf3b2">($</span><span class="sf18b2">self-&gt;_mode, $</span><span class="sf18b2">self-&gt;_paymentProcessor, $</span><span class="sf18b2">this);</span></code></td>
<td class="ln">895</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">payment = </span><span class="sf8b2">CRM_Core_Payment::singleton</span><span class="sf3b2">($</span><span class="sf18b2">self-&gt;_mode, $</span><span class="sf18b2">self-&gt;_paymentProcessor, $</span><span class="sf18b2">this);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">864</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">error = $</span><span class="sf18b2">payment-&gt;</span><span class="sf8b2">checkConfig</span><span class="sf3b2">($</span><span class="sf18b2">self-&gt;_mode);</span></code></td>
<td class="ln">896</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">error = $</span><span class="sf18b2">payment-&gt;</span><span class="sf8b2">checkConfig</span><span class="sf3b2">($</span><span class="sf18b2">self-&gt;_mode);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">865</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">error) {</span></code></td>
<td class="ln">897</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">error) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">866</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">errors[</span><span class="sf12b2">'_qf_default'</span><span class="sf3b2">] = $</span><span class="sf18b2">error;</span></code></td>
<td class="ln">898</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">errors[</span><span class="sf12b2">'_qf_default'</span><span class="sf3b2">] = $</span><span class="sf18b2">error;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">867</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">899</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">868</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">900</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">869</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">// return if this is express mode</span></code></td>
<td class="ln">901</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">// return if this is express mode</span></code></td>
</tr>
<tr valign="top">
<td class="ln">870</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">config = </span><span class="sf8b2">CRM_Core_Config::singleton</span><span class="sf3b2">();</span></code></td>
<td class="ln">902</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">config = </span><span class="sf8b2">CRM_Core_Config::singleton</span><span class="sf3b2">();</span></code></td>
</tr>
<tr valign="top">
<td class="ln">871</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">self-&gt;_paymentProcessor[</span><span class="sf12b2">'billing_mode'</span><span class="sf3b2">] &amp; CRM_Core_Payment::BILLING_MODE_BUTTON) {</span></code></td>
<td class="ln">903</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">self-&gt;_paymentProcessor[</span><span class="sf12b2">'billing_mode'</span><span class="sf3b2">] &amp; CRM_Core_Payment::BILLING_MODE_BUTTON) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">872</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">($</span><span class="sf18b2">self-&gt;_expressButtonName . </span><span class="sf12b2">'_x'</span><span class="sf3b2">, $</span><span class="sf18b2">fields) ||</span></code></td>
<td class="ln">904</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">($</span><span class="sf18b2">self-&gt;_expressButtonName . </span><span class="sf12b2">'_x'</span><span class="sf3b2">, $</span><span class="sf18b2">fields) ||</span></code></td>
</tr>
<tr valign="top">
<td class="ln">873</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">($</span><span class="sf18b2">self-&gt;_expressButtonName . </span><span class="sf12b2">'_y'</span><span class="sf3b2">, $</span><span class="sf18b2">fields) ||</span></code></td>
<td class="ln">905</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">($</span><span class="sf18b2">self-&gt;_expressButtonName . </span><span class="sf12b2">'_y'</span><span class="sf3b2">, $</span><span class="sf18b2">fields) ||</span></code></td>
</tr>
<tr valign="top">
<td class="ln">874</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">($</span><span class="sf18b2">self-&gt;_expressButtonName, $</span><span class="sf18b2">fields)</span></code></td>
<td class="ln">906</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">($</span><span class="sf18b2">self-&gt;_expressButtonName, $</span><span class="sf18b2">fields)</span></code></td>
</tr>
<tr valign="top">
<td class="ln">875</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;) {</span></code></td>
<td class="ln">907</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">876</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">return</span><span class="sf3b2"> </span><span class="sf7b2">empty</span><span class="sf3b2">($</span><span class="sf18b2">errors) ? TRUE : $</span><span class="sf18b2">errors;</span></code></td>
<td class="ln">908</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">return</span><span class="sf3b2"> </span><span class="sf7b2">empty</span><span class="sf3b2">($</span><span class="sf18b2">errors) ? TRUE : $</span><span class="sf18b2">errors;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">877</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">909</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">878</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">910</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">879</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">911</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">880</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">isZeroAmount = $</span><span class="sf18b2">skipPayementValidation = FALSE;</span></code></td>
<td class="ln">912</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">isZeroAmount = $</span><span class="sf18b2">skipPayementValidation = FALSE;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">881</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'priceSetId'</span><span class="sf3b2">, $</span><span class="sf18b2">fields)) {</span></code></td>
<td class="ln">913</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'priceSetId'</span><span class="sf3b2">, $</span><span class="sf18b2">fields)) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">882</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'amount'</span><span class="sf3b2">, $</span><span class="sf18b2">fields) == </span><span class="sf10b2">0</span><span class="sf3b2">) {</span></code></td>
<td class="ln">914</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'amount'</span><span class="sf3b2">, $</span><span class="sf18b2">fields) == </span><span class="sf10b2">0</span><span class="sf3b2">) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">883</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">isZeroAmount = TRUE;</span></code></td>
<td class="ln">915</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">isZeroAmount = TRUE;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">884</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">916</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">885</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">917</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">886</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">elseif</span><span class="sf3b2"> (</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'amount'</span><span class="sf3b2">, $</span><span class="sf18b2">fields) &amp;&amp;</span></code></td>
<td class="ln">918</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">elseif</span><span class="sf3b2"> (</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'amount'</span><span class="sf3b2">, $</span><span class="sf18b2">fields) &amp;&amp;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">887</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;(</span><span class="sf7b2">isset</span><span class="sf3b2">($</span><span class="sf18b2">self-&gt;_values[</span><span class="sf12b2">'discount'</span><span class="sf3b2">][$</span><span class="sf18b2">fields[</span><span class="sf12b2">'amount'</span><span class="sf3b2">]<wbr>])</span></code></td>
<td class="ln">919</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;(</span><span class="sf7b2">isset</span><span class="sf3b2">($</span><span class="sf18b2">self-&gt;_values[</span><span class="sf12b2">'discount'</span><span class="sf3b2">][$</span><span class="sf18b2">fields[</span><span class="sf12b2">'amount'</span><span class="sf3b2">]<wbr>])</span></code></td>
</tr>
<tr valign="top">
<td class="ln">888</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&amp;&amp; </span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'value'</span><span class="sf3b2">, $</span><span class="sf18b2">self-&gt;_values[</span><span class="sf12b2">'discount'</span><span class="sf3b2">][$</span><span class="sf18b2">fields[</span><span class="sf12b2">'amount'</span><span class="sf3b2">]]) == </span><span class="sf10b2">0</span></code></td>
<td class="ln">920</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&amp;&amp; </span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'value'</span><span class="sf3b2">, $</span><span class="sf18b2">self-&gt;_values[</span><span class="sf12b2">'discount'</span><span class="sf3b2">][$</span><span class="sf18b2">fields[</span><span class="sf12b2">'amount'</span><span class="sf3b2">]]) == </span><span class="sf10b2">0</span></code></td>
</tr>
<tr valign="top">
<td class="ln">889</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;)</span></code></td>
<td class="ln">921</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;)</span></code></td>
</tr>
<tr valign="top">
<td class="ln">890</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;) {</span></code></td>
<td class="ln">922</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">891</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">isZeroAmount = TRUE;</span></code></td>
<td class="ln">923</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">isZeroAmount = TRUE;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">892</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">924</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">893</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">elseif</span><span class="sf3b2"> (</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'amount'</span><span class="sf3b2">, $</span><span class="sf18b2">fields) &amp;&amp;</span></code></td>
<td class="ln">925</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">elseif</span><span class="sf3b2"> (</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'amount'</span><span class="sf3b2">, $</span><span class="sf18b2">fields) &amp;&amp;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">894</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;(</span><span class="sf7b2">isset</span><span class="sf3b2">($</span><span class="sf18b2">self-&gt;_values[</span><span class="sf12b2">'fee'</span><span class="sf3b2">][$</span><span class="sf18b2">fields[</span><span class="sf12b2">'amount'</span><span class="sf3b2">]])</span></code></td>
<td class="ln">926</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;(</span><span class="sf7b2">isset</span><span class="sf3b2">($</span><span class="sf18b2">self-&gt;_values[</span><span class="sf12b2">'fee'</span><span class="sf3b2">][$</span><span class="sf18b2">fields[</span><span class="sf12b2">'amount'</span><span class="sf3b2">]])</span></code></td>
</tr>
<tr valign="top">
<td class="ln">895</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&amp;&amp; </span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'value'</span><span class="sf3b2">, $</span><span class="sf18b2">self-&gt;_values[</span><span class="sf12b2">'fee'</span><span class="sf3b2">][$</span><span class="sf18b2">fields[</span><span class="sf12b2">'amount'</span><span class="sf3b2">]]) == </span><span class="sf10b2">0</span></code></td>
<td class="ln">927</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&amp;&amp; </span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'value'</span><span class="sf3b2">, $</span><span class="sf18b2">self-&gt;_values[</span><span class="sf12b2">'fee'</span><span class="sf3b2">][$</span><span class="sf18b2">fields[</span><span class="sf12b2">'amount'</span><span class="sf3b2">]]) == </span><span class="sf10b2">0</span></code></td>
</tr>
<tr valign="top">
<td class="ln">896</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;)</span></code></td>
<td class="ln">928</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;)</span></code></td>
</tr>
<tr valign="top">
<td class="ln">897</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;) {</span></code></td>
<td class="ln">929</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">898</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">isZeroAmount = TRUE;</span></code></td>
<td class="ln">930</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">isZeroAmount = TRUE;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">899</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">931</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">900</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">932</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">901</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">isZeroAmount &amp;&amp; !($</span><span class="sf18b2">self-&gt;</span><span class="sf8b2">_forcePayement &amp;&amp; CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'additional_participants'</span><span class="sf3b2">, $</span><span class="sf18b2">fields))) {</span></code></td>
<td class="ln">933</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">isZeroAmount &amp;&amp; !($</span><span class="sf18b2">self-&gt;</span><span class="sf8b2">_forcePayement &amp;&amp; CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'additional_participants'</span><span class="sf3b2">, $</span><span class="sf18b2">fields))) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">902</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">skipPayementValidation = TRUE;</span></code></td>
<td class="ln">934</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">skipPayementValidation = TRUE;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">903</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">935</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">904</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">936</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">905</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">// also return if paylater mode or zero fees for valid members</span></code></td>
<td class="ln">937</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">// also return if paylater mode or zero fees for valid members</span></code></td>
</tr>
<tr valign="top">
<td class="ln">906</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'is_pay_later'</span><span class="sf3b2">, $</span><span class="sf18b2">fields) ||</span></code></td>
<td class="ln">938</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'is_pay_later'</span><span class="sf3b2">, $</span><span class="sf18b2">fields) ||</span></code></td>
</tr>
<tr valign="top">
<td class="ln">907</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'bypass_payment'</span><span class="sf3b2">, $</span><span class="sf18b2">fields) ||</span></code></td>
<td class="ln">939</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'bypass_payment'</span><span class="sf3b2">, $</span><span class="sf18b2">fields) ||</span></code></td>
</tr>
<tr valign="top">
<td class="ln">908</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">skipPayementValidation ||</span></code></td>
<td class="ln">940</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">skipPayementValidation ||</span></code></td>
</tr>
<tr valign="top">
<td class="ln">909</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;(!$</span><span class="sf18b2">self-&gt;</span><span class="sf8b2">_allowConfirmation &amp;&amp;</span><span class="sf3b2"> ($</span><span class="sf18b2">self-&gt;_requireApproval || $</span><span class="sf18b2">self-&gt;_allowWaitlist))</span></code></td>
<td class="ln">941</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;(!$</span><span class="sf18b2">self-&gt;</span><span class="sf8b2">_allowConfirmation &amp;&amp;</span><span class="sf3b2"> ($</span><span class="sf18b2">self-&gt;_requireApproval || $</span><span class="sf18b2">self-&gt;_allowWaitlist))</span></code></td>
</tr>
<tr valign="top">
<td class="ln">910</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;) {</span></code></td>
<td class="ln">942</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">911</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">return</span><span class="sf3b2"> </span><span class="sf7b2">empty</span><span class="sf3b2">($</span><span class="sf18b2">errors) ? TRUE : $</span><span class="sf18b2">errors;</span></code></td>
<td class="ln">943</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">return</span><span class="sf3b2"> </span><span class="sf7b2">empty</span><span class="sf3b2">($</span><span class="sf18b2">errors) ? TRUE : $</span><span class="sf18b2">errors;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">912</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">944</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">913</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">property_exists</span><span class="sf3b2">($</span><span class="sf18b2">self, </span><span class="sf12b2">'_paymentFields'</span><span class="sf3b2">)) {</span></code></td>
<td class="ln">945</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">property_exists</span><span class="sf3b2">($</span><span class="sf18b2">self, </span><span class="sf12b2">'_paymentFields'</span><span class="sf3b2">)) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">914</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">foreach</span><span class="sf3b2"> ($</span><span class="sf18b2">self-&gt;_paymentFields as $</span><span class="sf18b2">name =&gt; $</span><span class="sf18b2">fld) {</span></code></td>
<td class="ln">946</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">foreach</span><span class="sf3b2"> ($</span><span class="sf18b2">self-&gt;_paymentFields as $</span><span class="sf18b2">name =&gt; $</span><span class="sf18b2">fld) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">915</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">fld[</span><span class="sf12b2">'is_required'</span><span class="sf3b2">] &amp;&amp;</span></code></td>
<td class="ln">947</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">fld[</span><span class="sf12b2">'is_required'</span><span class="sf3b2">] &amp;&amp;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">916</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">CRM_Utils_System::isNull</span><span class="sf3b2">(</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">($</span><span class="sf18b2">na<wbr>me, $</span><span class="sf18b2">fields))</span></code></td>
<td class="ln">948</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">CRM_Utils_System::isNull</span><span class="sf3b2">(</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">($</span><span class="sf18b2">na<wbr>me, $</span><span class="sf18b2">fields))</span></code></td>
</tr>
<tr valign="top">
<td class="ln">917</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;) {</span></code></td>
<td class="ln">949</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">918</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">errors[$</span><span class="sf18b2">name] = </span><span class="sf8b2">ts</span><span class="sf3b2">(</span><span class="sf12b2">'%1 is a required field.'</span><span class="sf3b2">, </span><span class="sf7b2">array</span><span class="sf3b2">(</span><span class="sf10b2">1</span><span class="sf3b2"> =&gt; $</span><span class="sf18b2">fld[</span><span class="sf12b2">'title'</span><span class="sf3b2">]));</span></code></td>
<td class="ln">950</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">errors[$</span><span class="sf18b2">name] = </span><span class="sf8b2">ts</span><span class="sf3b2">(</span><span class="sf12b2">'%1 is a required field.'</span><span class="sf3b2">, </span><span class="sf7b2">array</span><span class="sf3b2">(</span><span class="sf10b2">1</span><span class="sf3b2"> =&gt; $</span><span class="sf18b2">fld[</span><span class="sf12b2">'title'</span><span class="sf3b2">]));</span></code></td>
</tr>
<tr valign="top">
<td class="ln">919</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">951</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">920</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">952</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">921</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">953</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">922</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">954</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">923</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// make sure that credit card number and cvv are valid</span></code></td>
<td class="ln">955</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// make sure that credit card number and cvv are valid</span></code></td>
</tr>
<tr valign="top">
<td class="ln">924</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'credit_card_type'</span><span class="sf3b2">, $</span><span class="sf18b2">fields)) {</span></code></td>
<td class="ln">956</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'credit_card_type'</span><span class="sf3b2">, $</span><span class="sf18b2">fields)) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">925</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'credit_card_number'</span><span class="sf3b2">, $</span><span class="sf18b2">fields) &amp;&amp;</span></code></td>
<td class="ln">957</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'credit_card_number'</span><span class="sf3b2">, $</span><span class="sf18b2">fields) &amp;&amp;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">926</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;!</span><span class="sf8b2">CRM_Utils_Rule::creditCardNumber</span><span class="sf3b2">($</span><span class="sf18b2">fields[</span><span class="sf12b2">'credit_c<wbr>ard_number'</span><span class="sf3b2">], $</span><span class="sf18b2">fields[</span><span class="sf12b2">'credit_card_type'</span><span class="sf3b2">])</span></code></td>
<td class="ln">958</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;!</span><span class="sf8b2">CRM_Utils_Rule::creditCardNumber</span><span class="sf3b2">($</span><span class="sf18b2">fields[</span><span class="sf12b2">'credit_c<wbr>ard_number'</span><span class="sf3b2">], $</span><span class="sf18b2">fields[</span><span class="sf12b2">'credit_card_type'</span><span class="sf3b2">])</span></code></td>
</tr>
<tr valign="top">
<td class="ln">927</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;) {</span></code></td>
<td class="ln">959</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">928</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">errors[</span><span class="sf12b2">'credit_card_number'</span><span class="sf3b2">] = </span><span class="sf8b2">ts</span><span class="sf3b2">(</span><span class="sf12b2">'Please enter a valid Credit Card Number'</span><span class="sf3b2">);</span></code></td>
<td class="ln">960</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">errors[</span><span class="sf12b2">'credit_card_number'</span><span class="sf3b2">] = </span><span class="sf8b2">ts</span><span class="sf3b2">(</span><span class="sf12b2">'Please enter a valid Credit Card Number'</span><span class="sf3b2">);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">929</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">961</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">930</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">962</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">931</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'cvv2'</span><span class="sf3b2">, $</span><span class="sf18b2">fields) &amp;&amp;</span></code></td>
<td class="ln">963</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'cvv2'</span><span class="sf3b2">, $</span><span class="sf18b2">fields) &amp;&amp;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">932</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;!</span><span class="sf8b2">CRM_Utils_Rule::cvv</span><span class="sf3b2">($</span><span class="sf18b2">fields[</span><span class="sf12b2">'cvv2'</span><span class="sf3b2">], $</span><span class="sf18b2">fields[</span><span class="sf12b2">'credit_card_type'</span><span class="sf3b2">])</span></code></td>
<td class="ln">964</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;!</span><span class="sf8b2">CRM_Utils_Rule::cvv</span><span class="sf3b2">($</span><span class="sf18b2">fields[</span><span class="sf12b2">'cvv2'</span><span class="sf3b2">], $</span><span class="sf18b2">fields[</span><span class="sf12b2">'credit_card_type'</span><span class="sf3b2">])</span></code></td>
</tr>
<tr valign="top">
<td class="ln">933</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;) {</span></code></td>
<td class="ln">965</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">934</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">errors[</span><span class="sf12b2">'cvv2'</span><span class="sf3b2">] = </span><span class="sf8b2">ts</span><span class="sf3b2">(</span><span class="sf12b2">'Please enter a valid Credit Card Verification Number'</span><span class="sf3b2">);</span></code></td>
<td class="ln">966</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">errors[</span><span class="sf12b2">'cvv2'</span><span class="sf3b2">] = </span><span class="sf8b2">ts</span><span class="sf3b2">(</span><span class="sf12b2">'Please enter a valid Credit Card Verification Number'</span><span class="sf3b2">);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">935</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">967</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">936</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">968</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">937</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">foreach</span><span class="sf3b2"> (CRM_Contact_BAO_Contact::$</span><span class="sf18b2">_greetingTypes </span><span class="sf7b2">as</span><span class="sf3b2"> $</span><span class="sf18b2">greeting) {</span></code></td>
<td class="ln">969</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">foreach</span><span class="sf3b2"> (CRM_Contact_BAO_Contact::$</span><span class="sf18b2">_greetingTypes </span><span class="sf7b2">as</span><span class="sf3b2"> $</span><span class="sf18b2">greeting) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">938</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">greetingType = </span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">($</span><span class="sf18b2">greeting, $</span><span class="sf18b2">fields)) {</span></code></td>
<td class="ln">970</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">greetingType = </span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">($</span><span class="sf18b2">greeting, $</span><span class="sf18b2">fields)) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">939</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">customizedValue = </span><span class="sf8b2">CRM_Core_OptionGroup::getValue</span><span class="sf3b2">($</span><span class="sf18b2">greeting, </span><span class="sf12b2">'Customized'</span><span class="sf3b2">, </span><span class="sf12b2">'name'</span><span class="sf3b2">);</span></code></td>
<td class="ln">971</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">customizedValue = </span><span class="sf8b2">CRM_Core_OptionGroup::getValue</span><span class="sf3b2">($</span><span class="sf18b2">greeting, </span><span class="sf12b2">'Customized'</span><span class="sf3b2">, </span><span class="sf12b2">'name'</span><span class="sf3b2">);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">940</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">customizedValue == $</span><span class="sf18b2">greetingType &amp;&amp; </span><span class="sf7b2">empty</span><span class="sf3b2">($</span><span class="sf18b2">fields[$</span><span class="sf18b2">greeting . </span><span class="sf12b2">'_custom'</span><span class="sf3b2">])) {</span></code></td>
<td class="ln">972</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">customizedValue == $</span><span class="sf18b2">greetingType &amp;&amp; </span><span class="sf7b2">empty</span><span class="sf3b2">($</span><span class="sf18b2">fields[$</span><span class="sf18b2">greeting . </span><span class="sf12b2">'_custom'</span><span class="sf3b2">])) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">941</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">errors[$</span><span class="sf18b2">customizedGreeting] = </span><span class="sf8b2">ts</span><span class="sf3b2">(</span><span class="sf12b2">'Custom %1 is a required field if %1 is of type Customized.'</span><span class="sf3b2">,</span></code></td>
<td class="ln">973</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">errors[$</span><span class="sf18b2">customizedGreeting] = </span><span class="sf8b2">ts</span><span class="sf3b2">(</span><span class="sf12b2">'Custom %1 is a required field if %1 is of type Customized.'</span><span class="sf3b2">,</span></code></td>
</tr>
<tr valign="top">
<td class="ln">942</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">array</span><span class="sf3b2">(</span><span class="sf10b2">1</span><span class="sf3b2"> =&gt; </span><span class="sf8b2">ucwords</span><span class="sf3b2">(</span><span class="sf8b2">str_replace</span><span class="sf3b2">(</span><span class="sf12b2">'_'</span><span class="sf3b2">, </span><span class="sf12b2">' '</span><span class="sf3b2">, $</span><span class="sf18b2">greeting)))</span></code></td>
<td class="ln">974</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">array</span><span class="sf3b2">(</span><span class="sf10b2">1</span><span class="sf3b2"> =&gt; </span><span class="sf8b2">ucwords</span><span class="sf3b2">(</span><span class="sf8b2">str_replace</span><span class="sf3b2">(</span><span class="sf12b2">'_'</span><span class="sf3b2">, </span><span class="sf12b2">' '</span><span class="sf3b2">, $</span><span class="sf18b2">greeting)))</span></code></td>
</tr>
<tr valign="top">
<td class="ln">943</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;);</span></code></td>
<td class="ln">975</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">944</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">976</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">945</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">977</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">946</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">978</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">947</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">979</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">948</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">return</span><span class="sf3b2"> </span><span class="sf7b2">empty</span><span class="sf3b2">($</span><span class="sf18b2">errors) ? TRUE : $</span><span class="sf18b2">errors;</span></code></td>
<td class="ln">980</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">return</span><span class="sf3b2"> </span><span class="sf7b2">empty</span><span class="sf3b2">($</span><span class="sf18b2">errors) ? TRUE : $</span><span class="sf18b2">errors;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">949</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;}</span></code></td>
<td class="ln">981</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">950</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">982</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">951</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf9b2">/**</span></code></td>
<td class="ln">983</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf9b2">/**</span></code></td>
</tr>
<tr valign="top">
<td class="ln">952</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * Check if profiles are complete when event registration occurs(CRM-9587)</span></code></td>
<td class="ln">984</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * Check if profiles are complete when event registration occurs(CRM-9587)</span></code></td>
</tr>
<tr valign="top">
<td class="ln">953</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; *</span></code></td>
<td class="ln">985</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; *</span></code></td>
</tr>
<tr valign="top">
<td class="ln">954</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; */</span>&nbsp;</code></td>
<td class="ln">986</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; */</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">955</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf7b2">static</span><span class="sf3b2"> </span><span class="sf7b2">function</span><span class="sf3b2"> </span><span class="sf8b2">checkProfileComplete</span><span class="sf3b2">($</span><span class="sf18b2">fields, &amp;$</span><span class="sf18b2">errors, $</span><span class="sf18b2">eventId) {</span></code></td>
<td class="ln">987</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf7b2">static</span><span class="sf3b2"> </span><span class="sf7b2">function</span><span class="sf3b2"> </span><span class="sf8b2">checkProfileComplete</span><span class="sf3b2">($</span><span class="sf18b2">fields, &amp;$</span><span class="sf18b2">errors, $</span><span class="sf18b2">eventId) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">956</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">email = </span><span class="sf12b2">''</span><span class="sf3b2">;</span></code></td>
<td class="ln">988</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">email = </span><span class="sf12b2">''</span><span class="sf3b2">;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">957</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">foreach</span><span class="sf3b2"> ($</span><span class="sf18b2">fields </span><span class="sf7b2">as</span><span class="sf3b2"> $</span><span class="sf18b2">fieldname =&gt; $</span><span class="sf18b2">fieldvalue) {</span></code></td>
<td class="ln">989</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">foreach</span><span class="sf3b2"> ($</span><span class="sf18b2">fields </span><span class="sf7b2">as</span><span class="sf3b2"> $</span><span class="sf18b2">fieldname =&gt; $</span><span class="sf18b2">fieldvalue) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">958</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">substr</span><span class="sf3b2">($</span><span class="sf18b2">fieldname, </span><span class="sf10b2">0</span><span class="sf3b2">, </span><span class="sf10b2">6</span><span class="sf3b2">) == </span><span class="sf12b2">'email-'</span><span class="sf3b2"> &amp;&amp; $</span><span class="sf18b2">fieldvalue) {</span></code></td>
<td class="ln">990</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">substr</span><span class="sf3b2">($</span><span class="sf18b2">fieldname, </span><span class="sf10b2">0</span><span class="sf3b2">, </span><span class="sf10b2">6</span><span class="sf3b2">) == </span><span class="sf12b2">'email-'</span><span class="sf3b2"> &amp;&amp; $</span><span class="sf18b2">fieldvalue) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">959</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">email = $</span><span class="sf18b2">fieldvalue;</span></code></td>
<td class="ln">991</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">email = $</span><span class="sf18b2">fieldvalue;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">960</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">992</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">961</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">993</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">962</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">994</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">963</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!$</span><span class="sf18b2">email &amp;&amp; !(</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'first_name'</span><span class="sf3b2">, $</span><span class="sf18b2">fields) &amp;&amp;</span></code></td>
<td class="ln">995</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!$</span><span class="sf18b2">email &amp;&amp; !(</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'first_name'</span><span class="sf3b2">, $</span><span class="sf18b2">fields) &amp;&amp;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">964</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'last_name'</span><span class="sf3b2">, $</span><span class="sf18b2">fields)</span></code></td>
<td class="ln">996</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'last_name'</span><span class="sf3b2">, $</span><span class="sf18b2">fields)</span></code></td>
</tr>
<tr valign="top">
<td class="ln">965</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;)) {</span></code></td>
<td class="ln">997</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;)) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">966</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">defaults = $</span><span class="sf18b2">params = </span><span class="sf7b2">array</span><span class="sf3b2">(</span><span class="sf12b2">'id'</span><span class="sf3b2"> =&gt; $</span><span class="sf18b2">eventId);</span></code></td>
<td class="ln">998</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">defaults = $</span><span class="sf18b2">params = </span><span class="sf7b2">array</span><span class="sf3b2">(</span><span class="sf12b2">'id'</span><span class="sf3b2"> =&gt; $</span><span class="sf18b2">eventId);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">967</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">CRM_Event_BAO_Event::retrieve</span><span class="sf3b2">($</span><span class="sf18b2">params, $</span><span class="sf18b2">defaults);</span></code></td>
<td class="ln">999</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">CRM_Event_BAO_Event::retrieve</span><span class="sf3b2">($</span><span class="sf18b2">params, $</span><span class="sf18b2">defaults);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">968</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">message = </span><span class="sf8b2">ts</span><span class="sf3b2">(</span><span class="sf12b2">"Mandatory fields (first name and last name, OR email address) are missing from this form."</span><span class="sf3b2">);</span></code></td>
<td class="ln">1000</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">message = </span><span class="sf8b2">ts</span><span class="sf3b2">(</span><span class="sf12b2">"Mandatory fields (first name and last name, OR email address) are missing from this form."</span><span class="sf3b2">);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">969</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">errors[</span><span class="sf12b2">'_qf_default'</span><span class="sf3b2">] = $</span><span class="sf18b2">message;</span></code></td>
<td class="ln">1001</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">errors[</span><span class="sf12b2">'_qf_default'</span><span class="sf3b2">] = $</span><span class="sf18b2">message;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">970</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">1002</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">971</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;}</span></code></td>
<td class="ln">1003</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">972</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1004</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">973</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf9b2">/**</span></code></td>
<td class="ln">1005</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf9b2">/**</span></code></td>
</tr>
<tr valign="top">
<td class="ln">974</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * Function to process the form</span></code></td>
<td class="ln">1006</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * Function to process the form</span></code></td>
</tr>
<tr valign="top">
<td class="ln">975</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; *</span></code></td>
<td class="ln">1007</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; *</span></code></td>
</tr>
<tr valign="top">
<td class="ln">976</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @access public</span></code></td>
<td class="ln">1008</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @access public</span></code></td>
</tr>
<tr valign="top">
<td class="ln">977</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; *</span></code></td>
<td class="ln">1009</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; *</span></code></td>
</tr>
<tr valign="top">
<td class="ln">978</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @return None</span></code></td>
<td class="ln">1010</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @return None</span></code></td>
</tr>
<tr valign="top">
<td class="ln">979</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; */</span>&nbsp;</code></td>
<td class="ln">1011</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; */</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">980</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf8b2">public function postProcess</span><span class="sf3b2">() {</span></code></td>
<td class="ln">1012</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf8b2">public function postProcess</span><span class="sf3b2">() {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">981</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// get the submitted form values.</span></code></td>
<td class="ln">1013</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// get the submitted form values.</span></code></td>
</tr>
<tr valign="top">
<td class="ln">982</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">params = $</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">controller-&gt;exportValues</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;_name);</span></code></td>
<td class="ln">1014</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">params = $</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">controller-&gt;exportValues</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;_name);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">983</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1015</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">984</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">//set as Primary participant</span></code></td>
<td class="ln">1016</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">//set as Primary participant</span></code></td>
</tr>
<tr valign="top">
<td class="ln">985</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">params[</span><span class="sf12b2">'is_primary'</span><span class="sf3b2">] = </span><span class="sf10b2">1</span><span class="sf3b2">;</span></code></td>
<td class="ln">1017</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">params[</span><span class="sf12b2">'is_primary'</span><span class="sf3b2">] = </span><span class="sf10b2">1</span><span class="sf3b2">;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">986</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1018</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">987</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">][</span><span class="sf12b2">'is_pay_later'</span><span class="sf3b2">] &amp;&amp;</span></code></td>
<td class="ln">1019</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">][</span><span class="sf12b2">'is_pay_later'</span><span class="sf3b2">] &amp;&amp;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">988</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">//empty( $this-&gt;_paymentProcessor ) &amp;&amp;</span></code></td>
<td class="ln">1020</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">//empty( $this-&gt;_paymentProcessor ) &amp;&amp;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">989</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;!</span><span class="sf8b2">array_key_exists</span><span class="sf3b2">(</span><span class="sf12b2">'hidden_processor'</span><span class="sf3b2">, $</span><span class="sf18b2">params)</span></code></td>
<td class="ln">1021</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;!</span><span class="sf8b2">array_key_exists</span><span class="sf3b2">(</span><span class="sf12b2">'hidden_processor'</span><span class="sf3b2">, $</span><span class="sf18b2">params)</span></code></td>
</tr>
<tr valign="top">
<td class="ln">990</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;) {</span></code></td>
<td class="ln">1022</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">991</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">params[</span><span class="sf12b2">'is_pay_later'</span><span class="sf3b2">] = </span><span class="sf10b2">1</span><span class="sf3b2">;</span></code></td>
<td class="ln">1023</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">params[</span><span class="sf12b2">'is_pay_later'</span><span class="sf3b2">] = </span><span class="sf10b2">1</span><span class="sf3b2">;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">992</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">1024</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">993</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">else</span><span class="sf3b2"> {</span></code></td>
<td class="ln">1025</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">else</span><span class="sf3b2"> {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">994</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">params[</span><span class="sf12b2">'is_pay_later'</span><span class="sf3b2">] = </span><span class="sf10b2">0</span><span class="sf3b2">;</span></code></td>
<td class="ln">1026</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">params[</span><span class="sf12b2">'is_pay_later'</span><span class="sf3b2">] = </span><span class="sf10b2">0</span><span class="sf3b2">;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">995</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">1027</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">996</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1028</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">997</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">set</span><span class="sf3b2">(</span><span class="sf12b2">'is_pay_later'</span><span class="sf3b2">, $</span><span class="sf18b2">params[</span><span class="sf12b2">'is_pay_later'</span><span class="sf3b2">]);</span></code></td>
<td class="ln">1029</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">set</span><span class="sf3b2">(</span><span class="sf12b2">'is_pay_later'</span><span class="sf3b2">, $</span><span class="sf18b2">params[</span><span class="sf12b2">'is_pay_later'</span><span class="sf3b2">]);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">998</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1030</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">999</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// assign pay later stuff</span></code></td>
<td class="ln">1031</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// assign pay later stuff</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1000</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_params[</span><span class="sf12b2">'is_pay_later'</span><span class="sf3b2">] = CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'is_pay_later'</span><span class="sf3b2">, $</span><span class="sf18b2">params, FALSE);</span></code></td>
<td class="ln">1032</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_params[</span><span class="sf12b2">'is_pay_later'</span><span class="sf3b2">] = CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'is_pay_later'</span><span class="sf3b2">, $</span><span class="sf18b2">params, FALSE);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1001</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">assign</span><span class="sf3b2">(</span><span class="sf12b2">'is_pay_later'</span><span class="sf3b2">, $</span><span class="sf18b2">params[</span><span class="sf12b2">'is_pay_later'</span><span class="sf3b2">]);</span></code></td>
<td class="ln">1033</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">assign</span><span class="sf3b2">(</span><span class="sf12b2">'is_pay_later'</span><span class="sf3b2">, $</span><span class="sf18b2">params[</span><span class="sf12b2">'is_pay_later'</span><span class="sf3b2">]);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1002</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">params[</span><span class="sf12b2">'is_pay_later'</span><span class="sf3b2">]) {</span></code></td>
<td class="ln">1034</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">params[</span><span class="sf12b2">'is_pay_later'</span><span class="sf3b2">]) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1003</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">assign</span><span class="sf3b2">(</span><span class="sf12b2">'pay_later_text'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">][</span><span class="sf12b2">'pay_later_text'</span><span class="sf3b2">]);</span></code></td>
<td class="ln">1035</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">assign</span><span class="sf3b2">(</span><span class="sf12b2">'pay_later_text'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">][</span><span class="sf12b2">'pay_later_text'</span><span class="sf3b2">]);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1004</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">assign</span><span class="sf3b2">(</span><span class="sf12b2">'pay_later_receipt'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">][</span><span class="sf12b2">'pay_later_receipt'</span><span class="sf3b2">]);</span></code></td>
<td class="ln">1036</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">assign</span><span class="sf3b2">(</span><span class="sf12b2">'pay_later_receipt'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">][</span><span class="sf12b2">'pay_later_receipt'</span><span class="sf3b2">]);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1005</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">1037</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1006</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!$</span><span class="sf18b2">this-&gt;_allowConfirmation) {</span></code></td>
<td class="ln">1038</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!$</span><span class="sf18b2">this-&gt;_allowConfirmation) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1007</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">// check if the participant is already registered</span></code></td>
<td class="ln">1039</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">// check if the participant is already registered</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1008</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!$</span><span class="sf18b2">this-&gt;_skipDupeRegistrationCheck) {</span></code></td>
<td class="ln">1040</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!$</span><span class="sf18b2">this-&gt;_skipDupeRegistrationCheck) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1009</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">params[</span><span class="sf12b2">'contact_id'</span><span class="sf3b2">] = </span><span class="sf8b2">self::checkRegistration</span><span class="sf3b2">($</span><span class="sf18b2">params, $</span><span class="sf18b2">this, FALSE, TRUE);</span></code></td>
<td class="ln">1041</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">params[</span><span class="sf12b2">'contact_id'</span><span class="sf3b2">] = </span><span class="sf8b2">self::checkRegistration</span><span class="sf3b2">($</span><span class="sf18b2">params, $</span><span class="sf18b2">this, FALSE, TRUE);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1010</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">1042</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1011</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">1043</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1012</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1044</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">1013</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'image_URL'</span><span class="sf3b2">, $</span><span class="sf18b2">params)) {</span></code></td>
<td class="ln">1045</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'image_URL'</span><span class="sf3b2">, $</span><span class="sf18b2">params)) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1014</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">CRM_Contact_BAO_Contact::processImageParams</span><span class="sf3b2">($</span><span class="sf18b2">params<wbr>);</span></code></td>
<td class="ln">1046</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">CRM_Contact_BAO_Contact::processImageParams</span><span class="sf3b2">($</span><span class="sf18b2">params<wbr>);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1015</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">1047</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1016</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1048</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">1017</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">//carry campaign to partcipants.</span></code></td>
<td class="ln">1049</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">//carry campaign to partcipants.</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1018</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">array_key_exists</span><span class="sf3b2">(</span><span class="sf12b2">'participant_campaign_id'</span><span class="sf3b2">, $</span><span class="sf18b2">params)) {</span></code></td>
<td class="ln">1050</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">array_key_exists</span><span class="sf3b2">(</span><span class="sf12b2">'participant_campaign_id'</span><span class="sf3b2">, $</span><span class="sf18b2">params)) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1019</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">params[</span><span class="sf12b2">'campaign_id'</span><span class="sf3b2">] = $</span><span class="sf18b2">params[</span><span class="sf12b2">'participant_campaign_id'</span><span class="sf3b2">];</span></code></td>
<td class="ln">1051</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">params[</span><span class="sf12b2">'campaign_id'</span><span class="sf3b2">] = $</span><span class="sf18b2">params[</span><span class="sf12b2">'participant_campaign_id'</span><span class="sf3b2">];</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1020</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">1052</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1021</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">else</span><span class="sf3b2"> {</span></code></td>
<td class="ln">1053</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">else</span><span class="sf3b2"> {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1022</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">params[</span><span class="sf12b2">'campaign_id'</span><span class="sf3b2">] = </span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'campaign_id'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">]);</span></code></td>
<td class="ln">1054</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">params[</span><span class="sf12b2">'campaign_id'</span><span class="sf3b2">] = </span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'campaign_id'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">]);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1023</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">1055</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1024</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1056</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">1025</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">//hack to allow group to register w/ waiting</span></code></td>
<td class="ln">1057</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">//hack to allow group to register w/ waiting</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1026</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">primaryParticipantCount = </span><span class="sf8b2">self::getParticipantCount</span><span class="sf3b2">($</span><span class="sf18b2">this, $</span><span class="sf18b2">params);</span></code></td>
<td class="ln">1058</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">primaryParticipantCount = </span><span class="sf8b2">self::getParticipantCount</span><span class="sf3b2">($</span><span class="sf18b2">this, $</span><span class="sf18b2">params);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1027</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1059</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">1028</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">totalParticipants = $</span><span class="sf18b2">primaryParticipantCount;</span></code></td>
<td class="ln">1060</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">totalParticipants = $</span><span class="sf18b2">primaryParticipantCount;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1029</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'additional_participants'</span><span class="sf3b2">, $</span><span class="sf18b2">params)) {</span></code></td>
<td class="ln">1061</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'additional_participants'</span><span class="sf3b2">, $</span><span class="sf18b2">params)) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1030</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">totalParticipants += $</span><span class="sf18b2">params[</span><span class="sf12b2">'additional_participants'</span><span class="sf3b2">];</span></code></td>
<td class="ln">1062</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">totalParticipants += $</span><span class="sf18b2">params[</span><span class="sf12b2">'additional_participants'</span><span class="sf3b2">];</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1031</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">1063</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1032</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!$</span><span class="sf18b2">this-&gt;_allowConfirmation &amp;&amp;</span></code></td>
<td class="ln">1064</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!$</span><span class="sf18b2">this-&gt;_allowConfirmation &amp;&amp;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1033</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'bypass_payment'</span><span class="sf3b2">, $</span><span class="sf18b2">params) &amp;&amp;</span></code></td>
<td class="ln">1065</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'bypass_payment'</span><span class="sf3b2">, $</span><span class="sf18b2">params) &amp;&amp;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1034</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">is_numeric</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;_availableRegistrations) &amp;&amp;</span></code></td>
<td class="ln">1066</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">is_numeric</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;_availableRegistrations) &amp;&amp;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1035</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">totalParticipants &gt; $</span><span class="sf18b2">this-&gt;_availableRegistrations</span></code></td>
<td class="ln">1067</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">totalParticipants &gt; $</span><span class="sf18b2">this-&gt;_availableRegistrations</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1036</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;) {</span></code></td>
<td class="ln">1068</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1037</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_allowWaitlist = TRUE;</span></code></td>
<td class="ln">1069</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_allowWaitlist = TRUE;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1038</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">set</span><span class="sf3b2">(</span><span class="sf12b2">'allowWaitlist'</span><span class="sf3b2">, TRUE);</span></code></td>
<td class="ln">1070</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">set</span><span class="sf3b2">(</span><span class="sf12b2">'allowWaitlist'</span><span class="sf3b2">, TRUE);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1039</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">1071</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1040</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1072</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">1041</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">//carry participant id if pre-registered.</span></code></td>
<td class="ln">1073</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">//carry participant id if pre-registered.</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1042</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">this-&gt;_allowConfirmation &amp;&amp; $</span><span class="sf18b2">this-&gt;_participantId) {</span></code></td>
<td class="ln">1074</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">this-&gt;_allowConfirmation &amp;&amp; $</span><span class="sf18b2">this-&gt;_participantId) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1043</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">params[</span><span class="sf12b2">'participant_id'</span><span class="sf3b2">] = $</span><span class="sf18b2">this-&gt;_participantId;</span></code></td>
<td class="ln">1075</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">params[</span><span class="sf12b2">'participant_id'</span><span class="sf3b2">] = $</span><span class="sf18b2">this-&gt;_participantId;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1044</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">1076</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1045</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1077</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">1046</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">params[</span><span class="sf12b2">'defaultRole'</span><span class="sf3b2">] = </span><span class="sf10b2">1</span><span class="sf3b2">;</span></code></td>
<td class="ln">1078</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">params[</span><span class="sf12b2">'defaultRole'</span><span class="sf3b2">] = </span><span class="sf10b2">1</span><span class="sf3b2">;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1047</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">array_key_exists</span><span class="sf3b2">(</span><span class="sf12b2">'participant_role'</span><span class="sf3b2">, $</span><span class="sf18b2">params)) {</span></code></td>
<td class="ln">1079</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">array_key_exists</span><span class="sf3b2">(</span><span class="sf12b2">'participant_role'</span><span class="sf3b2">, $</span><span class="sf18b2">params)) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1048</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">params[</span><span class="sf12b2">'participant_role_id'</span><span class="sf3b2">] = $</span><span class="sf18b2">params[</span><span class="sf12b2">'participant_role'</span><span class="sf3b2">];</span></code></td>
<td class="ln">1080</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">params[</span><span class="sf12b2">'participant_role_id'</span><span class="sf3b2">] = $</span><span class="sf18b2">params[</span><span class="sf12b2">'participant_role'</span><span class="sf3b2">];</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1049</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">1081</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1050</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1082</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">1051</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">array_key_exists</span><span class="sf3b2">(</span><span class="sf12b2">'participant_role_id'</span><span class="sf3b2">, $</span><span class="sf18b2">params)) {</span></code></td>
<td class="ln">1083</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">array_key_exists</span><span class="sf3b2">(</span><span class="sf12b2">'participant_role_id'</span><span class="sf3b2">, $</span><span class="sf18b2">params)) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1052</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">params[</span><span class="sf12b2">'defaultRole'</span><span class="sf3b2">] = </span><span class="sf10b2">0</span><span class="sf3b2">;</span></code></td>
<td class="ln">1084</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">params[</span><span class="sf12b2">'defaultRole'</span><span class="sf3b2">] = </span><span class="sf10b2">0</span><span class="sf3b2">;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1053</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">1085</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1054</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'participant_role_id'</span><span class="sf3b2">, $</span><span class="sf18b2">params) &amp;&amp;</span></code></td>
<td class="ln">1086</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'participant_role_id'</span><span class="sf3b2">, $</span><span class="sf18b2">params) &amp;&amp;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1055</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">][</span><span class="sf12b2">'default_role_id'</span><span class="sf3b2">]</span></code></td>
<td class="ln">1087</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">][</span><span class="sf12b2">'default_role_id'</span><span class="sf3b2">]</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1056</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;) {</span></code></td>
<td class="ln">1088</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1057</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">params[</span><span class="sf12b2">'participant_role_id'</span><span class="sf3b2">] = $</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">][</span><span class="sf12b2">'default_role_id'</span><span class="sf3b2">];</span></code></td>
<td class="ln">1089</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">params[</span><span class="sf12b2">'participant_role_id'</span><span class="sf3b2">] = $</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">][</span><span class="sf12b2">'default_role_id'</span><span class="sf3b2">];</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1058</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">1090</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1059</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1091</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">1060</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">config = </span><span class="sf8b2">CRM_Core_Config::singleton</span><span class="sf3b2">();</span></code></td>
<td class="ln">1092</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">config = </span><span class="sf8b2">CRM_Core_Config::singleton</span><span class="sf3b2">();</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1061</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">params[</span><span class="sf12b2">'currencyID'</span><span class="sf3b2">] = $</span><span class="sf18b2">config-&gt;defaultCurrency;</span></code></td>
<td class="ln">1093</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">params[</span><span class="sf12b2">'currencyID'</span><span class="sf3b2">] = $</span><span class="sf18b2">config-&gt;defaultCurrency;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1062</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16">
</span>&nbsp;</code></td>
<td class="ln">1094</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp;
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">1095</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp;</span><span class="sf17b16">//BOT - add the showPaymentFields flag and payment processors to all pages
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">1096</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp;$</span><span class="sf17b16">params[</span><span class="sf17b16">'showPaymentFields'</span><span class="sf17b16">] = $</span><span class="sf17b16">this-&gt;_showPaymentFields;
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">1097</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp;$</span><span class="sf17b16">params[</span><span class="sf17b16">'pp'</span><span class="sf17b16">] &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;= $</span><span class="sf17b16">this-&gt;_pp;
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">1098</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp;</span><span class="sf17b16">//Ends
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">1099</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp;
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">1063</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">][</span><span class="sf12b2">'is_monetary'</span><span class="sf3b2">]) {</span></code></td>
<td class="ln">1100</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">][</span><span class="sf12b2">'is_monetary'</span><span class="sf3b2">]) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1064</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">// we first reset the confirm page so it accepts new values</span></code></td>
<td class="ln">1101</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">// we first reset the confirm page so it accepts new values</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1065</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">controller-&gt;resetPage</span><span class="sf3b2">(</span><span class="sf12b2">'Confirm'</span><span class="sf3b2">);</span></code></td>
<td class="ln">1102</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">controller-&gt;resetPage</span><span class="sf3b2">(</span><span class="sf12b2">'Confirm'</span><span class="sf3b2">);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1066</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1103</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">1067</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">//added for discount</span></code></td>
<td class="ln">1104</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">//added for discount</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1068</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">discountId = </span><span class="sf8b2">CRM_Core_BAO_Discount::findSet</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;_eventId, </span><span class="sf12b2">'civicrm_event'</span><span class="sf3b2">);</span></code></td>
<td class="ln">1105</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">discountId = </span><span class="sf8b2">CRM_Core_BAO_Discount::findSet</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;_eventId, </span><span class="sf12b2">'civicrm_event'</span><span class="sf3b2">);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1069</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1106</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">1070</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!</span><span class="sf7b2">empty</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'discount'</span><span class="sf3b2">][$</span><span class="sf18b2">discountId])) {</span></code></td>
<td class="ln">1107</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!</span><span class="sf7b2">empty</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'discount'</span><span class="sf3b2">][$</span><span class="sf18b2">discountId])) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1071</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">params[</span><span class="sf12b2">'discount_id'</span><span class="sf3b2">] = $</span><span class="sf18b2">discountId;</span></code></td>
<td class="ln">1108</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">params[</span><span class="sf12b2">'discount_id'</span><span class="sf3b2">] = $</span><span class="sf18b2">discountId;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1072</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">params[</span><span class="sf12b2">'amount_level'</span><span class="sf3b2">] = $</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'discount'</span><span class="sf3b2">][$</span><span class="sf18b2">discountId][$</span><span class="sf18b2">params[</span><span class="sf12b2">'am<wbr>ount'</span><span class="sf3b2">]][</span><span class="sf12b2">'label'</span><span class="sf3b2">];</span></code></td>
<td class="ln">1109</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">params[</span><span class="sf12b2">'amount_level'</span><span class="sf3b2">] = $</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'discount'</span><span class="sf3b2">][$</span><span class="sf18b2">discountId][$</span><span class="sf18b2">params[</span><span class="sf12b2">'am<wbr>ount'</span><span class="sf3b2">]][</span><span class="sf12b2">'label'</span><span class="sf3b2">];</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1073</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1110</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">1074</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">params[</span><span class="sf12b2">'amount'</span><span class="sf3b2">] = $</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'discount'</span><span class="sf3b2">][$</span><span class="sf18b2">discountId][$</span><span class="sf18b2">params[</span><span class="sf12b2">'am<wbr>ount'</span><span class="sf3b2">]][</span><span class="sf12b2">'value'</span><span class="sf3b2">];</span></code></td>
<td class="ln">1111</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">params[</span><span class="sf12b2">'amount'</span><span class="sf3b2">] = $</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'discount'</span><span class="sf3b2">][$</span><span class="sf18b2">discountId][$</span><span class="sf18b2">params[</span><span class="sf12b2">'am<wbr>ount'</span><span class="sf3b2">]][</span><span class="sf12b2">'value'</span><span class="sf3b2">];</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1075</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">1112</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1076</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">elseif</span><span class="sf3b2"> (</span><span class="sf7b2">empty</span><span class="sf3b2">($</span><span class="sf18b2">params[</span><span class="sf12b2">'priceSetId'</span><span class="sf3b2">])) {</span></code></td>
<td class="ln">1113</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">elseif</span><span class="sf3b2"> (</span><span class="sf7b2">empty</span><span class="sf3b2">($</span><span class="sf18b2">params[</span><span class="sf12b2">'priceSetId'</span><span class="sf3b2">])) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1077</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">params[</span><span class="sf12b2">'amount_level'</span><span class="sf3b2">] = $</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'fee'</span><span class="sf3b2">][$</span><span class="sf18b2">params[</span><span class="sf12b2">'amount'</span><span class="sf3b2">]][</span><span class="sf12b2">'label'</span><span class="sf3b2">];</span></code></td>
<td class="ln">1114</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">params[</span><span class="sf12b2">'amount_level'</span><span class="sf3b2">] = $</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'fee'</span><span class="sf3b2">][$</span><span class="sf18b2">params[</span><span class="sf12b2">'amount'</span><span class="sf3b2">]][</span><span class="sf12b2">'label'</span><span class="sf3b2">];</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1078</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">params[</span><span class="sf12b2">'amount'</span><span class="sf3b2">] = $</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'fee'</span><span class="sf3b2">][$</span><span class="sf18b2">params[</span><span class="sf12b2">'amount'</span><span class="sf3b2">]][</span><span class="sf12b2">'value'</span><span class="sf3b2">];</span></code></td>
<td class="ln">1115</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">params[</span><span class="sf12b2">'amount'</span><span class="sf3b2">] = $</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'fee'</span><span class="sf3b2">][$</span><span class="sf18b2">params[</span><span class="sf12b2">'amount'</span><span class="sf3b2">]][</span><span class="sf12b2">'value'</span><span class="sf3b2">];</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1079</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">1116</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1080</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">else</span><span class="sf3b2"> {</span></code></td>
<td class="ln">1117</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">else</span><span class="sf3b2"> {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1081</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">lineItem = </span><span class="sf7b2">array</span><span class="sf3b2">();</span></code></td>
<td class="ln">1118</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">lineItem = </span><span class="sf7b2">array</span><span class="sf3b2">();</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1082</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">CRM_Price_BAO_Set::processAmount</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'fe<wbr>e'</span><span class="sf3b2">], $</span><span class="sf18b2">params, $</span><span class="sf18b2">lineItem);</span></code></td>
<td class="ln">1119</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">CRM_Price_BAO_Set::processAmount</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'fe<wbr>e'</span><span class="sf3b2">], $</span><span class="sf18b2">params, $</span><span class="sf18b2">lineItem);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1083</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">set</span><span class="sf3b2">(</span><span class="sf12b2">'lineItem'</span><span class="sf3b2">, </span><span class="sf7b2">array</span><span class="sf3b2">($</span><span class="sf18b2">lineItem));</span></code></td>
<td class="ln">1120</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">set</span><span class="sf3b2">(</span><span class="sf12b2">'lineItem'</span><span class="sf3b2">, </span><span class="sf7b2">array</span><span class="sf3b2">($</span><span class="sf18b2">lineItem));</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1084</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">set</span><span class="sf3b2">(</span><span class="sf12b2">'lineItemParticipantsCount'</span><span class="sf3b2">, </span><span class="sf7b2">array</span><span class="sf3b2">($</span><span class="sf18b2">primaryParticipantCount));</span></code></td>
<td class="ln">1121</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">set</span><span class="sf3b2">(</span><span class="sf12b2">'lineItemParticipantsCount'</span><span class="sf3b2">, </span><span class="sf7b2">array</span><span class="sf3b2">($</span><span class="sf18b2">primaryParticipantCount));</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1085</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">1122</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1086</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1123</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">1087</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">set</span><span class="sf3b2">(</span><span class="sf12b2">'amount'</span><span class="sf3b2">, $</span><span class="sf18b2">params[</span><span class="sf12b2">'amount'</span><span class="sf3b2">]);</span></code></td>
<td class="ln">1124</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">set</span><span class="sf3b2">(</span><span class="sf12b2">'amount'</span><span class="sf3b2">, $</span><span class="sf18b2">params[</span><span class="sf12b2">'amount'</span><span class="sf3b2">]);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1088</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">set</span><span class="sf3b2">(</span><span class="sf12b2">'amount_level'</span><span class="sf3b2">, $</span><span class="sf18b2">params[</span><span class="sf12b2">'amount_level'</span><span class="sf3b2">]);</span></code></td>
<td class="ln">1125</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">set</span><span class="sf3b2">(</span><span class="sf12b2">'amount_level'</span><span class="sf3b2">, $</span><span class="sf18b2">params[</span><span class="sf12b2">'amount_level'</span><span class="sf3b2">]);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1089</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1126</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">1090</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">// generate and set an invoiceID for this transaction</span></code></td>
<td class="ln">1127</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">// generate and set an invoiceID for this transaction</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1091</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">invoiceID = </span><span class="sf8b2">md5</span><span class="sf3b2">(</span><span class="sf8b2">uniqid</span><span class="sf3b2">(</span><span class="sf8b2">rand</span><span class="sf3b2">(), TRUE));</span></code></td>
<td class="ln">1128</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">invoiceID = </span><span class="sf8b2">md5</span><span class="sf3b2">(</span><span class="sf8b2">uniqid</span><span class="sf3b2">(</span><span class="sf8b2">rand</span><span class="sf3b2">(), TRUE));</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1092</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">set</span><span class="sf3b2">(</span><span class="sf12b2">'invoiceID'</span><span class="sf3b2">, $</span><span class="sf18b2">invoiceID);</span></code></td>
<td class="ln">1129</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">set</span><span class="sf3b2">(</span><span class="sf12b2">'invoiceID'</span><span class="sf3b2">, $</span><span class="sf18b2">invoiceID);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1093</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1130</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">1094</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">is_array</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;_paymentProcessor)) {</span></code></td>
<td class="ln">1131</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">is_array</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;_paymentProcessor)) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1095</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">payment = </span><span class="sf8b2">CRM_Core_Payment::singleton</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;_mode, $</span><span class="sf18b2">this-&gt;_paymentProcessor, $</span><span class="sf18b2">this);</span></code></td>
<td class="ln">1132</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">payment = </span><span class="sf8b2">CRM_Core_Payment::singleton</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;_mode, $</span><span class="sf18b2">this-&gt;_paymentProcessor, $</span><span class="sf18b2">this);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1096</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">1133</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1097</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">// default mode is direct</span></code></td>
<td class="ln">1134</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">// default mode is direct</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1098</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">set</span><span class="sf3b2">(</span><span class="sf12b2">'contributeMode'</span><span class="sf3b2">, </span><span class="sf12b2">'direct'</span><span class="sf3b2">);</span></code></td>
<td class="ln">1135</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">set</span><span class="sf3b2">(</span><span class="sf12b2">'contributeMode'</span><span class="sf3b2">, </span><span class="sf12b2">'direct'</span><span class="sf3b2">);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1099</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1136</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">1100</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf7b2">isset</span><span class="sf3b2">($</span><span class="sf18b2">params[</span><span class="sf12b2">"state_province_id-{$this-&gt;_bltID}"</span><span class="sf3b2">]<wbr>) &amp;&amp;</span></code></td>
<td class="ln">1137</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf7b2">isset</span><span class="sf3b2">($</span><span class="sf18b2">params[</span><span class="sf12b2">"state_province_id-{$this-&gt;_bltID}"</span><span class="sf3b2">]<wbr>) &amp;&amp;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1101</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">params[</span><span class="sf12b2">"state_province_id-{$this-&gt;_bltID}"</span><span class="sf3b2">]</span></code></td>
<td class="ln">1138</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">params[</span><span class="sf12b2">"state_province_id-{$this-&gt;_bltID}"</span><span class="sf3b2">]</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1102</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;) {</span></code></td>
<td class="ln">1139</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1103</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">params[</span><span class="sf12b2">"state_province-{$this-&gt;_bltID}"</span><span class="sf3b2">] = </span><span class="sf8b2">CRM_Core_PseudoConstant::stateProvinceAbbreviation</span><span class="sf3b2">(<wbr>$</span><span class="sf18b2">params[</span><span class="sf12b2">"state_province_id-{$this-&gt;_bltID}"</span><span class="sf3b2">]);</span></code></td>
<td class="ln">1140</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">params[</span><span class="sf12b2">"state_province-{$this-&gt;_bltID}"</span><span class="sf3b2">] = </span><span class="sf8b2">CRM_Core_PseudoConstant::stateProvinceAbbreviation</span><span class="sf3b2">(<wbr>$</span><span class="sf18b2">params[</span><span class="sf12b2">"state_province_id-{$this-&gt;_bltID}"</span><span class="sf3b2">]);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1104</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">1141</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1105</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1142</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">1106</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf7b2">isset</span><span class="sf3b2">($</span><span class="sf18b2">params[</span><span class="sf12b2">"country_id-{$this-&gt;_bltID}"</span><span class="sf3b2">]) &amp;&amp;</span></code></td>
<td class="ln">1143</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf7b2">isset</span><span class="sf3b2">($</span><span class="sf18b2">params[</span><span class="sf12b2">"country_id-{$this-&gt;_bltID}"</span><span class="sf3b2">]) &amp;&amp;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1107</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">params[</span><span class="sf12b2">"country_id-{$this-&gt;_bltID}"</span><span class="sf3b2">]</span></code></td>
<td class="ln">1144</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">params[</span><span class="sf12b2">"country_id-{$this-&gt;_bltID}"</span><span class="sf3b2">]</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1108</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;) {</span></code></td>
<td class="ln">1145</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1109</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">params[</span><span class="sf12b2">"country-{$this-&gt;_bltID}"</span><span class="sf3b2">] = </span><span class="sf8b2">CRM_Core_PseudoConstant::countryIsoCode</span><span class="sf3b2">($</span><span class="sf18b2">params[</span><span class="sf12b2">"co<wbr>untry_id-{$this-&gt;_bltID}"</span><span class="sf3b2">]);</span></code></td>
<td class="ln">1146</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">params[</span><span class="sf12b2">"country-{$this-&gt;_bltID}"</span><span class="sf3b2">] = </span><span class="sf8b2">CRM_Core_PseudoConstant::countryIsoCode</span><span class="sf3b2">($</span><span class="sf18b2">params[</span><span class="sf12b2">"co<wbr>untry_id-{$this-&gt;_bltID}"</span><span class="sf3b2">]);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1110</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">1147</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1111</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf7b2">isset</span><span class="sf3b2">($</span><span class="sf18b2">params[</span><span class="sf12b2">'credit_card_exp_date'</span><span class="sf3b2">])) {</span></code></td>
<td class="ln">1148</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf7b2">isset</span><span class="sf3b2">($</span><span class="sf18b2">params[</span><span class="sf12b2">'credit_card_exp_date'</span><span class="sf3b2">])) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1112</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">params[</span><span class="sf12b2">'year'</span><span class="sf3b2">] = </span><span class="sf8b2">CRM_Core_Payment_Form::getCreditCardExpirationYear</span><span class="sf3b2">(<wbr>$</span><span class="sf18b2">params);</span></code></td>
<td class="ln">1149</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">params[</span><span class="sf12b2">'year'</span><span class="sf3b2">] = </span><span class="sf8b2">CRM_Core_Payment_Form::getCreditCardExpirationYear</span><span class="sf3b2">(<wbr>$</span><span class="sf18b2">params);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1113</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">params[</span><span class="sf12b2">'month'</span><span class="sf3b2">] = </span><span class="sf8b2">CRM_Core_Payment_Form::getCreditCardExpirationMonth<wbr></span><span class="sf3b2">($</span><span class="sf18b2">params);</span></code></td>
<td class="ln">1150</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">params[</span><span class="sf12b2">'month'</span><span class="sf3b2">] = </span><span class="sf8b2">CRM_Core_Payment_Form::getCreditCardExpirationMonth<wbr></span><span class="sf3b2">($</span><span class="sf18b2">params);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1114</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">1151</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1115</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">][</span><span class="sf12b2">'is_monetary'</span><span class="sf3b2">]) {</span></code></td>
<td class="ln">1152</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">][</span><span class="sf12b2">'is_monetary'</span><span class="sf3b2">]) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1116</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">params[</span><span class="sf12b2">'ip_address'</span><span class="sf3b2">] = </span><span class="sf8b2">CRM_Utils_System::ipAddress</span><span class="sf3b2">();</span></code></td>
<td class="ln">1153</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">params[</span><span class="sf12b2">'ip_address'</span><span class="sf3b2">] = </span><span class="sf8b2">CRM_Utils_System::ipAddress</span><span class="sf3b2">();</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1117</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">params[</span><span class="sf12b2">'currencyID'</span><span class="sf3b2">] = $</span><span class="sf18b2">config-&gt;defaultCurrency;</span></code></td>
<td class="ln">1154</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">params[</span><span class="sf12b2">'currencyID'</span><span class="sf3b2">] = $</span><span class="sf18b2">config-&gt;defaultCurrency;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1118</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">params[</span><span class="sf12b2">'payment_action'</span><span class="sf3b2">] = </span><span class="sf12b2">'Sale'</span><span class="sf3b2">;</span></code></td>
<td class="ln">1155</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">params[</span><span class="sf12b2">'payment_action'</span><span class="sf3b2">] = </span><span class="sf12b2">'Sale'</span><span class="sf3b2">;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1119</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">params[</span><span class="sf12b2">'invoiceID'</span><span class="sf3b2">] = $</span><span class="sf18b2">invoiceID;</span></code></td>
<td class="ln">1156</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">params[</span><span class="sf12b2">'invoiceID'</span><span class="sf3b2">] = $</span><span class="sf18b2">invoiceID;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1120</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">1157</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1121</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1158</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">1122</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">_params = array</span><span class="sf3b2">();</span></code></td>
<td class="ln">1159</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">_params = array</span><span class="sf3b2">();</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1123</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_params[] = $</span><span class="sf18b2">params;</span></code></td>
<td class="ln">1160</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_params[] = $</span><span class="sf18b2">params;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1124</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">set</span><span class="sf3b2">(</span><span class="sf12b2">'params'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_params);</span></code></td>
<td class="ln">1161</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">set</span><span class="sf3b2">(</span><span class="sf12b2">'params'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_params);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1125</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1162</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">1126</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">this-&gt;_paymentProcessor[</span><span class="sf12b2">'billing_mode'</span><span class="sf3b2">] &amp; CRM_Core_Payment::BILLING_MODE_BUTTON) {</span></code></td>
<td class="ln">1163</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">this-&gt;_paymentProcessor[</span><span class="sf12b2">'billing_mode'</span><span class="sf3b2">] &amp; CRM_Core_Payment::BILLING_MODE_BUTTON) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1127</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">//get the button name</span></code></td>
<td class="ln">1164</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">//get the button name</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1128</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">buttonName = $</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">controller-&gt;getButtonName</span><span class="sf3b2">();</span></code></td>
<td class="ln">1165</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">buttonName = $</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">controller-&gt;getButtonName</span><span class="sf3b2">();</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1129</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">in_array</span><span class="sf3b2">($</span><span class="sf18b2">buttonName,</span></code></td>
<td class="ln">1166</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">in_array</span><span class="sf3b2">($</span><span class="sf18b2">buttonName,</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1130</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">array</span><span class="sf3b2">(</span></code></td>
<td class="ln">1167</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">array</span><span class="sf3b2">(</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1131</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_expressButtonName,</span></code></td>
<td class="ln">1168</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_expressButtonName,</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1132</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_expressButtonName . </span><span class="sf12b2">'_x'</span><span class="sf3b2">,</span></code></td>
<td class="ln">1169</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_expressButtonName . </span><span class="sf12b2">'_x'</span><span class="sf3b2">,</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1133</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_expressButtonName . </span><span class="sf12b2">'_y'</span><span class="sf3b2">,</span></code></td>
<td class="ln">1170</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_expressButtonName . </span><span class="sf12b2">'_y'</span><span class="sf3b2">,</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1134</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;)</span></code></td>
<td class="ln">1171</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;)</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1135</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;) &amp;&amp;</span></code></td>
<td class="ln">1172</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;) &amp;&amp;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1136</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;!</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'is_pay_later'</span><span class="sf3b2">, $</span><span class="sf18b2">params) &amp;&amp;</span></code></td>
<td class="ln">1173</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;!</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'is_pay_later'</span><span class="sf3b2">, $</span><span class="sf18b2">params) &amp;&amp;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1137</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;!$</span><span class="sf18b2">this-&gt;_allowWaitlist &amp;&amp;</span></code></td>
<td class="ln">1174</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;!$</span><span class="sf18b2">this-&gt;_allowWaitlist &amp;&amp;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1138</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;!$</span><span class="sf18b2">this-&gt;_requireApproval</span></code></td>
<td class="ln">1175</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;!$</span><span class="sf18b2">this-&gt;_requireApproval</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1139</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;) {</span></code></td>
<td class="ln">1176</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1140</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">set</span><span class="sf3b2">(</span><span class="sf12b2">'contributeMode'</span><span class="sf3b2">, </span><span class="sf12b2">'express'</span><span class="sf3b2">);</span></code></td>
<td class="ln">1177</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">set</span><span class="sf3b2">(</span><span class="sf12b2">'contributeMode'</span><span class="sf3b2">, </span><span class="sf12b2">'express'</span><span class="sf3b2">);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1141</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1178</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">1142</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">// Send Event Name &amp; Id in Params</span></code></td>
<td class="ln">1179</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">// Send Event Name &amp; Id in Params</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1143</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">params[</span><span class="sf12b2">'eventName'</span><span class="sf3b2">] = $</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">][</span><span class="sf12b2">'title'</span><span class="sf3b2">];</span></code></td>
<td class="ln">1180</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">params[</span><span class="sf12b2">'eventName'</span><span class="sf3b2">] = $</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">][</span><span class="sf12b2">'title'</span><span class="sf3b2">];</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1144</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">params[</span><span class="sf12b2">'eventId'</span><span class="sf3b2">] = $</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">][</span><span class="sf12b2">'id'</span><span class="sf3b2">];</span></code></td>
<td class="ln">1181</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">params[</span><span class="sf12b2">'eventId'</span><span class="sf3b2">] = $</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">][</span><span class="sf12b2">'id'</span><span class="sf3b2">];</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1145</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1182</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">1146</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">params[</span><span class="sf12b2">'cancelURL'</span><span class="sf3b2">] = </span><span class="sf8b2">CRM_Utils_System::url</span><span class="sf3b2">(</span><span class="sf12b2">'civicrm/event/register'</span><span class="sf3b2">,</span></code></td>
<td class="ln">1183</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">params[</span><span class="sf12b2">'cancelURL'</span><span class="sf3b2">] = </span><span class="sf8b2">CRM_Utils_System::url</span><span class="sf3b2">(</span><span class="sf12b2">'civicrm/event/register'</span><span class="sf3b2">,</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1147</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">"_qf_Register_display=1&amp;qfKey={$this-&gt;controller-&gt;_<wbr>key}"</span><span class="sf3b2">,</span></code></td>
<td class="ln">1184</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">"_qf_Register_display=1&amp;qfKey={$this-&gt;controller-&gt;_<wbr>key}"</span><span class="sf3b2">,</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1148</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;TRUE, NULL, FALSE</span></code></td>
<td class="ln">1185</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;TRUE, NULL, FALSE</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1149</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;);</span></code></td>
<td class="ln">1186</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1150</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'additional_participants'</span><span class="sf3b2">, $</span><span class="sf18b2">params, FALSE)) {</span></code></td>
<td class="ln">1187</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'additional_participants'</span><span class="sf3b2">, $</span><span class="sf18b2">params, FALSE)) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1151</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">urlArgs = </span><span class="sf12b2">"_qf_Participant_1_display=1&amp;rfp=1&amp;qfKey={$this-&gt;co<wbr>ntroller-&gt;_key}"</span><span class="sf3b2">;</span></code></td>
<td class="ln">1188</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">urlArgs = </span><span class="sf12b2">"_qf_Participant_1_display=1&amp;rfp=1&amp;qfKey={$this-&gt;co<wbr>ntroller-&gt;_key}"</span><span class="sf3b2">;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1152</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">1189</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1153</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">else</span><span class="sf3b2"> {</span></code></td>
<td class="ln">1190</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">else</span><span class="sf3b2"> {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1154</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">urlArgs = </span><span class="sf12b2">"_qf_Confirm_display=1&amp;rfp=1&amp;qfKey={$this-&gt;controll<wbr>er-&gt;_key}"</span><span class="sf3b2">;</span></code></td>
<td class="ln">1191</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">urlArgs = </span><span class="sf12b2">"_qf_Confirm_display=1&amp;rfp=1&amp;qfKey={$this-&gt;controll<wbr>er-&gt;_key}"</span><span class="sf3b2">;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1155</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">1192</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1156</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">params[</span><span class="sf12b2">'returnURL'</span><span class="sf3b2">] = </span><span class="sf8b2">CRM_Utils_System::url</span><span class="sf3b2">(</span><span class="sf12b2">'civicrm/event/register'</span><span class="sf3b2">,</span></code></td>
<td class="ln">1193</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">params[</span><span class="sf12b2">'returnURL'</span><span class="sf3b2">] = </span><span class="sf8b2">CRM_Utils_System::url</span><span class="sf3b2">(</span><span class="sf12b2">'civicrm/event/register'</span><span class="sf3b2">,</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1157</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">urlArgs,</span></code></td>
<td class="ln">1194</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">urlArgs,</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1158</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;TRUE, NULL, FALSE</span></code></td>
<td class="ln">1195</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;TRUE, NULL, FALSE</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1159</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;);</span></code></td>
<td class="ln">1196</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1160</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">params[</span><span class="sf12b2">'invoiceID'</span><span class="sf3b2">] = $</span><span class="sf18b2">invoiceID;</span></code></td>
<td class="ln">1197</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">params[</span><span class="sf12b2">'invoiceID'</span><span class="sf3b2">] = $</span><span class="sf18b2">invoiceID;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1161</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1198</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">1162</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">//default action is Sale</span></code></td>
<td class="ln">1199</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">//default action is Sale</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1163</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">params[</span><span class="sf12b2">'payment_action'</span><span class="sf3b2">] = </span><span class="sf12b2">'Sale'</span><span class="sf3b2">;</span></code></td>
<td class="ln">1200</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">params[</span><span class="sf12b2">'payment_action'</span><span class="sf3b2">] = </span><span class="sf12b2">'Sale'</span><span class="sf3b2">;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1164</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1201</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">1165</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">token = $</span><span class="sf18b2">payment-&gt;</span><span class="sf8b2">setExpressCheckout</span><span class="sf3b2">($</span><span class="sf18b2">params);</span></code></td>
<td class="ln">1202</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">token = $</span><span class="sf18b2">payment-&gt;</span><span class="sf8b2">setExpressCheckout</span><span class="sf3b2">($</span><span class="sf18b2">params);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1166</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">is_a</span><span class="sf3b2">($</span><span class="sf18b2">token, </span><span class="sf12b2">'CRM_Core_Error'</span><span class="sf3b2">)) {</span></code></td>
<td class="ln">1203</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">is_a</span><span class="sf3b2">($</span><span class="sf18b2">token, </span><span class="sf12b2">'CRM_Core_Error'</span><span class="sf3b2">)) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1167</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">CRM_Core_Error::displaySessionError</span><span class="sf3b2">($</span><span class="sf18b2">token);</span></code></td>
<td class="ln">1204</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">CRM_Core_Error::displaySessionError</span><span class="sf3b2">($</span><span class="sf18b2">token);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1168</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">CRM_Utils_System::redirect</span><span class="sf3b2">($</span><span class="sf18b2">params[</span><span class="sf12b2">'cancelURL'</span><span class="sf3b2">]);</span></code></td>
<td class="ln">1205</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">CRM_Utils_System::redirect</span><span class="sf3b2">($</span><span class="sf18b2">params[</span><span class="sf12b2">'cancelURL'</span><span class="sf3b2">]);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1169</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">1206</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1170</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1207</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">1171</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">set</span><span class="sf3b2">(</span><span class="sf12b2">'token'</span><span class="sf3b2">, $</span><span class="sf18b2">token);</span></code></td>
<td class="ln">1208</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">set</span><span class="sf3b2">(</span><span class="sf12b2">'token'</span><span class="sf3b2">, $</span><span class="sf18b2">token);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1172</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1209</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">1173</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">paymentURL = $</span><span class="sf18b2">this-&gt;_paymentProcessor[</span><span class="sf12b2">'url_site'</span><span class="sf3b2">] . </span><span class="sf12b2">"/cgi-bin/webscr?cmd=_express-checkout&amp;token=$token<wbr>"</span><span class="sf3b2">;</span></code></td>
<td class="ln">1210</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">paymentURL = $</span><span class="sf18b2">this-&gt;_paymentProcessor[</span><span class="sf12b2">'url_site'</span><span class="sf3b2">] . </span><span class="sf12b2">"/cgi-bin/webscr?cmd=_express-checkout&amp;token=$token<wbr>"</span><span class="sf3b2">;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1174</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1211</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">1175</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">CRM_Utils_System::redirect</span><span class="sf3b2">($</span><span class="sf18b2">paymentURL);</span></code></td>
<td class="ln">1212</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">CRM_Utils_System::redirect</span><span class="sf3b2">($</span><span class="sf18b2">paymentURL);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1176</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">1213</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1177</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">1214</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1178</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">elseif</span><span class="sf3b2"> ($</span><span class="sf18b2">this-&gt;_paymentProcessor[</span><span class="sf12b2">'billing_mode'</span><span class="sf3b2">] &amp; CRM_Core_Payment::BILLING_MODE_NOTIFY) {</span></code></td>
<td class="ln">1215</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">elseif</span><span class="sf3b2"> ($</span><span class="sf18b2">this-&gt;_paymentProcessor[</span><span class="sf12b2">'billing_mode'</span><span class="sf3b2">] &amp; CRM_Core_Payment::BILLING_MODE_NOTIFY) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1179</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">set</span><span class="sf3b2">(</span><span class="sf12b2">'contributeMode'</span><span class="sf3b2">, </span><span class="sf12b2">'notify'</span><span class="sf3b2">);</span></code></td>
<td class="ln">1216</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">set</span><span class="sf3b2">(</span><span class="sf12b2">'contributeMode'</span><span class="sf3b2">, </span><span class="sf12b2">'notify'</span><span class="sf3b2">);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1180</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">1217</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1181</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">1218</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1182</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">else</span><span class="sf3b2"> {</span></code></td>
<td class="ln">1219</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">else</span><span class="sf3b2"> {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1183</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">session = </span><span class="sf8b2">CRM_Core_Session::singleton</span><span class="sf3b2">();</span></code></td>
<td class="ln">1220</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">session = </span><span class="sf8b2">CRM_Core_Session::singleton</span><span class="sf3b2">();</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1184</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">params[</span><span class="sf12b2">'description'</span><span class="sf3b2">] = </span><span class="sf8b2">ts</span><span class="sf3b2">(</span><span class="sf12b2">'Online Event Registration'</span><span class="sf3b2">) . </span><span class="sf12b2">' '</span><span class="sf3b2"> . $</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">][</span><span class="sf12b2">'title'</span><span class="sf3b2">];</span></code></td>
<td class="ln">1221</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">params[</span><span class="sf12b2">'description'</span><span class="sf3b2">] = </span><span class="sf8b2">ts</span><span class="sf3b2">(</span><span class="sf12b2">'Online Event Registration'</span><span class="sf3b2">) . </span><span class="sf12b2">' '</span><span class="sf3b2"> . $</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">][</span><span class="sf12b2">'title'</span><span class="sf3b2">];</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1185</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1222</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">1186</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">_params = array</span><span class="sf3b2">();</span></code></td>
<td class="ln">1223</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">_params = array</span><span class="sf3b2">();</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1187</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_params[] = $</span><span class="sf18b2">params;</span></code></td>
<td class="ln">1224</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_params[] = $</span><span class="sf18b2">params;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1188</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">set</span><span class="sf3b2">(</span><span class="sf12b2">'params'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_params);</span></code></td>
<td class="ln">1225</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">set</span><span class="sf3b2">(</span><span class="sf12b2">'params'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_params);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1189</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1226</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">1190</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'additional_participants'</span><span class="sf3b2">,<wbr> $</span><span class="sf18b2">params)) {</span></code></td>
<td class="ln">1227</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'additional_participants'</span><span class="sf3b2">,<wbr> $</span><span class="sf18b2">params)) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1191</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">self::processRegistration</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;_params);</span></code></td>
<td class="ln">1228</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">self::processRegistration</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;_params);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1192</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">1229</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1193</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">1230</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1194</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1231</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">1195</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// If registering &gt; 1 participant, give status message</span></code></td>
<td class="ln">1232</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// If registering &gt; 1 participant, give status message</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1196</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'additional_participants'</span><span class="sf3b2">, $</span><span class="sf18b2">params, FALSE)) {</span></code></td>
<td class="ln">1233</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'additional_participants'</span><span class="sf3b2">, $</span><span class="sf18b2">params, FALSE)) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1197</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">statusMsg = </span><span class="sf8b2">ts</span><span class="sf3b2">(</span><span class="sf12b2">'Registration information for participant 1 has been saved.'</span><span class="sf3b2">);</span></code></td>
<td class="ln">1234</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">statusMsg = </span><span class="sf8b2">ts</span><span class="sf3b2">(</span><span class="sf12b2">'Registration information for participant 1 has been saved.'</span><span class="sf3b2">);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1198</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">CRM_Core_Session::setStatus</span><span class="sf3b2">($</span><span class="sf18b2">statusMsg);</span></code></td>
<td class="ln">1235</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">CRM_Core_Session::setStatus</span><span class="sf3b2">($</span><span class="sf18b2">statusMsg);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1199</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">1236</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1200</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;}</span></code></td>
<td class="ln">1237</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1201</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf9b2">//end of function</span></code></td>
<td class="ln">1238</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf9b2">//end of function</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1202</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1239</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">1203</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf9b2">/*</span></code></td>
<td class="ln">1240</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf9b2">/*</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1204</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; *Function to process Registration of free event</span></code></td>
<td class="ln">1241</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; *Function to process Registration of free event</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1205</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; *</span></code></td>
<td class="ln">1242</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; *</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1206</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; *@param &nbsp;array $param Form valuess</span></code></td>
<td class="ln">1243</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; *@param &nbsp;array $param Form valuess</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1207</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; *@param &nbsp;int contactID</span></code></td>
<td class="ln">1244</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; *@param &nbsp;int contactID</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1208</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; *</span></code></td>
<td class="ln">1245</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; *</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1209</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; *@return None</span></code></td>
<td class="ln">1246</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; *@return None</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1210</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; *access public</span></code></td>
<td class="ln">1247</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; *access public</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1211</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; *</span></code></td>
<td class="ln">1248</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; *</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1212</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; */</span>&nbsp;</code></td>
<td class="ln">1249</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; */</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">1213</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf8b2">public function processRegistration</span><span class="sf3b2">($</span><span class="sf18b2">params, $</span><span class="sf18b2">contactID = NULL) {</span></code></td>
<td class="ln">1250</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf8b2">public function processRegistration</span><span class="sf3b2">($</span><span class="sf18b2">params, $</span><span class="sf18b2">contactID = NULL) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1214</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">session = </span><span class="sf8b2">CRM_Core_Session::singleton</span><span class="sf3b2">();</span></code></td>
<td class="ln">1251</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">session = </span><span class="sf8b2">CRM_Core_Session::singleton</span><span class="sf3b2">();</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1215</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">_participantInfo = array</span><span class="sf3b2">();</span></code></td>
<td class="ln">1252</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">_participantInfo = array</span><span class="sf3b2">();</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1216</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1253</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">1217</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// CRM-4320, lets build array of cancelled additional participant ids</span></code></td>
<td class="ln">1254</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// CRM-4320, lets build array of cancelled additional participant ids</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1218</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// those are drop or skip by primary at the time of confirmation.</span></code></td>
<td class="ln">1255</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// those are drop or skip by primary at the time of confirmation.</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1219</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// get all in and then unset those are confirmed.</span></code></td>
<td class="ln">1256</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// get all in and then unset those are confirmed.</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1220</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">cancelledIds = $</span><span class="sf18b2">this-&gt;_additionalParticipantIds;</span></code></td>
<td class="ln">1257</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">cancelledIds = $</span><span class="sf18b2">this-&gt;_additionalParticipantIds;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1221</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1258</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">1222</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">participantCount = </span><span class="sf7b2">array</span><span class="sf3b2">();</span></code></td>
<td class="ln">1259</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">participantCount = </span><span class="sf7b2">array</span><span class="sf3b2">();</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1223</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">foreach</span><span class="sf3b2"> ($</span><span class="sf18b2">params </span><span class="sf7b2">as</span><span class="sf3b2"> $</span><span class="sf18b2">participantNum =&gt; $</span><span class="sf18b2">record) {</span></code></td>
<td class="ln">1260</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">foreach</span><span class="sf3b2"> ($</span><span class="sf18b2">params </span><span class="sf7b2">as</span><span class="sf3b2"> $</span><span class="sf18b2">participantNum =&gt; $</span><span class="sf18b2">record) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1224</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">record == </span><span class="sf12b2">'skip'</span><span class="sf3b2">) {</span></code></td>
<td class="ln">1261</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">record == </span><span class="sf12b2">'skip'</span><span class="sf3b2">) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1225</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">participantCount[$</span><span class="sf18b2">participantNum] = </span><span class="sf12b2">'skip'</span><span class="sf3b2">;</span></code></td>
<td class="ln">1262</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">participantCount[$</span><span class="sf18b2">participantNum] = </span><span class="sf12b2">'skip'</span><span class="sf3b2">;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1226</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">1263</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1227</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">elseif</span><span class="sf3b2"> ($</span><span class="sf18b2">participantNum) {</span></code></td>
<td class="ln">1264</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">elseif</span><span class="sf3b2"> ($</span><span class="sf18b2">participantNum) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1228</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">participantCount[$</span><span class="sf18b2">participantNum] = </span><span class="sf12b2">'participant'</span><span class="sf3b2">;</span></code></td>
<td class="ln">1265</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">participantCount[$</span><span class="sf18b2">participantNum] = </span><span class="sf12b2">'participant'</span><span class="sf3b2">;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1229</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">1266</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1230</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">1267</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1231</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1268</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">1232</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">registerByID = NULL;</span></code></td>
<td class="ln">1269</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">registerByID = NULL;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1233</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">foreach</span><span class="sf3b2"> ($</span><span class="sf18b2">params </span><span class="sf7b2">as</span><span class="sf3b2"> $</span><span class="sf18b2">key =&gt; $</span><span class="sf18b2">value) {</span></code></td>
<td class="ln">1270</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">foreach</span><span class="sf3b2"> ($</span><span class="sf18b2">params </span><span class="sf7b2">as</span><span class="sf3b2"> $</span><span class="sf18b2">key =&gt; $</span><span class="sf18b2">value) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1234</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">value != </span><span class="sf12b2">'skip'</span><span class="sf3b2">) {</span></code></td>
<td class="ln">1271</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">value != </span><span class="sf12b2">'skip'</span><span class="sf3b2">) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1235</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">fields = NULL;</span></code></td>
<td class="ln">1272</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">fields = NULL;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1236</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1273</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">1237</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">// setting register by Id and unset contactId.</span></code></td>
<td class="ln">1274</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">// setting register by Id and unset contactId.</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1238</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'is_primary'</span><span class="sf3b2">, $</span><span class="sf18b2">value)) {</span></code></td>
<td class="ln">1275</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'is_primary'</span><span class="sf3b2">, $</span><span class="sf18b2">value)) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1239</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">contactID = NULL;</span></code></td>
<td class="ln">1276</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">contactID = NULL;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1240</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">registerByID = $</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">get</span><span class="sf3b2">(</span><span class="sf12b2">'registerByID'</span><span class="sf3b2">);</span></code></td>
<td class="ln">1277</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">registerByID = $</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">get</span><span class="sf3b2">(</span><span class="sf12b2">'registerByID'</span><span class="sf3b2">);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1241</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">registerByID) {</span></code></td>
<td class="ln">1278</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">registerByID) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1242</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">value[</span><span class="sf12b2">'registered_by_id'</span><span class="sf3b2">] = $</span><span class="sf18b2">registerByID;</span></code></td>
<td class="ln">1279</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">value[</span><span class="sf12b2">'registered_by_id'</span><span class="sf3b2">] = $</span><span class="sf18b2">registerByID;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1243</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">1280</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1244</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">// get an email if one exists for the participant</span></code></td>
<td class="ln">1281</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">// get an email if one exists for the participant</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1245</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">participantEmail = </span><span class="sf12b2">''</span><span class="sf3b2">;</span></code></td>
<td class="ln">1282</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">participantEmail = </span><span class="sf12b2">''</span><span class="sf3b2">;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1246</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">foreach</span><span class="sf3b2"> (</span><span class="sf8b2">array_keys</span><span class="sf3b2">($</span><span class="sf18b2">value) </span><span class="sf7b2">as</span><span class="sf3b2"> $</span><span class="sf18b2">valueName) {</span></code></td>
<td class="ln">1283</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">foreach</span><span class="sf3b2"> (</span><span class="sf8b2">array_keys</span><span class="sf3b2">($</span><span class="sf18b2">value) </span><span class="sf7b2">as</span><span class="sf3b2"> $</span><span class="sf18b2">valueName) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1247</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">substr</span><span class="sf3b2">($</span><span class="sf18b2">valueName, </span><span class="sf10b2">0</span><span class="sf3b2">, </span><span class="sf10b2">6</span><span class="sf3b2">) == </span><span class="sf12b2">'email-'</span><span class="sf3b2">) {</span></code></td>
<td class="ln">1284</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">substr</span><span class="sf3b2">($</span><span class="sf18b2">valueName, </span><span class="sf10b2">0</span><span class="sf3b2">, </span><span class="sf10b2">6</span><span class="sf3b2">) == </span><span class="sf12b2">'email-'</span><span class="sf3b2">) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1248</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">participantEmail = $</span><span class="sf18b2">value[$</span><span class="sf18b2">valueName];</span></code></td>
<td class="ln">1285</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">participantEmail = $</span><span class="sf18b2">value[$</span><span class="sf18b2">valueName];</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1249</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">1286</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1250</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">1287</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1251</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">participantEmail) {</span></code></td>
<td class="ln">1288</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">participantEmail) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1252</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_participantInfo[] = $</span><span class="sf18b2">participantEmail;</span></code></td>
<td class="ln">1289</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_participantInfo[] = $</span><span class="sf18b2">participantEmail;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1253</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">1290</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1254</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">else</span><span class="sf3b2"> {</span></code></td>
<td class="ln">1291</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">else</span><span class="sf3b2"> {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1255</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_participantInfo[] = $</span><span class="sf18b2">value[</span><span class="sf12b2">'first_name'</span><span class="sf3b2">] . </span><span class="sf12b2">' '</span><span class="sf3b2"> . $</span><span class="sf18b2">value[</span><span class="sf12b2">'last_name'</span><span class="sf3b2">];</span></code></td>
<td class="ln">1292</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_participantInfo[] = $</span><span class="sf18b2">value[</span><span class="sf12b2">'first_name'</span><span class="sf3b2">] . </span><span class="sf12b2">' '</span><span class="sf3b2"> . $</span><span class="sf18b2">value[</span><span class="sf12b2">'last_name'</span><span class="sf3b2">];</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1256</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">1293</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1257</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">1294</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1258</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">elseif</span><span class="sf3b2"> (</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'contact_id'</span><span class="sf3b2">, $</span><span class="sf18b2">value)) {</span></code></td>
<td class="ln">1295</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">elseif</span><span class="sf3b2"> (</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'contact_id'</span><span class="sf3b2">, $</span><span class="sf18b2">value)) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1259</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">contactID = $</span><span class="sf18b2">value[</span><span class="sf12b2">'contact_id'</span><span class="sf3b2">];</span></code></td>
<td class="ln">1296</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">contactID = $</span><span class="sf18b2">value[</span><span class="sf12b2">'contact_id'</span><span class="sf3b2">];</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1260</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">1297</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1261</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">else</span><span class="sf3b2"> {</span></code></td>
<td class="ln">1298</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">else</span><span class="sf3b2"> {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1262</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">contactID = </span><span class="sf8b2">parent::getContactID</span><span class="sf3b2">();</span></code></td>
<td class="ln">1299</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">contactID = </span><span class="sf8b2">parent::getContactID</span><span class="sf3b2">();</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1263</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">1300</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1264</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1301</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">1265</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">CRM_Event_Form_Registration_Confirm::fixLocationFie<wbr>lds</span><span class="sf3b2">($</span><span class="sf18b2">value, $</span><span class="sf18b2">fields);</span></code></td>
<td class="ln">1302</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">CRM_Event_Form_Registration_Confirm::fixLocationFie<wbr>lds</span><span class="sf3b2">($</span><span class="sf18b2">value, $</span><span class="sf18b2">fields);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1266</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">//for free event or additional participant, dont create billing email address.</span></code></td>
<td class="ln">1303</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">//for free event or additional participant, dont create billing email address.</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1267</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'is_primary'</span><span class="sf3b2">, $</span><span class="sf18b2">value) || !$</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">][</span><span class="sf12b2">'is_monetary'</span><span class="sf3b2">]) {</span></code></td>
<td class="ln">1304</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'is_primary'</span><span class="sf3b2">, $</span><span class="sf18b2">value) || !$</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">][</span><span class="sf12b2">'is_monetary'</span><span class="sf3b2">]) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1268</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">unset</span><span class="sf3b2">($</span><span class="sf18b2">value[</span><span class="sf12b2">"email-{$this-&gt;_bltID}"</span><span class="sf3b2">]);</span></code></td>
<td class="ln">1305</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">unset</span><span class="sf3b2">($</span><span class="sf18b2">value[</span><span class="sf12b2">"email-{$this-&gt;_bltID}"</span><span class="sf3b2">]);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1269</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">1306</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1270</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1307</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">1271</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">contactID = </span><span class="sf8b2">CRM_Event_Form_Registration_Confirm::updateContactF<wbr>ields</span><span class="sf3b2">($</span><span class="sf18b2">contactID, $</span><span class="sf18b2">value, $</span><span class="sf18b2">fields);</span></code></td>
<td class="ln">1308</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">contactID = </span><span class="sf8b2">CRM_Event_Form_Registration_Confirm::updateContactF<wbr>ields</span><span class="sf3b2">($</span><span class="sf18b2">contactID, $</span><span class="sf18b2">value, $</span><span class="sf18b2">fields);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1272</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1309</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">1273</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">// lets store the contactID in the session</span></code></td>
<td class="ln">1310</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">// lets store the contactID in the session</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1274</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">// we dont store in userID in case the user is doing multiple</span></code></td>
<td class="ln">1311</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">// we dont store in userID in case the user is doing multiple</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1275</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">// transactions etc</span></code></td>
<td class="ln">1312</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">// transactions etc</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1276</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">// for things like tell a friend</span></code></td>
<td class="ln">1313</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">// for things like tell a friend</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1277</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!</span><span class="sf8b2">parent::getContactID</span><span class="sf3b2">() &amp;&amp; </span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'is_primary'</span><span class="sf3b2">, $</span><span class="sf18b2">value)) {</span></code></td>
<td class="ln">1314</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!</span><span class="sf8b2">parent::getContactID</span><span class="sf3b2">() &amp;&amp; </span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'is_primary'</span><span class="sf3b2">, $</span><span class="sf18b2">value)) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1278</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">session-&gt;</span><span class="sf8b2">set</span><span class="sf3b2">(</span><span class="sf12b2">'transaction.userID'</span><span class="sf3b2">, $</span><span class="sf18b2">contactID);</span></code></td>
<td class="ln">1315</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">session-&gt;</span><span class="sf8b2">set</span><span class="sf3b2">(</span><span class="sf12b2">'transaction.userID'</span><span class="sf3b2">, $</span><span class="sf18b2">contactID);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1279</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">1316</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1280</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1317</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">1281</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">//lets get the status if require approval or waiting.</span></code></td>
<td class="ln">1318</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">//lets get the status if require approval or waiting.</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1282</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1319</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">1283</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">waitingStatuses = </span><span class="sf8b2">CRM_Event_PseudoConstant::participantStatus</span><span class="sf3b2">(NULL, </span><span class="sf12b2">"class = 'Waiting'"</span><span class="sf3b2">);</span></code></td>
<td class="ln">1320</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">waitingStatuses = </span><span class="sf8b2">CRM_Event_PseudoConstant::participantStatus</span><span class="sf3b2">(NULL, </span><span class="sf12b2">"class = 'Waiting'"</span><span class="sf3b2">);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1284</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">this-&gt;_allowWaitlist &amp;&amp; !$</span><span class="sf18b2">this-&gt;_allowConfirmation) {</span></code></td>
<td class="ln">1321</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">this-&gt;_allowWaitlist &amp;&amp; !$</span><span class="sf18b2">this-&gt;_allowConfirmation) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1285</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">value[</span><span class="sf12b2">'participant_status_id'</span><span class="sf3b2">] = $</span><span class="sf18b2">value[</span><span class="sf12b2">'participant_status'</span><span class="sf3b2">] = </span><span class="sf8b2">array_search</span><span class="sf3b2">(</span><span class="sf12b2">'On waitlist'</span><span class="sf3b2">, $</span><span class="sf18b2">waitingStatuses);</span></code></td>
<td class="ln">1322</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">value[</span><span class="sf12b2">'participant_status_id'</span><span class="sf3b2">] = $</span><span class="sf18b2">value[</span><span class="sf12b2">'participant_status'</span><span class="sf3b2">] = </span><span class="sf8b2">array_search</span><span class="sf3b2">(</span><span class="sf12b2">'On waitlist'</span><span class="sf3b2">, $</span><span class="sf18b2">waitingStatuses);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1286</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">1323</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1287</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">elseif</span><span class="sf3b2"> ($</span><span class="sf18b2">this-&gt;_requireApproval &amp;&amp; !$</span><span class="sf18b2">this-&gt;_allowConfirmation) {</span></code></td>
<td class="ln">1324</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">elseif</span><span class="sf3b2"> ($</span><span class="sf18b2">this-&gt;_requireApproval &amp;&amp; !$</span><span class="sf18b2">this-&gt;_allowConfirmation) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1288</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">value[</span><span class="sf12b2">'participant_status_id'</span><span class="sf3b2">] = $</span><span class="sf18b2">value[</span><span class="sf12b2">'participant_status'</span><span class="sf3b2">] = </span><span class="sf8b2">array_search</span><span class="sf3b2">(</span><span class="sf12b2">'Awaiting approval'</span><span class="sf3b2">, $</span><span class="sf18b2">waitingStatuses);</span></code></td>
<td class="ln">1325</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">value[</span><span class="sf12b2">'participant_status_id'</span><span class="sf3b2">] = $</span><span class="sf18b2">value[</span><span class="sf12b2">'participant_status'</span><span class="sf3b2">] = </span><span class="sf8b2">array_search</span><span class="sf3b2">(</span><span class="sf12b2">'Awaiting approval'</span><span class="sf3b2">, $</span><span class="sf18b2">waitingStatuses);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1289</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">1326</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1290</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1327</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">1291</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">set</span><span class="sf3b2">(</span><span class="sf12b2">'value'</span><span class="sf3b2">, $</span><span class="sf18b2">value);</span></code></td>
<td class="ln">1328</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">set</span><span class="sf3b2">(</span><span class="sf12b2">'value'</span><span class="sf3b2">, $</span><span class="sf18b2">value);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1292</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">confirmPostProcess</span><span class="sf3b2">($</span><span class="sf18b2">contactID, NULL, NULL);</span></code></td>
<td class="ln">1329</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">confirmPostProcess</span><span class="sf3b2">($</span><span class="sf18b2">contactID, NULL, NULL);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1293</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1330</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">1294</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">//lets get additional participant id to cancel.</span></code></td>
<td class="ln">1331</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">//lets get additional participant id to cancel.</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1295</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">_allowConfirmation &amp;&amp; is_array</span><span class="sf3b2">($</span><span class="sf18b2">cancelledIds)) {</span></code></td>
<td class="ln">1332</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">_allowConfirmation &amp;&amp; is_array</span><span class="sf3b2">($</span><span class="sf18b2">cancelledIds)) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1296</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">additonalId = </span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'participant_id'</span><span class="sf3b2">, $</span><span class="sf18b2">value);</span></code></td>
<td class="ln">1333</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">additonalId = </span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'participant_id'</span><span class="sf3b2">, $</span><span class="sf18b2">value);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1297</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">additonalId &amp;&amp; $</span><span class="sf18b2">key = </span><span class="sf8b2">array_search</span><span class="sf3b2">($</span><span class="sf18b2">additonalId, $</span><span class="sf18b2">cancelledIds)) {</span></code></td>
<td class="ln">1334</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">additonalId &amp;&amp; $</span><span class="sf18b2">key = </span><span class="sf8b2">array_search</span><span class="sf3b2">($</span><span class="sf18b2">additonalId, $</span><span class="sf18b2">cancelledIds)) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1298</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">unset</span><span class="sf3b2">($</span><span class="sf18b2">cancelledIds[$</span><span class="sf18b2">key]);</span></code></td>
<td class="ln">1335</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">unset</span><span class="sf3b2">($</span><span class="sf18b2">cancelledIds[$</span><span class="sf18b2">key]);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1299</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">1336</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1300</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">1337</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1301</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">1338</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1302</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">1339</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1303</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1340</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">1304</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// update status and send mail to cancelled additonal participants, CRM-4320</span></code></td>
<td class="ln">1341</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// update status and send mail to cancelled additonal participants, CRM-4320</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1305</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">_allowConfirmation &amp;&amp; is_array</span><span class="sf3b2">($</span><span class="sf18b2">cancelledIds) &amp;&amp; !</span><span class="sf7b2">empty</span><span class="sf3b2">($</span><span class="sf18b2">cancelledIds)) {</span></code></td>
<td class="ln">1342</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">_allowConfirmation &amp;&amp; is_array</span><span class="sf3b2">($</span><span class="sf18b2">cancelledIds) &amp;&amp; !</span><span class="sf7b2">empty</span><span class="sf3b2">($</span><span class="sf18b2">cancelledIds)) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1306</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">cancelledId = </span><span class="sf8b2">array_search</span><span class="sf3b2">(</span><span class="sf12b2">'Cancelled'</span><span class="sf3b2">,</span></code></td>
<td class="ln">1343</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">cancelledId = </span><span class="sf8b2">array_search</span><span class="sf3b2">(</span><span class="sf12b2">'Cancelled'</span><span class="sf3b2">,</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1307</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">CRM_Event_PseudoConstant::participantStatus</span><span class="sf3b2">(NULL, </span><span class="sf12b2">"class = 'Negative'"</span><span class="sf3b2">)</span></code></td>
<td class="ln">1344</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">CRM_Event_PseudoConstant::participantStatus</span><span class="sf3b2">(NULL, </span><span class="sf12b2">"class = 'Negative'"</span><span class="sf3b2">)</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1308</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;);</span></code></td>
<td class="ln">1345</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1309</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">CRM_Event_BAO_Participant::transitionParticipants</span><span class="sf3b2">($<wbr></span><span class="sf18b2">cancelledIds, $</span><span class="sf18b2">cancelledId);</span></code></td>
<td class="ln">1346</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">CRM_Event_BAO_Participant::transitionParticipants</span><span class="sf3b2">($<wbr></span><span class="sf18b2">cancelledIds, $</span><span class="sf18b2">cancelledId);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1310</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">1347</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1311</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1348</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">1312</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">//set information about additional participants if exists</span></code></td>
<td class="ln">1349</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">//set information about additional participants if exists</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1313</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">count</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;_participantInfo)) {</span></code></td>
<td class="ln">1350</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">count</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;_participantInfo)) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1314</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">set</span><span class="sf3b2">(</span><span class="sf12b2">'participantInfo'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_participantInfo);</span></code></td>
<td class="ln">1351</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">set</span><span class="sf3b2">(</span><span class="sf12b2">'participantInfo'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_participantInfo);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1315</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">1352</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1316</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1353</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">1317</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">//send mail Confirmation/Receipt</span></code></td>
<td class="ln">1354</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">//send mail Confirmation/Receipt</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1318</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">this-&gt;_contributeMode != </span><span class="sf12b2">'checkout'</span><span class="sf3b2"> ||</span></code></td>
<td class="ln">1355</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">this-&gt;_contributeMode != </span><span class="sf12b2">'checkout'</span><span class="sf3b2"> ||</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1319</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_contributeMode != </span><span class="sf12b2">'notify'</span>&nbsp;</code></td>
<td class="ln">1356</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_contributeMode != </span><span class="sf12b2">'notify'</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">1320</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;) {</span></code></td>
<td class="ln">1357</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1321</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">isTest = FALSE;</span></code></td>
<td class="ln">1358</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">isTest = FALSE;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1322</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">this-&gt;_action &amp; CRM_Core_Action::PREVIEW) {</span></code></td>
<td class="ln">1359</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">this-&gt;_action &amp; CRM_Core_Action::PREVIEW) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1323</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">isTest = TRUE;</span></code></td>
<td class="ln">1360</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">isTest = TRUE;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1324</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">1361</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1325</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1362</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">1326</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">//handle if no additional participant.</span></code></td>
<td class="ln">1363</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">//handle if no additional participant.</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1327</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!$</span><span class="sf18b2">registerByID) {</span></code></td>
<td class="ln">1364</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!$</span><span class="sf18b2">registerByID) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1328</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">registerByID = $</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">get</span><span class="sf3b2">(</span><span class="sf12b2">'registerByID'</span><span class="sf3b2">);</span></code></td>
<td class="ln">1365</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">registerByID = $</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">get</span><span class="sf3b2">(</span><span class="sf12b2">'registerByID'</span><span class="sf3b2">);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1329</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">1366</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1330</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">primaryContactId = $</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">get</span><span class="sf3b2">(</span><span class="sf12b2">'primaryContactId'</span><span class="sf3b2">);</span></code></td>
<td class="ln">1367</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">primaryContactId = $</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">get</span><span class="sf3b2">(</span><span class="sf12b2">'primaryContactId'</span><span class="sf3b2">);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1331</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1368</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">1332</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">//build an array of custom profile and assigning it to template.</span></code></td>
<td class="ln">1369</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">//build an array of custom profile and assigning it to template.</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1333</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">additionalIDs = </span><span class="sf8b2">CRM_Event_BAO_Event::buildCustomProfile</span><span class="sf3b2">($</span><span class="sf18b2">registerBy<wbr>ID, NULL,</span></code></td>
<td class="ln">1370</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">additionalIDs = </span><span class="sf8b2">CRM_Event_BAO_Event::buildCustomProfile</span><span class="sf3b2">($</span><span class="sf18b2">registerBy<wbr>ID, NULL,</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1334</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">primaryContactId, $</span><span class="sf18b2">isTest, TRUE</span></code></td>
<td class="ln">1371</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">primaryContactId, $</span><span class="sf18b2">isTest, TRUE</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1335</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;);</span></code></td>
<td class="ln">1372</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1336</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1373</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">1337</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">//lets carry all paticipant params w/ values.</span></code></td>
<td class="ln">1374</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">//lets carry all paticipant params w/ values.</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1338</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">foreach</span><span class="sf3b2"> ($</span><span class="sf18b2">additionalIDs </span><span class="sf7b2">as</span><span class="sf3b2"> $</span><span class="sf18b2">participantID =&gt; $</span><span class="sf18b2">contactId) {</span></code></td>
<td class="ln">1375</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">foreach</span><span class="sf3b2"> ($</span><span class="sf18b2">additionalIDs </span><span class="sf7b2">as</span><span class="sf3b2"> $</span><span class="sf18b2">participantID =&gt; $</span><span class="sf18b2">contactId) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1339</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">participantNum = NULL;</span></code></td>
<td class="ln">1376</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">participantNum = NULL;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1340</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">participantID == $</span><span class="sf18b2">registerByID) {</span></code></td>
<td class="ln">1377</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">participantID == $</span><span class="sf18b2">registerByID) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1341</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">participantNum = </span><span class="sf10b2">0</span><span class="sf3b2">;</span></code></td>
<td class="ln">1378</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">participantNum = </span><span class="sf10b2">0</span><span class="sf3b2">;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1342</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">1379</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1343</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">else</span><span class="sf3b2"> {</span></code></td>
<td class="ln">1380</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">else</span><span class="sf3b2"> {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1344</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">participantNum = </span><span class="sf8b2">array_search</span><span class="sf3b2">(</span><span class="sf12b2">'participant'</span><span class="sf3b2">, $</span><span class="sf18b2">participantCount)) {</span></code></td>
<td class="ln">1381</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">participantNum = </span><span class="sf8b2">array_search</span><span class="sf3b2">(</span><span class="sf12b2">'participant'</span><span class="sf3b2">, $</span><span class="sf18b2">participantCount)) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1345</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">unset</span><span class="sf3b2">($</span><span class="sf18b2">participantCount[$</span><span class="sf18b2">participantNum]);</span></code></td>
<td class="ln">1382</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">unset</span><span class="sf3b2">($</span><span class="sf18b2">participantCount[$</span><span class="sf18b2">participantNum]);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1346</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">1383</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1347</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">1384</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1348</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1385</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">1349</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">participantNum === NULL) {</span></code></td>
<td class="ln">1386</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">participantNum === NULL) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1350</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">break</span><span class="sf3b2">;</span></code></td>
<td class="ln">1387</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">break</span><span class="sf3b2">;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1351</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">1388</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1352</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1389</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">1353</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">//carry the participant submitted values.</span></code></td>
<td class="ln">1390</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">//carry the participant submitted values.</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1354</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'params'</span><span class="sf3b2">][$</span><span class="sf18b2">participantID] = $</span><span class="sf18b2">params[$</span><span class="sf18b2">participantNum];</span></code></td>
<td class="ln">1391</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'params'</span><span class="sf3b2">][$</span><span class="sf18b2">participantID] = $</span><span class="sf18b2">params[$</span><span class="sf18b2">participantNum];</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1355</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">1392</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1356</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1393</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">1357</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">//lets send &nbsp;mails to all with meanigful text, CRM-4320.</span></code></td>
<td class="ln">1394</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">//lets send &nbsp;mails to all with meanigful text, CRM-4320.</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1358</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">assign</span><span class="sf3b2">(</span><span class="sf12b2">'isOnWaitlist'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_allowWaitlist);</span></code></td>
<td class="ln">1395</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">assign</span><span class="sf3b2">(</span><span class="sf12b2">'isOnWaitlist'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_allowWaitlist);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1359</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">assign</span><span class="sf3b2">(</span><span class="sf12b2">'isRequireApproval'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_requireApproval);</span></code></td>
<td class="ln">1396</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">assign</span><span class="sf3b2">(</span><span class="sf12b2">'isRequireApproval'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_requireApproval);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1360</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1397</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">1361</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">foreach</span><span class="sf3b2"> ($</span><span class="sf18b2">additionalIDs </span><span class="sf7b2">as</span><span class="sf3b2"> $</span><span class="sf18b2">participantID =&gt; $</span><span class="sf18b2">contactId) {</span></code></td>
<td class="ln">1398</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">foreach</span><span class="sf3b2"> ($</span><span class="sf18b2">additionalIDs </span><span class="sf7b2">as</span><span class="sf3b2"> $</span><span class="sf18b2">participantID =&gt; $</span><span class="sf18b2">contactId) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1362</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">participantID == $</span><span class="sf18b2">registerByID) {</span></code></td>
<td class="ln">1399</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">participantID == $</span><span class="sf18b2">registerByID) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1363</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">//set as Primary Participant</span></code></td>
<td class="ln">1400</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">//set as Primary Participant</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1364</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">assign</span><span class="sf3b2">(</span><span class="sf12b2">'isPrimary'</span><span class="sf3b2">, </span><span class="sf10b2">1</span><span class="sf3b2">);</span></code></td>
<td class="ln">1401</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">assign</span><span class="sf3b2">(</span><span class="sf12b2">'isPrimary'</span><span class="sf3b2">, </span><span class="sf10b2">1</span><span class="sf3b2">);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1365</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1402</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">1366</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">customProfile = </span><span class="sf8b2">CRM_Event_BAO_Event::buildCustomProfile</span><span class="sf3b2">($</span><span class="sf18b2">participan<wbr>tID, $</span><span class="sf18b2">this-&gt;_values, NULL, $</span><span class="sf18b2">isTest);</span></code></td>
<td class="ln">1403</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">customProfile = </span><span class="sf8b2">CRM_Event_BAO_Event::buildCustomProfile</span><span class="sf3b2">($</span><span class="sf18b2">participan<wbr>tID, $</span><span class="sf18b2">this-&gt;_values, NULL, $</span><span class="sf18b2">isTest);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1367</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1404</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">1368</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">count</span><span class="sf3b2">($</span><span class="sf18b2">customProfile)) {</span></code></td>
<td class="ln">1405</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">count</span><span class="sf3b2">($</span><span class="sf18b2">customProfile)) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1369</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">assign</span><span class="sf3b2">(</span><span class="sf12b2">'customProfile'</span><span class="sf3b2">, $</span><span class="sf18b2">customProfile);</span></code></td>
<td class="ln">1406</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">assign</span><span class="sf3b2">(</span><span class="sf12b2">'customProfile'</span><span class="sf3b2">, $</span><span class="sf18b2">customProfile);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1370</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">set</span><span class="sf3b2">(</span><span class="sf12b2">'customProfile'</span><span class="sf3b2">, $</span><span class="sf18b2">customProfile);</span></code></td>
<td class="ln">1407</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">set</span><span class="sf3b2">(</span><span class="sf12b2">'customProfile'</span><span class="sf3b2">, $</span><span class="sf18b2">customProfile);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1371</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">1408</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1372</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">1409</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1373</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">else</span><span class="sf3b2"> {</span></code></td>
<td class="ln">1410</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">else</span><span class="sf3b2"> {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1374</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">assign</span><span class="sf3b2">(</span><span class="sf12b2">'isPrimary'</span><span class="sf3b2">, </span><span class="sf10b2">0</span><span class="sf3b2">);</span></code></td>
<td class="ln">1411</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">assign</span><span class="sf3b2">(</span><span class="sf12b2">'isPrimary'</span><span class="sf3b2">, </span><span class="sf10b2">0</span><span class="sf3b2">);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1375</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">assign</span><span class="sf3b2">(</span><span class="sf12b2">'customProfile'</span><span class="sf3b2">, NULL);</span></code></td>
<td class="ln">1412</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">assign</span><span class="sf3b2">(</span><span class="sf12b2">'customProfile'</span><span class="sf3b2">, NULL);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1376</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">1413</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1377</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1414</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">1378</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">//send Confirmation mail to Primary &amp; additional Participants if exists</span></code></td>
<td class="ln">1415</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">//send Confirmation mail to Primary &amp; additional Participants if exists</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1379</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">CRM_Event_BAO_Event::sendMail</span><span class="sf3b2">($</span><span class="sf18b2">contactId, $</span><span class="sf18b2">this-&gt;_values, $</span><span class="sf18b2">participantID, $</span><span class="sf18b2">isTest);</span></code></td>
<td class="ln">1416</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">CRM_Event_BAO_Event::sendMail</span><span class="sf3b2">($</span><span class="sf18b2">contactId, $</span><span class="sf18b2">this-&gt;_values, $</span><span class="sf18b2">participantID, $</span><span class="sf18b2">isTest);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1380</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">1417</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1381</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">1418</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1382</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;}</span></code></td>
<td class="ln">1419</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1383</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1420</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">1384</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf9b2">/**</span></code></td>
<td class="ln">1421</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf9b2">/**</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1385</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * Method to check if the user is already registered for the event</span></code></td>
<td class="ln">1422</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * Method to check if the user is already registered for the event</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1386</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * and if result found redirect to the event info page</span></code></td>
<td class="ln">1423</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * and if result found redirect to the event info page</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1387</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; *</span></code></td>
<td class="ln">1424</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; *</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1388</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @param array $fields &nbsp;the input form values(anonymous user)</span></code></td>
<td class="ln">1425</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @param array $fields &nbsp;the input form values(anonymous user)</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1389</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @param array $self &nbsp; &nbsp;event data</span></code></td>
<td class="ln">1426</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @param array $self &nbsp; &nbsp;event data</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1390</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; *</span></code></td>
<td class="ln">1427</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; *</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1391</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @return void</span></code></td>
<td class="ln">1428</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @return void</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1392</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @access public</span></code></td>
<td class="ln">1429</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @access public</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1393</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; */</span>&nbsp;</code></td>
<td class="ln">1430</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; */</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">1394</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf7b2">function</span><span class="sf3b2"> </span><span class="sf8b2">checkRegistration</span><span class="sf3b2">($</span><span class="sf18b2">fields, &amp;$</span><span class="sf18b2">self, $</span><span class="sf18b2">isAdditional = FALSE, $</span><span class="sf18b2">returnContactId = FALSE) {</span></code></td>
<td class="ln">1431</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf7b2">function</span><span class="sf3b2"> </span><span class="sf8b2">checkRegistration</span><span class="sf3b2">($</span><span class="sf18b2">fields, &amp;$</span><span class="sf18b2">self, $</span><span class="sf18b2">isAdditional = FALSE, $</span><span class="sf18b2">returnContactId = FALSE) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1395</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// CRM-3907, skip check for preview registrations</span></code></td>
<td class="ln">1432</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// CRM-3907, skip check for preview registrations</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1396</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// CRM-4320 participant need to walk wizard</span></code></td>
<td class="ln">1433</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// CRM-4320 participant need to walk wizard</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1397</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!$</span><span class="sf18b2">returnContactId &amp;&amp;</span></code></td>
<td class="ln">1434</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!$</span><span class="sf18b2">returnContactId &amp;&amp;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1398</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;($</span><span class="sf18b2">self-&gt;_mode == </span><span class="sf12b2">'test'</span><span class="sf3b2"> || $</span><span class="sf18b2">self-&gt;_allowConfirmation)</span></code></td>
<td class="ln">1435</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;($</span><span class="sf18b2">self-&gt;_mode == </span><span class="sf12b2">'test'</span><span class="sf3b2"> || $</span><span class="sf18b2">self-&gt;_allowConfirmation)</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1399</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;) {</span></code></td>
<td class="ln">1436</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1400</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">return</span><span class="sf3b2"> FALSE;</span></code></td>
<td class="ln">1437</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">return</span><span class="sf3b2"> FALSE;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1401</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">1438</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1402</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1439</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">1403</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">contactID = NULL;</span></code></td>
<td class="ln">1440</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">contactID = NULL;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1404</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">session = </span><span class="sf8b2">CRM_Core_Session::singleton</span><span class="sf3b2">();</span></code></td>
<td class="ln">1441</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">session = </span><span class="sf8b2">CRM_Core_Session::singleton</span><span class="sf3b2">();</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1405</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!$</span><span class="sf18b2">isAdditional) {</span></code></td>
<td class="ln">1442</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!$</span><span class="sf18b2">isAdditional) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1406</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">contactID = </span><span class="sf8b2">parent::getContactID</span><span class="sf3b2">();</span></code></td>
<td class="ln">1443</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">contactID = </span><span class="sf8b2">parent::getContactID</span><span class="sf3b2">();</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1407</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">1444</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1408</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1445</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">1409</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!$</span><span class="sf18b2">contactID &amp;&amp;</span></code></td>
<td class="ln">1446</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!$</span><span class="sf18b2">contactID &amp;&amp;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1410</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">is_array</span><span class="sf3b2">($</span><span class="sf18b2">fields) &amp;&amp;</span></code></td>
<td class="ln">1447</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">is_array</span><span class="sf3b2">($</span><span class="sf18b2">fields) &amp;&amp;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1411</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;!</span><span class="sf7b2">empty</span><span class="sf3b2">($</span><span class="sf18b2">fields)</span></code></td>
<td class="ln">1448</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;!</span><span class="sf7b2">empty</span><span class="sf3b2">($</span><span class="sf18b2">fields)</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1412</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;) {</span></code></td>
<td class="ln">1449</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1413</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1450</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">1414</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">//CRM-6996</span></code></td>
<td class="ln">1451</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">//CRM-6996</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1415</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">//as we are allowing w/ same email address,</span></code></td>
<td class="ln">1452</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">//as we are allowing w/ same email address,</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1416</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">//lets check w/ other contact params.</span></code></td>
<td class="ln">1453</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">//lets check w/ other contact params.</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1417</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">self-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">][</span><span class="sf12b2">'allow_same_participant_em<wbr>ails'</span><span class="sf3b2">]) {</span></code></td>
<td class="ln">1454</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">self-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">][</span><span class="sf12b2">'allow_same_participant_em<wbr>ails'</span><span class="sf3b2">]) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1418</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">params = $</span><span class="sf18b2">fields;</span></code></td>
<td class="ln">1455</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">params = $</span><span class="sf18b2">fields;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1419</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">level = ($</span><span class="sf18b2">isAdditional) ? </span><span class="sf12b2">'Fuzzy'</span><span class="sf3b2"> : </span><span class="sf12b2">'Strict'</span><span class="sf3b2">;</span></code></td>
<td class="ln">1456</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">level = ($</span><span class="sf18b2">isAdditional) ? </span><span class="sf12b2">'Fuzzy'</span><span class="sf3b2"> : </span><span class="sf12b2">'Strict'</span><span class="sf3b2">;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1420</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1457</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">1421</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">dedupeParams = </span><span class="sf8b2">CRM_Dedupe_Finder::formatParams</span><span class="sf3b2">($</span><span class="sf18b2">params, </span><span class="sf12b2">'Individual'</span><span class="sf3b2">);</span></code></td>
<td class="ln">1458</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">dedupeParams = </span><span class="sf8b2">CRM_Dedupe_Finder::formatParams</span><span class="sf3b2">($</span><span class="sf18b2">params, </span><span class="sf12b2">'Individual'</span><span class="sf3b2">);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1422</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1459</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">1423</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">// disable permission based on cache since event registration is public page/feature.</span></code></td>
<td class="ln">1460</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">// disable permission based on cache since event registration is public page/feature.</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1424</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">dedupeParams[</span><span class="sf12b2">'check_permission'</span><span class="sf3b2">] = FALSE;</span></code></td>
<td class="ln">1461</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">dedupeParams[</span><span class="sf12b2">'check_permission'</span><span class="sf3b2">] = FALSE;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1425</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">ids = </span><span class="sf8b2">CRM_Dedupe_Finder::dupesByParams</span><span class="sf3b2">($</span><span class="sf18b2">dedupeParams, </span><span class="sf12b2">'Individual'</span><span class="sf3b2">, $</span><span class="sf18b2">level);</span></code></td>
<td class="ln">1462</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">ids = </span><span class="sf8b2">CRM_Dedupe_Finder::dupesByParams</span><span class="sf3b2">($</span><span class="sf18b2">dedupeParams, </span><span class="sf12b2">'Individual'</span><span class="sf3b2">, $</span><span class="sf18b2">level);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1426</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">contactID = </span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf10b2">0</span><span class="sf3b2">, $</span><span class="sf18b2">ids);</span></code></td>
<td class="ln">1463</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">contactID = </span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf10b2">0</span><span class="sf3b2">, $</span><span class="sf18b2">ids);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1427</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">1464</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1428</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">else</span><span class="sf3b2"> {</span></code></td>
<td class="ln">1465</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">else</span><span class="sf3b2"> {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1429</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">foreach</span><span class="sf3b2"> ($</span><span class="sf18b2">fields </span><span class="sf7b2">as</span><span class="sf3b2"> $</span><span class="sf18b2">fieldname =&gt; $</span><span class="sf18b2">fieldvalue) {</span></code></td>
<td class="ln">1466</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">foreach</span><span class="sf3b2"> ($</span><span class="sf18b2">fields </span><span class="sf7b2">as</span><span class="sf3b2"> $</span><span class="sf18b2">fieldname =&gt; $</span><span class="sf18b2">fieldvalue) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1430</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">substr</span><span class="sf3b2">($</span><span class="sf18b2">fieldname, </span><span class="sf10b2">0</span><span class="sf3b2">, </span><span class="sf10b2">6</span><span class="sf3b2">) == </span><span class="sf12b2">'email-'</span><span class="sf3b2">) {</span></code></td>
<td class="ln">1467</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">substr</span><span class="sf3b2">($</span><span class="sf18b2">fieldname, </span><span class="sf10b2">0</span><span class="sf3b2">, </span><span class="sf10b2">6</span><span class="sf3b2">) == </span><span class="sf12b2">'email-'</span><span class="sf3b2">) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1431</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">emailString = </span><span class="sf8b2">trim</span><span class="sf3b2">($</span><span class="sf18b2">fieldvalue);</span></code></td>
<td class="ln">1468</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">emailString = </span><span class="sf8b2">trim</span><span class="sf3b2">($</span><span class="sf18b2">fieldvalue);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1432</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!</span><span class="sf7b2">empty</span><span class="sf3b2">($</span><span class="sf18b2">emailString)) {</span></code></td>
<td class="ln">1469</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!</span><span class="sf7b2">empty</span><span class="sf3b2">($</span><span class="sf18b2">emailString)) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1433</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">match = </span><span class="sf8b2">CRM_Contact_BAO_Contact::matchContactOnEmail</span><span class="sf3b2">($</span><span class="sf18b2">email<wbr>String, </span><span class="sf12b2">'Individual'</span><span class="sf3b2">);</span></code></td>
<td class="ln">1470</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">match = </span><span class="sf8b2">CRM_Contact_BAO_Contact::matchContactOnEmail</span><span class="sf3b2">($</span><span class="sf18b2">email<wbr>String, </span><span class="sf12b2">'Individual'</span><span class="sf3b2">);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1434</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!</span><span class="sf7b2">empty</span><span class="sf3b2">($</span><span class="sf18b2">match)) {</span></code></td>
<td class="ln">1471</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!</span><span class="sf7b2">empty</span><span class="sf3b2">($</span><span class="sf18b2">match)) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1435</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">contactID = $</span><span class="sf18b2">match-&gt;contact_id;</span></code></td>
<td class="ln">1472</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">contactID = $</span><span class="sf18b2">match-&gt;contact_id;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1436</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">1473</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1437</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">1474</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1438</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">1475</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1439</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">1476</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1440</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">1477</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1441</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">1478</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1442</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1479</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">1443</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">returnContactId) {</span></code></td>
<td class="ln">1480</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">returnContactId) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1444</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">// CRM-7377</span></code></td>
<td class="ln">1481</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">// CRM-7377</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1445</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">// return contactID if contact already exists</span></code></td>
<td class="ln">1482</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">// return contactID if contact already exists</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1446</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">return</span><span class="sf3b2"> $</span><span class="sf18b2">contactID;</span></code></td>
<td class="ln">1483</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">return</span><span class="sf3b2"> $</span><span class="sf18b2">contactID;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1447</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">1484</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1448</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1485</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">1449</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">contactID) {</span></code></td>
<td class="ln">1486</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">contactID) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1450</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">participant = </span><span class="sf7b2">new</span><span class="sf3b2"> </span><span class="sf8b2">CRM_Event_BAO_Participant</span><span class="sf3b2">();</span></code></td>
<td class="ln">1487</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">participant = </span><span class="sf7b2">new</span><span class="sf3b2"> </span><span class="sf8b2">CRM_Event_BAO_Participant</span><span class="sf3b2">();</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1451</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">participant-&gt;contact_id = $</span><span class="sf18b2">contactID;</span></code></td>
<td class="ln">1488</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">participant-&gt;contact_id = $</span><span class="sf18b2">contactID;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1452</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">participant-&gt;event_id = $</span><span class="sf18b2">self-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">][</span><span class="sf12b2">'id'</span><span class="sf3b2">];</span></code></td>
<td class="ln">1489</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">participant-&gt;event_id = $</span><span class="sf18b2">self-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">][</span><span class="sf12b2">'id'</span><span class="sf3b2">];</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1453</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">participant-&gt;role_id = $</span><span class="sf18b2">self-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">][</span><span class="sf12b2">'default_role_id'</span><span class="sf3b2">];</span></code></td>
<td class="ln">1490</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">participant-&gt;role_id = $</span><span class="sf18b2">self-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">][</span><span class="sf12b2">'default_role_id'</span><span class="sf3b2">];</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1454</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">participant-&gt;is_test = 0;</span></code></td>
<td class="ln">1491</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">participant-&gt;is_test = 0;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1455</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">participant-&gt;</span><span class="sf8b2">find</span><span class="sf3b2">();</span></code></td>
<td class="ln">1492</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">participant-&gt;</span><span class="sf8b2">find</span><span class="sf3b2">();</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1456</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1493</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">1457</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">statusTypes = </span><span class="sf8b2">CRM_Event_PseudoConstant::participantStatus</span><span class="sf3b2">(NULL, </span><span class="sf12b2">'is_counted = 1'</span><span class="sf3b2">);</span></code></td>
<td class="ln">1494</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">statusTypes = </span><span class="sf8b2">CRM_Event_PseudoConstant::participantStatus</span><span class="sf3b2">(NULL, </span><span class="sf12b2">'is_counted = 1'</span><span class="sf3b2">);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1458</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">while</span><span class="sf3b2"> ($</span><span class="sf18b2">participant-&gt;</span><span class="sf8b2">fetch</span><span class="sf3b2">()) {</span></code></td>
<td class="ln">1495</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">while</span><span class="sf3b2"> ($</span><span class="sf18b2">participant-&gt;</span><span class="sf8b2">fetch</span><span class="sf3b2">()) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1459</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">array_key_exists</span><span class="sf3b2">($</span><span class="sf18b2">participant-&gt;status_id, $</span><span class="sf18b2">statusTypes)) {</span></code></td>
<td class="ln">1496</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">array_key_exists</span><span class="sf3b2">($</span><span class="sf18b2">participant-&gt;status_id, $</span><span class="sf18b2">statusTypes)) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1460</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!$</span><span class="sf18b2">isAdditional &amp;&amp; !$</span><span class="sf18b2">self-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">][</span><span class="sf12b2">'allow_same_participant_em<wbr>ails'</span><span class="sf3b2">]) {</span></code></td>
<td class="ln">1497</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!$</span><span class="sf18b2">isAdditional &amp;&amp; !$</span><span class="sf18b2">self-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">][</span><span class="sf12b2">'allow_same_participant_em<wbr>ails'</span><span class="sf3b2">]) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1461</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">registerUrl = </span><span class="sf8b2">CRM_Utils_System::url</span><span class="sf3b2">(</span><span class="sf12b2">'civicrm/event/register'</span><span class="sf3b2">,</span></code></td>
<td class="ln">1498</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">registerUrl = </span><span class="sf8b2">CRM_Utils_System::url</span><span class="sf3b2">(</span><span class="sf12b2">'civicrm/event/register'</span><span class="sf3b2">,</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1462</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">"reset=1&amp;id={$self-&gt;_values['event']['id']}&amp;cid=0"</span>&nbsp;</code></td>
<td class="ln">1499</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">"reset=1&amp;id={$self-&gt;_values['event']['id']}&amp;cid=0"</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">1463</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;);</span></code></td>
<td class="ln">1500</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1464</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">self-&gt;_pcpId) {</span></code></td>
<td class="ln">1501</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">self-&gt;_pcpId) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1465</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">registerUrl .= </span><span class="sf12b2">'&amp;pcpId='</span><span class="sf3b2"> . $</span><span class="sf18b2">self-&gt;_pcpId;</span></code></td>
<td class="ln">1502</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">registerUrl .= </span><span class="sf12b2">'&amp;pcpId='</span><span class="sf3b2"> . $</span><span class="sf18b2">self-&gt;_pcpId;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1466</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">1503</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1467</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1504</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">1468</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">status = </span><span class="sf8b2">ts</span><span class="sf3b2">(</span><span class="sf12b2">"Oops. It looks like you are already registered for this event. If you want to change your registration, or you feel that you've gotten this message in error, please contact the site administrator."</span><span class="sf3b2">) . </span><span class="sf12b2">' '</span><span class="sf3b2"> . ts</span><span class="sf3b2">(</span><span class="sf12b2">'You can also &lt;a href="%1"&gt;register another participant&lt;/a&gt;.'</span><span class="sf3b2">, </span><span class="sf7b2">array</span><span class="sf3b2">(</span><span class="sf10b2">1</span><span class="sf3b2"> =&gt; $</span><span class="sf18b2">registerUrl));</span></code></td>
<td class="ln">1505</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">status = </span><span class="sf8b2">ts</span><span class="sf3b2">(</span><span class="sf12b2">"Oops. It looks like you are already registered for this event. If you want to change your registration, or you feel that you've gotten this message in error, please contact the site administrator."</span><span class="sf3b2">) . </span><span class="sf12b2">' '</span><span class="sf3b2"> . ts</span><span class="sf3b2">(</span><span class="sf12b2">'You can also &lt;a href="%1"&gt;register another participant&lt;/a&gt;.'</span><span class="sf3b2">, </span><span class="sf7b2">array</span><span class="sf3b2">(</span><span class="sf10b2">1</span><span class="sf3b2"> =&gt; $</span><span class="sf18b2">registerUrl));</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1469</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">session-&gt;</span><span class="sf8b2">setStatus</span><span class="sf3b2">($</span><span class="sf18b2">status);</span></code></td>
<td class="ln">1506</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">session-&gt;</span><span class="sf8b2">setStatus</span><span class="sf3b2">($</span><span class="sf18b2">status);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1470</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">url = </span><span class="sf8b2">CRM_Utils_System::url</span><span class="sf3b2">(</span><span class="sf12b2">'civicrm/event/info'</span><span class="sf3b2">,</span></code></td>
<td class="ln">1507</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">url = </span><span class="sf8b2">CRM_Utils_System::url</span><span class="sf3b2">(</span><span class="sf12b2">'civicrm/event/info'</span><span class="sf3b2">,</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1471</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">"reset=1&amp;id={$self-&gt;_values['event']['id']}&amp;noFullM<wbr>sg=true"</span>&nbsp;</code></td>
<td class="ln">1508</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">"reset=1&amp;id={$self-&gt;_values['event']['id']}&amp;noFullM<wbr>sg=true"</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">1472</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;);</span></code></td>
<td class="ln">1509</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1473</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">self-&gt;_action &amp; CRM_Core_Action::PREVIEW) {</span></code></td>
<td class="ln">1510</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">self-&gt;_action &amp; CRM_Core_Action::PREVIEW) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1474</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">url .= </span><span class="sf12b2">'&amp;action=preview'</span><span class="sf3b2">;</span></code></td>
<td class="ln">1511</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">url .= </span><span class="sf12b2">'&amp;action=preview'</span><span class="sf3b2">;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1475</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">1512</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1476</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1513</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">1477</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">self-&gt;_pcpId) {</span></code></td>
<td class="ln">1514</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">self-&gt;_pcpId) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1478</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">url .= </span><span class="sf12b2">'&amp;pcpId='</span><span class="sf3b2"> . $</span><span class="sf18b2">self-&gt;_pcpId;</span></code></td>
<td class="ln">1515</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">url .= </span><span class="sf12b2">'&amp;pcpId='</span><span class="sf3b2"> . $</span><span class="sf18b2">self-&gt;_pcpId;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1479</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">1516</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1480</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1517</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">1481</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">CRM_Utils_System::redirect</span><span class="sf3b2">($</span><span class="sf18b2">url);</span></code></td>
<td class="ln">1518</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">CRM_Utils_System::redirect</span><span class="sf3b2">($</span><span class="sf18b2">url);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1482</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">1519</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1483</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1520</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">1484</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">isAdditional) {</span></code></td>
<td class="ln">1521</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">isAdditional) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1485</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">status = </span><span class="sf8b2">ts</span><span class="sf3b2">(</span><span class="sf12b2">"Oops. It looks like this participant is already registered for this event. If you want to change your registration, or you feel that you've gotten this message in error, please contact the site administrator."</span><span class="sf3b2">);</span></code></td>
<td class="ln">1522</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">status = </span><span class="sf8b2">ts</span><span class="sf3b2">(</span><span class="sf12b2">"Oops. It looks like this participant is already registered for this event. If you want to change your registration, or you feel that you've gotten this message in error, please contact the site administrator."</span><span class="sf3b2">);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1486</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">session-&gt;</span><span class="sf8b2">setStatus</span><span class="sf3b2">($</span><span class="sf18b2">status);</span></code></td>
<td class="ln">1523</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">session-&gt;</span><span class="sf8b2">setStatus</span><span class="sf3b2">($</span><span class="sf18b2">status);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1487</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">return</span><span class="sf3b2"> $</span><span class="sf18b2">participant-&gt;id;</span></code></td>
<td class="ln">1524</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">return</span><span class="sf3b2"> $</span><span class="sf18b2">participant-&gt;id;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1488</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">1525</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1489</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">1526</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1490</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">1527</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1491</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">1528</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1492</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;}</span></code></td>
<td class="ln">1529</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1493</td><td class="sf3b2"><code><span class="sf3b2">}</span></code></td>
<td class="ln">1530</td><td class="sf3b2"><code><span class="sf3b2">}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1494</td><td style="color: #000000; background-color: #fbf2bf; "><code>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #e9e9e9; "><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">1495</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1531</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
</tbody>
</table>
</body>
</html>
