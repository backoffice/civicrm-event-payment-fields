<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
	"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>WinMerge File Compare Report</title>
<style type="text/css">
<!--
td,th {font-size: 12pt;}
.ln {text-align: right; background-color: lightgrey;}
.title {color: white; background-color: blue; vertical-align: top;}
.sf3b2 {color: #000000; background-color: #ffffff; }
.sf3b5 {color: #000000; background-color: #000000; }
.sf3b14 {color: #000000; background-color: #ffa0a0; }
.sf3b16 {color: #000000; background-color: #f1e2ad; }
.sf6b2 {color: #ffffff; background-color: #ffffff; }
.sf6b5 {color: #ffffff; background-color: #000000; }
.sf6b14 {color: #ffffff; background-color: #ffa0a0; }
.sf6b16 {color: #ffffff; background-color: #f1e2ad; }
.sf7b2 {color: #0000ff; background-color: #ffffff; font-weight: bold; }
.sf7b5 {color: #0000ff; background-color: #000000; font-weight: bold; }
.sf7b14 {color: #0000ff; background-color: #ffa0a0; font-weight: bold; }
.sf7b16 {color: #0000ff; background-color: #f1e2ad; font-weight: bold; }
.sf8b2 {color: #800080; background-color: #ffffff; }
.sf8b5 {color: #800080; background-color: #000000; }
.sf8b14 {color: #800080; background-color: #ffa0a0; }
.sf8b16 {color: #800080; background-color: #f1e2ad; }
.sf9b2 {color: #008000; background-color: #ffffff; }
.sf9b5 {color: #008000; background-color: #000000; }
.sf9b14 {color: #008000; background-color: #ffa0a0; }
.sf9b16 {color: #008000; background-color: #f1e2ad; }
.sf10b2 {color: #ff0000; background-color: #ffffff; }
.sf10b5 {color: #ff0000; background-color: #000000; }
.sf10b14 {color: #ff0000; background-color: #ffa0a0; }
.sf10b16 {color: #ff0000; background-color: #f1e2ad; }
.sf11b2 {color: #606060; background-color: #ffffff; }
.sf11b5 {color: #606060; background-color: #000000; }
.sf11b14 {color: #606060; background-color: #ffa0a0; }
.sf11b16 {color: #606060; background-color: #f1e2ad; }
.sf12b2 {color: #800000; background-color: #ffffff; }
.sf12b5 {color: #800000; background-color: #000000; }
.sf12b14 {color: #800000; background-color: #ffa0a0; }
.sf12b16 {color: #800000; background-color: #f1e2ad; }
.sf13b2 {color: #0080c0; background-color: #ffffff; }
.sf13b5 {color: #0080c0; background-color: #000000; }
.sf13b14 {color: #0080c0; background-color: #ffa0a0; }
.sf13b16 {color: #0080c0; background-color: #f1e2ad; }
.sf15b2 {color: #000000; background-color: #ffffff; }
.sf15b5 {color: #000000; background-color: #000000; }
.sf15b14 {color: #000000; background-color: #ffa0a0; }
.sf15b16 {color: #000000; background-color: #f1e2ad; }
.sf17b2 {color: #000000; background-color: #ffffff; }
.sf17b5 {color: #000000; background-color: #000000; }
.sf17b14 {color: #000000; background-color: #ffa0a0; }
.sf17b16 {color: #000000; background-color: #f1e2ad; }
.sf18b2 {color: #000080; background-color: #ffffff; }
.sf18b5 {color: #000080; background-color: #000000; }
.sf18b14 {color: #000080; background-color: #ffa0a0; }
.sf18b16 {color: #000080; background-color: #f1e2ad; }
.sf19b2 {color: #0080c0; background-color: #ffffff; }
.sf19b5 {color: #0080c0; background-color: #000000; }
.sf19b14 {color: #0080c0; background-color: #ffa0a0; }
.sf19b16 {color: #0080c0; background-color: #f1e2ad; }
-->
</style>
</head>
<body>
<table cellspacing="0" cellpadding="0" style="width: 100%; margin: 0; border: none;">
<thead>
<tr>
<th class="title" style="width:1%"></th><th class="title" style="width:49.000000%">Original\Event\Form\Registration.php</th>
<th class="title" style="width:1%"></th><th class="title" style="width:49.000000%">Custom\Event\Form\Registration.php</th>
</tr>
</thead>
<tbody>
<tr valign="top">
<td class="ln">1</td><td class="sf3b2"><code><span class="sf3b2">&lt;?php</span></code></td>
<td class="ln">1</td><td class="sf3b2"><code><span class="sf3b2">&lt;?php</span></code></td>
</tr>
<tr valign="top">
<td class="ln">2</td><td class="sf3b2"><code><span class="sf9b2">/*</span></code></td>
<td class="ln">2</td><td class="sf3b2"><code><span class="sf9b2">/*</span></code></td>
</tr>
<tr valign="top">
<td class="ln">3</td><td class="sf3b2"><code><span class="sf9b2"> +--------------------------------------------------<wbr>------------------+</span></code></td>
<td class="ln">3</td><td class="sf3b2"><code><span class="sf9b2"> +--------------------------------------------------<wbr>------------------+</span></code></td>
</tr>
<tr valign="top">
<td class="ln">4</td><td class="sf3b2"><code><span class="sf9b2"> | CiviCRM version 4.2 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|</span></code></td>
<td class="ln">4</td><td class="sf3b2"><code><span class="sf9b2"> | CiviCRM version 4.2 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|</span></code></td>
</tr>
<tr valign="top">
<td class="ln">5</td><td class="sf3b2"><code><span class="sf9b2"> +--------------------------------------------------<wbr>------------------+</span></code></td>
<td class="ln">5</td><td class="sf3b2"><code><span class="sf9b2"> +--------------------------------------------------<wbr>------------------+</span></code></td>
</tr>
<tr valign="top">
<td class="ln">6</td><td class="sf3b2"><code><span class="sf9b2"> | Copyright CiviCRM LLC (c) 2004-2012 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|</span></code></td>
<td class="ln">6</td><td class="sf3b2"><code><span class="sf9b2"> | Copyright CiviCRM LLC (c) 2004-2012 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|</span></code></td>
</tr>
<tr valign="top">
<td class="ln">7</td><td class="sf3b2"><code><span class="sf9b2"> +--------------------------------------------------<wbr>------------------+</span></code></td>
<td class="ln">7</td><td class="sf3b2"><code><span class="sf9b2"> +--------------------------------------------------<wbr>------------------+</span></code></td>
</tr>
<tr valign="top">
<td class="ln">8</td><td class="sf3b2"><code><span class="sf9b2"> | This file is a part of CiviCRM. &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|</span></code></td>
<td class="ln">8</td><td class="sf3b2"><code><span class="sf9b2"> | This file is a part of CiviCRM. &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|</span></code></td>
</tr>
<tr valign="top">
<td class="ln">9</td><td class="sf3b2"><code><span class="sf9b2"> | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|</span></code></td>
<td class="ln">9</td><td class="sf3b2"><code><span class="sf9b2"> | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|</span></code></td>
</tr>
<tr valign="top">
<td class="ln">10</td><td class="sf3b2"><code><span class="sf9b2"> | CiviCRM is free software; you can copy, modify, and distribute it &nbsp;|</span></code></td>
<td class="ln">10</td><td class="sf3b2"><code><span class="sf9b2"> | CiviCRM is free software; you can copy, modify, and distribute it &nbsp;|</span></code></td>
</tr>
<tr valign="top">
<td class="ln">11</td><td class="sf3b2"><code><span class="sf9b2"> | under the terms of the GNU Affero General Public License &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |</span></code></td>
<td class="ln">11</td><td class="sf3b2"><code><span class="sf9b2"> | under the terms of the GNU Affero General Public License &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |</span></code></td>
</tr>
<tr valign="top">
<td class="ln">12</td><td class="sf3b2"><code><span class="sf9b2"> | Version 3, 19 November 2007 and the CiviCRM Licensing Exception. &nbsp; |</span></code></td>
<td class="ln">12</td><td class="sf3b2"><code><span class="sf9b2"> | Version 3, 19 November 2007 and the CiviCRM Licensing Exception. &nbsp; |</span></code></td>
</tr>
<tr valign="top">
<td class="ln">13</td><td class="sf3b2"><code><span class="sf9b2"> | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|</span></code></td>
<td class="ln">13</td><td class="sf3b2"><code><span class="sf9b2"> | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|</span></code></td>
</tr>
<tr valign="top">
<td class="ln">14</td><td class="sf3b2"><code><span class="sf9b2"> | CiviCRM is distributed in the hope that it will be useful, but &nbsp; &nbsp; |</span></code></td>
<td class="ln">14</td><td class="sf3b2"><code><span class="sf9b2"> | CiviCRM is distributed in the hope that it will be useful, but &nbsp; &nbsp; |</span></code></td>
</tr>
<tr valign="top">
<td class="ln">15</td><td class="sf3b2"><code><span class="sf9b2"> | WITHOUT ANY WARRANTY; without even the implied warranty of &nbsp; &nbsp; &nbsp; &nbsp; |</span></code></td>
<td class="ln">15</td><td class="sf3b2"><code><span class="sf9b2"> | WITHOUT ANY WARRANTY; without even the implied warranty of &nbsp; &nbsp; &nbsp; &nbsp; |</span></code></td>
</tr>
<tr valign="top">
<td class="ln">16</td><td class="sf3b2"><code><span class="sf9b2"> | MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |</span></code></td>
<td class="ln">16</td><td class="sf3b2"><code><span class="sf9b2"> | MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |</span></code></td>
</tr>
<tr valign="top">
<td class="ln">17</td><td class="sf3b2"><code><span class="sf9b2"> | See the GNU Affero General Public License for more details. &nbsp; &nbsp; &nbsp; &nbsp;|</span></code></td>
<td class="ln">17</td><td class="sf3b2"><code><span class="sf9b2"> | See the GNU Affero General Public License for more details. &nbsp; &nbsp; &nbsp; &nbsp;|</span></code></td>
</tr>
<tr valign="top">
<td class="ln">18</td><td class="sf3b2"><code><span class="sf9b2"> | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|</span></code></td>
<td class="ln">18</td><td class="sf3b2"><code><span class="sf9b2"> | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|</span></code></td>
</tr>
<tr valign="top">
<td class="ln">19</td><td class="sf3b2"><code><span class="sf9b2"> | You should have received a copy of the GNU Affero General Public &nbsp; |</span></code></td>
<td class="ln">19</td><td class="sf3b2"><code><span class="sf9b2"> | You should have received a copy of the GNU Affero General Public &nbsp; |</span></code></td>
</tr>
<tr valign="top">
<td class="ln">20</td><td class="sf3b2"><code><span class="sf9b2"> | License and the CiviCRM Licensing Exception along &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|</span></code></td>
<td class="ln">20</td><td class="sf3b2"><code><span class="sf9b2"> | License and the CiviCRM Licensing Exception along &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|</span></code></td>
</tr>
<tr valign="top">
<td class="ln">21</td><td class="sf3b2"><code><span class="sf9b2"> | with this program; if not, contact CiviCRM LLC &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |</span></code></td>
<td class="ln">21</td><td class="sf3b2"><code><span class="sf9b2"> | with this program; if not, contact CiviCRM LLC &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |</span></code></td>
</tr>
<tr valign="top">
<td class="ln">22</td><td class="sf3b2"><code><span class="sf9b2"> | at info[AT]civicrm[DOT]org. If you have questions about the &nbsp; &nbsp; &nbsp; &nbsp;|</span></code></td>
<td class="ln">22</td><td class="sf3b2"><code><span class="sf9b2"> | at info[AT]civicrm[DOT]org. If you have questions about the &nbsp; &nbsp; &nbsp; &nbsp;|</span></code></td>
</tr>
<tr valign="top">
<td class="ln">23</td><td class="sf3b2"><code><span class="sf9b2"> | GNU Affero General Public License or the licensing of CiviCRM, &nbsp; &nbsp; |</span></code></td>
<td class="ln">23</td><td class="sf3b2"><code><span class="sf9b2"> | GNU Affero General Public License or the licensing of CiviCRM, &nbsp; &nbsp; |</span></code></td>
</tr>
<tr valign="top">
<td class="ln">24</td><td class="sf3b2"><code><span class="sf9b2"> | see the CiviCRM license FAQ at http://civicrm.org/licensing &nbsp; &nbsp; &nbsp; &nbsp;|</span></code></td>
<td class="ln">24</td><td class="sf3b2"><code><span class="sf9b2"> | see the CiviCRM license FAQ at http://civicrm.org/licensing &nbsp; &nbsp; &nbsp; &nbsp;|</span></code></td>
</tr>
<tr valign="top">
<td class="ln">25</td><td class="sf3b2"><code><span class="sf9b2"> +--------------------------------------------------<wbr>------------------+</span></code></td>
<td class="ln">25</td><td class="sf3b2"><code><span class="sf9b2"> +--------------------------------------------------<wbr>------------------+</span></code></td>
</tr>
<tr valign="top">
<td class="ln">26</td><td class="sf3b2"><code><span class="sf9b2">*/</span>&nbsp;</code></td>
<td class="ln">26</td><td class="sf3b2"><code><span class="sf9b2">*/</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">27</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">27</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">28</td><td class="sf3b2"><code><span class="sf9b2">/**</span></code></td>
<td class="ln">28</td><td class="sf3b2"><code><span class="sf9b2">/**</span></code></td>
</tr>
<tr valign="top">
<td class="ln">29</td><td class="sf3b2"><code><span class="sf9b2"> *</span></code></td>
<td class="ln">29</td><td class="sf3b2"><code><span class="sf9b2"> *</span></code></td>
</tr>
<tr valign="top">
<td class="ln">30</td><td class="sf3b2"><code><span class="sf9b2"> *</span></code></td>
<td class="ln">30</td><td class="sf3b2"><code><span class="sf9b2"> *</span></code></td>
</tr>
<tr valign="top">
<td class="ln">31</td><td class="sf3b2"><code><span class="sf9b2"> * @package CRM</span></code></td>
<td class="ln">31</td><td class="sf3b2"><code><span class="sf9b2"> * @package CRM</span></code></td>
</tr>
<tr valign="top">
<td class="ln">32</td><td class="sf3b2"><code><span class="sf9b2"> * @copyright CiviCRM LLC (c) 2004-2012</span></code></td>
<td class="ln">32</td><td class="sf3b2"><code><span class="sf9b2"> * @copyright CiviCRM LLC (c) 2004-2012</span></code></td>
</tr>
<tr valign="top">
<td class="ln">33</td><td class="sf3b2"><code><span class="sf9b2"> * $Id$</span></code></td>
<td class="ln">33</td><td class="sf3b2"><code><span class="sf9b2"> * $Id$</span></code></td>
</tr>
<tr valign="top">
<td class="ln">34</td><td class="sf3b2"><code><span class="sf9b2"> *</span></code></td>
<td class="ln">34</td><td class="sf3b2"><code><span class="sf9b2"> *</span></code></td>
</tr>
<tr valign="top">
<td class="ln">35</td><td class="sf3b2"><code><span class="sf9b2"> */</span>&nbsp;</code></td>
<td class="ln">35</td><td class="sf3b2"><code><span class="sf9b2"> */</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">36</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">36</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">37</td><td class="sf3b2"><code><span class="sf9b2">/**</span></code></td>
<td class="ln">37</td><td class="sf3b2"><code><span class="sf9b2">/**</span></code></td>
</tr>
<tr valign="top">
<td class="ln">38</td><td class="sf3b2"><code><span class="sf9b2"> * This class generates form components for processing Event</span></code></td>
<td class="ln">38</td><td class="sf3b2"><code><span class="sf9b2"> * This class generates form components for processing Event</span></code></td>
</tr>
<tr valign="top">
<td class="ln">39</td><td class="sf3b2"><code><span class="sf9b2"> *</span></code></td>
<td class="ln">39</td><td class="sf3b2"><code><span class="sf9b2"> *</span></code></td>
</tr>
<tr valign="top">
<td class="ln">40</td><td class="sf3b2"><code><span class="sf9b2"> */</span>&nbsp;</code></td>
<td class="ln">40</td><td class="sf3b2"><code><span class="sf9b2"> */</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">41</td><td class="sf3b2"><code><span class="sf7b2">class</span><span class="sf3b2"> CRM_Event_Form_Registration extends CRM_Core_Form {</span></code></td>
<td class="ln">41</td><td class="sf3b2"><code><span class="sf7b2">class</span><span class="sf3b2"> CRM_Event_Form_Registration extends CRM_Core_Form {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">42</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">42</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">43</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf9b2">/**</span></code></td>
<td class="ln">43</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf9b2">/**</span></code></td>
</tr>
<tr valign="top">
<td class="ln">44</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * how many locationBlocks should we display?</span></code></td>
<td class="ln">44</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * how many locationBlocks should we display?</span></code></td>
</tr>
<tr valign="top">
<td class="ln">45</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; *</span></code></td>
<td class="ln">45</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; *</span></code></td>
</tr>
<tr valign="top">
<td class="ln">46</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @var int</span></code></td>
<td class="ln">46</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @var int</span></code></td>
</tr>
<tr valign="top">
<td class="ln">47</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @const</span></code></td>
<td class="ln">47</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @const</span></code></td>
</tr>
<tr valign="top">
<td class="ln">48</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; */</span>&nbsp;</code></td>
<td class="ln">48</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; */</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">49</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf7b2">CONST</span><span class="sf3b2"> LOCATION_BLOCKS = 1;</span></code></td>
<td class="ln">49</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf7b2">CONST</span><span class="sf3b2"> LOCATION_BLOCKS = 1;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">50</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">50</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">51</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf9b2">/**</span></code></td>
<td class="ln">51</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf9b2">/**</span></code></td>
</tr>
<tr valign="top">
<td class="ln">52</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * the id of the event we are proceessing</span></code></td>
<td class="ln">52</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * the id of the event we are proceessing</span></code></td>
</tr>
<tr valign="top">
<td class="ln">53</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; *</span></code></td>
<td class="ln">53</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; *</span></code></td>
</tr>
<tr valign="top">
<td class="ln">54</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @var int</span></code></td>
<td class="ln">54</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @var int</span></code></td>
</tr>
<tr valign="top">
<td class="ln">55</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @protected</span></code></td>
<td class="ln">55</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @protected</span></code></td>
</tr>
<tr valign="top">
<td class="ln">56</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; */</span>&nbsp;</code></td>
<td class="ln">56</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; */</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">57</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;public $</span><span class="sf18b2">_eventId;</span></code></td>
<td class="ln">57</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;public $</span><span class="sf18b2">_eventId;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">58</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">58</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">59</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf9b2">/**</span></code></td>
<td class="ln">59</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf9b2">/**</span></code></td>
</tr>
<tr valign="top">
<td class="ln">60</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * the array of ids of all the participant we are proceessing</span></code></td>
<td class="ln">60</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * the array of ids of all the participant we are proceessing</span></code></td>
</tr>
<tr valign="top">
<td class="ln">61</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; *</span></code></td>
<td class="ln">61</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; *</span></code></td>
</tr>
<tr valign="top">
<td class="ln">62</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @var int</span></code></td>
<td class="ln">62</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @var int</span></code></td>
</tr>
<tr valign="top">
<td class="ln">63</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @protected</span></code></td>
<td class="ln">63</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @protected</span></code></td>
</tr>
<tr valign="top">
<td class="ln">64</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; */</span>&nbsp;</code></td>
<td class="ln">64</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; */</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">65</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;protected $</span><span class="sf18b2">_participantIDS = NULL;</span></code></td>
<td class="ln">65</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;protected $</span><span class="sf18b2">_participantIDS = NULL;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">66</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">66</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">67</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf9b2">/**</span></code></td>
<td class="ln">67</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf9b2">/**</span></code></td>
</tr>
<tr valign="top">
<td class="ln">68</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * the id of the participant we are proceessing</span></code></td>
<td class="ln">68</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * the id of the participant we are proceessing</span></code></td>
</tr>
<tr valign="top">
<td class="ln">69</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; *</span></code></td>
<td class="ln">69</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; *</span></code></td>
</tr>
<tr valign="top">
<td class="ln">70</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @var int</span></code></td>
<td class="ln">70</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @var int</span></code></td>
</tr>
<tr valign="top">
<td class="ln">71</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @protected</span></code></td>
<td class="ln">71</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @protected</span></code></td>
</tr>
<tr valign="top">
<td class="ln">72</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; */</span>&nbsp;</code></td>
<td class="ln">72</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; */</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">73</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;protected $</span><span class="sf18b2">_participantId;</span></code></td>
<td class="ln">73</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;protected $</span><span class="sf18b2">_participantId;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">74</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">74</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">75</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf9b2">/**</span></code></td>
<td class="ln">75</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf9b2">/**</span></code></td>
</tr>
<tr valign="top">
<td class="ln">76</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * is participant able to walk registration wizard.</span></code></td>
<td class="ln">76</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * is participant able to walk registration wizard.</span></code></td>
</tr>
<tr valign="top">
<td class="ln">77</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; *</span></code></td>
<td class="ln">77</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; *</span></code></td>
</tr>
<tr valign="top">
<td class="ln">78</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @var Boolean</span></code></td>
<td class="ln">78</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @var Boolean</span></code></td>
</tr>
<tr valign="top">
<td class="ln">79</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @protected</span></code></td>
<td class="ln">79</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @protected</span></code></td>
</tr>
<tr valign="top">
<td class="ln">80</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; */</span>&nbsp;</code></td>
<td class="ln">80</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; */</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">81</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;public $</span><span class="sf18b2">_allowConfirmation;</span></code></td>
<td class="ln">81</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;public $</span><span class="sf18b2">_allowConfirmation;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">82</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">82</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">83</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf9b2">/**</span></code></td>
<td class="ln">83</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf9b2">/**</span></code></td>
</tr>
<tr valign="top">
<td class="ln">84</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * is participant requires approval</span></code></td>
<td class="ln">84</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * is participant requires approval</span></code></td>
</tr>
<tr valign="top">
<td class="ln">85</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; *</span></code></td>
<td class="ln">85</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; *</span></code></td>
</tr>
<tr valign="top">
<td class="ln">86</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @var Boolean</span></code></td>
<td class="ln">86</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @var Boolean</span></code></td>
</tr>
<tr valign="top">
<td class="ln">87</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @public</span></code></td>
<td class="ln">87</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @public</span></code></td>
</tr>
<tr valign="top">
<td class="ln">88</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; */</span>&nbsp;</code></td>
<td class="ln">88</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; */</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">89</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;public $</span><span class="sf18b2">_requireApproval;</span></code></td>
<td class="ln">89</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;public $</span><span class="sf18b2">_requireApproval;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">90</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">90</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">91</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf9b2">/**</span></code></td>
<td class="ln">91</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf9b2">/**</span></code></td>
</tr>
<tr valign="top">
<td class="ln">92</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * is event configured for waitlist.</span></code></td>
<td class="ln">92</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * is event configured for waitlist.</span></code></td>
</tr>
<tr valign="top">
<td class="ln">93</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; *</span></code></td>
<td class="ln">93</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; *</span></code></td>
</tr>
<tr valign="top">
<td class="ln">94</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @var Boolean</span></code></td>
<td class="ln">94</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @var Boolean</span></code></td>
</tr>
<tr valign="top">
<td class="ln">95</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @public</span></code></td>
<td class="ln">95</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @public</span></code></td>
</tr>
<tr valign="top">
<td class="ln">96</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; */</span>&nbsp;</code></td>
<td class="ln">96</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; */</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">97</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;public $</span><span class="sf18b2">_allowWaitlist;</span></code></td>
<td class="ln">97</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;public $</span><span class="sf18b2">_allowWaitlist;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">98</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">98</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">99</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf9b2">/**</span></code></td>
<td class="ln">99</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf9b2">/**</span></code></td>
</tr>
<tr valign="top">
<td class="ln">100</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * store additional participant ids</span></code></td>
<td class="ln">100</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * store additional participant ids</span></code></td>
</tr>
<tr valign="top">
<td class="ln">101</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * when there are pre-registered.</span></code></td>
<td class="ln">101</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * when there are pre-registered.</span></code></td>
</tr>
<tr valign="top">
<td class="ln">102</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; *</span></code></td>
<td class="ln">102</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; *</span></code></td>
</tr>
<tr valign="top">
<td class="ln">103</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @var array</span></code></td>
<td class="ln">103</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @var array</span></code></td>
</tr>
<tr valign="top">
<td class="ln">104</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @public</span></code></td>
<td class="ln">104</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @public</span></code></td>
</tr>
<tr valign="top">
<td class="ln">105</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; */</span>&nbsp;</code></td>
<td class="ln">105</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; */</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">106</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;public $</span><span class="sf18b2">_additionalParticipantIds;</span></code></td>
<td class="ln">106</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;public $</span><span class="sf18b2">_additionalParticipantIds;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">107</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">107</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">108</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf9b2">/**</span></code></td>
<td class="ln">108</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf9b2">/**</span></code></td>
</tr>
<tr valign="top">
<td class="ln">109</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * the mode that we are in</span></code></td>
<td class="ln">109</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * the mode that we are in</span></code></td>
</tr>
<tr valign="top">
<td class="ln">110</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; *</span></code></td>
<td class="ln">110</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; *</span></code></td>
</tr>
<tr valign="top">
<td class="ln">111</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @var string</span></code></td>
<td class="ln">111</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @var string</span></code></td>
</tr>
<tr valign="top">
<td class="ln">112</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @protect</span></code></td>
<td class="ln">112</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @protect</span></code></td>
</tr>
<tr valign="top">
<td class="ln">113</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; */</span>&nbsp;</code></td>
<td class="ln">113</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; */</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">114</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;public $</span><span class="sf18b2">_mode;</span></code></td>
<td class="ln">114</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;public $</span><span class="sf18b2">_mode;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">115</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">115</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">116</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf9b2">/**</span></code></td>
<td class="ln">116</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf9b2">/**</span></code></td>
</tr>
<tr valign="top">
<td class="ln">117</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * the values for the contribution db object</span></code></td>
<td class="ln">117</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * the values for the contribution db object</span></code></td>
</tr>
<tr valign="top">
<td class="ln">118</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; *</span></code></td>
<td class="ln">118</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; *</span></code></td>
</tr>
<tr valign="top">
<td class="ln">119</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @var array</span></code></td>
<td class="ln">119</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @var array</span></code></td>
</tr>
<tr valign="top">
<td class="ln">120</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @protected</span></code></td>
<td class="ln">120</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @protected</span></code></td>
</tr>
<tr valign="top">
<td class="ln">121</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; */</span>&nbsp;</code></td>
<td class="ln">121</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; */</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">122</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;public $</span><span class="sf18b2">_values;</span></code></td>
<td class="ln">122</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;public $</span><span class="sf18b2">_values;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">123</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">123</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">124</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf9b2">/**</span></code></td>
<td class="ln">124</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf9b2">/**</span></code></td>
</tr>
<tr valign="top">
<td class="ln">125</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * the paymentProcessor attributes for this page</span></code></td>
<td class="ln">125</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * the paymentProcessor attributes for this page</span></code></td>
</tr>
<tr valign="top">
<td class="ln">126</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; *</span></code></td>
<td class="ln">126</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; *</span></code></td>
</tr>
<tr valign="top">
<td class="ln">127</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @var array</span></code></td>
<td class="ln">127</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @var array</span></code></td>
</tr>
<tr valign="top">
<td class="ln">128</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @protected</span></code></td>
<td class="ln">128</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @protected</span></code></td>
</tr>
<tr valign="top">
<td class="ln">129</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; */</span>&nbsp;</code></td>
<td class="ln">129</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; */</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">130</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;public $</span><span class="sf18b2">_paymentProcessor;</span></code></td>
<td class="ln">130</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;public $</span><span class="sf18b2">_paymentProcessor;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">131</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">131</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">132</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf9b2">/**</span></code></td>
<td class="ln">132</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf9b2">/**</span></code></td>
</tr>
<tr valign="top">
<td class="ln">133</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * The params submitted by the form and computed by the app</span></code></td>
<td class="ln">133</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * The params submitted by the form and computed by the app</span></code></td>
</tr>
<tr valign="top">
<td class="ln">134</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; *</span></code></td>
<td class="ln">134</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; *</span></code></td>
</tr>
<tr valign="top">
<td class="ln">135</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @var array</span></code></td>
<td class="ln">135</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @var array</span></code></td>
</tr>
<tr valign="top">
<td class="ln">136</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @protected</span></code></td>
<td class="ln">136</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @protected</span></code></td>
</tr>
<tr valign="top">
<td class="ln">137</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; */</span>&nbsp;</code></td>
<td class="ln">137</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; */</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">138</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;protected $</span><span class="sf18b2">_params;</span></code></td>
<td class="ln">138</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;protected $</span><span class="sf18b2">_params;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">139</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">139</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">140</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf9b2">/**</span></code></td>
<td class="ln">140</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf9b2">/**</span></code></td>
</tr>
<tr valign="top">
<td class="ln">141</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * The fields involved in this contribution page</span></code></td>
<td class="ln">141</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * The fields involved in this contribution page</span></code></td>
</tr>
<tr valign="top">
<td class="ln">142</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; *</span></code></td>
<td class="ln">142</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; *</span></code></td>
</tr>
<tr valign="top">
<td class="ln">143</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @var array</span></code></td>
<td class="ln">143</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @var array</span></code></td>
</tr>
<tr valign="top">
<td class="ln">144</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @protected</span></code></td>
<td class="ln">144</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @protected</span></code></td>
</tr>
<tr valign="top">
<td class="ln">145</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; */</span>&nbsp;</code></td>
<td class="ln">145</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; */</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">146</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;public $</span><span class="sf18b2">_fields;</span></code></td>
<td class="ln">146</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;public $</span><span class="sf18b2">_fields;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">147</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">147</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">148</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf9b2">/**</span></code></td>
<td class="ln">148</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf9b2">/**</span></code></td>
</tr>
<tr valign="top">
<td class="ln">149</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * The billing location id for this contribiution page</span></code></td>
<td class="ln">149</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * The billing location id for this contribiution page</span></code></td>
</tr>
<tr valign="top">
<td class="ln">150</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; *</span></code></td>
<td class="ln">150</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; *</span></code></td>
</tr>
<tr valign="top">
<td class="ln">151</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @var int</span></code></td>
<td class="ln">151</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @var int</span></code></td>
</tr>
<tr valign="top">
<td class="ln">152</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @protected</span></code></td>
<td class="ln">152</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @protected</span></code></td>
</tr>
<tr valign="top">
<td class="ln">153</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; */</span>&nbsp;</code></td>
<td class="ln">153</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; */</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">154</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;public $</span><span class="sf18b2">_bltID;</span></code></td>
<td class="ln">154</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;public $</span><span class="sf18b2">_bltID;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">155</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">155</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">156</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf9b2">/**</span></code></td>
<td class="ln">156</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf9b2">/**</span></code></td>
</tr>
<tr valign="top">
<td class="ln">157</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * Price Set ID, if the new price set method is used</span></code></td>
<td class="ln">157</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * Price Set ID, if the new price set method is used</span></code></td>
</tr>
<tr valign="top">
<td class="ln">158</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; *</span></code></td>
<td class="ln">158</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; *</span></code></td>
</tr>
<tr valign="top">
<td class="ln">159</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @var int</span></code></td>
<td class="ln">159</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @var int</span></code></td>
</tr>
<tr valign="top">
<td class="ln">160</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @protected</span></code></td>
<td class="ln">160</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @protected</span></code></td>
</tr>
<tr valign="top">
<td class="ln">161</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; */</span>&nbsp;</code></td>
<td class="ln">161</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; */</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">162</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;public $</span><span class="sf18b2">_priceSetId = NULL;</span></code></td>
<td class="ln">162</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;public $</span><span class="sf18b2">_priceSetId = NULL;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">163</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">163</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">164</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf9b2">/**</span></code></td>
<td class="ln">164</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf9b2">/**</span></code></td>
</tr>
<tr valign="top">
<td class="ln">165</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * Array of fields for the price set</span></code></td>
<td class="ln">165</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * Array of fields for the price set</span></code></td>
</tr>
<tr valign="top">
<td class="ln">166</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; *</span></code></td>
<td class="ln">166</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; *</span></code></td>
</tr>
<tr valign="top">
<td class="ln">167</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @var array</span></code></td>
<td class="ln">167</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @var array</span></code></td>
</tr>
<tr valign="top">
<td class="ln">168</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @protected</span></code></td>
<td class="ln">168</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @protected</span></code></td>
</tr>
<tr valign="top">
<td class="ln">169</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; */</span>&nbsp;</code></td>
<td class="ln">169</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; */</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">170</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;public $</span><span class="sf18b2">_priceSet;</span></code></td>
<td class="ln">170</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;public $</span><span class="sf18b2">_priceSet;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">171</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">171</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">172</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;public $</span><span class="sf18b2">_action;</span></code></td>
<td class="ln">172</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;public $</span><span class="sf18b2">_action;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">173</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">173</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">174</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;public $</span><span class="sf18b2">_pcpId;</span></code></td>
<td class="ln">174</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;public $</span><span class="sf18b2">_pcpId;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">175</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">175</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">176</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf9b2">/* Is event already full.</span></code></td>
<td class="ln">176</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf9b2">/* Is event already full.</span></code></td>
</tr>
<tr valign="top">
<td class="ln">177</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; &nbsp; *</span></code></td>
<td class="ln">177</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; &nbsp; *</span></code></td>
</tr>
<tr valign="top">
<td class="ln">178</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; &nbsp; * @var boolean</span></code></td>
<td class="ln">178</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; &nbsp; * @var boolean</span></code></td>
</tr>
<tr valign="top">
<td class="ln">179</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; &nbsp; * @protected</span></code></td>
<td class="ln">179</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; &nbsp; * @protected</span></code></td>
</tr>
<tr valign="top">
<td class="ln">180</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; &nbsp; */</span>&nbsp;</code></td>
<td class="ln">180</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; &nbsp; */</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">181</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">181</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">182</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;public $</span><span class="sf18b2">_isEventFull;</span></code></td>
<td class="ln">182</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;public $</span><span class="sf18b2">_isEventFull;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">183</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">183</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">184</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;public $</span><span class="sf18b2">_lineItem;</span></code></td>
<td class="ln">184</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;public $</span><span class="sf18b2">_lineItem;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">185</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;public $</span><span class="sf18b2">_lineItemParticipantsCount;</span></code></td>
<td class="ln">185</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;public $</span><span class="sf18b2">_lineItemParticipantsCount;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">186</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;public $</span><span class="sf18b2">_availableRegistrations;</span></code></td>
<td class="ln">186</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;public $</span><span class="sf18b2">_availableRegistrations;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">187</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">187</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">188</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;public $</span><span class="sf18b2">_forcePayement;</span></code></td>
<td class="ln">188</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;public $</span><span class="sf18b2">_forcePayement;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">189</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">189</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">190</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf9b2">/**</span></code></td>
<td class="ln">190</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf9b2">/**</span></code></td>
</tr>
<tr valign="top">
<td class="ln">191</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * Function to set variables up before form is built</span></code></td>
<td class="ln">191</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * Function to set variables up before form is built</span></code></td>
</tr>
<tr valign="top">
<td class="ln">192</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; *</span></code></td>
<td class="ln">192</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; *</span></code></td>
</tr>
<tr valign="top">
<td class="ln">193</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @return void</span></code></td>
<td class="ln">193</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @return void</span></code></td>
</tr>
<tr valign="top">
<td class="ln">194</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @access public</span></code></td>
<td class="ln">194</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @access public</span></code></td>
</tr>
<tr valign="top">
<td class="ln">195</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; */</span>&nbsp;</code></td>
<td class="ln">195</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; */</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">196</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf7b2">function</span><span class="sf3b2"> </span><span class="sf8b2">preProcess</span><span class="sf3b2">() {</span></code></td>
<td class="ln">196</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf7b2">function</span><span class="sf3b2"> </span><span class="sf8b2">preProcess</span><span class="sf3b2">() {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">197</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">_eventId = CRM_Utils_Request::retrieve</span><span class="sf3b2">(</span><span class="sf12b2">'id'</span><span class="sf3b2">, </span><span class="sf12b2">'Positive'</span><span class="sf3b2">, $</span><span class="sf18b2">this, TRUE);</span></code></td>
<td class="ln">197</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">_eventId = CRM_Utils_Request::retrieve</span><span class="sf3b2">(</span><span class="sf12b2">'id'</span><span class="sf3b2">, </span><span class="sf12b2">'Positive'</span><span class="sf3b2">, $</span><span class="sf18b2">this, TRUE);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">198</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">_action = CRM_Utils_Request::retrieve</span><span class="sf3b2">(</span><span class="sf12b2">'action'</span><span class="sf3b2">, </span><span class="sf12b2">'String'</span><span class="sf3b2">, $</span><span class="sf18b2">this, FALSE);</span></code></td>
<td class="ln">198</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">_action = CRM_Utils_Request::retrieve</span><span class="sf3b2">(</span><span class="sf12b2">'action'</span><span class="sf3b2">, </span><span class="sf12b2">'String'</span><span class="sf3b2">, $</span><span class="sf18b2">this, FALSE);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">199</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">199</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">200</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">//CRM-4320</span></code></td>
<td class="ln">200</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">//CRM-4320</span></code></td>
</tr>
<tr valign="top">
<td class="ln">201</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">_participantId = CRM_Utils_Request::retrieve</span><span class="sf3b2">(</span><span class="sf12b2">'participantId'</span><span class="sf3b2">, </span><span class="sf12b2">'Positive'</span><span class="sf3b2">, $</span><span class="sf18b2">this);</span></code></td>
<td class="ln">201</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">_participantId = CRM_Utils_Request::retrieve</span><span class="sf3b2">(</span><span class="sf12b2">'participantId'</span><span class="sf3b2">, </span><span class="sf12b2">'Positive'</span><span class="sf3b2">, $</span><span class="sf18b2">this);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">202</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">202</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">203</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// current mode</span></code></td>
<td class="ln">203</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// current mode</span></code></td>
</tr>
<tr valign="top">
<td class="ln">204</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">_mode =</span><span class="sf3b2"> ($</span><span class="sf18b2">this-&gt;_action == 1024) ? </span><span class="sf12b2">'test'</span><span class="sf3b2"> : </span><span class="sf12b2">'live'</span><span class="sf3b2">;</span></code></td>
<td class="ln">204</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">_mode =</span><span class="sf3b2"> ($</span><span class="sf18b2">this-&gt;_action == 1024) ? </span><span class="sf12b2">'test'</span><span class="sf3b2"> : </span><span class="sf12b2">'live'</span><span class="sf3b2">;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">205</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">205</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">206</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_values = $</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">get</span><span class="sf3b2">(</span><span class="sf12b2">'values'</span><span class="sf3b2">);</span></code></td>
<td class="ln">206</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_values = $</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">get</span><span class="sf3b2">(</span><span class="sf12b2">'values'</span><span class="sf3b2">);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">207</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_fields = $</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">get</span><span class="sf3b2">(</span><span class="sf12b2">'fields'</span><span class="sf3b2">);</span></code></td>
<td class="ln">207</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_fields = $</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">get</span><span class="sf3b2">(</span><span class="sf12b2">'fields'</span><span class="sf3b2">);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">208</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_bltID = $</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">get</span><span class="sf3b2">(</span><span class="sf12b2">'bltID'</span><span class="sf3b2">);</span></code></td>
<td class="ln">208</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_bltID = $</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">get</span><span class="sf3b2">(</span><span class="sf12b2">'bltID'</span><span class="sf3b2">);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">209</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_paymentProcessor = $</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">get</span><span class="sf3b2">(</span><span class="sf12b2">'paymentProcessor'</span><span class="sf3b2">);</span></code></td>
<td class="ln">209</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_paymentProcessor = $</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">get</span><span class="sf3b2">(</span><span class="sf12b2">'paymentProcessor'</span><span class="sf3b2">);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">210</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_priceSetId = $</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">get</span><span class="sf3b2">(</span><span class="sf12b2">'priceSetId'</span><span class="sf3b2">);</span></code></td>
<td class="ln">210</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_priceSetId = $</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">get</span><span class="sf3b2">(</span><span class="sf12b2">'priceSetId'</span><span class="sf3b2">);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">211</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_priceSet = $</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">get</span><span class="sf3b2">(</span><span class="sf12b2">'priceSet'</span><span class="sf3b2">);</span></code></td>
<td class="ln">211</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_priceSet = $</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">get</span><span class="sf3b2">(</span><span class="sf12b2">'priceSet'</span><span class="sf3b2">);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">212</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_lineItem = $</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">get</span><span class="sf3b2">(</span><span class="sf12b2">'lineItem'</span><span class="sf3b2">);</span></code></td>
<td class="ln">212</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_lineItem = $</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">get</span><span class="sf3b2">(</span><span class="sf12b2">'lineItem'</span><span class="sf3b2">);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">213</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_isEventFull = $</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">get</span><span class="sf3b2">(</span><span class="sf12b2">'isEventFull'</span><span class="sf3b2">);</span></code></td>
<td class="ln">213</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_isEventFull = $</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">get</span><span class="sf3b2">(</span><span class="sf12b2">'isEventFull'</span><span class="sf3b2">);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">214</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_lineItemParticipantsCount = $</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">get</span><span class="sf3b2">(</span><span class="sf12b2">'lineItemParticipants'</span><span class="sf3b2">);</span></code></td>
<td class="ln">214</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_lineItemParticipantsCount = $</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">get</span><span class="sf3b2">(</span><span class="sf12b2">'lineItemParticipants'</span><span class="sf3b2">);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">215</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!</span><span class="sf8b2">is_array</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;_lineItem)) {</span></code></td>
<td class="ln">215</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!</span><span class="sf8b2">is_array</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;_lineItem)) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">216</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">_lineItem = array</span><span class="sf3b2">();</span></code></td>
<td class="ln">216</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">_lineItem = array</span><span class="sf3b2">();</span></code></td>
</tr>
<tr valign="top">
<td class="ln">217</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">217</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">218</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!</span><span class="sf8b2">is_array</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;_lineItemParticipantsCount)) {</span></code></td>
<td class="ln">218</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!</span><span class="sf8b2">is_array</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;_lineItemParticipantsCount)) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">219</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">_lineItemParticipantsCount = array</span><span class="sf3b2">();</span></code></td>
<td class="ln">219</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">_lineItemParticipantsCount = array</span><span class="sf3b2">();</span></code></td>
</tr>
<tr valign="top">
<td class="ln">220</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">220</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">221</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_availableRegistrations = $</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">get</span><span class="sf3b2">(</span><span class="sf12b2">'availableRegistrations'</span><span class="sf3b2">);</span></code></td>
<td class="ln">221</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_availableRegistrations = $</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">get</span><span class="sf3b2">(</span><span class="sf12b2">'availableRegistrations'</span><span class="sf3b2">);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">222</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_totalParticipantCount = $</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">get</span><span class="sf3b2">(</span><span class="sf12b2">'totalParticipantcount'</span><span class="sf3b2">);</span></code></td>
<td class="ln">222</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_totalParticipantCount = $</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">get</span><span class="sf3b2">(</span><span class="sf12b2">'totalParticipantcount'</span><span class="sf3b2">);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">223</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_participantIDS = $</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">get</span><span class="sf3b2">(</span><span class="sf12b2">'participantIDs'</span><span class="sf3b2">);</span></code></td>
<td class="ln">223</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_participantIDS = $</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">get</span><span class="sf3b2">(</span><span class="sf12b2">'participantIDs'</span><span class="sf3b2">);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">224</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">224</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">225</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">//check if participant allow to walk registration wizard.</span></code></td>
<td class="ln">225</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">//check if participant allow to walk registration wizard.</span></code></td>
</tr>
<tr valign="top">
<td class="ln">226</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_allowConfirmation = $</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">get</span><span class="sf3b2">(</span><span class="sf12b2">'allowConfirmation'</span><span class="sf3b2">);</span></code></td>
<td class="ln">226</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_allowConfirmation = $</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">get</span><span class="sf3b2">(</span><span class="sf12b2">'allowConfirmation'</span><span class="sf3b2">);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">227</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">227</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">228</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// check for Approval</span></code></td>
<td class="ln">228</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// check for Approval</span></code></td>
</tr>
<tr valign="top">
<td class="ln">229</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_requireApproval = $</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">get</span><span class="sf3b2">(</span><span class="sf12b2">'requireApproval'</span><span class="sf3b2">);</span></code></td>
<td class="ln">229</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_requireApproval = $</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">get</span><span class="sf3b2">(</span><span class="sf12b2">'requireApproval'</span><span class="sf3b2">);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">230</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">230</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">231</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// check for waitlisting.</span></code></td>
<td class="ln">231</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// check for waitlisting.</span></code></td>
</tr>
<tr valign="top">
<td class="ln">232</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_allowWaitlist = $</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">get</span><span class="sf3b2">(</span><span class="sf12b2">'allowWaitlist'</span><span class="sf3b2">);</span></code></td>
<td class="ln">232</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_allowWaitlist = $</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">get</span><span class="sf3b2">(</span><span class="sf12b2">'allowWaitlist'</span><span class="sf3b2">);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">233</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">233</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">234</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_forcePayement = $</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">get</span><span class="sf3b2">(</span><span class="sf12b2">'forcePayement'</span><span class="sf3b2">);</span></code></td>
<td class="ln">234</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_forcePayement = $</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">get</span><span class="sf3b2">(</span><span class="sf12b2">'forcePayement'</span><span class="sf3b2">);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">235</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">235</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">236</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">//get the additional participant ids.</span></code></td>
<td class="ln">236</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">//get the additional participant ids.</span></code></td>
</tr>
<tr valign="top">
<td class="ln">237</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_additionalParticipantIds = $</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">get</span><span class="sf3b2">(</span><span class="sf12b2">'additionalParticipantIds'</span><span class="sf3b2">);</span></code></td>
<td class="ln">237</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_additionalParticipantIds = $</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">get</span><span class="sf3b2">(</span><span class="sf12b2">'additionalParticipantIds'</span><span class="sf3b2">);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">238</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">238</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">239</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">config = </span><span class="sf8b2">CRM_Core_Config::singleton</span><span class="sf3b2">();</span></code></td>
<td class="ln">239</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">config = </span><span class="sf8b2">CRM_Core_Config::singleton</span><span class="sf3b2">();</span></code></td>
</tr>
<tr valign="top">
<td class="ln">240</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">240</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">241</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!$</span><span class="sf18b2">this-&gt;_values) {</span></code></td>
<td class="ln">241</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!$</span><span class="sf18b2">this-&gt;_values) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">242</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">// create redirect URL to send folks back to event info page is registration not available</span></code></td>
<td class="ln">242</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">// create redirect URL to send folks back to event info page is registration not available</span></code></td>
</tr>
<tr valign="top">
<td class="ln">243</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">infoUrl = </span><span class="sf8b2">CRM_Utils_System::url</span><span class="sf3b2">(</span><span class="sf12b2">'civicrm/event/info'</span><span class="sf3b2">, </span><span class="sf12b2">"reset=1&amp;id={$this-&gt;_eventId}"</span><span class="sf3b2">,</span></code></td>
<td class="ln">243</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">infoUrl = </span><span class="sf8b2">CRM_Utils_System::url</span><span class="sf3b2">(</span><span class="sf12b2">'civicrm/event/info'</span><span class="sf3b2">, </span><span class="sf12b2">"reset=1&amp;id={$this-&gt;_eventId}"</span><span class="sf3b2">,</span></code></td>
</tr>
<tr valign="top">
<td class="ln">244</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;FALSE, NULL, FALSE, TRUE</span></code></td>
<td class="ln">244</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;FALSE, NULL, FALSE, TRUE</span></code></td>
</tr>
<tr valign="top">
<td class="ln">245</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;);</span></code></td>
<td class="ln">245</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">246</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">246</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">247</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">// this is the first time we are hitting this, so check for permissions here</span></code></td>
<td class="ln">247</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">// this is the first time we are hitting this, so check for permissions here</span></code></td>
</tr>
<tr valign="top">
<td class="ln">248</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!</span><span class="sf8b2">CRM_Core_Permission::event</span><span class="sf3b2">(CRM_Core_Permission::E<wbr>DIT,</span></code></td>
<td class="ln">248</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!</span><span class="sf8b2">CRM_Core_Permission::event</span><span class="sf3b2">(CRM_Core_Permission::E<wbr>DIT,</span></code></td>
</tr>
<tr valign="top">
<td class="ln">249</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_eventId</span></code></td>
<td class="ln">249</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_eventId</span></code></td>
</tr>
<tr valign="top">
<td class="ln">250</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;)) {</span></code></td>
<td class="ln">250</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;)) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">251</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">CRM_Core_Error::statusBounce</span><span class="sf3b2">(</span><span class="sf8b2">ts</span><span class="sf3b2">(</span><span class="sf12b2">'You do not have permission to register for this event'</span><span class="sf3b2">), $</span><span class="sf18b2">infoUrl);</span></code></td>
<td class="ln">251</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">CRM_Core_Error::statusBounce</span><span class="sf3b2">(</span><span class="sf8b2">ts</span><span class="sf3b2">(</span><span class="sf12b2">'You do not have permission to register for this event'</span><span class="sf3b2">), $</span><span class="sf18b2">infoUrl);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">252</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">252</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">253</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">253</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">254</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">// get all the values from the dao object</span></code></td>
<td class="ln">254</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">// get all the values from the dao object</span></code></td>
</tr>
<tr valign="top">
<td class="ln">255</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">_values = array</span><span class="sf3b2">();</span></code></td>
<td class="ln">255</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">_values = array</span><span class="sf3b2">();</span></code></td>
</tr>
<tr valign="top">
<td class="ln">256</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">_fields = array</span><span class="sf3b2">();</span></code></td>
<td class="ln">256</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">_fields = array</span><span class="sf3b2">();</span></code></td>
</tr>
<tr valign="top">
<td class="ln">257</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_forcePayement = FALSE;</span></code></td>
<td class="ln">257</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_forcePayement = FALSE;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">258</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">258</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">259</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">//retrieve event information</span></code></td>
<td class="ln">259</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">//retrieve event information</span></code></td>
</tr>
<tr valign="top">
<td class="ln">260</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">params = </span><span class="sf7b2">array</span><span class="sf3b2">(</span><span class="sf12b2">'id'</span><span class="sf3b2"> =&gt; $</span><span class="sf18b2">this-&gt;_eventId);</span></code></td>
<td class="ln">260</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">params = </span><span class="sf7b2">array</span><span class="sf3b2">(</span><span class="sf12b2">'id'</span><span class="sf3b2"> =&gt; $</span><span class="sf18b2">this-&gt;_eventId);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">261</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">CRM_Event_BAO_Event::retrieve</span><span class="sf3b2">($</span><span class="sf18b2">params, $</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">]);</span></code></td>
<td class="ln">261</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">CRM_Event_BAO_Event::retrieve</span><span class="sf3b2">($</span><span class="sf18b2">params, $</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">]);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">262</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">262</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">263</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">checkValidEvent</span><span class="sf3b2">();</span></code></td>
<td class="ln">263</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">checkValidEvent</span><span class="sf3b2">();</span></code></td>
</tr>
<tr valign="top">
<td class="ln">264</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">264</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">265</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">// get the participant values, CRM-4320</span></code></td>
<td class="ln">265</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">// get the participant values, CRM-4320</span></code></td>
</tr>
<tr valign="top">
<td class="ln">266</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_allowConfirmation = FALSE;</span></code></td>
<td class="ln">266</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_allowConfirmation = FALSE;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">267</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">this-&gt;_participantId) {</span></code></td>
<td class="ln">267</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">this-&gt;_participantId) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">268</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">processFirstParticipant</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;_participantI<wbr>d);</span></code></td>
<td class="ln">268</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">processFirstParticipant</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;_participantI<wbr>d);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">269</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">269</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">270</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">270</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">271</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">//check for additional participants.</span></code></td>
<td class="ln">271</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">//check for additional participants.</span></code></td>
</tr>
<tr valign="top">
<td class="ln">272</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">this-&gt;_allowConfirmation &amp;&amp; $</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">][</span><span class="sf12b2">'is_multiple_registrations'<wbr></span><span class="sf3b2">]) {</span></code></td>
<td class="ln">272</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">this-&gt;_allowConfirmation &amp;&amp; $</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">][</span><span class="sf12b2">'is_multiple_registrations'<wbr></span><span class="sf3b2">]) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">273</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">additionalParticipantIds = </span><span class="sf8b2">CRM_Event_BAO_Participant::getAdditionalParticipant<wbr>Ids</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;_participantId);</span></code></td>
<td class="ln">273</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">additionalParticipantIds = </span><span class="sf8b2">CRM_Event_BAO_Participant::getAdditionalParticipant<wbr>Ids</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;_participantId);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">274</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">cnt = </span><span class="sf10b2">1</span><span class="sf3b2">;</span></code></td>
<td class="ln">274</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">cnt = </span><span class="sf10b2">1</span><span class="sf3b2">;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">275</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">foreach</span><span class="sf3b2"> ($</span><span class="sf18b2">additionalParticipantIds </span><span class="sf7b2">as</span><span class="sf3b2"> $</span><span class="sf18b2">additionalParticipantId) {</span></code></td>
<td class="ln">275</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">foreach</span><span class="sf3b2"> ($</span><span class="sf18b2">additionalParticipantIds </span><span class="sf7b2">as</span><span class="sf3b2"> $</span><span class="sf18b2">additionalParticipantId) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">276</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_additionalParticipantIds[$</span><span class="sf18b2">cnt] = $</span><span class="sf18b2">additionalParticipantId;</span></code></td>
<td class="ln">276</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_additionalParticipantIds[$</span><span class="sf18b2">cnt] = $</span><span class="sf18b2">additionalParticipantId;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">277</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">cnt++;</span></code></td>
<td class="ln">277</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">cnt++;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">278</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">278</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">279</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">set</span><span class="sf3b2">(</span><span class="sf12b2">'additionalParticipantIds'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_additionalParticipantIds);</span></code></td>
<td class="ln">279</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">set</span><span class="sf3b2">(</span><span class="sf12b2">'additionalParticipantIds'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_additionalParticipantIds);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">280</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">280</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">281</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">281</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">282</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">eventFull = </span><span class="sf8b2">CRM_Event_BAO_Participant::eventFull</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;_eventI<wbr>d,</span></code></td>
<td class="ln">282</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">eventFull = </span><span class="sf8b2">CRM_Event_BAO_Participant::eventFull</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;_eventI<wbr>d,</span></code></td>
</tr>
<tr valign="top">
<td class="ln">283</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;FALSE,</span></code></td>
<td class="ln">283</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;FALSE,</span></code></td>
</tr>
<tr valign="top">
<td class="ln">284</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'has_waitlist'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">])</span></code></td>
<td class="ln">284</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'has_waitlist'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">])</span></code></td>
</tr>
<tr valign="top">
<td class="ln">285</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;);</span></code></td>
<td class="ln">285</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">286</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">286</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">287</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_allowWaitlist = FALSE;</span></code></td>
<td class="ln">287</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_allowWaitlist = FALSE;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">288</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_isEventFull = FALSE;</span></code></td>
<td class="ln">288</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_isEventFull = FALSE;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">289</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">eventFull &amp;&amp; !$</span><span class="sf18b2">this-&gt;_allowConfirmation) {</span></code></td>
<td class="ln">289</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">eventFull &amp;&amp; !$</span><span class="sf18b2">this-&gt;_allowConfirmation) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">290</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_isEventFull = TRUE;</span></code></td>
<td class="ln">290</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_isEventFull = TRUE;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">291</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">//lets redirecting to info only when to waiting list.</span></code></td>
<td class="ln">291</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">//lets redirecting to info only when to waiting list.</span></code></td>
</tr>
<tr valign="top">
<td class="ln">292</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">_allowWaitlist = CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'has_waitlist'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">]);</span></code></td>
<td class="ln">292</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">_allowWaitlist = CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'has_waitlist'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">]);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">293</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!$</span><span class="sf18b2">this-&gt;_allowWaitlist) {</span></code></td>
<td class="ln">293</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!$</span><span class="sf18b2">this-&gt;_allowWaitlist) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">294</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">CRM_Utils_System::redirect</span><span class="sf3b2">($</span><span class="sf18b2">infoUrl);</span></code></td>
<td class="ln">294</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">CRM_Utils_System::redirect</span><span class="sf3b2">($</span><span class="sf18b2">infoUrl);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">295</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">295</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">296</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">296</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">297</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">set</span><span class="sf3b2">(</span><span class="sf12b2">'isEventFull'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_isEventFull);</span></code></td>
<td class="ln">297</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">set</span><span class="sf3b2">(</span><span class="sf12b2">'isEventFull'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_isEventFull);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">298</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">set</span><span class="sf3b2">(</span><span class="sf12b2">'allowWaitlist'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_allowWaitlist);</span></code></td>
<td class="ln">298</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">set</span><span class="sf3b2">(</span><span class="sf12b2">'allowWaitlist'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_allowWaitlist);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">299</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">299</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">300</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">//check for require requires approval.</span></code></td>
<td class="ln">300</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">//check for require requires approval.</span></code></td>
</tr>
<tr valign="top">
<td class="ln">301</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_requireApproval = FALSE;</span></code></td>
<td class="ln">301</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_requireApproval = FALSE;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">302</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'requires_approval'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">]) &amp;&amp; !$</span><span class="sf18b2">this-&gt;_allowConfirmation) {</span></code></td>
<td class="ln">302</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'requires_approval'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">]) &amp;&amp; !$</span><span class="sf18b2">this-&gt;_allowConfirmation) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">303</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_requireApproval = TRUE;</span></code></td>
<td class="ln">303</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_requireApproval = TRUE;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">304</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">304</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">305</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">set</span><span class="sf3b2">(</span><span class="sf12b2">'requireApproval'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_requireApproval);</span></code></td>
<td class="ln">305</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">set</span><span class="sf3b2">(</span><span class="sf12b2">'requireApproval'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_requireApproval);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">306</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">306</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">307</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">// also get the accounting code</span></code></td>
<td class="ln">307</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">// also get the accounting code</span></code></td>
</tr>
<tr valign="top">
<td class="ln">308</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'contribution_type_id'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">])) {</span></code></td>
<td class="ln">308</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'contribution_type_id'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">])) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">309</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">][</span><span class="sf12b2">'accountingCode'</span><span class="sf3b2">] = CRM_Core_DAO::getFieldValue</span><span class="sf3b2">(</span><span class="sf12b2">'CRM_Contribute_DAO_Con<wbr>tributionType'</span><span class="sf3b2">,</span></code></td>
<td class="ln">309</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">][</span><span class="sf12b2">'accountingCode'</span><span class="sf3b2">] = CRM_Core_DAO::getFieldValue</span><span class="sf3b2">(</span><span class="sf12b2">'CRM_Contribute_DAO_Con<wbr>tributionType'</span><span class="sf3b2">,</span></code></td>
</tr>
<tr valign="top">
<td class="ln">310</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">][</span><span class="sf12b2">'contribution_type_id'</span><span class="sf3b2">],</span></code></td>
<td class="ln">310</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">][</span><span class="sf12b2">'contribution_type_id'</span><span class="sf3b2">],</span></code></td>
</tr>
<tr valign="top">
<td class="ln">311</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'accounting_code'</span>&nbsp;</code></td>
<td class="ln">311</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'accounting_code'</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">312</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;);</span></code></td>
<td class="ln">312</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">313</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">313</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">314</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">314</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">315</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf7b2">isset</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">][</span><span class="sf12b2">'default_role_id'</span><span class="sf3b2">]))<wbr> {</span></code></td>
<td class="ln">315</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf7b2">isset</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">][</span><span class="sf12b2">'default_role_id'</span><span class="sf3b2">]))<wbr> {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">316</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">participant_role = </span><span class="sf8b2">CRM_Core_OptionGroup::values</span><span class="sf3b2">(</span><span class="sf12b2">'participant_role'</span><span class="sf3b2">);</span></code></td>
<td class="ln">316</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">participant_role = </span><span class="sf8b2">CRM_Core_OptionGroup::values</span><span class="sf3b2">(</span><span class="sf12b2">'participant_role'</span><span class="sf3b2">);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">317</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">][</span><span class="sf12b2">'participant_role'</span><span class="sf3b2">] = $</span><span class="sf18b2">participant_role[</span><span class="sf12b2">"{$this-&gt;_values['event']['defaul<wbr>t_role_id']}"</span><span class="sf3b2">];</span></code></td>
<td class="ln">317</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">][</span><span class="sf12b2">'participant_role'</span><span class="sf3b2">] = $</span><span class="sf18b2">participant_role[</span><span class="sf12b2">"{$this-&gt;_values['event']['defaul<wbr>t_role_id']}"</span><span class="sf3b2">];</span></code></td>
</tr>
<tr valign="top">
<td class="ln">318</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">318</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">319</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">319</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">320</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">// check for is_monetary status</span></code></td>
<td class="ln">320</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">// check for is_monetary status</span></code></td>
</tr>
<tr valign="top">
<td class="ln">321</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">isMonetary = </span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'is_monetary'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">]);</span></code></td>
<td class="ln">321</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">isMonetary = </span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'is_monetary'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">]);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">322</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">322</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">323</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">//retrieve custom information</span></code></td>
<td class="ln">323</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">//retrieve custom information</span></code></td>
</tr>
<tr valign="top">
<td class="ln">324</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">eventID = $</span><span class="sf18b2">this-&gt;_eventId;</span></code></td>
<td class="ln">324</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">eventID = $</span><span class="sf18b2">this-&gt;_eventId;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">325</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">325</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">326</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">isPayLater = </span><span class="sf8b2">CRM_Core_DAO::getFieldValue</span><span class="sf3b2">(</span><span class="sf12b2">'CRM_Event_DAO_Event'</span><span class="sf3b2">, $</span><span class="sf18b2">eventID, </span><span class="sf12b2">'is_pay_later'</span><span class="sf3b2">);</span></code></td>
<td class="ln">326</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">isPayLater = </span><span class="sf8b2">CRM_Core_DAO::getFieldValue</span><span class="sf3b2">(</span><span class="sf12b2">'CRM_Event_DAO_Event'</span><span class="sf3b2">, $</span><span class="sf18b2">eventID, </span><span class="sf12b2">'is_pay_later'</span><span class="sf3b2">);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">327</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">//check for variour combination for paylater, payment</span></code></td>
<td class="ln">327</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">//check for variour combination for paylater, payment</span></code></td>
</tr>
<tr valign="top">
<td class="ln">328</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">//process with paid event.</span></code></td>
<td class="ln">328</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">//process with paid event.</span></code></td>
</tr>
<tr valign="top">
<td class="ln">329</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">isMonetary &amp;&amp;</span></code></td>
<td class="ln">329</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">isMonetary &amp;&amp;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">330</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;(!$</span><span class="sf18b2">isPayLater || </span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'payment_processor'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">]))</span></code></td>
<td class="ln">330</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;(!$</span><span class="sf18b2">isPayLater || </span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'payment_processor'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">]))</span></code></td>
</tr>
<tr valign="top">
<td class="ln">331</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;) {</span></code></td>
<td class="ln">331</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">332</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">ppID = </span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'payment_processor'</span><span class="sf3b2">,</span></code></td>
<td class="ln">332</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">ppID = </span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'payment_processor'</span><span class="sf3b2">,</span></code></td>
</tr>
<tr valign="top">
<td class="ln">333</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">]</span></code></td>
<td class="ln">333</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">]</span></code></td>
</tr>
<tr valign="top">
<td class="ln">334</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;);</span></code></td>
<td class="ln">334</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">335</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!$</span><span class="sf18b2">ppID) {</span></code></td>
<td class="ln">335</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!$</span><span class="sf18b2">ppID) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">336</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">CRM_Core_Error::statusBounce</span><span class="sf3b2">(</span><span class="sf8b2">ts</span><span class="sf3b2">(</span><span class="sf12b2">'A payment processor must be selected for this event registration page, or the event must be configured to give users the option to pay later (contact the site administrator for assistance).'</span><span class="sf3b2">), $</span><span class="sf18b2">infoUrl);</span></code></td>
<td class="ln">336</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">CRM_Core_Error::statusBounce</span><span class="sf3b2">(</span><span class="sf8b2">ts</span><span class="sf3b2">(</span><span class="sf12b2">'A payment processor must be selected for this event registration page, or the event must be configured to give users the option to pay later (contact the site administrator for assistance).'</span><span class="sf3b2">), $</span><span class="sf18b2">infoUrl);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">337</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">337</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">338</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">338</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">339</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">ppIds = </span><span class="sf8b2">explode</span><span class="sf3b2">(CRM_Core_DAO::VALUE_SEPARATOR, $</span><span class="sf18b2">ppID);</span></code></td>
<td class="ln">339</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">ppIds = </span><span class="sf8b2">explode</span><span class="sf3b2">(CRM_Core_DAO::VALUE_SEPARATOR, $</span><span class="sf18b2">ppID);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">340</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">_paymentProcessors = CRM_Core_BAO_PaymentProcessor::getPayments</span><span class="sf3b2">($</span><span class="sf18b2">ppIds,</span></code></td>
<td class="ln">340</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">_paymentProcessors = CRM_Core_BAO_PaymentProcessor::getPayments</span><span class="sf3b2">($</span><span class="sf18b2">ppIds,</span></code></td>
</tr>
<tr valign="top">
<td class="ln">341</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_mode</span></code></td>
<td class="ln">341</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_mode</span></code></td>
</tr>
<tr valign="top">
<td class="ln">342</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;);</span></code></td>
<td class="ln">342</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">343</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">343</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">344</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">set</span><span class="sf3b2">(</span><span class="sf12b2">'paymentProcessors'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_paymentProcessors);</span></code></td>
<td class="ln">344</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">set</span><span class="sf3b2">(</span><span class="sf12b2">'paymentProcessors'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_paymentProcessors);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">345</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">345</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">346</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">//set default payment processor</span></code></td>
<td class="ln">346</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">//set default payment processor</span></code></td>
</tr>
<tr valign="top">
<td class="ln">347</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!</span><span class="sf7b2">empty</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">_paymentProcessors) &amp;&amp; empty</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;_paymentProcessor)) {</span></code></td>
<td class="ln">347</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!</span><span class="sf7b2">empty</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">_paymentProcessors) &amp;&amp; empty</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;_paymentProcessor)) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">348</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">foreach</span><span class="sf3b2"> ($</span><span class="sf18b2">this-&gt;_paymentProcessors as $</span><span class="sf18b2">ppId =&gt; $</span><span class="sf18b2">values) {</span></code></td>
<td class="ln">348</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">foreach</span><span class="sf3b2"> ($</span><span class="sf18b2">this-&gt;_paymentProcessors as $</span><span class="sf18b2">ppId =&gt; $</span><span class="sf18b2">values) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">349</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">values[</span><span class="sf12b2">'is_default'</span><span class="sf3b2">] == </span><span class="sf10b2">1</span><span class="sf3b2"> || (</span><span class="sf8b2">count</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;_paymentProcessors) == 1)) {</span></code></td>
<td class="ln">349</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">values[</span><span class="sf12b2">'is_default'</span><span class="sf3b2">] == </span><span class="sf10b2">1</span><span class="sf3b2"> || (</span><span class="sf8b2">count</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;_paymentProcessors) == 1)) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">350</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">defaultProcessorId = $</span><span class="sf18b2">ppId;</span></code></td>
<td class="ln">350</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">defaultProcessorId = $</span><span class="sf18b2">ppId;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">351</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">break</span><span class="sf3b2">;</span></code></td>
<td class="ln">351</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">break</span><span class="sf3b2">;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">352</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">352</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">353</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">353</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">354</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">354</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">355</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">355</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">356</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf7b2">isset</span><span class="sf3b2">($</span><span class="sf18b2">defaultProcessorId)) {</span></code></td>
<td class="ln">356</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf7b2">isset</span><span class="sf3b2">($</span><span class="sf18b2">defaultProcessorId)) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">357</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">_paymentProcessor = CRM_Core_BAO_PaymentProcessor::getPayment</span><span class="sf3b2">($</span><span class="sf18b2">defaultP<wbr>rocessorId, $</span><span class="sf18b2">this-&gt;_mode);</span></code></td>
<td class="ln">357</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">_paymentProcessor = CRM_Core_BAO_PaymentProcessor::getPayment</span><span class="sf3b2">($</span><span class="sf18b2">defaultP<wbr>rocessorId, $</span><span class="sf18b2">this-&gt;_mode);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">358</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">assign_by_ref</span><span class="sf3b2">(</span><span class="sf12b2">'paymentProcessor'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_paymentProcessor);</span></code></td>
<td class="ln">358</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">assign_by_ref</span><span class="sf3b2">(</span><span class="sf12b2">'paymentProcessor'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_paymentProcessor);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">359</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">359</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">360</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">360</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">361</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">// make sure we have a valid payment class, else abort</span></code></td>
<td class="ln">361</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">// make sure we have a valid payment class, else abort</span></code></td>
</tr>
<tr valign="top">
<td class="ln">362</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">][</span><span class="sf12b2">'is_monetary'</span><span class="sf3b2">]) {</span></code></td>
<td class="ln">362</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">][</span><span class="sf12b2">'is_monetary'</span><span class="sf3b2">]) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">363</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">363</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">364</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!</span><span class="sf8b2">CRM_Utils_System::isNull</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;_paymentProcessor<wbr>s)) {</span></code></td>
<td class="ln">364</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!</span><span class="sf8b2">CRM_Utils_System::isNull</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;_paymentProcessor<wbr>s)) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">365</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">foreach</span><span class="sf3b2"> ($</span><span class="sf18b2">this-&gt;_paymentProcessors as $</span><span class="sf18b2">eachPaymentProcessor) {</span></code></td>
<td class="ln">365</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">foreach</span><span class="sf3b2"> ($</span><span class="sf18b2">this-&gt;_paymentProcessors as $</span><span class="sf18b2">eachPaymentProcessor) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">366</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">366</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">367</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">// check selected payment processor is active</span></code></td>
<td class="ln">367</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">// check selected payment processor is active</span></code></td>
</tr>
<tr valign="top">
<td class="ln">368</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!$</span><span class="sf18b2">eachPaymentProcessor) {</span></code></td>
<td class="ln">368</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!$</span><span class="sf18b2">eachPaymentProcessor) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">369</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">CRM_Core_Error::fatal</span><span class="sf3b2">(</span><span class="sf8b2">ts</span><span class="sf3b2">(</span><span class="sf12b2">'The site administrator must set a Payment Processor for this event in order to use online registration.'</span><span class="sf3b2">));</span></code></td>
<td class="ln">369</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">CRM_Core_Error::fatal</span><span class="sf3b2">(</span><span class="sf8b2">ts</span><span class="sf3b2">(</span><span class="sf12b2">'The site administrator must set a Payment Processor for this event in order to use online registration.'</span><span class="sf3b2">));</span></code></td>
</tr>
<tr valign="top">
<td class="ln">370</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">370</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">371</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">371</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">372</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">// ensure that processor has a valid config</span></code></td>
<td class="ln">372</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">// ensure that processor has a valid config</span></code></td>
</tr>
<tr valign="top">
<td class="ln">373</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">payment = </span><span class="sf8b2">CRM_Core_Payment::singleton</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;_mode, $</span><span class="sf18b2">eachPaymentProcessor, $</span><span class="sf18b2">this);</span></code></td>
<td class="ln">373</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">payment = </span><span class="sf8b2">CRM_Core_Payment::singleton</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;_mode, $</span><span class="sf18b2">eachPaymentProcessor, $</span><span class="sf18b2">this);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">374</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">error = $</span><span class="sf18b2">payment-&gt;</span><span class="sf8b2">checkConfig</span><span class="sf3b2">();</span></code></td>
<td class="ln">374</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">error = $</span><span class="sf18b2">payment-&gt;</span><span class="sf8b2">checkConfig</span><span class="sf3b2">();</span></code></td>
</tr>
<tr valign="top">
<td class="ln">375</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!</span><span class="sf7b2">empty</span><span class="sf3b2">($</span><span class="sf18b2">error)) {</span></code></td>
<td class="ln">375</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!</span><span class="sf7b2">empty</span><span class="sf3b2">($</span><span class="sf18b2">error)) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">376</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">CRM_Core_Error::fatal</span><span class="sf3b2">($</span><span class="sf18b2">error);</span></code></td>
<td class="ln">376</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">CRM_Core_Error::fatal</span><span class="sf3b2">($</span><span class="sf18b2">error);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">377</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">377</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">378</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">378</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">379</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">379</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">380</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">380</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">381</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">381</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">382</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">382</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">383</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">//init event fee.</span></code></td>
<td class="ln">383</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">//init event fee.</span></code></td>
</tr>
<tr valign="top">
<td class="ln">384</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">self::initEventFee</span><span class="sf3b2">($</span><span class="sf18b2">this, $</span><span class="sf18b2">eventID);</span></code></td>
<td class="ln">384</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">self::initEventFee</span><span class="sf3b2">($</span><span class="sf18b2">this, $</span><span class="sf18b2">eventID);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">385</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">385</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">386</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">// get the profile ids</span></code></td>
<td class="ln">386</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">// get the profile ids</span></code></td>
</tr>
<tr valign="top">
<td class="ln">387</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">ufJoinParams = </span><span class="sf7b2">array</span><span class="sf3b2">(</span></code></td>
<td class="ln">387</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">ufJoinParams = </span><span class="sf7b2">array</span><span class="sf3b2">(</span></code></td>
</tr>
<tr valign="top">
<td class="ln">388</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'entity_table'</span><span class="sf3b2"> =&gt; </span><span class="sf12b2">'civicrm_event'</span><span class="sf3b2">,</span></code></td>
<td class="ln">388</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'entity_table'</span><span class="sf3b2"> =&gt; </span><span class="sf12b2">'civicrm_event'</span><span class="sf3b2">,</span></code></td>
</tr>
<tr valign="top">
<td class="ln">389</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">// CRM-4377:Â CiviEvent for the main participant, CiviEvent_Additional for additional participants</span></code></td>
<td class="ln">389</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">// CRM-4377:Â CiviEvent for the main participant, CiviEvent_Additional for additional participants</span></code></td>
</tr>
<tr valign="top">
<td class="ln">390</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'module'</span><span class="sf3b2"> =&gt; </span><span class="sf12b2">'CiviEvent'</span><span class="sf3b2">,</span></code></td>
<td class="ln">390</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'module'</span><span class="sf3b2"> =&gt; </span><span class="sf12b2">'CiviEvent'</span><span class="sf3b2">,</span></code></td>
</tr>
<tr valign="top">
<td class="ln">391</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'entity_id'</span><span class="sf3b2"> =&gt; $</span><span class="sf18b2">this-&gt;_eventId,</span></code></td>
<td class="ln">391</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'entity_id'</span><span class="sf3b2"> =&gt; $</span><span class="sf18b2">this-&gt;_eventId,</span></code></td>
</tr>
<tr valign="top">
<td class="ln">392</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;);</span></code></td>
<td class="ln">392</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">393</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">list</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'custom_pre_id'</span><span class="sf3b2">],</span></code></td>
<td class="ln">393</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">list</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'custom_pre_id'</span><span class="sf3b2">],</span></code></td>
</tr>
<tr valign="top">
<td class="ln">394</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'custom_post_id'</span><span class="sf3b2">]</span></code></td>
<td class="ln">394</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'custom_post_id'</span><span class="sf3b2">]</span></code></td>
</tr>
<tr valign="top">
<td class="ln">395</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;) = </span><span class="sf8b2">CRM_Core_BAO_UFJoin::getUFGroupIds</span><span class="sf3b2">($</span><span class="sf18b2">ufJoinParams);</span></code></td>
<td class="ln">395</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;) = </span><span class="sf8b2">CRM_Core_BAO_UFJoin::getUFGroupIds</span><span class="sf3b2">($</span><span class="sf18b2">ufJoinParams);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">396</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">396</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">397</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">// set profiles for additional participants</span></code></td>
<td class="ln">397</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">// set profiles for additional participants</span></code></td>
</tr>
<tr valign="top">
<td class="ln">398</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">][</span><span class="sf12b2">'is_multiple_registrations<wbr>'</span><span class="sf3b2">]) {</span></code></td>
<td class="ln">398</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">][</span><span class="sf12b2">'is_multiple_registrations<wbr>'</span><span class="sf3b2">]) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">399</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">ufJoinParams = </span><span class="sf7b2">array</span><span class="sf3b2">(</span></code></td>
<td class="ln">399</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">ufJoinParams = </span><span class="sf7b2">array</span><span class="sf3b2">(</span></code></td>
</tr>
<tr valign="top">
<td class="ln">400</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'entity_table'</span><span class="sf3b2"> =&gt; </span><span class="sf12b2">'civicrm_event'</span><span class="sf3b2">,</span></code></td>
<td class="ln">400</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'entity_table'</span><span class="sf3b2"> =&gt; </span><span class="sf12b2">'civicrm_event'</span><span class="sf3b2">,</span></code></td>
</tr>
<tr valign="top">
<td class="ln">401</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">// CRM-4377:Â CiviEvent for the main participant, CiviEvent_Additional for additional participants</span></code></td>
<td class="ln">401</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">// CRM-4377:Â CiviEvent for the main participant, CiviEvent_Additional for additional participants</span></code></td>
</tr>
<tr valign="top">
<td class="ln">402</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'module'</span><span class="sf3b2"> =&gt; </span><span class="sf12b2">'CiviEvent_Additional'</span><span class="sf3b2">,</span></code></td>
<td class="ln">402</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'module'</span><span class="sf3b2"> =&gt; </span><span class="sf12b2">'CiviEvent_Additional'</span><span class="sf3b2">,</span></code></td>
</tr>
<tr valign="top">
<td class="ln">403</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'entity_id'</span><span class="sf3b2"> =&gt; $</span><span class="sf18b2">this-&gt;_eventId,</span></code></td>
<td class="ln">403</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'entity_id'</span><span class="sf3b2"> =&gt; $</span><span class="sf18b2">this-&gt;_eventId,</span></code></td>
</tr>
<tr valign="top">
<td class="ln">404</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;);</span></code></td>
<td class="ln">404</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">405</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">list</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'additional_custom_pre_id'</span><span class="sf3b2">],</span></code></td>
<td class="ln">405</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">list</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'additional_custom_pre_id'</span><span class="sf3b2">],</span></code></td>
</tr>
<tr valign="top">
<td class="ln">406</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'additional_custom_post_id'</span><span class="sf3b2">], $</span><span class="sf18b2">preActive, $postActive</span></code></td>
<td class="ln">406</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'additional_custom_post_id'</span><span class="sf3b2">], $</span><span class="sf18b2">preActive, $postActive</span></code></td>
</tr>
<tr valign="top">
<td class="ln">407</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;) = </span><span class="sf8b2">CRM_Core_BAO_UFJoin::getUFGroupIds</span><span class="sf3b2">($</span><span class="sf18b2">ufJoinParams);</span></code></td>
<td class="ln">407</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;) = </span><span class="sf8b2">CRM_Core_BAO_UFJoin::getUFGroupIds</span><span class="sf3b2">($</span><span class="sf18b2">ufJoinParams);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">408</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">408</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">409</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">// CRM-4377:Â we need to maintain backward compatibility, hence if there is profile for main contact</span></code></td>
<td class="ln">409</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">// CRM-4377:Â we need to maintain backward compatibility, hence if there is profile for main contact</span></code></td>
</tr>
<tr valign="top">
<td class="ln">410</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">// set same profile for additional contacts.</span></code></td>
<td class="ln">410</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">// set same profile for additional contacts.</span></code></td>
</tr>
<tr valign="top">
<td class="ln">411</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'custom_pre_id'</span><span class="sf3b2">] &amp;&amp; !$</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'additional_custom_pre_id'</span><span class="sf3b2">]) {</span></code></td>
<td class="ln">411</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'custom_pre_id'</span><span class="sf3b2">] &amp;&amp; !$</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'additional_custom_pre_id'</span><span class="sf3b2">]) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">412</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'additional_custom_pre_id'</span><span class="sf3b2">] = $</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'custom_pre_id'</span><span class="sf3b2">];</span></code></td>
<td class="ln">412</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'additional_custom_pre_id'</span><span class="sf3b2">] = $</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'custom_pre_id'</span><span class="sf3b2">];</span></code></td>
</tr>
<tr valign="top">
<td class="ln">413</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">413</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">414</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">414</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">415</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'custom_post_id'</span><span class="sf3b2">] &amp;&amp; !$</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'additional_custom_post_id'</span><span class="sf3b2">]) {</span></code></td>
<td class="ln">415</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'custom_post_id'</span><span class="sf3b2">] &amp;&amp; !$</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'additional_custom_post_id'</span><span class="sf3b2">]) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">416</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'additional_custom_post_id'</span><span class="sf3b2">] = $</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'custom_post_id'</span><span class="sf3b2">];</span></code></td>
<td class="ln">416</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'additional_custom_post_id'</span><span class="sf3b2">] = $</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'custom_post_id'</span><span class="sf3b2">];</span></code></td>
</tr>
<tr valign="top">
<td class="ln">417</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">417</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">418</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">418</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">419</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">// now check for no profile condition, in that case is_active = 0</span></code></td>
<td class="ln">419</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">// now check for no profile condition, in that case is_active = 0</span></code></td>
</tr>
<tr valign="top">
<td class="ln">420</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf7b2">isset</span><span class="sf3b2">($</span><span class="sf18b2">preActive) &amp;&amp; !$</span><span class="sf18b2">preActive) {</span></code></td>
<td class="ln">420</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf7b2">isset</span><span class="sf3b2">($</span><span class="sf18b2">preActive) &amp;&amp; !$</span><span class="sf18b2">preActive) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">421</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">unset</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'additional_custom_pre_id'</span><span class="sf3b2">]);</span></code></td>
<td class="ln">421</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">unset</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'additional_custom_pre_id'</span><span class="sf3b2">]);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">422</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">422</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">423</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">423</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">424</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf7b2">isset</span><span class="sf3b2">($</span><span class="sf18b2">postActive) &amp;&amp; !$</span><span class="sf18b2">postActive) {</span></code></td>
<td class="ln">424</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf7b2">isset</span><span class="sf3b2">($</span><span class="sf18b2">postActive) &amp;&amp; !$</span><span class="sf18b2">postActive) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">425</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">unset</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'additional_custom_post_id'</span><span class="sf3b2">]);<wbr></span></code></td>
<td class="ln">425</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">unset</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'additional_custom_post_id'</span><span class="sf3b2">]);<wbr></span></code></td>
</tr>
<tr valign="top">
<td class="ln">426</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">426</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">427</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">427</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">428</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">428</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">429</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">params = </span><span class="sf7b2">array</span><span class="sf3b2">(</span><span class="sf12b2">'id'</span><span class="sf3b2"> =&gt; $</span><span class="sf18b2">this-&gt;_eventId);</span></code></td>
<td class="ln">429</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">params = </span><span class="sf7b2">array</span><span class="sf3b2">(</span><span class="sf12b2">'id'</span><span class="sf3b2"> =&gt; $</span><span class="sf18b2">this-&gt;_eventId);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">430</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">430</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">431</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">// get the billing location type</span></code></td>
<td class="ln">431</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">// get the billing location type</span></code></td>
</tr>
<tr valign="top">
<td class="ln">432</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">locationTypes = </span><span class="sf8b2">CRM_Core_PseudoConstant::locationType</span><span class="sf3b2">();</span></code></td>
<td class="ln">432</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">locationTypes = </span><span class="sf8b2">CRM_Core_PseudoConstant::locationType</span><span class="sf3b2">();</span></code></td>
</tr>
<tr valign="top">
<td class="ln">433</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">433</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">434</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">// CRM-8108 remove ts from Billing as the location type can not be translated in CiviCRM!</span></code></td>
<td class="ln">434</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">// CRM-8108 remove ts from Billing as the location type can not be translated in CiviCRM!</span></code></td>
</tr>
<tr valign="top">
<td class="ln">435</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">//$this-&gt;_bltID = array_search( ts('Billing'), &nbsp;$locationTypes );</span></code></td>
<td class="ln">435</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">//$this-&gt;_bltID = array_search( ts('Billing'), &nbsp;$locationTypes );</span></code></td>
</tr>
<tr valign="top">
<td class="ln">436</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">_bltID = array_search</span><span class="sf3b2">(</span><span class="sf12b2">'Billing'</span><span class="sf3b2">, $</span><span class="sf18b2">locationTypes);</span></code></td>
<td class="ln">436</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">_bltID = array_search</span><span class="sf3b2">(</span><span class="sf12b2">'Billing'</span><span class="sf3b2">, $</span><span class="sf18b2">locationTypes);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">437</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">437</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">438</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!$</span><span class="sf18b2">this-&gt;_bltID) {</span></code></td>
<td class="ln">438</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!$</span><span class="sf18b2">this-&gt;_bltID) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">439</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">CRM_Core_Error::fatal</span><span class="sf3b2">(</span><span class="sf8b2">ts</span><span class="sf3b2">(</span><span class="sf12b2">'Please set a location type of %1'</span><span class="sf3b2">, </span><span class="sf7b2">array</span><span class="sf3b2">(</span><span class="sf10b2">1</span><span class="sf3b2"> =&gt; </span><span class="sf12b2">'Billing'</span><span class="sf3b2">)));</span></code></td>
<td class="ln">439</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">CRM_Core_Error::fatal</span><span class="sf3b2">(</span><span class="sf8b2">ts</span><span class="sf3b2">(</span><span class="sf12b2">'Please set a location type of %1'</span><span class="sf3b2">, </span><span class="sf7b2">array</span><span class="sf3b2">(</span><span class="sf10b2">1</span><span class="sf3b2"> =&gt; </span><span class="sf12b2">'Billing'</span><span class="sf3b2">)));</span></code></td>
</tr>
<tr valign="top">
<td class="ln">440</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">440</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">441</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">set</span><span class="sf3b2">(</span><span class="sf12b2">'bltID'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_bltID);</span></code></td>
<td class="ln">441</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">set</span><span class="sf3b2">(</span><span class="sf12b2">'bltID'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_bltID);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">442</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">442</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">443</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">][</span><span class="sf12b2">'is_monetary'</span><span class="sf3b2">] &amp;&amp;</span></code></td>
<td class="ln">443</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">][</span><span class="sf12b2">'is_monetary'</span><span class="sf3b2">] &amp;&amp;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">444</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;($</span><span class="sf18b2">this-&gt;_paymentProcessor[</span><span class="sf12b2">'billing_mode'</span><span class="sf3b2">] &amp; CRM_Core_Payment::BILLING_MODE_FORM)</span></code></td>
<td class="ln">444</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;($</span><span class="sf18b2">this-&gt;_paymentProcessor[</span><span class="sf12b2">'billing_mode'</span><span class="sf3b2">] &amp; CRM_Core_Payment::BILLING_MODE_FORM)</span></code></td>
</tr>
<tr valign="top">
<td class="ln">445</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;) {</span></code></td>
<td class="ln">445</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">446</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">CRM_Core_Payment_Form::setCreditCardFields</span><span class="sf3b2">($</span><span class="sf18b2">this);</span></code></td>
<td class="ln">446</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">CRM_Core_Payment_Form::setCreditCardFields</span><span class="sf3b2">($</span><span class="sf18b2">this);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">447</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">447</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">448</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">448</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">449</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">params = </span><span class="sf7b2">array</span><span class="sf3b2">(</span><span class="sf12b2">'entity_id'</span><span class="sf3b2"> =&gt; $</span><span class="sf18b2">this-&gt;_eventId, </span><span class="sf12b2">'entity_table'</span><span class="sf3b2"> =&gt; </span><span class="sf12b2">'civicrm_event'</span><span class="sf3b2">);</span></code></td>
<td class="ln">449</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">params = </span><span class="sf7b2">array</span><span class="sf3b2">(</span><span class="sf12b2">'entity_id'</span><span class="sf3b2"> =&gt; $</span><span class="sf18b2">this-&gt;_eventId, </span><span class="sf12b2">'entity_table'</span><span class="sf3b2"> =&gt; </span><span class="sf12b2">'civicrm_event'</span><span class="sf3b2">);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">450</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'location'</span><span class="sf3b2">] = CRM_Core_BAO_Location::getValues</span><span class="sf3b2">($</span><span class="sf18b2">params, TRUE);</span></code></td>
<td class="ln">450</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'location'</span><span class="sf3b2">] = CRM_Core_BAO_Location::getValues</span><span class="sf3b2">($</span><span class="sf18b2">params, TRUE);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">451</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">451</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">452</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">set</span><span class="sf3b2">(</span><span class="sf12b2">'values'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_values);</span></code></td>
<td class="ln">452</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">set</span><span class="sf3b2">(</span><span class="sf12b2">'values'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_values);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">453</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">set</span><span class="sf3b2">(</span><span class="sf12b2">'fields'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_fields);</span></code></td>
<td class="ln">453</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">set</span><span class="sf3b2">(</span><span class="sf12b2">'fields'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_fields);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">454</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">454</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">455</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">_availableRegistrations = CRM_Event_BAO_Participant::eventFull</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;_values<wbr>[</span><span class="sf12b2">'event'</span><span class="sf3b2">][</span><span class="sf12b2">'id'</span><span class="sf3b2">], TRUE, CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'has_waitlist'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">]));</span></code></td>
<td class="ln">455</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">_availableRegistrations = CRM_Event_BAO_Participant::eventFull</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;_values<wbr>[</span><span class="sf12b2">'event'</span><span class="sf3b2">][</span><span class="sf12b2">'id'</span><span class="sf3b2">], TRUE, CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'has_waitlist'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">]));</span></code></td>
</tr>
<tr valign="top">
<td class="ln">456</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">set</span><span class="sf3b2">(</span><span class="sf12b2">'availableRegistrations'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_availableRegistrations);</span></code></td>
<td class="ln">456</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">set</span><span class="sf3b2">(</span><span class="sf12b2">'availableRegistrations'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_availableRegistrations);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">457</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">457</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">458</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">458</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">459</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">assign_by_ref</span><span class="sf3b2">(</span><span class="sf12b2">'paymentProcessor'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_paymentProcessor);</span></code></td>
<td class="ln">459</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">assign_by_ref</span><span class="sf3b2">(</span><span class="sf12b2">'paymentProcessor'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_paymentProcessor);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">460</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">460</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">461</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// check if this is a paypal auto return and redirect accordingly</span></code></td>
<td class="ln">461</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// check if this is a paypal auto return and redirect accordingly</span></code></td>
</tr>
<tr valign="top">
<td class="ln">462</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">CRM_Core_Payment::paypalRedirect</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;_paymentPr<wbr>ocessor)) {</span></code></td>
<td class="ln">462</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">CRM_Core_Payment::paypalRedirect</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;_paymentPr<wbr>ocessor)) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">463</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">url = </span><span class="sf8b2">CRM_Utils_System::url</span><span class="sf3b2">(</span><span class="sf12b2">'civicrm/event/register'</span><span class="sf3b2">,</span></code></td>
<td class="ln">463</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">url = </span><span class="sf8b2">CRM_Utils_System::url</span><span class="sf3b2">(</span><span class="sf12b2">'civicrm/event/register'</span><span class="sf3b2">,</span></code></td>
</tr>
<tr valign="top">
<td class="ln">464</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">"_qf_ThankYou_display=1&amp;qfKey={$this-&gt;controller-&gt;_<wbr>key}"</span>&nbsp;</code></td>
<td class="ln">464</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">"_qf_ThankYou_display=1&amp;qfKey={$this-&gt;controller-&gt;_<wbr>key}"</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">465</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;);</span></code></td>
<td class="ln">465</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">466</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">CRM_Utils_System::redirect</span><span class="sf3b2">($</span><span class="sf18b2">url);</span></code></td>
<td class="ln">466</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">CRM_Utils_System::redirect</span><span class="sf3b2">($</span><span class="sf18b2">url);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">467</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">467</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">468</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">468</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">469</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_contributeMode = $</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">get</span><span class="sf3b2">(</span><span class="sf12b2">'contributeMode'</span><span class="sf3b2">);</span></code></td>
<td class="ln">469</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_contributeMode = $</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">get</span><span class="sf3b2">(</span><span class="sf12b2">'contributeMode'</span><span class="sf3b2">);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">470</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">assign</span><span class="sf3b2">(</span><span class="sf12b2">'contributeMode'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_contributeMode);</span></code></td>
<td class="ln">470</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">assign</span><span class="sf3b2">(</span><span class="sf12b2">'contributeMode'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_contributeMode);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">471</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">471</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">472</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// setting CMS page title</span></code></td>
<td class="ln">472</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// setting CMS page title</span></code></td>
</tr>
<tr valign="top">
<td class="ln">473</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf8b2">CRM_Utils_System::setTitle</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">][<wbr></span><span class="sf12b2">'title'</span><span class="sf3b2">]);</span></code></td>
<td class="ln">473</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf8b2">CRM_Utils_System::setTitle</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">][<wbr></span><span class="sf12b2">'title'</span><span class="sf3b2">]);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">474</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">assign</span><span class="sf3b2">(</span><span class="sf12b2">'title'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">][</span><span class="sf12b2">'title'</span><span class="sf3b2">]);</span></code></td>
<td class="ln">474</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">assign</span><span class="sf3b2">(</span><span class="sf12b2">'title'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">][</span><span class="sf12b2">'title'</span><span class="sf3b2">]);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">475</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">475</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">476</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">assign</span><span class="sf3b2">(</span><span class="sf12b2">'paidEvent'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">][</span><span class="sf12b2">'is_monetary'</span><span class="sf3b2">]);</span></code></td>
<td class="ln">476</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">assign</span><span class="sf3b2">(</span><span class="sf12b2">'paidEvent'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">][</span><span class="sf12b2">'is_monetary'</span><span class="sf3b2">]);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">477</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">477</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">478</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// we do not want to display recently viewed items on Registration pages</span></code></td>
<td class="ln">478</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// we do not want to display recently viewed items on Registration pages</span></code></td>
</tr>
<tr valign="top">
<td class="ln">479</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">assign</span><span class="sf3b2">(</span><span class="sf12b2">'displayRecent'</span><span class="sf3b2">, FALSE);</span></code></td>
<td class="ln">479</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">assign</span><span class="sf3b2">(</span><span class="sf12b2">'displayRecent'</span><span class="sf3b2">, FALSE);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">480</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// Registration page values are cleared from session, so can't use normal Printer Friendly view.</span></code></td>
<td class="ln">480</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// Registration page values are cleared from session, so can't use normal Printer Friendly view.</span></code></td>
</tr>
<tr valign="top">
<td class="ln">481</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// Use Browser Print instead.</span></code></td>
<td class="ln">481</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// Use Browser Print instead.</span></code></td>
</tr>
<tr valign="top">
<td class="ln">482</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">assign</span><span class="sf3b2">(</span><span class="sf12b2">'browserPrint'</span><span class="sf3b2">, TRUE);</span></code></td>
<td class="ln">482</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">assign</span><span class="sf3b2">(</span><span class="sf12b2">'browserPrint'</span><span class="sf3b2">, TRUE);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">483</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">483</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">484</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">isShowLocation = </span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'is_show_location'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">]);</span></code></td>
<td class="ln">484</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">isShowLocation = </span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'is_show_location'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">]);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">485</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">assign</span><span class="sf3b2">(</span><span class="sf12b2">'isShowLocation'</span><span class="sf3b2">, $</span><span class="sf18b2">isShowLocation);</span></code></td>
<td class="ln">485</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">assign</span><span class="sf3b2">(</span><span class="sf12b2">'isShowLocation'</span><span class="sf3b2">, $</span><span class="sf18b2">isShowLocation);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">486</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">486</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">487</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// Handle PCP</span></code></td>
<td class="ln">487</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// Handle PCP</span></code></td>
</tr>
<tr valign="top">
<td class="ln">488</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">pcpId = </span><span class="sf8b2">CRM_Utils_Request::retrieve</span><span class="sf3b2">(</span><span class="sf12b2">'pcpId'</span><span class="sf3b2">, </span><span class="sf12b2">'Positive'</span><span class="sf3b2">, $</span><span class="sf18b2">this);</span></code></td>
<td class="ln">488</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">pcpId = </span><span class="sf8b2">CRM_Utils_Request::retrieve</span><span class="sf3b2">(</span><span class="sf12b2">'pcpId'</span><span class="sf3b2">, </span><span class="sf12b2">'Positive'</span><span class="sf3b2">, $</span><span class="sf18b2">this);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">489</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">pcpId) {</span></code></td>
<td class="ln">489</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">pcpId) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">490</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">pcp &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; = </span><span class="sf8b2">CRM_PCP_BAO_PCP::handlePcp</span><span class="sf3b2">($</span><span class="sf18b2">pcpId, </span><span class="sf12b2">'event'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">]);</span></code></td>
<td class="ln">490</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">pcp &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; = </span><span class="sf8b2">CRM_PCP_BAO_PCP::handlePcp</span><span class="sf3b2">($</span><span class="sf18b2">pcpId, </span><span class="sf12b2">'event'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">]);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">491</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_pcpId &nbsp; &nbsp;= $</span><span class="sf18b2">pcp[</span><span class="sf12b2">'pcpId'</span><span class="sf3b2">];</span></code></td>
<td class="ln">491</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_pcpId &nbsp; &nbsp;= $</span><span class="sf18b2">pcp[</span><span class="sf12b2">'pcpId'</span><span class="sf3b2">];</span></code></td>
</tr>
<tr valign="top">
<td class="ln">492</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_pcpBlock = $</span><span class="sf18b2">pcp[</span><span class="sf12b2">'pcpBlock'</span><span class="sf3b2">];</span></code></td>
<td class="ln">492</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_pcpBlock = $</span><span class="sf18b2">pcp[</span><span class="sf12b2">'pcpBlock'</span><span class="sf3b2">];</span></code></td>
</tr>
<tr valign="top">
<td class="ln">493</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_pcpInfo &nbsp;= $</span><span class="sf18b2">pcp[</span><span class="sf12b2">'pcpInfo'</span><span class="sf3b2">];</span></code></td>
<td class="ln">493</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_pcpInfo &nbsp;= $</span><span class="sf18b2">pcp[</span><span class="sf12b2">'pcpInfo'</span><span class="sf3b2">];</span></code></td>
</tr>
<tr valign="top">
<td class="ln">494</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">494</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">495</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">495</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">496</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf7b2">isset</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">_pcpInfo) &amp;&amp; CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'intro_text'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_pcpInfo)) {</span></code></td>
<td class="ln">496</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf7b2">isset</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">_pcpInfo) &amp;&amp; CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'intro_text'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_pcpInfo)) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">497</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">][</span><span class="sf12b2">'intro_text'</span><span class="sf3b2">] = $</span><span class="sf18b2">this-&gt;_pcpInfo[</span><span class="sf12b2">'intro_text'</span><span class="sf3b2">];</span></code></td>
<td class="ln">497</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">][</span><span class="sf12b2">'intro_text'</span><span class="sf3b2">] = $</span><span class="sf18b2">this-&gt;_pcpInfo[</span><span class="sf12b2">'intro_text'</span><span class="sf3b2">];</span></code></td>
</tr>
<tr valign="top">
<td class="ln">498</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">498</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">499</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">499</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">500</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// assign all event properties so wizard templates can display event info.</span></code></td>
<td class="ln">500</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// assign all event properties so wizard templates can display event info.</span></code></td>
</tr>
<tr valign="top">
<td class="ln">501</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">assign</span><span class="sf3b2">(</span><span class="sf12b2">'event'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">]);</span></code></td>
<td class="ln">501</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">assign</span><span class="sf3b2">(</span><span class="sf12b2">'event'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">]);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">502</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">assign</span><span class="sf3b2">(</span><span class="sf12b2">'location'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'location'</span><span class="sf3b2">]);</span></code></td>
<td class="ln">502</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">assign</span><span class="sf3b2">(</span><span class="sf12b2">'location'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'location'</span><span class="sf3b2">]);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">503</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">assign</span><span class="sf3b2">(</span><span class="sf12b2">'bltID'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_bltID);</span></code></td>
<td class="ln">503</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">assign</span><span class="sf3b2">(</span><span class="sf12b2">'bltID'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_bltID);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">504</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">isShowLocation = </span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'is_show_location'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">]);</span></code></td>
<td class="ln">504</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">isShowLocation = </span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'is_show_location'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">]);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">505</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">assign</span><span class="sf3b2">(</span><span class="sf12b2">'isShowLocation'</span><span class="sf3b2">, $</span><span class="sf18b2">isShowLocation);</span></code></td>
<td class="ln">505</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">assign</span><span class="sf3b2">(</span><span class="sf12b2">'isShowLocation'</span><span class="sf3b2">, $</span><span class="sf18b2">isShowLocation);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">506</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">pcpId &amp;&amp; $</span><span class="sf18b2">pcpSupporter = </span><span class="sf8b2">CRM_PCP_BAO_PCP::displayName</span><span class="sf3b2">($</span><span class="sf18b2">pcpId)) {</span></code></td>
<td class="ln">506</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">pcpId &amp;&amp; $</span><span class="sf18b2">pcpSupporter = </span><span class="sf8b2">CRM_PCP_BAO_PCP::displayName</span><span class="sf3b2">($</span><span class="sf18b2">pcpId)) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">507</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">assign</span><span class="sf3b2">(</span><span class="sf12b2">'pcpSupporterText'</span><span class="sf3b2">, </span><span class="sf8b2">ts</span><span class="sf3b2">(</span><span class="sf12b2">'This event registration is being made thanks to effort of &lt;strong&gt;%1&lt;/strong&gt;, who supports our campaign. You can support it as well - once you complete the registration, you will be able to create your own Personal Campaign Page!'</span><span class="sf3b2">, </span><span class="sf7b2">array</span><span class="sf3b2">(</span><span class="sf10b2">1</span><span class="sf3b2"> =&gt; $</span><span class="sf18b2">pcpSupporter)));</span></code></td>
<td class="ln">507</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">assign</span><span class="sf3b2">(</span><span class="sf12b2">'pcpSupporterText'</span><span class="sf3b2">, </span><span class="sf8b2">ts</span><span class="sf3b2">(</span><span class="sf12b2">'This event registration is being made thanks to effort of &lt;strong&gt;%1&lt;/strong&gt;, who supports our campaign. You can support it as well - once you complete the registration, you will be able to create your own Personal Campaign Page!'</span><span class="sf3b2">, </span><span class="sf7b2">array</span><span class="sf3b2">(</span><span class="sf10b2">1</span><span class="sf3b2"> =&gt; $</span><span class="sf18b2">pcpSupporter)));</span></code></td>
</tr>
<tr valign="top">
<td class="ln">508</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">508</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">509</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">509</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">510</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">//CRM-6907</span></code></td>
<td class="ln">510</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">//CRM-6907</span></code></td>
</tr>
<tr valign="top">
<td class="ln">511</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">config = </span><span class="sf8b2">CRM_Core_Config::singleton</span><span class="sf3b2">();</span></code></td>
<td class="ln">511</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">config = </span><span class="sf8b2">CRM_Core_Config::singleton</span><span class="sf3b2">();</span></code></td>
</tr>
<tr valign="top">
<td class="ln">512</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">config-&gt;</span><span class="sf8b2">defaultCurrency = CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'currency'</span><span class="sf3b2">,</span></code></td>
<td class="ln">512</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">config-&gt;</span><span class="sf8b2">defaultCurrency = CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'currency'</span><span class="sf3b2">,</span></code></td>
</tr>
<tr valign="top">
<td class="ln">513</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">],</span></code></td>
<td class="ln">513</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">],</span></code></td>
</tr>
<tr valign="top">
<td class="ln">514</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">config-&gt;defaultCurrency</span></code></td>
<td class="ln">514</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">config-&gt;defaultCurrency</span></code></td>
</tr>
<tr valign="top">
<td class="ln">515</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;);</span></code></td>
<td class="ln">515</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">516</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">516</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">517</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">//lets allow user to override campaign.</span></code></td>
<td class="ln">517</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">//lets allow user to override campaign.</span></code></td>
</tr>
<tr valign="top">
<td class="ln">518</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">campID = </span><span class="sf8b2">CRM_Utils_Request::retrieve</span><span class="sf3b2">(</span><span class="sf12b2">'campID'</span><span class="sf3b2">, </span><span class="sf12b2">'Positive'</span><span class="sf3b2">, $</span><span class="sf18b2">this);</span></code></td>
<td class="ln">518</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">campID = </span><span class="sf8b2">CRM_Utils_Request::retrieve</span><span class="sf3b2">(</span><span class="sf12b2">'campID'</span><span class="sf3b2">, </span><span class="sf12b2">'Positive'</span><span class="sf3b2">, $</span><span class="sf18b2">this);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">519</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">campID &amp;&amp; </span><span class="sf8b2">CRM_Core_DAO::getFieldValue</span><span class="sf3b2">(</span><span class="sf12b2">'CRM_Campaign_DAO_Campa<wbr>ign'</span><span class="sf3b2">, $</span><span class="sf18b2">campID)) {</span></code></td>
<td class="ln">519</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">campID &amp;&amp; </span><span class="sf8b2">CRM_Core_DAO::getFieldValue</span><span class="sf3b2">(</span><span class="sf12b2">'CRM_Campaign_DAO_Campa<wbr>ign'</span><span class="sf3b2">, $</span><span class="sf18b2">campID)) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">520</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">][</span><span class="sf12b2">'campaign_id'</span><span class="sf3b2">] = $</span><span class="sf18b2">campID;</span></code></td>
<td class="ln">520</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">][</span><span class="sf12b2">'campaign_id'</span><span class="sf3b2">] = $</span><span class="sf18b2">campID;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">521</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">521</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">522</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;}</span></code></td>
<td class="ln">522</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">523</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">523</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">524</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf9b2">/**</span></code></td>
<td class="ln">524</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf9b2">/**</span></code></td>
</tr>
<tr valign="top">
<td class="ln">525</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * assign the minimal set of variables to the template</span></code></td>
<td class="ln">525</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * assign the minimal set of variables to the template</span></code></td>
</tr>
<tr valign="top">
<td class="ln">526</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; *</span></code></td>
<td class="ln">526</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; *</span></code></td>
</tr>
<tr valign="top">
<td class="ln">527</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @return void</span></code></td>
<td class="ln">527</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @return void</span></code></td>
</tr>
<tr valign="top">
<td class="ln">528</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @access public</span></code></td>
<td class="ln">528</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @access public</span></code></td>
</tr>
<tr valign="top">
<td class="ln">529</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; */</span>&nbsp;</code></td>
<td class="ln">529</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; */</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">530</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf7b2">function</span><span class="sf3b2"> </span><span class="sf8b2">assignToTemplate</span><span class="sf3b2">() {</span></code></td>
<td class="ln">530</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf7b2">function</span><span class="sf3b2"> </span><span class="sf8b2">assignToTemplate</span><span class="sf3b2">() {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">531</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">//process only primary participant params</span></code></td>
<td class="ln">531</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">//process only primary participant params</span></code></td>
</tr>
<tr valign="top">
<td class="ln">532</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_params = $</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">get</span><span class="sf3b2">(</span><span class="sf12b2">'params'</span><span class="sf3b2">);</span></code></td>
<td class="ln">532</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_params = $</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">get</span><span class="sf3b2">(</span><span class="sf12b2">'params'</span><span class="sf3b2">);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">533</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; </span><span class="sf17b16">&nbsp;</span><span style="color: #000000; background-color: #efcb05; font-weight: bold; ">if</span><span style="color: #000000; background-color: #efcb05; "> (</span><span style="color: #000000; background-color: #efcb05; font-weight: bold; ">isset</span><span style="color: #000000; background-color: #efcb05; ">($</span><span style="color: #000000; background-color: #efcb05; ">this-&gt;_params[0])) {</span></code></td>
<td class="ln">533</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; </span><span class="sf17b16">//</span><span style="color: #000000; background-color: #efcb05; "> if (isset($this-&gt;_params[0])) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">534</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp;</span><span class="sf17b16"> &nbsp; &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">$</span><span style="color: #000000; background-color: #efcb05; ">params = $</span><span style="color: #000000; background-color: #efcb05; ">this-&gt;_params[0];</span></code></td>
<td class="ln">534</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp;</span><span class="sf17b16">//</span><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp;$params = $this-&gt;_params[0];</span></code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">535</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp;</span><span class="sf17b16">// &nbsp;}
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">536</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16">//Modified by BOT - use params of the payer
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">537</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp;</span><span class="sf17b16">foreach</span><span class="sf17b16">( $</span><span class="sf17b16">this-&gt;_params as $</span><span class="sf17b16">key =&gt; $</span><span class="sf17b16">val ) {
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">538</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; </span><span class="sf17b16">if</span><span class="sf17b16">( </span><span class="sf17b16">isset</span><span class="sf17b16">($</span><span class="sf17b16">val[</span><span class="sf17b16">'is_payer'</span><span class="sf17b16">]) ) {
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">539</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp; $</span><span class="sf17b16">params = $</span><span class="sf17b16">this-&gt;_params[$</span><span class="sf17b16">key];
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">540</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; }
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">535</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">541</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">536</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">name = </span><span class="sf12b2">''</span><span class="sf3b2">;</span></code></td>
<td class="ln">542</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">name = </span><span class="sf12b2">''</span><span class="sf3b2">;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">537</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'billing_first_name'</span><span class="sf3b2">, $</span><span class="sf18b2">params)) {</span></code></td>
<td class="ln">543</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'billing_first_name'</span><span class="sf3b2">, $</span><span class="sf18b2">params)) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">538</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">name = $</span><span class="sf18b2">params[</span><span class="sf12b2">'billing_first_name'</span><span class="sf3b2">];</span></code></td>
<td class="ln">544</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">name = $</span><span class="sf18b2">params[</span><span class="sf12b2">'billing_first_name'</span><span class="sf3b2">];</span></code></td>
</tr>
<tr valign="top">
<td class="ln">539</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">545</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">540</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">546</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">541</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'billing_middle_name'</span><span class="sf3b2">, $</span><span class="sf18b2">params)) {</span></code></td>
<td class="ln">547</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'billing_middle_name'</span><span class="sf3b2">, $</span><span class="sf18b2">params)) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">542</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">name .= </span><span class="sf12b2">" {$params['billing_middle_name']}"</span><span class="sf3b2">;</span></code></td>
<td class="ln">548</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">name .= </span><span class="sf12b2">" {$params['billing_middle_name']}"</span><span class="sf3b2">;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">543</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">549</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">544</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">550</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">545</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'billing_last_name'</span><span class="sf3b2">, $</span><span class="sf18b2">params)) {</span></code></td>
<td class="ln">551</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'billing_last_name'</span><span class="sf3b2">, $</span><span class="sf18b2">params)) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">546</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">name .= </span><span class="sf12b2">" {$params['billing_last_name']}"</span><span class="sf3b2">;</span></code></td>
<td class="ln">552</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">name .= </span><span class="sf12b2">" {$params['billing_last_name']}"</span><span class="sf3b2">;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">547</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">553</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">548</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">assign</span><span class="sf3b2">(</span><span class="sf12b2">'billingName'</span><span class="sf3b2">, $</span><span class="sf18b2">name);</span></code></td>
<td class="ln">554</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">assign</span><span class="sf3b2">(</span><span class="sf12b2">'billingName'</span><span class="sf3b2">, $</span><span class="sf18b2">name);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">549</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">set</span><span class="sf3b2">(</span><span class="sf12b2">'name'</span><span class="sf3b2">, $</span><span class="sf18b2">name);</span></code></td>
<td class="ln">555</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">set</span><span class="sf3b2">(</span><span class="sf12b2">'name'</span><span class="sf3b2">, $</span><span class="sf18b2">name);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">550</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">556</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">551</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">vars = </span><span class="sf7b2">array</span><span class="sf3b2">(</span></code></td>
<td class="ln">557</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">vars = </span><span class="sf7b2">array</span><span class="sf3b2">(</span></code></td>
</tr>
<tr valign="top">
<td class="ln">552</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'amount'</span><span class="sf3b2">, </span><span class="sf12b2">'currencyID'</span><span class="sf3b2">, </span><span class="sf12b2">'credit_card_type'</span><span class="sf3b2">,</span></code></td>
<td class="ln">558</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'amount'</span><span class="sf3b2">, </span><span class="sf12b2">'currencyID'</span><span class="sf3b2">, </span><span class="sf12b2">'credit_card_type'</span><span class="sf3b2">,</span></code></td>
</tr>
<tr valign="top">
<td class="ln">553</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'trxn_id'</span><span class="sf3b2">, </span><span class="sf12b2">'amount_level'</span><span class="sf3b2">, </span><span class="sf12b2">'receive_date'</span><span class="sf3b2">,</span></code></td>
<td class="ln">559</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'trxn_id'</span><span class="sf3b2">, </span><span class="sf12b2">'amount_level'</span><span class="sf3b2">, </span><span class="sf12b2">'receive_date'</span><span class="sf3b2">,</span></code></td>
</tr>
<tr valign="top">
<td class="ln">554</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;);</span></code></td>
<td class="ln">560</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">555</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">561</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">556</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">foreach</span><span class="sf3b2"> ($</span><span class="sf18b2">vars </span><span class="sf7b2">as</span><span class="sf3b2"> $</span><span class="sf18b2">v) {</span></code></td>
<td class="ln">562</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">foreach</span><span class="sf3b2"> ($</span><span class="sf18b2">vars </span><span class="sf7b2">as</span><span class="sf3b2"> $</span><span class="sf18b2">v) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">557</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">($</span><span class="sf18b2">v, $</span><span class="sf18b2">params)) {</span></code></td>
<td class="ln">563</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">($</span><span class="sf18b2">v, $</span><span class="sf18b2">params)) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">558</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">v == </span><span class="sf12b2">'receive_date'</span><span class="sf3b2">) {</span></code></td>
<td class="ln">564</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">v == </span><span class="sf12b2">'receive_date'</span><span class="sf3b2">) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">559</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">assign</span><span class="sf3b2">($</span><span class="sf18b2">v, </span><span class="sf8b2">CRM_Utils_Date::mysqlToIso</span><span class="sf3b2">($</span><span class="sf18b2">params[$</span><span class="sf18b2">v]));</span></code></td>
<td class="ln">565</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">assign</span><span class="sf3b2">($</span><span class="sf18b2">v, </span><span class="sf8b2">CRM_Utils_Date::mysqlToIso</span><span class="sf3b2">($</span><span class="sf18b2">params[$</span><span class="sf18b2">v]));</span></code></td>
</tr>
<tr valign="top">
<td class="ln">560</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">566</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">561</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">else</span><span class="sf3b2"> {</span></code></td>
<td class="ln">567</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">else</span><span class="sf3b2"> {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">562</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">assign</span><span class="sf3b2">($</span><span class="sf18b2">v, $</span><span class="sf18b2">params[$</span><span class="sf18b2">v]);</span></code></td>
<td class="ln">568</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">assign</span><span class="sf3b2">($</span><span class="sf18b2">v, $</span><span class="sf18b2">params[$</span><span class="sf18b2">v]);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">563</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">569</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">564</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">570</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">565</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">elseif</span><span class="sf3b2"> (</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'amount'</span><span class="sf3b2">, $</span><span class="sf18b2">params) == </span><span class="sf10b2">0</span><span class="sf3b2">) {</span></code></td>
<td class="ln">571</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">elseif</span><span class="sf3b2"> (</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'amount'</span><span class="sf3b2">, $</span><span class="sf18b2">params) == </span><span class="sf10b2">0</span><span class="sf3b2">) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">566</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">assign</span><span class="sf3b2">($</span><span class="sf18b2">v, </span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">($</span><span class="sf18b2">v, $</span><span class="sf18b2">params));</span></code></td>
<td class="ln">572</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">assign</span><span class="sf3b2">($</span><span class="sf18b2">v, </span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">($</span><span class="sf18b2">v, $</span><span class="sf18b2">params));</span></code></td>
</tr>
<tr valign="top">
<td class="ln">567</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">573</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">568</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">574</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">569</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">575</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">570</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// assign the address formatted up for display</span></code></td>
<td class="ln">576</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// assign the address formatted up for display</span></code></td>
</tr>
<tr valign="top">
<td class="ln">571</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">addressParts = </span><span class="sf7b2">array</span><span class="sf3b2">(</span></code></td>
<td class="ln">577</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">addressParts = </span><span class="sf7b2">array</span><span class="sf3b2">(</span></code></td>
</tr>
<tr valign="top">
<td class="ln">572</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">"street_address-{$this-&gt;_bltID}"</span><span class="sf3b2">,</span></code></td>
<td class="ln">578</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">"street_address-{$this-&gt;_bltID}"</span><span class="sf3b2">,</span></code></td>
</tr>
<tr valign="top">
<td class="ln">573</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">"city-{$this-&gt;_bltID}"</span><span class="sf3b2">,</span></code></td>
<td class="ln">579</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">"city-{$this-&gt;_bltID}"</span><span class="sf3b2">,</span></code></td>
</tr>
<tr valign="top">
<td class="ln">574</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">"postal_code-{$this-&gt;_bltID}"</span><span class="sf3b2">,</span></code></td>
<td class="ln">580</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">"postal_code-{$this-&gt;_bltID}"</span><span class="sf3b2">,</span></code></td>
</tr>
<tr valign="top">
<td class="ln">575</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">"state_province-{$this-&gt;_bltID}"</span><span class="sf3b2">,</span></code></td>
<td class="ln">581</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">"state_province-{$this-&gt;_bltID}"</span><span class="sf3b2">,</span></code></td>
</tr>
<tr valign="top">
<td class="ln">576</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">"country-{$this-&gt;_bltID}"</span><span class="sf3b2">,</span></code></td>
<td class="ln">582</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">"country-{$this-&gt;_bltID}"</span><span class="sf3b2">,</span></code></td>
</tr>
<tr valign="top">
<td class="ln">577</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;);</span></code></td>
<td class="ln">583</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">578</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">addressFields = </span><span class="sf7b2">array</span><span class="sf3b2">();</span></code></td>
<td class="ln">584</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">addressFields = </span><span class="sf7b2">array</span><span class="sf3b2">();</span></code></td>
</tr>
<tr valign="top">
<td class="ln">579</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">foreach</span><span class="sf3b2"> ($</span><span class="sf18b2">addressParts </span><span class="sf7b2">as</span><span class="sf3b2"> $</span><span class="sf18b2">part) {</span></code></td>
<td class="ln">585</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">foreach</span><span class="sf3b2"> ($</span><span class="sf18b2">addressParts </span><span class="sf7b2">as</span><span class="sf3b2"> $</span><span class="sf18b2">part) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">580</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">list</span><span class="sf3b2">($</span><span class="sf18b2">n, $</span><span class="sf18b2">id) = </span><span class="sf8b2">explode</span><span class="sf3b2">(</span><span class="sf12b2">'-'</span><span class="sf3b2">, $</span><span class="sf18b2">part);</span></code></td>
<td class="ln">586</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">list</span><span class="sf3b2">($</span><span class="sf18b2">n, $</span><span class="sf18b2">id) = </span><span class="sf8b2">explode</span><span class="sf3b2">(</span><span class="sf12b2">'-'</span><span class="sf3b2">, $</span><span class="sf18b2">part);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">581</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf7b2">isset</span><span class="sf3b2">($</span><span class="sf18b2">params[</span><span class="sf12b2">'billing_'</span><span class="sf3b2"> . $</span><span class="sf18b2">part])) {</span></code></td>
<td class="ln">587</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf7b2">isset</span><span class="sf3b2">($</span><span class="sf18b2">params[</span><span class="sf12b2">'billing_'</span><span class="sf3b2"> . $</span><span class="sf18b2">part])) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">582</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">addressFields[$</span><span class="sf18b2">n] = </span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'billing_'</span><span class="sf3b2"> . $</span><span class="sf18b2">part, $</span><span class="sf18b2">params);</span></code></td>
<td class="ln">588</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">addressFields[$</span><span class="sf18b2">n] = </span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'billing_'</span><span class="sf3b2"> . $</span><span class="sf18b2">part, $</span><span class="sf18b2">params);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">583</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">589</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">584</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">590</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">585</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">591</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">586</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">assign</span><span class="sf3b2">(</span><span class="sf12b2">'address'</span><span class="sf3b2">, </span><span class="sf8b2">CRM_Utils_Address::format</span><span class="sf3b2">($</span><span class="sf18b2">addressFields));</span></code></td>
<td class="ln">592</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">assign</span><span class="sf3b2">(</span><span class="sf12b2">'address'</span><span class="sf3b2">, </span><span class="sf8b2">CRM_Utils_Address::format</span><span class="sf3b2">($</span><span class="sf18b2">addressFields));</span></code></td>
</tr>
<tr valign="top">
<td class="ln">587</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">593</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">588</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">this-&gt;_contributeMode == </span><span class="sf12b2">'direct'</span><span class="sf3b2"> &amp;&amp;</span></code></td>
<td class="ln">594</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">this-&gt;_contributeMode == </span><span class="sf12b2">'direct'</span><span class="sf3b2"> &amp;&amp;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">589</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;!</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'is_pay_later'</span><span class="sf3b2">, $</span><span class="sf18b2">params)</span></code></td>
<td class="ln">595</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;!</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'is_pay_later'</span><span class="sf3b2">, $</span><span class="sf18b2">params)</span></code></td>
</tr>
<tr valign="top">
<td class="ln">590</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;) {</span></code></td>
<td class="ln">596</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">591</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">date = </span><span class="sf8b2">CRM_Utils_Date::format</span><span class="sf3b2">(</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'cred<wbr>it_card_exp_date'</span><span class="sf3b2">, $</span><span class="sf18b2">params));</span></code></td>
<td class="ln">597</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">date = </span><span class="sf8b2">CRM_Utils_Date::format</span><span class="sf3b2">(</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'cred<wbr>it_card_exp_date'</span><span class="sf3b2">, $</span><span class="sf18b2">params));</span></code></td>
</tr>
<tr valign="top">
<td class="ln">592</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">date = </span><span class="sf8b2">CRM_Utils_Date::mysqlToIso</span><span class="sf3b2">($</span><span class="sf18b2">date);</span></code></td>
<td class="ln">598</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">date = </span><span class="sf8b2">CRM_Utils_Date::mysqlToIso</span><span class="sf3b2">($</span><span class="sf18b2">date);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">593</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">assign</span><span class="sf3b2">(</span><span class="sf12b2">'credit_card_exp_date'</span><span class="sf3b2">, $</span><span class="sf18b2">date);</span></code></td>
<td class="ln">599</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">assign</span><span class="sf3b2">(</span><span class="sf12b2">'credit_card_exp_date'</span><span class="sf3b2">, $</span><span class="sf18b2">date);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">594</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">assign</span><span class="sf3b2">(</span><span class="sf12b2">'credit_card_number'</span><span class="sf3b2">,</span></code></td>
<td class="ln">600</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">assign</span><span class="sf3b2">(</span><span class="sf12b2">'credit_card_number'</span><span class="sf3b2">,</span></code></td>
</tr>
<tr valign="top">
<td class="ln">595</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">CRM_Utils_System::mungeCreditCard</span><span class="sf3b2">(</span><span class="sf8b2">CRM_Utils_Array::<wbr>value</span><span class="sf3b2">(</span><span class="sf12b2">'credit_card_number'</span><span class="sf3b2">, $</span><span class="sf18b2">params))</span></code></td>
<td class="ln">601</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">CRM_Utils_System::mungeCreditCard</span><span class="sf3b2">(</span><span class="sf8b2">CRM_Utils_Array::<wbr>value</span><span class="sf3b2">(</span><span class="sf12b2">'credit_card_number'</span><span class="sf3b2">, $</span><span class="sf18b2">params))</span></code></td>
</tr>
<tr valign="top">
<td class="ln">596</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;);</span></code></td>
<td class="ln">602</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">597</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">603</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">598</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">604</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">599</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// get the email that the confirmation would have been sent to</span></code></td>
<td class="ln">605</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// get the email that the confirmation would have been sent to</span></code></td>
</tr>
<tr valign="top">
<td class="ln">600</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">session = </span><span class="sf8b2">CRM_Core_Session::singleton</span><span class="sf3b2">();</span></code></td>
<td class="ln">606</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">session = </span><span class="sf8b2">CRM_Core_Session::singleton</span><span class="sf3b2">();</span></code></td>
</tr>
<tr valign="top">
<td class="ln">601</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">607</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">602</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// assign is_email_confirm to templates</span></code></td>
<td class="ln">608</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// assign is_email_confirm to templates</span></code></td>
</tr>
<tr valign="top">
<td class="ln">603</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf7b2">isset</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">][</span><span class="sf12b2">'is_email_confirm'</span><span class="sf3b2">])<wbr>) {</span></code></td>
<td class="ln">609</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf7b2">isset</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">][</span><span class="sf12b2">'is_email_confirm'</span><span class="sf3b2">])<wbr>) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">604</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">assign</span><span class="sf3b2">(</span><span class="sf12b2">'is_email_confirm'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">][</span><span class="sf12b2">'is_email_confirm'</span><span class="sf3b2">]);</span></code></td>
<td class="ln">610</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">assign</span><span class="sf3b2">(</span><span class="sf12b2">'is_email_confirm'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">][</span><span class="sf12b2">'is_email_confirm'</span><span class="sf3b2">]);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">605</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">611</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">606</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">612</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">607</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// assign pay later stuff</span></code></td>
<td class="ln">613</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// assign pay later stuff</span></code></td>
</tr>
<tr valign="top">
<td class="ln">608</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">params[</span><span class="sf12b2">'is_pay_later'</span><span class="sf3b2">] = </span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'is_pay_later'</span><span class="sf3b2">, $</span><span class="sf18b2">params, FALSE);</span></code></td>
<td class="ln">614</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">params[</span><span class="sf12b2">'is_pay_later'</span><span class="sf3b2">] = </span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'is_pay_later'</span><span class="sf3b2">, $</span><span class="sf18b2">params, FALSE);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">609</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">assign</span><span class="sf3b2">(</span><span class="sf12b2">'is_pay_later'</span><span class="sf3b2">, $</span><span class="sf18b2">params[</span><span class="sf12b2">'is_pay_later'</span><span class="sf3b2">]);</span></code></td>
<td class="ln">615</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">assign</span><span class="sf3b2">(</span><span class="sf12b2">'is_pay_later'</span><span class="sf3b2">, $</span><span class="sf18b2">params[</span><span class="sf12b2">'is_pay_later'</span><span class="sf3b2">]);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">610</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">params[</span><span class="sf12b2">'is_pay_later'</span><span class="sf3b2">]) {</span></code></td>
<td class="ln">616</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">params[</span><span class="sf12b2">'is_pay_later'</span><span class="sf3b2">]) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">611</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">assign</span><span class="sf3b2">(</span><span class="sf12b2">'pay_later_text'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">][</span><span class="sf12b2">'pay_later_text'</span><span class="sf3b2">]);</span></code></td>
<td class="ln">617</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">assign</span><span class="sf3b2">(</span><span class="sf12b2">'pay_later_text'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">][</span><span class="sf12b2">'pay_later_text'</span><span class="sf3b2">]);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">612</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">assign</span><span class="sf3b2">(</span><span class="sf12b2">'pay_later_receipt'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">][</span><span class="sf12b2">'pay_later_receipt'</span><span class="sf3b2">]);</span></code></td>
<td class="ln">618</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">assign</span><span class="sf3b2">(</span><span class="sf12b2">'pay_later_receipt'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">][</span><span class="sf12b2">'pay_later_receipt'</span><span class="sf3b2">]);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">613</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">619</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">614</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">620</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">615</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// also assign all participantIDs to the template</span></code></td>
<td class="ln">621</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// also assign all participantIDs to the template</span></code></td>
</tr>
<tr valign="top">
<td class="ln">616</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// useful in generating confirmation numbers if needed</span></code></td>
<td class="ln">622</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// useful in generating confirmation numbers if needed</span></code></td>
</tr>
<tr valign="top">
<td class="ln">617</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">assign</span><span class="sf3b2">(</span><span class="sf12b2">'participantIDs'</span><span class="sf3b2">,</span></code></td>
<td class="ln">623</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">assign</span><span class="sf3b2">(</span><span class="sf12b2">'participantIDs'</span><span class="sf3b2">,</span></code></td>
</tr>
<tr valign="top">
<td class="ln">618</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_participantIDS</span></code></td>
<td class="ln">624</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_participantIDS</span></code></td>
</tr>
<tr valign="top">
<td class="ln">619</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;);</span></code></td>
<td class="ln">625</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">620</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;}</span></code></td>
<td class="ln">626</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">621</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">627</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">622</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf9b2">/**</span></code></td>
<td class="ln">628</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf9b2">/**</span></code></td>
</tr>
<tr valign="top">
<td class="ln">623</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * Function to add the custom fields</span></code></td>
<td class="ln">629</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * Function to add the custom fields</span></code></td>
</tr>
<tr valign="top">
<td class="ln">624</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; *</span></code></td>
<td class="ln">630</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; *</span></code></td>
</tr>
<tr valign="top">
<td class="ln">625</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @return None</span></code></td>
<td class="ln">631</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @return None</span></code></td>
</tr>
<tr valign="top">
<td class="ln">626</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @access public</span></code></td>
<td class="ln">632</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @access public</span></code></td>
</tr>
<tr valign="top">
<td class="ln">627</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; */</span>&nbsp;</code></td>
<td class="ln">633</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; */</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">628</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf7b2">function</span><span class="sf3b2"> </span><span class="sf8b2">buildCustom</span><span class="sf3b2">($</span><span class="sf18b2">id, $</span><span class="sf18b2">name, $</span><span class="sf18b2">viewOnly = FALSE) {</span></code></td>
<td class="ln">634</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf7b2">function</span><span class="sf3b2"> </span><span class="sf8b2">buildCustom</span><span class="sf3b2">($</span><span class="sf18b2">id, $</span><span class="sf18b2">name, $</span><span class="sf18b2">viewOnly = FALSE) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">629</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">stateCountryMap = $</span><span class="sf18b2">fields = </span><span class="sf7b2">array</span><span class="sf3b2">();</span></code></td>
<td class="ln">635</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">stateCountryMap = $</span><span class="sf18b2">fields = </span><span class="sf7b2">array</span><span class="sf3b2">();</span></code></td>
</tr>
<tr valign="top">
<td class="ln">630</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">636</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">631</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">id) {</span></code></td>
<td class="ln">637</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">id) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">632</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">button &nbsp; &nbsp;= </span><span class="sf8b2">substr</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">controller-&gt;getButtonName</span><span class="sf3b2">(), -</span><span class="sf10b2">4</span><span class="sf3b2">);</span></code></td>
<td class="ln">638</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">button &nbsp; &nbsp;= </span><span class="sf8b2">substr</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">controller-&gt;getButtonName</span><span class="sf3b2">(), -</span><span class="sf10b2">4</span><span class="sf3b2">);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">633</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">cid &nbsp; &nbsp; &nbsp; = </span><span class="sf8b2">CRM_Utils_Request::retrieve</span><span class="sf3b2">(</span><span class="sf12b2">'cid'</span><span class="sf3b2">, </span><span class="sf12b2">'Positive'</span><span class="sf3b2">, $</span><span class="sf18b2">this);</span></code></td>
<td class="ln">639</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">cid &nbsp; &nbsp; &nbsp; = </span><span class="sf8b2">CRM_Utils_Request::retrieve</span><span class="sf3b2">(</span><span class="sf12b2">'cid'</span><span class="sf3b2">, </span><span class="sf12b2">'Positive'</span><span class="sf3b2">, $</span><span class="sf18b2">this);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">634</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">session &nbsp; = </span><span class="sf8b2">CRM_Core_Session::singleton</span><span class="sf3b2">();</span></code></td>
<td class="ln">640</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">session &nbsp; = </span><span class="sf8b2">CRM_Core_Session::singleton</span><span class="sf3b2">();</span></code></td>
</tr>
<tr valign="top">
<td class="ln">635</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">contactID = $</span><span class="sf18b2">session-&gt;</span><span class="sf8b2">get</span><span class="sf3b2">(</span><span class="sf12b2">'userID'</span><span class="sf3b2">);</span></code></td>
<td class="ln">641</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">contactID = $</span><span class="sf18b2">session-&gt;</span><span class="sf8b2">get</span><span class="sf3b2">(</span><span class="sf12b2">'userID'</span><span class="sf3b2">);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">636</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">642</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">637</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">// we don't allow conflicting fields to be</span></code></td>
<td class="ln">643</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">// we don't allow conflicting fields to be</span></code></td>
</tr>
<tr valign="top">
<td class="ln">638</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">// configured via profile</span></code></td>
<td class="ln">644</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">// configured via profile</span></code></td>
</tr>
<tr valign="top">
<td class="ln">639</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">fieldsToIgnore = </span><span class="sf7b2">array</span><span class="sf3b2">(</span></code></td>
<td class="ln">645</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">fieldsToIgnore = </span><span class="sf7b2">array</span><span class="sf3b2">(</span></code></td>
</tr>
<tr valign="top">
<td class="ln">640</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'participant_fee_amount'</span><span class="sf3b2"> =&gt; </span><span class="sf10b2">1</span><span class="sf3b2">,</span></code></td>
<td class="ln">646</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'participant_fee_amount'</span><span class="sf3b2"> =&gt; </span><span class="sf10b2">1</span><span class="sf3b2">,</span></code></td>
</tr>
<tr valign="top">
<td class="ln">641</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'participant_fee_level'</span><span class="sf3b2"> =&gt; </span><span class="sf10b2">1</span><span class="sf3b2">,</span></code></td>
<td class="ln">647</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'participant_fee_level'</span><span class="sf3b2"> =&gt; </span><span class="sf10b2">1</span><span class="sf3b2">,</span></code></td>
</tr>
<tr valign="top">
<td class="ln">642</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;);</span></code></td>
<td class="ln">648</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">643</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">contactID) {</span></code></td>
<td class="ln">649</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">contactID) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">644</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">//FIX CRM-9653</span></code></td>
<td class="ln">650</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">//FIX CRM-9653</span></code></td>
</tr>
<tr valign="top">
<td class="ln">645</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">is_array</span><span class="sf3b2">($</span><span class="sf18b2">id)) {</span></code></td>
<td class="ln">651</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">is_array</span><span class="sf3b2">($</span><span class="sf18b2">id)) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">646</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">fields = </span><span class="sf7b2">array</span><span class="sf3b2">();</span></code></td>
<td class="ln">652</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">fields = </span><span class="sf7b2">array</span><span class="sf3b2">();</span></code></td>
</tr>
<tr valign="top">
<td class="ln">647</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">foreach</span><span class="sf3b2"> ($</span><span class="sf18b2">id </span><span class="sf7b2">as</span><span class="sf3b2"> $</span><span class="sf18b2">profileID) {</span></code></td>
<td class="ln">653</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">foreach</span><span class="sf3b2"> ($</span><span class="sf18b2">id </span><span class="sf7b2">as</span><span class="sf3b2"> $</span><span class="sf18b2">profileID) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">648</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">field = </span><span class="sf8b2">CRM_Core_BAO_UFGroup::getFields</span><span class="sf3b2">($</span><span class="sf18b2">profileID, FALSE, CRM_Core_Action::ADD,</span></code></td>
<td class="ln">654</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">field = </span><span class="sf8b2">CRM_Core_BAO_UFGroup::getFields</span><span class="sf3b2">($</span><span class="sf18b2">profileID, FALSE, CRM_Core_Action::ADD,</span></code></td>
</tr>
<tr valign="top">
<td class="ln">649</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;NULL, NULL, FALSE, NULL,</span></code></td>
<td class="ln">655</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;NULL, NULL, FALSE, NULL,</span></code></td>
</tr>
<tr valign="top">
<td class="ln">650</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;FALSE, NULL, CRM_Core_Permission::CREATE,</span></code></td>
<td class="ln">656</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;FALSE, NULL, CRM_Core_Permission::CREATE,</span></code></td>
</tr>
<tr valign="top">
<td class="ln">651</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'field_name'</span><span class="sf3b2">, TRUE</span></code></td>
<td class="ln">657</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'field_name'</span><span class="sf3b2">, TRUE</span></code></td>
</tr>
<tr valign="top">
<td class="ln">652</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;);</span></code></td>
<td class="ln">658</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">653</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">fields = </span><span class="sf8b2">array_merge</span><span class="sf3b2">($</span><span class="sf18b2">fields, $</span><span class="sf18b2">field);</span></code></td>
<td class="ln">659</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">fields = </span><span class="sf8b2">array_merge</span><span class="sf3b2">($</span><span class="sf18b2">fields, $</span><span class="sf18b2">field);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">654</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">660</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">655</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">661</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">656</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">else</span><span class="sf3b2"> {</span></code></td>
<td class="ln">662</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">else</span><span class="sf3b2"> {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">657</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">CRM_Core_BAO_UFGroup::filterUFGroups</span><span class="sf3b2">($</span><span class="sf18b2">id, $</span><span class="sf18b2">contactID)) {</span></code></td>
<td class="ln">663</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">CRM_Core_BAO_UFGroup::filterUFGroups</span><span class="sf3b2">($</span><span class="sf18b2">id, $</span><span class="sf18b2">contactID)) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">658</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">fields = </span><span class="sf8b2">CRM_Core_BAO_UFGroup::getFields</span><span class="sf3b2">($</span><span class="sf18b2">id, FALSE, CRM_Core_Action::ADD,</span></code></td>
<td class="ln">664</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">fields = </span><span class="sf8b2">CRM_Core_BAO_UFGroup::getFields</span><span class="sf3b2">($</span><span class="sf18b2">id, FALSE, CRM_Core_Action::ADD,</span></code></td>
</tr>
<tr valign="top">
<td class="ln">659</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;NULL, NULL, FALSE, NULL,</span></code></td>
<td class="ln">665</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;NULL, NULL, FALSE, NULL,</span></code></td>
</tr>
<tr valign="top">
<td class="ln">660</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;FALSE, NULL, CRM_Core_Permission::CREATE,</span></code></td>
<td class="ln">666</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;FALSE, NULL, CRM_Core_Permission::CREATE,</span></code></td>
</tr>
<tr valign="top">
<td class="ln">661</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'field_name'</span><span class="sf3b2">, TRUE</span></code></td>
<td class="ln">667</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'field_name'</span><span class="sf3b2">, TRUE</span></code></td>
</tr>
<tr valign="top">
<td class="ln">662</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;);</span></code></td>
<td class="ln">668</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">663</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">669</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">664</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">670</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">665</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">671</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">666</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">else</span><span class="sf3b2"> {</span></code></td>
<td class="ln">672</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">else</span><span class="sf3b2"> {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">667</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">fields = </span><span class="sf8b2">CRM_Core_BAO_UFGroup::getFields</span><span class="sf3b2">($</span><span class="sf18b2">id, FALSE, CRM_Core_Action::ADD,</span></code></td>
<td class="ln">673</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">fields = </span><span class="sf8b2">CRM_Core_BAO_UFGroup::getFields</span><span class="sf3b2">($</span><span class="sf18b2">id, FALSE, CRM_Core_Action::ADD,</span></code></td>
</tr>
<tr valign="top">
<td class="ln">668</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;NULL, NULL, FALSE, NULL,</span></code></td>
<td class="ln">674</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;NULL, NULL, FALSE, NULL,</span></code></td>
</tr>
<tr valign="top">
<td class="ln">669</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;FALSE, NULL, CRM_Core_Permission::CREATE,</span></code></td>
<td class="ln">675</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;FALSE, NULL, CRM_Core_Permission::CREATE,</span></code></td>
</tr>
<tr valign="top">
<td class="ln">670</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'field_name'</span><span class="sf3b2">, TRUE</span></code></td>
<td class="ln">676</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'field_name'</span><span class="sf3b2">, TRUE</span></code></td>
</tr>
<tr valign="top">
<td class="ln">671</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;);</span></code></td>
<td class="ln">677</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">672</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">678</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">673</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">679</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">674</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">array_intersect_key</span><span class="sf3b2">($</span><span class="sf18b2">fields, $</span><span class="sf18b2">fieldsToIgnore)) {</span></code></td>
<td class="ln">680</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">array_intersect_key</span><span class="sf3b2">($</span><span class="sf18b2">fields, $</span><span class="sf18b2">fieldsToIgnore)) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">675</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">fields = </span><span class="sf8b2">array_diff_key</span><span class="sf3b2">($</span><span class="sf18b2">fields, $</span><span class="sf18b2">fieldsToIgnore);</span></code></td>
<td class="ln">681</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">fields = </span><span class="sf8b2">array_diff_key</span><span class="sf3b2">($</span><span class="sf18b2">fields, $</span><span class="sf18b2">fieldsToIgnore);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">676</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">CRM_Core_Session::setStatus</span><span class="sf3b2">(</span><span class="sf8b2">ts</span><span class="sf3b2">(</span><span class="sf12b2">'Some of the profile fields cannot be configured for this page.'</span><span class="sf3b2">));</span></code></td>
<td class="ln">682</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">CRM_Core_Session::setStatus</span><span class="sf3b2">(</span><span class="sf8b2">ts</span><span class="sf3b2">(</span><span class="sf12b2">'Some of the profile fields cannot be configured for this page.'</span><span class="sf3b2">));</span></code></td>
</tr>
<tr valign="top">
<td class="ln">677</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">683</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">678</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">addCaptcha = FALSE;</span></code></td>
<td class="ln">684</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">addCaptcha = FALSE;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">679</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">fields = </span><span class="sf8b2">array_diff_assoc</span><span class="sf3b2">($</span><span class="sf18b2">fields, $</span><span class="sf18b2">this-&gt;_fields);</span></code></td>
<td class="ln">685</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">fields = </span><span class="sf8b2">array_diff_assoc</span><span class="sf3b2">($</span><span class="sf18b2">fields, $</span><span class="sf18b2">this-&gt;_fields);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">680</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'additional_participants'</span><span class="sf3b2">,<wbr> $</span><span class="sf18b2">this-&gt;_params[0]) &amp;&amp;</span></code></td>
<td class="ln">686</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'additional_participants'</span><span class="sf3b2">,<wbr> $</span><span class="sf18b2">this-&gt;_params[0]) &amp;&amp;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">681</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">is_null</span><span class="sf3b2">($</span><span class="sf18b2">cid)</span></code></td>
<td class="ln">687</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">is_null</span><span class="sf3b2">($</span><span class="sf18b2">cid)</span></code></td>
</tr>
<tr valign="top">
<td class="ln">682</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;) {</span></code></td>
<td class="ln">688</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">683</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">CRM_Core_BAO_Address::checkContactSharedAddressFiel<wbr>ds</span><span class="sf3b2">($</span><span class="sf18b2">fields, $</span><span class="sf18b2">contactID);</span></code></td>
<td class="ln">689</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">CRM_Core_BAO_Address::checkContactSharedAddressFiel<wbr>ds</span><span class="sf3b2">($</span><span class="sf18b2">fields, $</span><span class="sf18b2">contactID);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">684</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">690</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">685</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">assign</span><span class="sf3b2">($</span><span class="sf18b2">name, $</span><span class="sf18b2">fields);</span></code></td>
<td class="ln">691</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">assign</span><span class="sf3b2">($</span><span class="sf18b2">name, $</span><span class="sf18b2">fields);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">686</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">is_array</span><span class="sf3b2">($</span><span class="sf18b2">fields)) {</span></code></td>
<td class="ln">692</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">is_array</span><span class="sf3b2">($</span><span class="sf18b2">fields)) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">687</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">foreach</span><span class="sf3b2"> ($</span><span class="sf18b2">fields </span><span class="sf7b2">as</span><span class="sf3b2"> $</span><span class="sf18b2">key =&gt; $</span><span class="sf18b2">field) {</span></code></td>
<td class="ln">693</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">foreach</span><span class="sf3b2"> ($</span><span class="sf18b2">fields </span><span class="sf7b2">as</span><span class="sf3b2"> $</span><span class="sf18b2">key =&gt; $</span><span class="sf18b2">field) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">688</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">viewOnly &amp;&amp;</span></code></td>
<td class="ln">694</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">viewOnly &amp;&amp;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">689</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">isset</span><span class="sf3b2">($</span><span class="sf18b2">field[</span><span class="sf12b2">'data_type'</span><span class="sf3b2">]) &amp;&amp;</span></code></td>
<td class="ln">695</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">isset</span><span class="sf3b2">($</span><span class="sf18b2">field[</span><span class="sf12b2">'data_type'</span><span class="sf3b2">]) &amp;&amp;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">690</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">field[</span><span class="sf12b2">'data_type'</span><span class="sf3b2">] == </span><span class="sf12b2">'File'</span><span class="sf3b2"> || ($</span><span class="sf18b2">viewOnly &amp;&amp; $</span><span class="sf18b2">field[</span><span class="sf12b2">'name'</span><span class="sf3b2">] == </span><span class="sf12b2">'image_URL'</span><span class="sf3b2">)</span></code></td>
<td class="ln">696</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">field[</span><span class="sf12b2">'data_type'</span><span class="sf3b2">] == </span><span class="sf12b2">'File'</span><span class="sf3b2"> || ($</span><span class="sf18b2">viewOnly &amp;&amp; $</span><span class="sf18b2">field[</span><span class="sf12b2">'name'</span><span class="sf3b2">] == </span><span class="sf12b2">'image_URL'</span><span class="sf3b2">)</span></code></td>
</tr>
<tr valign="top">
<td class="ln">691</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;) {</span></code></td>
<td class="ln">697</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">692</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">// ignore file upload fields</span></code></td>
<td class="ln">698</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">// ignore file upload fields</span></code></td>
</tr>
<tr valign="top">
<td class="ln">693</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">continue</span><span class="sf3b2">;</span></code></td>
<td class="ln">699</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">continue</span><span class="sf3b2">;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">694</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">700</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">695</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">//make the field optional if primary participant</span></code></td>
<td class="ln">701</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">//make the field optional if primary participant</span></code></td>
</tr>
<tr valign="top">
<td class="ln">696</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">//have been skip the additional participant.</span></code></td>
<td class="ln">702</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">//have been skip the additional participant.</span></code></td>
</tr>
<tr valign="top">
<td class="ln">697</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">button == </span><span class="sf12b2">'skip'</span><span class="sf3b2">) {</span></code></td>
<td class="ln">703</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">button == </span><span class="sf12b2">'skip'</span><span class="sf3b2">) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">698</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">field[</span><span class="sf12b2">'is_required'</span><span class="sf3b2">] = FALSE;</span></code></td>
<td class="ln">704</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">field[</span><span class="sf12b2">'is_required'</span><span class="sf3b2">] = FALSE;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">699</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">705</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">700</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">elseif</span><span class="sf3b2"> ($</span><span class="sf18b2">field[</span><span class="sf12b2">'add_captcha'</span><span class="sf3b2">]) {</span></code></td>
<td class="ln">706</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">elseif</span><span class="sf3b2"> ($</span><span class="sf18b2">field[</span><span class="sf12b2">'add_captcha'</span><span class="sf3b2">]) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">701</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">// only add captcha for first page</span></code></td>
<td class="ln">707</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">// only add captcha for first page</span></code></td>
</tr>
<tr valign="top">
<td class="ln">702</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">addCaptcha = TRUE;</span></code></td>
<td class="ln">708</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">addCaptcha = TRUE;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">703</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">709</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">704</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">710</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">705</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">list</span><span class="sf3b2">($</span><span class="sf18b2">prefixName, $</span><span class="sf18b2">index) = </span><span class="sf8b2">CRM_Utils_System::explode</span><span class="sf3b2">(</span><span class="sf12b2">'-'</span><span class="sf3b2">, $</span><span class="sf18b2">key, </span><span class="sf10b2">2</span><span class="sf3b2">);</span></code></td>
<td class="ln">711</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">list</span><span class="sf3b2">($</span><span class="sf18b2">prefixName, $</span><span class="sf18b2">index) = </span><span class="sf8b2">CRM_Utils_System::explode</span><span class="sf3b2">(</span><span class="sf12b2">'-'</span><span class="sf3b2">, $</span><span class="sf18b2">key, </span><span class="sf10b2">2</span><span class="sf3b2">);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">706</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">prefixName == </span><span class="sf12b2">'state_province'</span><span class="sf3b2"> || $</span><span class="sf18b2">prefixName == </span><span class="sf12b2">'country'</span><span class="sf3b2"> || $</span><span class="sf18b2">prefixName == </span><span class="sf12b2">'county'</span><span class="sf3b2">) {</span></code></td>
<td class="ln">712</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">prefixName == </span><span class="sf12b2">'state_province'</span><span class="sf3b2"> || $</span><span class="sf18b2">prefixName == </span><span class="sf12b2">'country'</span><span class="sf3b2"> || $</span><span class="sf18b2">prefixName == </span><span class="sf12b2">'county'</span><span class="sf3b2">) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">707</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!</span><span class="sf8b2">array_key_exists</span><span class="sf3b2">($</span><span class="sf18b2">index, $</span><span class="sf18b2">stateCountryMap)) {</span></code></td>
<td class="ln">713</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!</span><span class="sf8b2">array_key_exists</span><span class="sf3b2">($</span><span class="sf18b2">index, $</span><span class="sf18b2">stateCountryMap)) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">708</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">stateCountryMap[$</span><span class="sf18b2">index] = </span><span class="sf7b2">array</span><span class="sf3b2">();</span></code></td>
<td class="ln">714</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">stateCountryMap[$</span><span class="sf18b2">index] = </span><span class="sf7b2">array</span><span class="sf3b2">();</span></code></td>
</tr>
<tr valign="top">
<td class="ln">709</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">715</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">710</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">stateCountryMap[$</span><span class="sf18b2">index][$</span><span class="sf18b2">prefixName] = $</span><span class="sf18b2">key;</span></code></td>
<td class="ln">716</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">stateCountryMap[$</span><span class="sf18b2">index][$</span><span class="sf18b2">prefixName] = $</span><span class="sf18b2">key;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">711</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">717</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">712</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">CRM_Core_BAO_UFField::assignAddressField</span><span class="sf3b2">($</span><span class="sf18b2">key, $</span><span class="sf18b2">profileAddressFields);</span></code></td>
<td class="ln">718</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">CRM_Core_BAO_UFField::assignAddressField</span><span class="sf3b2">($</span><span class="sf18b2">key, $</span><span class="sf18b2">profileAddressFields);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">713</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">CRM_Core_BAO_UFGroup::buildProfile</span><span class="sf3b2">($</span><span class="sf18b2">this, $</span><span class="sf18b2">field, CRM_Profile_Form::MODE_CREATE, $</span><span class="sf18b2">contactID, TRUE);</span></code></td>
<td class="ln">719</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">CRM_Core_BAO_UFGroup::buildProfile</span><span class="sf3b2">($</span><span class="sf18b2">this, $</span><span class="sf18b2">field, CRM_Profile_Form::MODE_CREATE, $</span><span class="sf18b2">contactID, TRUE);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">714</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">720</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">715</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_fields[$</span><span class="sf18b2">key] = $</span><span class="sf18b2">field;</span></code></td>
<td class="ln">721</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_fields[$</span><span class="sf18b2">key] = $</span><span class="sf18b2">field;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">716</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">722</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">717</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">723</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">718</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!</span><span class="sf7b2">empty</span><span class="sf3b2">($</span><span class="sf18b2">profileAddressFields)) {</span></code></td>
<td class="ln">724</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!</span><span class="sf7b2">empty</span><span class="sf3b2">($</span><span class="sf18b2">profileAddressFields)) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">719</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">set</span><span class="sf3b2">(</span><span class="sf12b2">'profileAddressFields'</span><span class="sf3b2">, $</span><span class="sf18b2">profileAddressFields);</span></code></td>
<td class="ln">725</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">set</span><span class="sf3b2">(</span><span class="sf12b2">'profileAddressFields'</span><span class="sf3b2">, $</span><span class="sf18b2">profileAddressFields);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">720</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">726</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">721</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">CRM_Core_BAO_Address::addStateCountryMap</span><span class="sf3b2">($</span><span class="sf18b2">stateCoun<wbr>tryMap);</span></code></td>
<td class="ln">727</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">CRM_Core_BAO_Address::addStateCountryMap</span><span class="sf3b2">($</span><span class="sf18b2">stateCoun<wbr>tryMap);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">722</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">728</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">723</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">addCaptcha &amp;&amp;</span></code></td>
<td class="ln">729</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">addCaptcha &amp;&amp;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">724</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;!$viewOnly</span></code></td>
<td class="ln">730</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;!$viewOnly</span></code></td>
</tr>
<tr valign="top">
<td class="ln">725</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;) {</span></code></td>
<td class="ln">731</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">726</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">captcha = </span><span class="sf8b2">CRM_Utils_ReCAPTCHA::singleton</span><span class="sf3b2">();</span></code></td>
<td class="ln">732</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">captcha = </span><span class="sf8b2">CRM_Utils_ReCAPTCHA::singleton</span><span class="sf3b2">();</span></code></td>
</tr>
<tr valign="top">
<td class="ln">727</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">captcha-&gt;</span><span class="sf8b2">add</span><span class="sf3b2">($</span><span class="sf18b2">this);</span></code></td>
<td class="ln">733</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">captcha-&gt;</span><span class="sf8b2">add</span><span class="sf3b2">($</span><span class="sf18b2">this);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">728</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">assign</span><span class="sf3b2">(</span><span class="sf12b2">'isCaptcha'</span><span class="sf3b2">, TRUE);</span></code></td>
<td class="ln">734</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">assign</span><span class="sf3b2">(</span><span class="sf12b2">'isCaptcha'</span><span class="sf3b2">, TRUE);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">729</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">735</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">730</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">736</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">731</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;}</span></code></td>
<td class="ln">737</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">732</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">738</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">733</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf7b2">static</span></code></td>
<td class="ln">739</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf7b2">static</span></code></td>
</tr>
<tr valign="top">
<td class="ln">734</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf7b2">function</span><span class="sf3b2"> </span><span class="sf8b2">initEventFee</span><span class="sf3b2">(&amp;$</span><span class="sf18b2">form, $</span><span class="sf18b2">eventID) {</span></code></td>
<td class="ln">740</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf7b2">function</span><span class="sf3b2"> </span><span class="sf8b2">initEventFee</span><span class="sf3b2">(&amp;$</span><span class="sf18b2">form, $</span><span class="sf18b2">eventID) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">735</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// get price info</span></code></td>
<td class="ln">741</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// get price info</span></code></td>
</tr>
<tr valign="top">
<td class="ln">736</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">742</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">737</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// retrive all active price set fields.</span></code></td>
<td class="ln">743</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// retrive all active price set fields.</span></code></td>
</tr>
<tr valign="top">
<td class="ln">738</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">discountId = </span><span class="sf8b2">CRM_Core_BAO_Discount::findSet</span><span class="sf3b2">($</span><span class="sf18b2">eventID, </span><span class="sf12b2">'civicrm_event'</span><span class="sf3b2">);</span></code></td>
<td class="ln">744</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">discountId = </span><span class="sf8b2">CRM_Core_BAO_Discount::findSet</span><span class="sf3b2">($</span><span class="sf18b2">eventID, </span><span class="sf12b2">'civicrm_event'</span><span class="sf3b2">);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">739</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">discountId) {</span></code></td>
<td class="ln">745</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">discountId) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">740</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">priceSetId = </span><span class="sf8b2">CRM_Core_DAO::getFieldValue</span><span class="sf3b2">(</span><span class="sf12b2">'CRM_Core_BAO_Discount'<wbr></span><span class="sf3b2">, $</span><span class="sf18b2">discountId, </span><span class="sf12b2">'option_group_id'</span><span class="sf3b2">);</span></code></td>
<td class="ln">746</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">priceSetId = </span><span class="sf8b2">CRM_Core_DAO::getFieldValue</span><span class="sf3b2">(</span><span class="sf12b2">'CRM_Core_BAO_Discount'<wbr></span><span class="sf3b2">, $</span><span class="sf18b2">discountId, </span><span class="sf12b2">'option_group_id'</span><span class="sf3b2">);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">741</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">price = </span><span class="sf8b2">CRM_Price_BAO_Set::initSet</span><span class="sf3b2">($</span><span class="sf18b2">form, $</span><span class="sf18b2">eventID, </span><span class="sf12b2">'civicrm_event'</span><span class="sf3b2">, TRUE, $</span><span class="sf18b2">priceSetId);</span></code></td>
<td class="ln">747</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">price = </span><span class="sf8b2">CRM_Price_BAO_Set::initSet</span><span class="sf3b2">($</span><span class="sf18b2">form, $</span><span class="sf18b2">eventID, </span><span class="sf12b2">'civicrm_event'</span><span class="sf3b2">, TRUE, $</span><span class="sf18b2">priceSetId);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">742</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">748</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">743</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">else</span><span class="sf3b2"> {</span></code></td>
<td class="ln">749</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">else</span><span class="sf3b2"> {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">744</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">price = </span><span class="sf8b2">CRM_Price_BAO_Set::initSet</span><span class="sf3b2">($</span><span class="sf18b2">form, $</span><span class="sf18b2">eventID, </span><span class="sf12b2">'civicrm_event'</span><span class="sf3b2">, TRUE);</span></code></td>
<td class="ln">750</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">price = </span><span class="sf8b2">CRM_Price_BAO_Set::initSet</span><span class="sf3b2">($</span><span class="sf18b2">form, $</span><span class="sf18b2">eventID, </span><span class="sf12b2">'civicrm_event'</span><span class="sf3b2">, TRUE);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">745</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">751</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">746</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">752</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">747</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">eventFee = </span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'fee'</span><span class="sf3b2">, $</span><span class="sf18b2">form-&gt;_values);</span></code></td>
<td class="ln">753</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">eventFee = </span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'fee'</span><span class="sf3b2">, $</span><span class="sf18b2">form-&gt;_values);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">748</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!</span><span class="sf8b2">is_array</span><span class="sf3b2">($</span><span class="sf18b2">eventFee) || </span><span class="sf7b2">empty</span><span class="sf3b2">($</span><span class="sf18b2">eventFee)) {</span></code></td>
<td class="ln">754</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!</span><span class="sf8b2">is_array</span><span class="sf3b2">($</span><span class="sf18b2">eventFee) || </span><span class="sf7b2">empty</span><span class="sf3b2">($</span><span class="sf18b2">eventFee)) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">749</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">form-&gt;_values[</span><span class="sf12b2">'fee'</span><span class="sf3b2">] = array</span><span class="sf3b2">();</span></code></td>
<td class="ln">755</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">form-&gt;_values[</span><span class="sf12b2">'fee'</span><span class="sf3b2">] = array</span><span class="sf3b2">();</span></code></td>
</tr>
<tr valign="top">
<td class="ln">750</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">756</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">751</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">757</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">752</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">//fix for non-upgraded price sets.CRM-4256.</span></code></td>
<td class="ln">758</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">//fix for non-upgraded price sets.CRM-4256.</span></code></td>
</tr>
<tr valign="top">
<td class="ln">753</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf7b2">isset</span><span class="sf3b2">($</span><span class="sf18b2">form-&gt;_isPaidEvent)) {</span></code></td>
<td class="ln">759</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf7b2">isset</span><span class="sf3b2">($</span><span class="sf18b2">form-&gt;_isPaidEvent)) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">754</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">isPaidEvent = $</span><span class="sf18b2">form-&gt;_isPaidEvent;</span></code></td>
<td class="ln">760</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">isPaidEvent = $</span><span class="sf18b2">form-&gt;_isPaidEvent;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">755</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">761</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">756</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">else</span><span class="sf3b2"> {</span></code></td>
<td class="ln">762</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">else</span><span class="sf3b2"> {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">757</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">isPaidEvent = </span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'is_monetary'</span><span class="sf3b2">, $</span><span class="sf18b2">form-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">]);</span></code></td>
<td class="ln">763</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">isPaidEvent = </span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'is_monetary'</span><span class="sf3b2">, $</span><span class="sf18b2">form-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">]);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">758</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">764</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">759</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">isPaidEvent &amp;&amp; </span><span class="sf7b2">empty</span><span class="sf3b2">($</span><span class="sf18b2">form-&gt;_values[</span><span class="sf12b2">'fee'</span><span class="sf3b2">])) {</span></code></td>
<td class="ln">765</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">isPaidEvent &amp;&amp; </span><span class="sf7b2">empty</span><span class="sf3b2">($</span><span class="sf18b2">form-&gt;_values[</span><span class="sf12b2">'fee'</span><span class="sf3b2">])) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">760</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">CRM_Utils_System::getClassName</span><span class="sf3b2">($</span><span class="sf18b2">form) != </span><span class="sf12b2">'CRM_Event_Form_Participant'</span><span class="sf3b2">) {</span></code></td>
<td class="ln">766</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">CRM_Utils_System::getClassName</span><span class="sf3b2">($</span><span class="sf18b2">form) != </span><span class="sf12b2">'CRM_Event_Form_Participant'</span><span class="sf3b2">) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">761</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">CRM_Core_Error::fatal</span><span class="sf3b2">(</span><span class="sf8b2">ts</span><span class="sf3b2">(</span><span class="sf12b2">'No Fee Level(s) or Price Set is configured for this event.&lt;br /&gt;Click &lt;a href=\'%1\'&gt;CiviEvent &gt;&gt; Manage Event &gt;&gt; Configure &gt;&gt; Event Fees&lt;/a&gt; to configure the Fee Level(s) or Price Set for this event.'</span><span class="sf3b2">, </span><span class="sf7b2">array</span><span class="sf3b2">(</span><span class="sf10b2">1</span><span class="sf3b2"> =&gt; </span><span class="sf8b2">CRM_Utils_System::url</span><span class="sf3b2">(</span><span class="sf12b2">'civicrm/event/manage/fee'</span><span class="sf3b2">, </span><span class="sf12b2">'reset=1&amp;action=update&amp;id='</span><span class="sf3b2"> . $</span><span class="sf18b2">form-&gt;_eventId))));</span></code></td>
<td class="ln">767</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">CRM_Core_Error::fatal</span><span class="sf3b2">(</span><span class="sf8b2">ts</span><span class="sf3b2">(</span><span class="sf12b2">'No Fee Level(s) or Price Set is configured for this event.&lt;br /&gt;Click &lt;a href=\'%1\'&gt;CiviEvent &gt;&gt; Manage Event &gt;&gt; Configure &gt;&gt; Event Fees&lt;/a&gt; to configure the Fee Level(s) or Price Set for this event.'</span><span class="sf3b2">, </span><span class="sf7b2">array</span><span class="sf3b2">(</span><span class="sf10b2">1</span><span class="sf3b2"> =&gt; </span><span class="sf8b2">CRM_Utils_System::url</span><span class="sf3b2">(</span><span class="sf12b2">'civicrm/event/manage/fee'</span><span class="sf3b2">, </span><span class="sf12b2">'reset=1&amp;action=update&amp;id='</span><span class="sf3b2"> . $</span><span class="sf18b2">form-&gt;_eventId))));</span></code></td>
</tr>
<tr valign="top">
<td class="ln">762</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">768</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">763</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">769</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">764</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;}</span></code></td>
<td class="ln">770</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">765</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">771</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">766</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf9b2">/**</span></code></td>
<td class="ln">772</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf9b2">/**</span></code></td>
</tr>
<tr valign="top">
<td class="ln">767</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * Function to handle &nbsp;process after the confirmation of payment by User</span></code></td>
<td class="ln">773</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * Function to handle &nbsp;process after the confirmation of payment by User</span></code></td>
</tr>
<tr valign="top">
<td class="ln">768</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; *</span></code></td>
<td class="ln">774</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; *</span></code></td>
</tr>
<tr valign="top">
<td class="ln">769</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @return None</span></code></td>
<td class="ln">775</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @return None</span></code></td>
</tr>
<tr valign="top">
<td class="ln">770</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @access public</span></code></td>
<td class="ln">776</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @access public</span></code></td>
</tr>
<tr valign="top">
<td class="ln">771</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; */</span>&nbsp;</code></td>
<td class="ln">777</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; */</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">772</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf7b2">function</span><span class="sf3b2"> </span><span class="sf8b2">confirmPostProcess</span><span class="sf3b2">($</span><span class="sf18b2">contactID = NULL, $</span><span class="sf18b2">contribution = NULL, $</span><span class="sf18b2">payment = NULL) {</span></code></td>
<td class="ln">778</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf7b2">function</span><span class="sf3b2"> </span><span class="sf8b2">confirmPostProcess</span><span class="sf3b2">($</span><span class="sf18b2">contactID = NULL, $</span><span class="sf18b2">contribution = NULL, $</span><span class="sf18b2">payment = NULL) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">773</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// add/update contact information</span></code></td>
<td class="ln">779</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// add/update contact information</span></code></td>
</tr>
<tr valign="top">
<td class="ln">774</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">fields = </span><span class="sf7b2">array</span><span class="sf3b2">();</span></code></td>
<td class="ln">780</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">fields = </span><span class="sf7b2">array</span><span class="sf3b2">();</span></code></td>
</tr>
<tr valign="top">
<td class="ln">775</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">unset</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;_params[</span><span class="sf12b2">'note'</span><span class="sf3b2">]);</span></code></td>
<td class="ln">781</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">unset</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;_params[</span><span class="sf12b2">'note'</span><span class="sf3b2">]);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">776</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">782</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">777</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">//to avoid conflict overwrite $this-&gt;_params</span></code></td>
<td class="ln">783</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">//to avoid conflict overwrite $this-&gt;_params</span></code></td>
</tr>
<tr valign="top">
<td class="ln">778</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_params = $</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">get</span><span class="sf3b2">(</span><span class="sf12b2">'value'</span><span class="sf3b2">);</span></code></td>
<td class="ln">784</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_params = $</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">get</span><span class="sf3b2">(</span><span class="sf12b2">'value'</span><span class="sf3b2">);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">779</td><td style="color: #000000; background-color: #fbf2bf; "><code>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #e9e9e9; "><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">780</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">//get the amount of primary participant</span></code></td>
<td class="ln">785</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">//get the amount of primary participant</span></code></td>
</tr>
<tr valign="top">
<td class="ln">781</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp;</span><span style="color: #000000; background-color: #efcb05; font-weight: bold; ">if</span><span style="color: #000000; background-color: #efcb05; "> </span><span class="sf17b16">(</span><span class="sf17b16">CRM_Utils_Array::value</span><span class="sf17b16">(</span><span class="sf17b16">'is_primary'</span><span class="sf17b16">,</span><span style="color: #000000; background-color: #efcb05; "> $</span><span style="color: #000000; background-color: #efcb05; ">this-&gt;_params)) {</span></code></td>
<td class="ln">786</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp;</span><span style="color: #000000; background-color: #efcb05; font-weight: bold; ">if</span><span style="color: #000000; background-color: #efcb05; "> </span><span class="sf17b16">(</span><span class="sf17b16">CRM_Utils_Array::value</span><span class="sf17b16">(</span><span class="sf17b16">'is_payer'</span><span class="sf17b16">,</span><span style="color: #000000; background-color: #efcb05; "> $</span><span style="color: #000000; background-color: #efcb05; ">this-&gt;_params)) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">782</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; </span><span class="sf17b16">&nbsp;</span><span style="color: #000000; background-color: #efcb05; ">$</span><span style="color: #000000; background-color: #efcb05; ">this-&gt;_params[</span><span style="color: #000000; background-color: #efcb05; ">'fee_amount'</span><span style="color: #000000; background-color: #efcb05; ">] = $</span><span style="color: #000000; background-color: #efcb05; ">this-&gt;</span><span style="color: #000000; background-color: #efcb05; ">get</span><span style="color: #000000; background-color: #efcb05; ">(</span><span style="color: #000000; background-color: #efcb05; ">'primaryParticipantAmount'</span><span style="color: #000000; background-color: #efcb05; ">);</span></code></td>
<td class="ln">787</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; </span><span class="sf17b16">//</span><span style="color: #000000; background-color: #efcb05; "> $this-&gt;_params['fee_amount'] = $this-&gt;get('primaryParticipantAmount');</span></code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">788</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; </span><span class="sf17b16">//BOT - changed to prevent setting the amount of 1st participant if additional participant is Payer
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">789</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp;$</span><span class="sf17b16">this-&gt;_params[</span><span class="sf17b16">'fee_amount'</span><span class="sf17b16">] = $</span><span class="sf17b16">this-&gt;_params[</span><span class="sf17b16">'original_amount'</span><span class="sf17b16">];
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">783</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">790</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">784</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">791</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">785</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// add participant record</span></code></td>
<td class="ln">792</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// add participant record</span></code></td>
</tr>
<tr valign="top">
<td class="ln">786</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">participant = $</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">addParticipant</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;_params, $</span><span class="sf18b2">contactID);</span></code></td>
<td class="ln">793</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">participant = $</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">addParticipant</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;_params, $</span><span class="sf18b2">contactID);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">787</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_participantIDS[] = $</span><span class="sf18b2">participant-&gt;id;</span></code></td>
<td class="ln">794</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_participantIDS[] = $</span><span class="sf18b2">participant-&gt;id;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">788</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16">
</span>&nbsp;</code></td>
<td class="ln">795</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp;
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">789</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">//setting register_by_id field and primaryContactId</span></code></td>
<td class="ln">796</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">//setting register_by_id field and primaryContactId</span></code></td>
</tr>
<tr valign="top">
<td class="ln">790</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp;</span><span style="color: #000000; background-color: #efcb05; font-weight: bold; ">if</span><span style="color: #000000; background-color: #efcb05; "> </span><span class="sf17b16">(</span><span class="sf17b16">CRM_Utils_Array::value</span><span class="sf17b16">(</span><span class="sf17b16">'is_primary'</span><span class="sf17b16">, $</span><span class="sf17b16">this-&gt;_params))</span><span style="color: #000000; background-color: #efcb05; "> {</span></code></td>
<td class="ln">797</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp;</span><span style="color: #000000; background-color: #efcb05; font-weight: bold; ">if</span><span style="color: #000000; background-color: #efcb05; "> </span><span class="sf17b16">(</span><span class="sf17b16">CRM_Utils_Array::value</span><span class="sf17b16">(</span><span class="sf17b16">'is_payer'</span><span class="sf17b16">, $</span><span class="sf17b16">this-&gt;_params) ) </span><span style="color: #000000; background-color: #efcb05; ">&nbsp;{</span></code></td>
</tr>
<tr valign="top">
<td class="ln">791</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">set</span><span class="sf3b2">(</span><span class="sf12b2">'registerByID'</span><span class="sf3b2">, $</span><span class="sf18b2">participant-&gt;id);</span></code></td>
<td class="ln">798</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">set</span><span class="sf3b2">(</span><span class="sf12b2">'registerByID'</span><span class="sf3b2">, $</span><span class="sf18b2">participant-&gt;id);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">792</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">set</span><span class="sf3b2">(</span><span class="sf12b2">'primaryContactId'</span><span class="sf3b2">, $</span><span class="sf18b2">contactID);</span></code></td>
<td class="ln">799</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">set</span><span class="sf3b2">(</span><span class="sf12b2">'primaryContactId'</span><span class="sf3b2">, $</span><span class="sf18b2">contactID);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">793</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">800</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">794</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">// CRM-10032</span></code></td>
<td class="ln">801</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">// CRM-10032</span></code></td>
</tr>
<tr valign="top">
<td class="ln">795</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">processFirstParticipant</span><span class="sf3b2">($</span><span class="sf18b2">participant-&gt;id);</span></code></td>
<td class="ln">802</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">processFirstParticipant</span><span class="sf3b2">($</span><span class="sf18b2">participant-&gt;id);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">796</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">803</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">797</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16">
</span>&nbsp;</code></td>
<td class="ln">804</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; 
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">798</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf8b2">CRM_Core_BAO_CustomValueTable::postProcess</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;_<wbr>params,</span></code></td>
<td class="ln">805</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf8b2">CRM_Core_BAO_CustomValueTable::postProcess</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;_<wbr>params,</span></code></td>
</tr>
<tr valign="top">
<td class="ln">799</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;CRM_Core_DAO::$</span><span class="sf18b2">_nullArray,</span></code></td>
<td class="ln">806</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;CRM_Core_DAO::$</span><span class="sf18b2">_nullArray,</span></code></td>
</tr>
<tr valign="top">
<td class="ln">800</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'civicrm_participant'</span><span class="sf3b2">,</span></code></td>
<td class="ln">807</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'civicrm_participant'</span><span class="sf3b2">,</span></code></td>
</tr>
<tr valign="top">
<td class="ln">801</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">participant-&gt;id,</span></code></td>
<td class="ln">808</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">participant-&gt;id,</span></code></td>
</tr>
<tr valign="top">
<td class="ln">802</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'Participant'</span>&nbsp;</code></td>
<td class="ln">809</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'Participant'</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">803</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;);</span></code></td>
<td class="ln">810</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">804</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16">
</span>&nbsp;</code></td>
<td class="ln">811</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; 
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">805</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">createPayment = (</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'amount'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_params, 0) != 0) ? TRUE : FALSE;</span></code></td>
<td class="ln">812</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">createPayment = (</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'amount'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_params, 0) != 0) ? TRUE : FALSE;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">806</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">813</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">807</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// force to create zero amount payment, CRM-5095</span></code></td>
<td class="ln">814</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// force to create zero amount payment, CRM-5095</span></code></td>
</tr>
<tr valign="top">
<td class="ln">808</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// we know the amout is zero since createPayment is false</span></code></td>
<td class="ln">815</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// we know the amout is zero since createPayment is false</span></code></td>
</tr>
<tr valign="top">
<td class="ln">809</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!$</span><span class="sf18b2">createPayment &amp;&amp;</span></code></td>
<td class="ln">816</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!$</span><span class="sf18b2">createPayment &amp;&amp;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">810</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;(</span><span class="sf7b2">isset</span><span class="sf3b2">($</span><span class="sf18b2">contribution) &amp;&amp; $</span><span class="sf18b2">contribution-&gt;id) &amp;&amp;</span></code></td>
<td class="ln">817</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;(</span><span class="sf7b2">isset</span><span class="sf3b2">($</span><span class="sf18b2">contribution) &amp;&amp; $</span><span class="sf18b2">contribution-&gt;id) &amp;&amp;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">811</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_priceSetId &amp;&amp;</span></code></td>
<td class="ln">818</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_priceSetId &amp;&amp;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">812</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_lineItem</span></code></td>
<td class="ln">819</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_lineItem</span></code></td>
</tr>
<tr valign="top">
<td class="ln">813</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;) {</span></code></td>
<td class="ln">820</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">814</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">createPayment = TRUE;</span></code></td>
<td class="ln">821</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">createPayment = TRUE;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">815</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">822</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">816</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">823</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">824</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; 
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">817</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">createPayment &amp;&amp; $</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">][</span><span class="sf12b2">'is_monetary'</span><span class="sf3b2">] &amp;&amp;</span></code></td>
<td class="ln">825</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">createPayment &amp;&amp; $</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">][</span><span class="sf12b2">'is_monetary'</span><span class="sf3b2">] &amp;&amp;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">818</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'contributionID'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_params)</span></code></td>
<td class="ln">826</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'contributionID'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_params)</span></code></td>
</tr>
<tr valign="top">
<td class="ln">819</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;) {</span></code></td>
<td class="ln">827</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">820</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">paymentParams = </span><span class="sf7b2">array</span><span class="sf3b2">(</span></code></td>
<td class="ln">828</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">paymentParams = </span><span class="sf7b2">array</span><span class="sf3b2">(</span></code></td>
</tr>
<tr valign="top">
<td class="ln">821</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'participant_id'</span><span class="sf3b2"> =&gt; $</span><span class="sf18b2">participant-&gt;id,</span></code></td>
<td class="ln">829</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'participant_id'</span><span class="sf3b2"> =&gt; $</span><span class="sf18b2">participant-&gt;id,</span></code></td>
</tr>
<tr valign="top">
<td class="ln">822</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'contribution_id'</span><span class="sf3b2"> =&gt; $</span><span class="sf18b2">contribution-&gt;id,</span></code></td>
<td class="ln">830</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'contribution_id'</span><span class="sf3b2"> =&gt; $</span><span class="sf18b2">contribution-&gt;id,</span></code></td>
</tr>
<tr valign="top">
<td class="ln">823</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;);</span></code></td>
<td class="ln">831</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">824</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp;</span><span class="sf17b16"> &nbsp;$</span><span class="sf17b16">ids = </span><span class="sf17b16">array</span><span class="sf17b16">();
</span>&nbsp;</code></td>
<td class="ln">832</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp;</span><span class="sf17b16">
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">833</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp;$</span><span class="sf17b16">ids = </span><span class="sf17b16">array</span><span class="sf17b16">(); 
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">825</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">paymentPartcipant = </span><span class="sf8b2">CRM_Event_BAO_ParticipantPayment::create</span><span class="sf3b2">($</span><span class="sf18b2">paymentPa<wbr>rams, $</span><span class="sf18b2">ids);</span></code></td>
<td class="ln">834</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">paymentPartcipant = </span><span class="sf8b2">CRM_Event_BAO_ParticipantPayment::create</span><span class="sf3b2">($</span><span class="sf18b2">paymentPa<wbr>rams, $</span><span class="sf18b2">ids);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">826</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">}</span></code></td>
<td class="ln">835</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp;</span><span class="sf17b16"> </span><span style="color: #000000; background-color: #efcb05; ">}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">827</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16">
</span>&nbsp;</code></td>
<td class="ln">836</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp;
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">828</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">//set only primary participant's params for transfer checkout.</span></code></td>
<td class="ln">837</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">//set only primary participant's params for transfer checkout.</span></code></td>
</tr>
<tr valign="top">
<td class="ln">829</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (($</span><span class="sf18b2">this-&gt;_contributeMode == </span><span class="sf12b2">'checkout'</span><span class="sf3b2"> || $</span><span class="sf18b2">this-&gt;_contributeMode == </span><span class="sf12b2">'notify'</span><span class="sf3b2">)</span></code></td>
<td class="ln">838</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (($</span><span class="sf18b2">this-&gt;_contributeMode == </span><span class="sf12b2">'checkout'</span><span class="sf3b2"> || $</span><span class="sf18b2">this-&gt;_contributeMode == </span><span class="sf12b2">'notify'</span><span class="sf3b2">)</span></code></td>
</tr>
<tr valign="top">
<td class="ln">830</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp;&amp;&amp; </span><span class="sf17b16">CRM_Utils_Array::value</span><span class="sf17b16">(</span><span class="sf17b16">'is_primary'</span><span class="sf17b16">,</span><span style="color: #000000; background-color: #efcb05; "> $</span><span style="color: #000000; background-color: #efcb05; ">this-&gt;_params)</span></code></td>
<td class="ln">839</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp;&amp;&amp; </span><span class="sf17b16">CRM_Utils_Array::value</span><span class="sf17b16">(</span><span class="sf17b16">'is_payer'</span><span class="sf17b16">,</span><span style="color: #000000; background-color: #efcb05; "> $</span><span style="color: #000000; background-color: #efcb05; ">this-&gt;_params)</span></code></td>
</tr>
<tr valign="top">
<td class="ln">831</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;) {</span></code></td>
<td class="ln">840</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">832</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_params[</span><span class="sf12b2">'participantID'</span><span class="sf3b2">] = $</span><span class="sf18b2">participant-&gt;id;</span></code></td>
<td class="ln">841</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_params[</span><span class="sf12b2">'participantID'</span><span class="sf3b2">] = $</span><span class="sf18b2">participant-&gt;id;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">833</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">set</span><span class="sf3b2">(</span><span class="sf12b2">'primaryParticipant'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_params);</span></code></td>
<td class="ln">842</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">set</span><span class="sf3b2">(</span><span class="sf12b2">'primaryParticipant'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_params);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">834</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">843</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">835</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">844</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">836</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">assign</span><span class="sf3b2">(</span><span class="sf12b2">'action'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_action);</span></code></td>
<td class="ln">845</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">assign</span><span class="sf3b2">(</span><span class="sf12b2">'action'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_action);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">837</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">846</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">838</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// create CMS user</span></code></td>
<td class="ln">847</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// create CMS user</span></code></td>
</tr>
<tr valign="top">
<td class="ln">839</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'cms_create_account'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_params)) {</span></code></td>
<td class="ln">848</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'cms_create_account'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_params)) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">840</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_params[</span><span class="sf12b2">'contactID'</span><span class="sf3b2">] = $</span><span class="sf18b2">contactID;</span></code></td>
<td class="ln">849</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_params[</span><span class="sf12b2">'contactID'</span><span class="sf3b2">] = $</span><span class="sf18b2">contactID;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">841</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">850</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">842</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">array_key_exists</span><span class="sf3b2">(</span><span class="sf12b2">'email-5'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_params)) {</span></code></td>
<td class="ln">851</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">array_key_exists</span><span class="sf3b2">(</span><span class="sf12b2">'email-5'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_params)) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">843</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">mail = </span><span class="sf12b2">'email-5'</span><span class="sf3b2">;</span></code></td>
<td class="ln">852</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">mail = </span><span class="sf12b2">'email-5'</span><span class="sf3b2">;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">844</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;} </span><span class="sf7b2">else</span><span class="sf3b2"> {</span></code></td>
<td class="ln">853</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;} </span><span class="sf7b2">else</span><span class="sf3b2"> {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">845</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">foreach</span><span class="sf3b2"> ($</span><span class="sf18b2">this-&gt;_params as $</span><span class="sf18b2">name =&gt; $</span><span class="sf18b2">dontCare) {</span></code></td>
<td class="ln">854</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">foreach</span><span class="sf3b2"> ($</span><span class="sf18b2">this-&gt;_params as $</span><span class="sf18b2">name =&gt; $</span><span class="sf18b2">dontCare) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">846</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">substr</span><span class="sf3b2">($</span><span class="sf18b2">name, </span><span class="sf10b2">0</span><span class="sf3b2">, </span><span class="sf10b2">5</span><span class="sf3b2">) == </span><span class="sf12b2">'email'</span><span class="sf3b2">) {</span></code></td>
<td class="ln">855</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">substr</span><span class="sf3b2">($</span><span class="sf18b2">name, </span><span class="sf10b2">0</span><span class="sf3b2">, </span><span class="sf10b2">5</span><span class="sf3b2">) == </span><span class="sf12b2">'email'</span><span class="sf3b2">) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">847</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">mail = $</span><span class="sf18b2">name;</span></code></td>
<td class="ln">856</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">mail = $</span><span class="sf18b2">name;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">848</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">break</span><span class="sf3b2">;</span></code></td>
<td class="ln">857</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">break</span><span class="sf3b2">;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">849</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">858</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">850</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">859</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">851</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">860</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">852</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">861</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">853</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">// we should use primary email for</span></code></td>
<td class="ln">862</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">// we should use primary email for</span></code></td>
</tr>
<tr valign="top">
<td class="ln">854</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">// 1. free event registration.</span></code></td>
<td class="ln">863</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">// 1. free event registration.</span></code></td>
</tr>
<tr valign="top">
<td class="ln">855</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">// 2. pay later participant.</span></code></td>
<td class="ln">864</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">// 2. pay later participant.</span></code></td>
</tr>
<tr valign="top">
<td class="ln">856</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">// 3. waiting list participant.</span></code></td>
<td class="ln">865</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">// 3. waiting list participant.</span></code></td>
</tr>
<tr valign="top">
<td class="ln">857</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">// 4. require approval participant.</span></code></td>
<td class="ln">866</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">// 4. require approval participant.</span></code></td>
</tr>
<tr valign="top">
<td class="ln">858</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'is_pay_later'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_params) ||</span></code></td>
<td class="ln">867</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'is_pay_later'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_params) ||</span></code></td>
</tr>
<tr valign="top">
<td class="ln">859</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_allowWaitlist || $</span><span class="sf18b2">this-&gt;_requireApproval ||</span></code></td>
<td class="ln">868</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_allowWaitlist || $</span><span class="sf18b2">this-&gt;_requireApproval ||</span></code></td>
</tr>
<tr valign="top">
<td class="ln">860</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;!</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'is_monetary'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">])</span></code></td>
<td class="ln">869</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;!</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'is_monetary'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">])</span></code></td>
</tr>
<tr valign="top">
<td class="ln">861</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;) {</span></code></td>
<td class="ln">870</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">862</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">mail = </span><span class="sf12b2">'email-Primary'</span><span class="sf3b2">;</span></code></td>
<td class="ln">871</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">mail = </span><span class="sf12b2">'email-Primary'</span><span class="sf3b2">;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">863</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">872</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">864</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">873</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">865</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!</span><span class="sf8b2">CRM_Core_BAO_CMSUser::create</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;_params, $</span><span class="sf18b2">mail)) {</span></code></td>
<td class="ln">874</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!</span><span class="sf8b2">CRM_Core_BAO_CMSUser::create</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;_params, $</span><span class="sf18b2">mail)) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">866</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">CRM_Core_Error::statusBounce</span><span class="sf3b2">(</span><span class="sf8b2">ts</span><span class="sf3b2">(</span><span class="sf12b2">'Your profile is not saved and Account is not created.'</span><span class="sf3b2">));</span></code></td>
<td class="ln">875</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">CRM_Core_Error::statusBounce</span><span class="sf3b2">(</span><span class="sf8b2">ts</span><span class="sf3b2">(</span><span class="sf12b2">'Your profile is not saved and Account is not created.'</span><span class="sf3b2">));</span></code></td>
</tr>
<tr valign="top">
<td class="ln">867</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">876</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">868</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">877</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">869</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;}</span></code></td>
<td class="ln">878</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">870</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">879</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">871</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf9b2">/**</span></code></td>
<td class="ln">880</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf9b2">/**</span></code></td>
</tr>
<tr valign="top">
<td class="ln">872</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * Process the participant</span></code></td>
<td class="ln">881</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * Process the participant</span></code></td>
</tr>
<tr valign="top">
<td class="ln">873</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; *</span></code></td>
<td class="ln">882</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; *</span></code></td>
</tr>
<tr valign="top">
<td class="ln">874</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @return void</span></code></td>
<td class="ln">883</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @return void</span></code></td>
</tr>
<tr valign="top">
<td class="ln">875</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @access public</span></code></td>
<td class="ln">884</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @access public</span></code></td>
</tr>
<tr valign="top">
<td class="ln">876</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; */</span>&nbsp;</code></td>
<td class="ln">885</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; */</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">877</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf8b2">public function addParticipant</span><span class="sf3b2">($</span><span class="sf18b2">params, $</span><span class="sf18b2">contactID) {</span></code></td>
<td class="ln">886</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf8b2">public function addParticipant</span><span class="sf3b2">($</span><span class="sf18b2">params, $</span><span class="sf18b2">contactID) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">878</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">887</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">879</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">transaction = </span><span class="sf7b2">new</span><span class="sf3b2"> </span><span class="sf8b2">CRM_Core_Transaction</span><span class="sf3b2">();</span></code></td>
<td class="ln">888</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">transaction = </span><span class="sf7b2">new</span><span class="sf3b2"> </span><span class="sf8b2">CRM_Core_Transaction</span><span class="sf3b2">();</span></code></td>
</tr>
<tr valign="top">
<td class="ln">880</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">889</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">881</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">groupName = </span><span class="sf12b2">'participant_role'</span><span class="sf3b2">;</span></code></td>
<td class="ln">890</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">groupName = </span><span class="sf12b2">'participant_role'</span><span class="sf3b2">;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">882</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">query = </span><span class="sf12b2">"</span></code></td>
<td class="ln">891</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">query = </span><span class="sf12b2">"</span></code></td>
</tr>
<tr valign="top">
<td class="ln">883</td><td class="sf3b2"><code><span class="sf12b2">SELECT &nbsp;v.label as label ,v.value as value</span></code></td>
<td class="ln">892</td><td class="sf3b2"><code><span class="sf12b2">SELECT &nbsp;v.label as label ,v.value as value</span></code></td>
</tr>
<tr valign="top">
<td class="ln">884</td><td class="sf3b2"><code><span class="sf12b2">FROM &nbsp; civicrm_option_value v,</span></code></td>
<td class="ln">893</td><td class="sf3b2"><code><span class="sf12b2">FROM &nbsp; civicrm_option_value v,</span></code></td>
</tr>
<tr valign="top">
<td class="ln">885</td><td class="sf3b2"><code><span class="sf12b2"> &nbsp; &nbsp; &nbsp; civicrm_option_group g</span></code></td>
<td class="ln">894</td><td class="sf3b2"><code><span class="sf12b2"> &nbsp; &nbsp; &nbsp; civicrm_option_group g</span></code></td>
</tr>
<tr valign="top">
<td class="ln">886</td><td class="sf3b2"><code><span class="sf12b2">WHERE &nbsp;v.option_group_id = g.id</span></code></td>
<td class="ln">895</td><td class="sf3b2"><code><span class="sf12b2">WHERE &nbsp;v.option_group_id = g.id</span></code></td>
</tr>
<tr valign="top">
<td class="ln">887</td><td class="sf3b2"><code><span class="sf12b2"> &nbsp;AND &nbsp;g.name &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;= %1</span></code></td>
<td class="ln">896</td><td class="sf3b2"><code><span class="sf12b2"> &nbsp;AND &nbsp;g.name &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;= %1</span></code></td>
</tr>
<tr valign="top">
<td class="ln">888</td><td class="sf3b2"><code><span class="sf12b2"> &nbsp;AND &nbsp;v.is_active &nbsp; &nbsp; &nbsp; = 1</span></code></td>
<td class="ln">897</td><td class="sf3b2"><code><span class="sf12b2"> &nbsp;AND &nbsp;v.is_active &nbsp; &nbsp; &nbsp; = 1</span></code></td>
</tr>
<tr valign="top">
<td class="ln">889</td><td class="sf3b2"><code><span class="sf12b2"> &nbsp;AND &nbsp;g.is_active &nbsp; &nbsp; &nbsp; = 1</span></code></td>
<td class="ln">898</td><td class="sf3b2"><code><span class="sf12b2"> &nbsp;AND &nbsp;g.is_active &nbsp; &nbsp; &nbsp; = 1</span></code></td>
</tr>
<tr valign="top">
<td class="ln">890</td><td class="sf3b2"><code><span class="sf12b2">"</span><span class="sf3b2">;</span></code></td>
<td class="ln">899</td><td class="sf3b2"><code><span class="sf12b2">"</span><span class="sf3b2">;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">891</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">p = </span><span class="sf7b2">array</span><span class="sf3b2">(</span><span class="sf10b2">1</span><span class="sf3b2"> =&gt; </span><span class="sf7b2">array</span><span class="sf3b2">($</span><span class="sf18b2">groupName, </span><span class="sf12b2">'String'</span><span class="sf3b2">));</span></code></td>
<td class="ln">900</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">p = </span><span class="sf7b2">array</span><span class="sf3b2">(</span><span class="sf10b2">1</span><span class="sf3b2"> =&gt; </span><span class="sf7b2">array</span><span class="sf3b2">($</span><span class="sf18b2">groupName, </span><span class="sf12b2">'String'</span><span class="sf3b2">));</span></code></td>
</tr>
<tr valign="top">
<td class="ln">892</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">901</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">893</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">dao = </span><span class="sf8b2">CRM_Core_DAO::executeQuery</span><span class="sf3b2">($</span><span class="sf18b2">query, $</span><span class="sf18b2">p);</span></code></td>
<td class="ln">902</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">dao = </span><span class="sf8b2">CRM_Core_DAO::executeQuery</span><span class="sf3b2">($</span><span class="sf18b2">query, $</span><span class="sf18b2">p);</span></code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">903</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp;
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">894</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">dao-&gt;</span><span class="sf8b2">fetch</span><span class="sf3b2">()) {</span></code></td>
<td class="ln">904</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">dao-&gt;</span><span class="sf8b2">fetch</span><span class="sf3b2">()) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">895</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">roleID = $</span><span class="sf18b2">dao-&gt;value;</span></code></td>
<td class="ln">905</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">roleID = $</span><span class="sf18b2">dao-&gt;value;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">896</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">906</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">897</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">907</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">898</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// handle register date CRM-4320</span></code></td>
<td class="ln">908</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// handle register date CRM-4320</span></code></td>
</tr>
<tr valign="top">
<td class="ln">899</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">registerDate = NULL;</span></code></td>
<td class="ln">909</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">registerDate = NULL;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">900</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">this-&gt;_allowConfirmation &amp;&amp; $</span><span class="sf18b2">this-&gt;_participantId) {</span></code></td>
<td class="ln">910</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">this-&gt;_allowConfirmation &amp;&amp; $</span><span class="sf18b2">this-&gt;_participantId) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">901</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">registerDate = $</span><span class="sf18b2">params[</span><span class="sf12b2">'participant_register_date'</span><span class="sf3b2">];</span></code></td>
<td class="ln">911</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">registerDate = $</span><span class="sf18b2">params[</span><span class="sf12b2">'participant_register_date'</span><span class="sf3b2">];</span></code></td>
</tr>
<tr valign="top">
<td class="ln">902</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">912</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">903</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">elseif</span><span class="sf3b2"> (</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'participant_register_date'<wbr></span><span class="sf3b2">, $</span><span class="sf18b2">params) &amp;&amp;</span></code></td>
<td class="ln">913</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">elseif</span><span class="sf3b2"> (</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'participant_register_date'<wbr></span><span class="sf3b2">, $</span><span class="sf18b2">params) &amp;&amp;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">904</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">is_array</span><span class="sf3b2">($</span><span class="sf18b2">params[</span><span class="sf12b2">'participant_register_date'</span><span class="sf3b2">]) &amp;&amp;</span></code></td>
<td class="ln">914</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">is_array</span><span class="sf3b2">($</span><span class="sf18b2">params[</span><span class="sf12b2">'participant_register_date'</span><span class="sf3b2">]) &amp;&amp;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">905</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;!</span><span class="sf7b2">empty</span><span class="sf3b2">($</span><span class="sf18b2">params[</span><span class="sf12b2">'participant_register_date'</span><span class="sf3b2">])</span></code></td>
<td class="ln">915</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;!</span><span class="sf7b2">empty</span><span class="sf3b2">($</span><span class="sf18b2">params[</span><span class="sf12b2">'participant_register_date'</span><span class="sf3b2">])</span></code></td>
</tr>
<tr valign="top">
<td class="ln">906</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;) {</span></code></td>
<td class="ln">916</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">907</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">registerDate = </span><span class="sf8b2">CRM_Utils_Date::format</span><span class="sf3b2">($</span><span class="sf18b2">params[</span><span class="sf12b2">'participant_registe<wbr>r_date'</span><span class="sf3b2">]);</span></code></td>
<td class="ln">917</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">registerDate = </span><span class="sf8b2">CRM_Utils_Date::format</span><span class="sf3b2">($</span><span class="sf18b2">params[</span><span class="sf12b2">'participant_registe<wbr>r_date'</span><span class="sf3b2">]);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">908</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">918</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">909</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">919</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">920</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; 
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">910</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">participantParams = </span><span class="sf7b2">array</span><span class="sf3b2">(</span><span class="sf12b2">'id'</span><span class="sf3b2"> =&gt; </span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'participant_id'</span><span class="sf3b2">, $</span><span class="sf18b2">params),</span></code></td>
<td class="ln">921</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">participantParams = </span><span class="sf7b2">array</span><span class="sf3b2">(</span><span class="sf12b2">'id'</span><span class="sf3b2"> =&gt; </span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'participant_id'</span><span class="sf3b2">, $</span><span class="sf18b2">params),</span></code></td>
</tr>
<tr valign="top">
<td class="ln">911</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'contact_id'</span><span class="sf3b2"> =&gt; $</span><span class="sf18b2">contactID,</span></code></td>
<td class="ln">922</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'contact_id'</span><span class="sf3b2"> =&gt; $</span><span class="sf18b2">contactID,</span></code></td>
</tr>
<tr valign="top">
<td class="ln">912</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'event_id'</span><span class="sf3b2"> =&gt; $</span><span class="sf18b2">this-&gt;_eventId ? $</span><span class="sf18b2">this-&gt;_eventId : $</span><span class="sf18b2">params[</span><span class="sf12b2">'event_id'</span><span class="sf3b2">],</span></code></td>
<td class="ln">923</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'event_id'</span><span class="sf3b2"> =&gt; $</span><span class="sf18b2">this-&gt;_eventId ? $</span><span class="sf18b2">this-&gt;_eventId : $</span><span class="sf18b2">params[</span><span class="sf12b2">'event_id'</span><span class="sf3b2">],</span></code></td>
</tr>
<tr valign="top">
<td class="ln">913</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'status_id'</span><span class="sf3b2"> =&gt; </span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'participant_status'</span><span class="sf3b2">,</span></code></td>
<td class="ln">924</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'status_id'</span><span class="sf3b2"> =&gt; </span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'participant_status'</span><span class="sf3b2">,</span></code></td>
</tr>
<tr valign="top">
<td class="ln">914</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">params, </span><span class="sf10b2">1</span></code></td>
<td class="ln">925</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">params, </span><span class="sf10b2">1</span></code></td>
</tr>
<tr valign="top">
<td class="ln">915</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;),</span></code></td>
<td class="ln">926</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;),</span></code></td>
</tr>
<tr valign="top">
<td class="ln">916</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'role_id'</span><span class="sf3b2"> =&gt; </span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'participant_role_id'</span><span class="sf3b2">,</span></code></td>
<td class="ln">927</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'role_id'</span><span class="sf3b2"> =&gt; </span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'participant_role_id'</span><span class="sf3b2">,</span></code></td>
</tr>
<tr valign="top">
<td class="ln">917</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">params, $roleID</span></code></td>
<td class="ln">928</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">params, $roleID</span></code></td>
</tr>
<tr valign="top">
<td class="ln">918</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;),</span></code></td>
<td class="ln">929</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;),</span></code></td>
</tr>
<tr valign="top">
<td class="ln">919</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'register_date'</span><span class="sf3b2"> =&gt; ($</span><span class="sf18b2">registerDate) ? $</span><span class="sf18b2">registerDate : </span><span class="sf8b2">date</span><span class="sf3b2">(</span><span class="sf12b2">'YmdHis'</span><span class="sf3b2">),</span></code></td>
<td class="ln">930</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'register_date'</span><span class="sf3b2"> =&gt; ($</span><span class="sf18b2">registerDate) ? $</span><span class="sf18b2">registerDate : </span><span class="sf8b2">date</span><span class="sf3b2">(</span><span class="sf12b2">'YmdHis'</span><span class="sf3b2">),</span></code></td>
</tr>
<tr valign="top">
<td class="ln">920</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'source'</span><span class="sf3b2"> =&gt; </span><span class="sf7b2">isset</span><span class="sf3b2">($</span><span class="sf18b2">params[</span><span class="sf12b2">'participant_source'</span><span class="sf3b2">]) ?</span></code></td>
<td class="ln">931</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'source'</span><span class="sf3b2"> =&gt; </span><span class="sf7b2">isset</span><span class="sf3b2">($</span><span class="sf18b2">params[</span><span class="sf12b2">'participant_source'</span><span class="sf3b2">]) ?</span></code></td>
</tr>
<tr valign="top">
<td class="ln">921</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'participant_source'</span><span class="sf3b2">, $</span><span class="sf18b2">params) : </span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'description'</span><span class="sf3b2">, $</span><span class="sf18b2">params),</span></code></td>
<td class="ln">932</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'participant_source'</span><span class="sf3b2">, $</span><span class="sf18b2">params) : </span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'description'</span><span class="sf3b2">, $</span><span class="sf18b2">params),</span></code></td>
</tr>
<tr valign="top">
<td class="ln">922</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'fee_level'</span><span class="sf3b2"> =&gt; </span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'amount_level'</span><span class="sf3b2">, $</span><span class="sf18b2">params),</span></code></td>
<td class="ln">933</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'fee_level'</span><span class="sf3b2"> =&gt; </span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'amount_level'</span><span class="sf3b2">, $</span><span class="sf18b2">params),</span></code></td>
</tr>
<tr valign="top">
<td class="ln">923</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'is_pay_later'</span><span class="sf3b2"> =&gt; </span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'is_pay_later'</span><span class="sf3b2">, $</span><span class="sf18b2">params, </span><span class="sf10b2">0</span><span class="sf3b2">),</span></code></td>
<td class="ln">934</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'is_pay_later'</span><span class="sf3b2"> =&gt; </span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'is_pay_later'</span><span class="sf3b2">, $</span><span class="sf18b2">params, </span><span class="sf10b2">0</span><span class="sf3b2">),</span></code></td>
</tr>
<tr valign="top">
<td class="ln">924</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'fee_amount'</span><span class="sf3b2"> =&gt; </span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'fee_amount'</span><span class="sf3b2">, $</span><span class="sf18b2">params),</span></code></td>
<td class="ln">935</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'fee_amount'</span><span class="sf3b2"> =&gt; </span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'fee_amount'</span><span class="sf3b2">, $</span><span class="sf18b2">params),</span></code></td>
</tr>
<tr valign="top">
<td class="ln">925</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'registered_by_id'</span><span class="sf3b2"> =&gt; </span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'registered_by_id'</span><span class="sf3b2">, $</span><span class="sf18b2">params),</span></code></td>
<td class="ln">936</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'registered_by_id'</span><span class="sf3b2"> =&gt; </span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'registered_by_id'</span><span class="sf3b2">, $</span><span class="sf18b2">params),</span></code></td>
</tr>
<tr valign="top">
<td class="ln">926</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'discount_id'</span><span class="sf3b2"> =&gt; </span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'discount_id'</span><span class="sf3b2">, $</span><span class="sf18b2">params),</span></code></td>
<td class="ln">937</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'discount_id'</span><span class="sf3b2"> =&gt; </span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'discount_id'</span><span class="sf3b2">, $</span><span class="sf18b2">params),</span></code></td>
</tr>
<tr valign="top">
<td class="ln">927</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'fee_currency'</span><span class="sf3b2"> =&gt; </span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'currencyID'</span><span class="sf3b2">, $</span><span class="sf18b2">params),</span></code></td>
<td class="ln">938</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'fee_currency'</span><span class="sf3b2"> =&gt; </span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'currencyID'</span><span class="sf3b2">, $</span><span class="sf18b2">params),</span></code></td>
</tr>
<tr valign="top">
<td class="ln">928</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'campaign_id'</span><span class="sf3b2"> =&gt; </span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'campaign_id'</span><span class="sf3b2">, $</span><span class="sf18b2">params),</span></code></td>
<td class="ln">939</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'campaign_id'</span><span class="sf3b2"> =&gt; </span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'campaign_id'</span><span class="sf3b2">, $</span><span class="sf18b2">params),</span></code></td>
</tr>
<tr valign="top">
<td class="ln">929</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;);</span></code></td>
<td class="ln">940</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">930</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">941</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">931</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">_action &amp; CRM_Core_Action::PREVIEW || CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'mode'</span><span class="sf3b2">, $</span><span class="sf18b2">params) == </span><span class="sf12b2">'test'</span><span class="sf3b2">) {</span></code></td>
<td class="ln">942</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">_action &amp; CRM_Core_Action::PREVIEW || CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'mode'</span><span class="sf3b2">, $</span><span class="sf18b2">params) == </span><span class="sf12b2">'test'</span><span class="sf3b2">) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">932</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">participantParams[</span><span class="sf12b2">'is_test'</span><span class="sf3b2">] = </span><span class="sf10b2">1</span><span class="sf3b2">;</span></code></td>
<td class="ln">943</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">participantParams[</span><span class="sf12b2">'is_test'</span><span class="sf3b2">] = </span><span class="sf10b2">1</span><span class="sf3b2">;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">933</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">944</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">934</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">else</span><span class="sf3b2"> {</span></code></td>
<td class="ln">945</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">else</span><span class="sf3b2"> {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">935</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">participantParams[</span><span class="sf12b2">'is_test'</span><span class="sf3b2">] = </span><span class="sf10b2">0</span><span class="sf3b2">;</span></code></td>
<td class="ln">946</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">participantParams[</span><span class="sf12b2">'is_test'</span><span class="sf3b2">] = </span><span class="sf10b2">0</span><span class="sf3b2">;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">936</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">947</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">937</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">948</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">938</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'note'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_params)) {</span></code></td>
<td class="ln">949</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'note'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_params)) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">939</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">participantParams[</span><span class="sf12b2">'note'</span><span class="sf3b2">] = $</span><span class="sf18b2">this-&gt;_params[</span><span class="sf12b2">'note'</span><span class="sf3b2">];</span></code></td>
<td class="ln">950</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">participantParams[</span><span class="sf12b2">'note'</span><span class="sf3b2">] = $</span><span class="sf18b2">this-&gt;_params[</span><span class="sf12b2">'note'</span><span class="sf3b2">];</span></code></td>
</tr>
<tr valign="top">
<td class="ln">940</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">951</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">941</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">elseif</span><span class="sf3b2"> (</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'participant_note'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_params)) {</span></code></td>
<td class="ln">952</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">elseif</span><span class="sf3b2"> (</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'participant_note'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_params)) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">942</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">participantParams[</span><span class="sf12b2">'note'</span><span class="sf3b2">] = $</span><span class="sf18b2">this-&gt;_params[</span><span class="sf12b2">'participant_note'</span><span class="sf3b2">];</span></code></td>
<td class="ln">953</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">participantParams[</span><span class="sf12b2">'note'</span><span class="sf3b2">] = $</span><span class="sf18b2">this-&gt;_params[</span><span class="sf12b2">'participant_note'</span><span class="sf3b2">];</span></code></td>
</tr>
<tr valign="top">
<td class="ln">943</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">954</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">944</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16">
</span>&nbsp;</code></td>
<td class="ln">955</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp;
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">956</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp;</span><span class="sf17b16">//BOT - Unset amount for Payer not attending participant
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">957</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp;$</span><span class="sf17b16">statuses = </span><span class="sf17b16">CRM_Event_PseudoConstant::participantStatus</span><span class="sf17b16">();
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">958</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp;$</span><span class="sf17b16">payerNotAttendingStatusId = </span><span class="sf17b16">array_search</span><span class="sf17b16">( </span><span class="sf17b16">'Payer not attending'</span><span class="sf17b16">, $</span><span class="sf17b16">statuses );
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">959</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp;</span><span class="sf17b16">if</span><span class="sf17b16"> ( $</span><span class="sf17b16">payerNotAttendingStatusId == $</span><span class="sf17b16">participantParams[</span><span class="sf17b16">'status_id'</span><span class="sf17b16">] ) {
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">960</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp;</span><span class="sf17b16">unset</span><span class="sf17b16">($</span><span class="sf17b16">participantParams[</span><span class="sf17b16">'fee_amount'</span><span class="sf17b16">]);
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">961</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp;}
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">945</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// reuse id if one already exists for this one (can happen</span></code></td>
<td class="ln">962</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// reuse id if one already exists for this one (can happen</span></code></td>
</tr>
<tr valign="top">
<td class="ln">946</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// with back button being hit etc)</span></code></td>
<td class="ln">963</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// with back button being hit etc)</span></code></td>
</tr>
<tr valign="top">
<td class="ln">947</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!$</span><span class="sf18b2">participantParams[</span><span class="sf12b2">'id'</span><span class="sf3b2">] &amp;&amp;</span></code></td>
<td class="ln">964</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!$</span><span class="sf18b2">participantParams[</span><span class="sf12b2">'id'</span><span class="sf3b2">] &amp;&amp;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">948</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'contributionID'</span><span class="sf3b2">, $</span><span class="sf18b2">params)</span></code></td>
<td class="ln">965</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'contributionID'</span><span class="sf3b2">, $</span><span class="sf18b2">params)</span></code></td>
</tr>
<tr valign="top">
<td class="ln">949</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;) {</span></code></td>
<td class="ln">966</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">950</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">pID = </span><span class="sf8b2">CRM_Core_DAO::getFieldValue</span><span class="sf3b2">(</span><span class="sf12b2">'CRM_Event_DAO_Particip<wbr>antPayment'</span><span class="sf3b2">,</span></code></td>
<td class="ln">967</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">pID = </span><span class="sf8b2">CRM_Core_DAO::getFieldValue</span><span class="sf3b2">(</span><span class="sf12b2">'CRM_Event_DAO_Particip<wbr>antPayment'</span><span class="sf3b2">,</span></code></td>
</tr>
<tr valign="top">
<td class="ln">951</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">params[</span><span class="sf12b2">'contributionID'</span><span class="sf3b2">],</span></code></td>
<td class="ln">968</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">params[</span><span class="sf12b2">'contributionID'</span><span class="sf3b2">],</span></code></td>
</tr>
<tr valign="top">
<td class="ln">952</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'participant_id'</span><span class="sf3b2">,</span></code></td>
<td class="ln">969</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'participant_id'</span><span class="sf3b2">,</span></code></td>
</tr>
<tr valign="top">
<td class="ln">953</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'contribution_id'</span>&nbsp;</code></td>
<td class="ln">970</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'contribution_id'</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">954</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;);</span></code></td>
<td class="ln">971</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">955</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">participantParams[</span><span class="sf12b2">'id'</span><span class="sf3b2">] = $</span><span class="sf18b2">pID;</span></code></td>
<td class="ln">972</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">participantParams[</span><span class="sf12b2">'id'</span><span class="sf3b2">] = $</span><span class="sf18b2">pID;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">956</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">973</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">957</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">participantParams[</span><span class="sf12b2">'discount_id'</span><span class="sf3b2">] = </span><span class="sf8b2">CRM_Core_BAO_Discount::findSet</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;_eventId, </span><span class="sf12b2">'civicrm_event'</span><span class="sf3b2">);</span></code></td>
<td class="ln">974</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">participantParams[</span><span class="sf12b2">'discount_id'</span><span class="sf3b2">] = </span><span class="sf8b2">CRM_Core_BAO_Discount::findSet</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;_eventId, </span><span class="sf12b2">'civicrm_event'</span><span class="sf3b2">);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">958</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">975</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">959</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!$</span><span class="sf18b2">participantParams[</span><span class="sf12b2">'discount_id'</span><span class="sf3b2">]) {</span></code></td>
<td class="ln">976</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!$</span><span class="sf18b2">participantParams[</span><span class="sf12b2">'discount_id'</span><span class="sf3b2">]) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">960</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">participantParams[</span><span class="sf12b2">'discount_id'</span><span class="sf3b2">] = </span><span class="sf12b2">"null"</span><span class="sf3b2">;</span></code></td>
<td class="ln">977</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">participantParams[</span><span class="sf12b2">'discount_id'</span><span class="sf3b2">] = </span><span class="sf12b2">"null"</span><span class="sf3b2">;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">961</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">978</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">962</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">979</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">963</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">participant = </span><span class="sf8b2">CRM_Event_BAO_Participant::create</span><span class="sf3b2">($</span><span class="sf18b2">participantParam<wbr>s);</span></code></td>
<td class="ln">980</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">participant = </span><span class="sf8b2">CRM_Event_BAO_Participant::create</span><span class="sf3b2">($</span><span class="sf18b2">participantParam<wbr>s);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">964</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16">
</span>&nbsp;</code></td>
<td class="ln">981</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp;
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">965</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">transaction-&gt;</span><span class="sf8b2">commit</span><span class="sf3b2">();</span></code></td>
<td class="ln">982</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">transaction-&gt;</span><span class="sf8b2">commit</span><span class="sf3b2">();</span></code></td>
</tr>
<tr valign="top">
<td class="ln">966</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">983</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">967</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">return</span><span class="sf3b2"> $</span><span class="sf18b2">participant;</span></code></td>
<td class="ln">984</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">return</span><span class="sf3b2"> $</span><span class="sf18b2">participant;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">968</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;}</span></code></td>
<td class="ln">985</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">969</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">986</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">970</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf9b2">/* Calculate the total participant count as per params.</span></code></td>
<td class="ln">987</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf9b2">/* Calculate the total participant count as per params.</span></code></td>
</tr>
<tr valign="top">
<td class="ln">971</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; &nbsp; *</span></code></td>
<td class="ln">988</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; &nbsp; *</span></code></td>
</tr>
<tr valign="top">
<td class="ln">972</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; &nbsp; * @param &nbsp;array $params user params.</span></code></td>
<td class="ln">989</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; &nbsp; * @param &nbsp;array $params user params.</span></code></td>
</tr>
<tr valign="top">
<td class="ln">973</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; &nbsp; *</span></code></td>
<td class="ln">990</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; &nbsp; *</span></code></td>
</tr>
<tr valign="top">
<td class="ln">974</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; &nbsp; * @return $totalCount total participant count.</span></code></td>
<td class="ln">991</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; &nbsp; * @return $totalCount total participant count.</span></code></td>
</tr>
<tr valign="top">
<td class="ln">975</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; &nbsp; * @access public</span></code></td>
<td class="ln">992</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; &nbsp; * @access public</span></code></td>
</tr>
<tr valign="top">
<td class="ln">976</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; &nbsp; */</span>&nbsp;</code></td>
<td class="ln">993</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; &nbsp; */</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">977</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">994</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">978</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf8b2">public function getParticipantCount</span><span class="sf3b2">(&amp;$</span><span class="sf18b2">form, $</span><span class="sf18b2">params, $</span><span class="sf18b2">skipCurrent = FALSE) {</span></code></td>
<td class="ln">995</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf8b2">public function getParticipantCount</span><span class="sf3b2">(&amp;$</span><span class="sf18b2">form, $</span><span class="sf18b2">params, $</span><span class="sf18b2">skipCurrent = FALSE) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">979</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">totalCount = </span><span class="sf10b2">0</span><span class="sf3b2">;</span></code></td>
<td class="ln">996</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">totalCount = </span><span class="sf10b2">0</span><span class="sf3b2">;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">980</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!</span><span class="sf8b2">is_array</span><span class="sf3b2">($</span><span class="sf18b2">params) || </span><span class="sf7b2">empty</span><span class="sf3b2">($</span><span class="sf18b2">params)) {</span></code></td>
<td class="ln">997</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!</span><span class="sf8b2">is_array</span><span class="sf3b2">($</span><span class="sf18b2">params) || </span><span class="sf7b2">empty</span><span class="sf3b2">($</span><span class="sf18b2">params)) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">981</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">return</span><span class="sf3b2"> $</span><span class="sf18b2">totalCount;</span></code></td>
<td class="ln">998</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">return</span><span class="sf3b2"> $</span><span class="sf18b2">totalCount;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">982</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">999</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">983</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1000</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">984</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">priceSetId &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;= $</span><span class="sf18b2">form-&gt;</span><span class="sf8b2">get</span><span class="sf3b2">(</span><span class="sf12b2">'priceSetId'</span><span class="sf3b2">);</span></code></td>
<td class="ln">1001</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">priceSetId &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;= $</span><span class="sf18b2">form-&gt;</span><span class="sf8b2">get</span><span class="sf3b2">(</span><span class="sf12b2">'priceSetId'</span><span class="sf3b2">);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">985</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">addParticipantNum &nbsp; = </span><span class="sf8b2">substr</span><span class="sf3b2">($</span><span class="sf18b2">form-&gt;_name, 12);</span></code></td>
<td class="ln">1002</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">addParticipantNum &nbsp; = </span><span class="sf8b2">substr</span><span class="sf3b2">($</span><span class="sf18b2">form-&gt;_name, 12);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">986</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">priceSetFields &nbsp; &nbsp; &nbsp;= $</span><span class="sf18b2">priceSetDetails = </span><span class="sf7b2">array</span><span class="sf3b2">();</span></code></td>
<td class="ln">1003</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">priceSetFields &nbsp; &nbsp; &nbsp;= $</span><span class="sf18b2">priceSetDetails = </span><span class="sf7b2">array</span><span class="sf3b2">();</span></code></td>
</tr>
<tr valign="top">
<td class="ln">987</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">hasPriceFieldsCount = FALSE;</span></code></td>
<td class="ln">1004</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">hasPriceFieldsCount = FALSE;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">988</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">priceSetId) {</span></code></td>
<td class="ln">1005</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">priceSetId) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">989</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">priceSetDetails = $</span><span class="sf18b2">form-&gt;</span><span class="sf8b2">get</span><span class="sf3b2">(</span><span class="sf12b2">'priceSet'</span><span class="sf3b2">);</span></code></td>
<td class="ln">1006</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">priceSetDetails = $</span><span class="sf18b2">form-&gt;</span><span class="sf8b2">get</span><span class="sf3b2">(</span><span class="sf12b2">'priceSet'</span><span class="sf3b2">);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">990</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf7b2">isset</span><span class="sf3b2">($</span><span class="sf18b2">priceSetDetails[</span><span class="sf12b2">'optionsCountTotal'</span><span class="sf3b2">])</span></code></td>
<td class="ln">1007</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf7b2">isset</span><span class="sf3b2">($</span><span class="sf18b2">priceSetDetails[</span><span class="sf12b2">'optionsCountTotal'</span><span class="sf3b2">])</span></code></td>
</tr>
<tr valign="top">
<td class="ln">991</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;&amp;&amp; $</span><span class="sf18b2">priceSetDetails[</span><span class="sf12b2">'optionsCountTotal'</span><span class="sf3b2">]</span></code></td>
<td class="ln">1008</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;&amp;&amp; $</span><span class="sf18b2">priceSetDetails[</span><span class="sf12b2">'optionsCountTotal'</span><span class="sf3b2">]</span></code></td>
</tr>
<tr valign="top">
<td class="ln">992</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;) {</span></code></td>
<td class="ln">1009</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">993</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">hasPriceFieldsCount = TRUE;</span></code></td>
<td class="ln">1010</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">hasPriceFieldsCount = TRUE;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">994</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">priceSetFields = $</span><span class="sf18b2">priceSetDetails[</span><span class="sf12b2">'optionsCountDetails'</span><span class="sf3b2">][</span><span class="sf12b2">'fields'</span><span class="sf3b2">];</span></code></td>
<td class="ln">1011</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">priceSetFields = $</span><span class="sf18b2">priceSetDetails[</span><span class="sf12b2">'optionsCountDetails'</span><span class="sf3b2">][</span><span class="sf12b2">'fields'</span><span class="sf3b2">];</span></code></td>
</tr>
<tr valign="top">
<td class="ln">995</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">1012</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">996</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">1013</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">997</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1014</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">998</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">singleFormParams = FALSE;</span></code></td>
<td class="ln">1015</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">singleFormParams = FALSE;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">999</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">foreach</span><span class="sf3b2"> ($</span><span class="sf18b2">params </span><span class="sf7b2">as</span><span class="sf3b2"> $</span><span class="sf18b2">key =&gt; $</span><span class="sf18b2">val) {</span></code></td>
<td class="ln">1016</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">foreach</span><span class="sf3b2"> ($</span><span class="sf18b2">params </span><span class="sf7b2">as</span><span class="sf3b2"> $</span><span class="sf18b2">key =&gt; $</span><span class="sf18b2">val) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1000</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!</span><span class="sf8b2">is_numeric</span><span class="sf3b2">($</span><span class="sf18b2">key)) {</span></code></td>
<td class="ln">1017</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!</span><span class="sf8b2">is_numeric</span><span class="sf3b2">($</span><span class="sf18b2">key)) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1001</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">singleFormParams = TRUE;</span></code></td>
<td class="ln">1018</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">singleFormParams = TRUE;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1002</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">break</span><span class="sf3b2">;</span></code></td>
<td class="ln">1019</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">break</span><span class="sf3b2">;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1003</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">1020</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1004</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">1021</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1005</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1022</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">1006</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">//first format the params.</span></code></td>
<td class="ln">1023</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">//first format the params.</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1007</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">singleFormParams) {</span></code></td>
<td class="ln">1024</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">singleFormParams) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1008</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">params = </span><span class="sf8b2">self::formatPriceSetParams</span><span class="sf3b2">($</span><span class="sf18b2">form, $</span><span class="sf18b2">params);</span></code></td>
<td class="ln">1025</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">params = </span><span class="sf8b2">self::formatPriceSetParams</span><span class="sf3b2">($</span><span class="sf18b2">form, $</span><span class="sf18b2">params);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1009</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">params = </span><span class="sf7b2">array</span><span class="sf3b2">($</span><span class="sf18b2">params);</span></code></td>
<td class="ln">1026</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">params = </span><span class="sf7b2">array</span><span class="sf3b2">($</span><span class="sf18b2">params);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1010</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">1027</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1011</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1028</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">1012</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">foreach</span><span class="sf3b2"> ($</span><span class="sf18b2">params </span><span class="sf7b2">as</span><span class="sf3b2"> $</span><span class="sf18b2">key =&gt; $</span><span class="sf18b2">values) {</span></code></td>
<td class="ln">1029</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">foreach</span><span class="sf3b2"> ($</span><span class="sf18b2">params </span><span class="sf7b2">as</span><span class="sf3b2"> $</span><span class="sf18b2">key =&gt; $</span><span class="sf18b2">values) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1013</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!</span><span class="sf8b2">is_numeric</span><span class="sf3b2">($</span><span class="sf18b2">key) ||</span></code></td>
<td class="ln">1030</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!</span><span class="sf8b2">is_numeric</span><span class="sf3b2">($</span><span class="sf18b2">key) ||</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1014</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">values == </span><span class="sf12b2">'skip'</span><span class="sf3b2"> ||</span></code></td>
<td class="ln">1031</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">values == </span><span class="sf12b2">'skip'</span><span class="sf3b2"> ||</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1015</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;($</span><span class="sf18b2">skipCurrent &amp;&amp; ($</span><span class="sf18b2">addParticipantNum == $</span><span class="sf18b2">key))</span></code></td>
<td class="ln">1032</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;($</span><span class="sf18b2">skipCurrent &amp;&amp; ($</span><span class="sf18b2">addParticipantNum == $</span><span class="sf18b2">key))</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1016</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;) {</span></code></td>
<td class="ln">1033</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1017</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">continue</span><span class="sf3b2">;</span></code></td>
<td class="ln">1034</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">continue</span><span class="sf3b2">;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1018</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">1035</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1019</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">count = </span><span class="sf10b2">1</span><span class="sf3b2">;</span></code></td>
<td class="ln">1036</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">count = </span><span class="sf10b2">1</span><span class="sf3b2">;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1020</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1037</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">1021</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">usedCache = FALSE;</span></code></td>
<td class="ln">1038</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">usedCache = FALSE;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1022</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">cacheCount = </span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">($</span><span class="sf18b2">key, $</span><span class="sf18b2">form-&gt;_lineItemParticipantsCount);</span></code></td>
<td class="ln">1039</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">cacheCount = </span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">($</span><span class="sf18b2">key, $</span><span class="sf18b2">form-&gt;_lineItemParticipantsCount);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1023</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">cacheCount &amp;&amp; </span><span class="sf8b2">is_numeric</span><span class="sf3b2">($</span><span class="sf18b2">cacheCount)) {</span></code></td>
<td class="ln">1040</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">cacheCount &amp;&amp; </span><span class="sf8b2">is_numeric</span><span class="sf3b2">($</span><span class="sf18b2">cacheCount)) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1024</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">count = $</span><span class="sf18b2">cacheCount;</span></code></td>
<td class="ln">1041</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">count = $</span><span class="sf18b2">cacheCount;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1025</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">usedCache = TRUE;</span></code></td>
<td class="ln">1042</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">usedCache = TRUE;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1026</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">1043</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1027</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1044</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">1028</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!$</span><span class="sf18b2">usedCache &amp;&amp; $</span><span class="sf18b2">hasPriceFieldsCount) {</span></code></td>
<td class="ln">1045</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!$</span><span class="sf18b2">usedCache &amp;&amp; $</span><span class="sf18b2">hasPriceFieldsCount) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1029</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">count = </span><span class="sf10b2">0</span><span class="sf3b2">;</span></code></td>
<td class="ln">1046</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">count = </span><span class="sf10b2">0</span><span class="sf3b2">;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1030</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">foreach</span><span class="sf3b2"> ($</span><span class="sf18b2">values </span><span class="sf7b2">as</span><span class="sf3b2"> $</span><span class="sf18b2">valKey =&gt; $</span><span class="sf18b2">value) {</span></code></td>
<td class="ln">1047</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">foreach</span><span class="sf3b2"> ($</span><span class="sf18b2">values </span><span class="sf7b2">as</span><span class="sf3b2"> $</span><span class="sf18b2">valKey =&gt; $</span><span class="sf18b2">value) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1031</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">strpos</span><span class="sf3b2">($</span><span class="sf18b2">valKey, </span><span class="sf12b2">'price_'</span><span class="sf3b2">) === FALSE) {</span></code></td>
<td class="ln">1048</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">strpos</span><span class="sf3b2">($</span><span class="sf18b2">valKey, </span><span class="sf12b2">'price_'</span><span class="sf3b2">) === FALSE) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1032</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">continue</span><span class="sf3b2">;</span></code></td>
<td class="ln">1049</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">continue</span><span class="sf3b2">;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1033</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">1050</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1034</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">priceFieldId = </span><span class="sf8b2">substr</span><span class="sf3b2">($</span><span class="sf18b2">valKey, </span><span class="sf10b2">6</span><span class="sf3b2">);</span></code></td>
<td class="ln">1051</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">priceFieldId = </span><span class="sf8b2">substr</span><span class="sf3b2">($</span><span class="sf18b2">valKey, </span><span class="sf10b2">6</span><span class="sf3b2">);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1035</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!$</span><span class="sf18b2">priceFieldId ||</span></code></td>
<td class="ln">1052</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!$</span><span class="sf18b2">priceFieldId ||</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1036</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;!</span><span class="sf8b2">is_array</span><span class="sf3b2">($</span><span class="sf18b2">value) ||</span></code></td>
<td class="ln">1053</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;!</span><span class="sf8b2">is_array</span><span class="sf3b2">($</span><span class="sf18b2">value) ||</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1037</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;!</span><span class="sf8b2">array_key_exists</span><span class="sf3b2">($</span><span class="sf18b2">priceFieldId, $</span><span class="sf18b2">priceSetFields)</span></code></td>
<td class="ln">1054</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;!</span><span class="sf8b2">array_key_exists</span><span class="sf3b2">($</span><span class="sf18b2">priceFieldId, $</span><span class="sf18b2">priceSetFields)</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1038</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;) {</span></code></td>
<td class="ln">1055</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1039</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">continue</span><span class="sf3b2">;</span></code></td>
<td class="ln">1056</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">continue</span><span class="sf3b2">;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1040</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">1057</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1041</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">foreach</span><span class="sf3b2"> ($</span><span class="sf18b2">value </span><span class="sf7b2">as</span><span class="sf3b2"> $</span><span class="sf18b2">optId =&gt; $</span><span class="sf18b2">optVal) {</span></code></td>
<td class="ln">1058</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">foreach</span><span class="sf3b2"> ($</span><span class="sf18b2">value </span><span class="sf7b2">as</span><span class="sf3b2"> $</span><span class="sf18b2">optId =&gt; $</span><span class="sf18b2">optVal) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1042</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">currentCount = $</span><span class="sf18b2">priceSetFields[$</span><span class="sf18b2">priceFieldId][</span><span class="sf12b2">'options'</span><span class="sf3b2">][$</span><span class="sf18b2">optId] * $</span><span class="sf18b2">optVal;</span></code></td>
<td class="ln">1059</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">currentCount = $</span><span class="sf18b2">priceSetFields[$</span><span class="sf18b2">priceFieldId][</span><span class="sf12b2">'options'</span><span class="sf3b2">][$</span><span class="sf18b2">optId] * $</span><span class="sf18b2">optVal;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1043</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">currentCount) {</span></code></td>
<td class="ln">1060</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">currentCount) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1044</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">count += $</span><span class="sf18b2">currentCount;</span></code></td>
<td class="ln">1061</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">count += $</span><span class="sf18b2">currentCount;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1045</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">1062</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1046</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">1063</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1047</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">1064</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1048</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!$</span><span class="sf18b2">count) {</span></code></td>
<td class="ln">1065</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!$</span><span class="sf18b2">count) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1049</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">count = </span><span class="sf10b2">1</span><span class="sf3b2">;</span></code></td>
<td class="ln">1066</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">count = </span><span class="sf10b2">1</span><span class="sf3b2">;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1050</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">1067</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1051</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">1068</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1052</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">totalCount += $</span><span class="sf18b2">count;</span></code></td>
<td class="ln">1069</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">totalCount += $</span><span class="sf18b2">count;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1053</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">1070</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1054</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!$</span><span class="sf18b2">totalCount) {</span></code></td>
<td class="ln">1071</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!$</span><span class="sf18b2">totalCount) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1055</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">totalCount = </span><span class="sf10b2">1</span><span class="sf3b2">;</span></code></td>
<td class="ln">1072</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">totalCount = </span><span class="sf10b2">1</span><span class="sf3b2">;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1056</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">1073</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1057</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1074</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">1058</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">return</span><span class="sf3b2"> $</span><span class="sf18b2">totalCount;</span></code></td>
<td class="ln">1075</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">return</span><span class="sf3b2"> $</span><span class="sf18b2">totalCount;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1059</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;}</span></code></td>
<td class="ln">1076</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1060</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1077</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">1061</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf9b2">/* Format user submitted price set params.</span></code></td>
<td class="ln">1078</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf9b2">/* Format user submitted price set params.</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1062</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; &nbsp; * Convert price set each param as an array.</span></code></td>
<td class="ln">1079</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; &nbsp; * Convert price set each param as an array.</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1063</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; &nbsp; *</span></code></td>
<td class="ln">1080</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; &nbsp; *</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1064</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; &nbsp; * @param $params an array of user submitted params.</span></code></td>
<td class="ln">1081</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; &nbsp; * @param $params an array of user submitted params.</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1065</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; &nbsp; *</span></code></td>
<td class="ln">1082</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; &nbsp; *</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1066</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; &nbsp; *</span></code></td>
<td class="ln">1083</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; &nbsp; *</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1067</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; &nbsp; * @return array $formatted, formatted price set params.</span></code></td>
<td class="ln">1084</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; &nbsp; * @return array $formatted, formatted price set params.</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1068</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; &nbsp; * @access public</span></code></td>
<td class="ln">1085</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; &nbsp; * @access public</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1069</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; &nbsp; */</span>&nbsp;</code></td>
<td class="ln">1086</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; &nbsp; */</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">1070</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1087</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">1071</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf8b2">public function formatPriceSetParams</span><span class="sf3b2">(&amp;$</span><span class="sf18b2">form, $</span><span class="sf18b2">params) {</span></code></td>
<td class="ln">1088</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf8b2">public function formatPriceSetParams</span><span class="sf3b2">(&amp;$</span><span class="sf18b2">form, $</span><span class="sf18b2">params) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1072</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!</span><span class="sf8b2">is_array</span><span class="sf3b2">($</span><span class="sf18b2">params) || </span><span class="sf7b2">empty</span><span class="sf3b2">($</span><span class="sf18b2">params)) {</span></code></td>
<td class="ln">1089</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!</span><span class="sf8b2">is_array</span><span class="sf3b2">($</span><span class="sf18b2">params) || </span><span class="sf7b2">empty</span><span class="sf3b2">($</span><span class="sf18b2">params)) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1073</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">return</span><span class="sf3b2"> $</span><span class="sf18b2">params;</span></code></td>
<td class="ln">1090</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">return</span><span class="sf3b2"> $</span><span class="sf18b2">params;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1074</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">1091</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1075</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1092</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">1076</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">priceSetId = $</span><span class="sf18b2">form-&gt;</span><span class="sf8b2">get</span><span class="sf3b2">(</span><span class="sf12b2">'priceSetId'</span><span class="sf3b2">);</span></code></td>
<td class="ln">1093</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">priceSetId = $</span><span class="sf18b2">form-&gt;</span><span class="sf8b2">get</span><span class="sf3b2">(</span><span class="sf12b2">'priceSetId'</span><span class="sf3b2">);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1077</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!$</span><span class="sf18b2">priceSetId) {</span></code></td>
<td class="ln">1094</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!$</span><span class="sf18b2">priceSetId) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1078</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">return</span><span class="sf3b2"> $</span><span class="sf18b2">params;</span></code></td>
<td class="ln">1095</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">return</span><span class="sf3b2"> $</span><span class="sf18b2">params;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1079</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">1096</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1080</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">priceSetDetails = $</span><span class="sf18b2">form-&gt;</span><span class="sf8b2">get</span><span class="sf3b2">(</span><span class="sf12b2">'priceSet'</span><span class="sf3b2">);</span></code></td>
<td class="ln">1097</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">priceSetDetails = $</span><span class="sf18b2">form-&gt;</span><span class="sf8b2">get</span><span class="sf3b2">(</span><span class="sf12b2">'priceSet'</span><span class="sf3b2">);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1081</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1098</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">1082</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">foreach</span><span class="sf3b2"> ($</span><span class="sf18b2">params </span><span class="sf7b2">as</span><span class="sf3b2"> $</span><span class="sf18b2">key =&gt; &amp; $</span><span class="sf18b2">value) {</span></code></td>
<td class="ln">1099</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">foreach</span><span class="sf3b2"> ($</span><span class="sf18b2">params </span><span class="sf7b2">as</span><span class="sf3b2"> $</span><span class="sf18b2">key =&gt; &amp; $</span><span class="sf18b2">value) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1083</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">vals = </span><span class="sf7b2">array</span><span class="sf3b2">();</span></code></td>
<td class="ln">1100</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">vals = </span><span class="sf7b2">array</span><span class="sf3b2">();</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1084</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">strpos</span><span class="sf3b2">($</span><span class="sf18b2">key, </span><span class="sf12b2">'price_'</span><span class="sf3b2">) !== FALSE) {</span></code></td>
<td class="ln">1101</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">strpos</span><span class="sf3b2">($</span><span class="sf18b2">key, </span><span class="sf12b2">'price_'</span><span class="sf3b2">) !== FALSE) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1085</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">fieldId = </span><span class="sf8b2">substr</span><span class="sf3b2">($</span><span class="sf18b2">key, </span><span class="sf10b2">6</span><span class="sf3b2">);</span></code></td>
<td class="ln">1102</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">fieldId = </span><span class="sf8b2">substr</span><span class="sf3b2">($</span><span class="sf18b2">key, </span><span class="sf10b2">6</span><span class="sf3b2">);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1086</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!</span><span class="sf8b2">array_key_exists</span><span class="sf3b2">($</span><span class="sf18b2">fieldId, $</span><span class="sf18b2">priceSetDetails[</span><span class="sf12b2">'fields'</span><span class="sf3b2">]) ||</span></code></td>
<td class="ln">1103</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!</span><span class="sf8b2">array_key_exists</span><span class="sf3b2">($</span><span class="sf18b2">fieldId, $</span><span class="sf18b2">priceSetDetails[</span><span class="sf12b2">'fields'</span><span class="sf3b2">]) ||</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1087</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">is_array</span><span class="sf3b2">($</span><span class="sf18b2">value) ||</span></code></td>
<td class="ln">1104</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">is_array</span><span class="sf3b2">($</span><span class="sf18b2">value) ||</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1088</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;!$value</span></code></td>
<td class="ln">1105</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;!$value</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1089</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;) {</span></code></td>
<td class="ln">1106</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1090</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">continue</span><span class="sf3b2">;</span></code></td>
<td class="ln">1107</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">continue</span><span class="sf3b2">;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1091</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">1108</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1092</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">field = $</span><span class="sf18b2">priceSetDetails[</span><span class="sf12b2">'fields'</span><span class="sf3b2">][$</span><span class="sf18b2">fieldId];</span></code></td>
<td class="ln">1109</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">field = $</span><span class="sf18b2">priceSetDetails[</span><span class="sf12b2">'fields'</span><span class="sf3b2">][$</span><span class="sf18b2">fieldId];</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1093</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">field[</span><span class="sf12b2">'html_type'</span><span class="sf3b2">] == </span><span class="sf12b2">'Text'</span><span class="sf3b2">) {</span></code></td>
<td class="ln">1110</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">field[</span><span class="sf12b2">'html_type'</span><span class="sf3b2">] == </span><span class="sf12b2">'Text'</span><span class="sf3b2">) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1094</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">fieldOption = </span><span class="sf8b2">current</span><span class="sf3b2">($</span><span class="sf18b2">field[</span><span class="sf12b2">'options'</span><span class="sf3b2">]);</span></code></td>
<td class="ln">1111</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">fieldOption = </span><span class="sf8b2">current</span><span class="sf3b2">($</span><span class="sf18b2">field[</span><span class="sf12b2">'options'</span><span class="sf3b2">]);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1095</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">value = </span><span class="sf7b2">array</span><span class="sf3b2">($</span><span class="sf18b2">fieldOption[</span><span class="sf12b2">'id'</span><span class="sf3b2">] =&gt; $</span><span class="sf18b2">value);</span></code></td>
<td class="ln">1112</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">value = </span><span class="sf7b2">array</span><span class="sf3b2">($</span><span class="sf18b2">fieldOption[</span><span class="sf12b2">'id'</span><span class="sf3b2">] =&gt; $</span><span class="sf18b2">value);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1096</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">1113</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1097</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">else</span><span class="sf3b2"> {</span></code></td>
<td class="ln">1114</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">else</span><span class="sf3b2"> {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1098</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">value = </span><span class="sf7b2">array</span><span class="sf3b2">($</span><span class="sf18b2">value =&gt; TRUE);</span></code></td>
<td class="ln">1115</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">value = </span><span class="sf7b2">array</span><span class="sf3b2">($</span><span class="sf18b2">value =&gt; TRUE);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1099</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">1116</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1100</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">1117</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1101</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">1118</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1102</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1119</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">1103</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">return</span><span class="sf3b2"> $</span><span class="sf18b2">params;</span></code></td>
<td class="ln">1120</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">return</span><span class="sf3b2"> $</span><span class="sf18b2">params;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1104</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;}</span></code></td>
<td class="ln">1121</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1105</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1122</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">1106</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf9b2">/* Calculate total count for each price set options.</span></code></td>
<td class="ln">1123</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf9b2">/* Calculate total count for each price set options.</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1107</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; &nbsp; * those are currently selected by user.</span></code></td>
<td class="ln">1124</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; &nbsp; * those are currently selected by user.</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1108</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; &nbsp; *</span></code></td>
<td class="ln">1125</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; &nbsp; *</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1109</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; &nbsp; * @param $form form object.</span></code></td>
<td class="ln">1126</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; &nbsp; * @param $form form object.</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1110</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; &nbsp; *</span></code></td>
<td class="ln">1127</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; &nbsp; *</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1111</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; &nbsp; *</span></code></td>
<td class="ln">1128</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; &nbsp; *</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1112</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; &nbsp; * @return array $optionsCount, array of each option w/ count total.</span></code></td>
<td class="ln">1129</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; &nbsp; * @return array $optionsCount, array of each option w/ count total.</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1113</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; &nbsp; * @access public</span></code></td>
<td class="ln">1130</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; &nbsp; * @access public</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1114</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; &nbsp; */</span>&nbsp;</code></td>
<td class="ln">1131</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; &nbsp; */</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">1115</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf7b2">function</span><span class="sf3b2"> </span><span class="sf8b2">getPriceSetOptionCount</span><span class="sf3b2">(&amp;$</span><span class="sf18b2">form) {</span></code></td>
<td class="ln">1132</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf7b2">function</span><span class="sf3b2"> </span><span class="sf8b2">getPriceSetOptionCount</span><span class="sf3b2">(&amp;$</span><span class="sf18b2">form) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1116</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">params &nbsp; &nbsp; = $</span><span class="sf18b2">form-&gt;</span><span class="sf8b2">get</span><span class="sf3b2">(</span><span class="sf12b2">'params'</span><span class="sf3b2">);</span></code></td>
<td class="ln">1133</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">params &nbsp; &nbsp; = $</span><span class="sf18b2">form-&gt;</span><span class="sf8b2">get</span><span class="sf3b2">(</span><span class="sf12b2">'params'</span><span class="sf3b2">);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1117</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">priceSet &nbsp; = $</span><span class="sf18b2">form-&gt;</span><span class="sf8b2">get</span><span class="sf3b2">(</span><span class="sf12b2">'priceSet'</span><span class="sf3b2">);</span></code></td>
<td class="ln">1134</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">priceSet &nbsp; = $</span><span class="sf18b2">form-&gt;</span><span class="sf8b2">get</span><span class="sf3b2">(</span><span class="sf12b2">'priceSet'</span><span class="sf3b2">);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1118</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">priceSetId = $</span><span class="sf18b2">form-&gt;</span><span class="sf8b2">get</span><span class="sf3b2">(</span><span class="sf12b2">'priceSetId'</span><span class="sf3b2">);</span></code></td>
<td class="ln">1135</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">priceSetId = $</span><span class="sf18b2">form-&gt;</span><span class="sf8b2">get</span><span class="sf3b2">(</span><span class="sf12b2">'priceSetId'</span><span class="sf3b2">);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1119</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1136</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">1120</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">optionsCount = </span><span class="sf7b2">array</span><span class="sf3b2">();</span></code></td>
<td class="ln">1137</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">optionsCount = </span><span class="sf7b2">array</span><span class="sf3b2">();</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1121</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!$</span><span class="sf18b2">priceSetId ||</span></code></td>
<td class="ln">1138</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!$</span><span class="sf18b2">priceSetId ||</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1122</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;!</span><span class="sf8b2">is_array</span><span class="sf3b2">($</span><span class="sf18b2">priceSet) ||</span></code></td>
<td class="ln">1139</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;!</span><span class="sf8b2">is_array</span><span class="sf3b2">($</span><span class="sf18b2">priceSet) ||</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1123</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">empty</span><span class="sf3b2">($</span><span class="sf18b2">priceSet) ||</span></code></td>
<td class="ln">1140</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">empty</span><span class="sf3b2">($</span><span class="sf18b2">priceSet) ||</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1124</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;!</span><span class="sf8b2">is_array</span><span class="sf3b2">($</span><span class="sf18b2">params) ||</span></code></td>
<td class="ln">1141</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;!</span><span class="sf8b2">is_array</span><span class="sf3b2">($</span><span class="sf18b2">params) ||</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1125</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">empty</span><span class="sf3b2">($</span><span class="sf18b2">params)</span></code></td>
<td class="ln">1142</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">empty</span><span class="sf3b2">($</span><span class="sf18b2">params)</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1126</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;) {</span></code></td>
<td class="ln">1143</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1127</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">return</span><span class="sf3b2"> $</span><span class="sf18b2">optionsCount;</span></code></td>
<td class="ln">1144</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">return</span><span class="sf3b2"> $</span><span class="sf18b2">optionsCount;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1128</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">1145</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1129</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1146</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">1130</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">priceSetFields = $</span><span class="sf18b2">priceMaxFieldDetails = </span><span class="sf7b2">array</span><span class="sf3b2">();</span></code></td>
<td class="ln">1147</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">priceSetFields = $</span><span class="sf18b2">priceMaxFieldDetails = </span><span class="sf7b2">array</span><span class="sf3b2">();</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1131</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'optionsCountTotal'</span><span class="sf3b2">, $</span><span class="sf18b2">priceSet)) {</span></code></td>
<td class="ln">1148</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'optionsCountTotal'</span><span class="sf3b2">, $</span><span class="sf18b2">priceSet)) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1132</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">priceSetFields = $</span><span class="sf18b2">priceSet[</span><span class="sf12b2">'optionsCountDetails'</span><span class="sf3b2">][</span><span class="sf12b2">'fields'</span><span class="sf3b2">];</span></code></td>
<td class="ln">1149</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">priceSetFields = $</span><span class="sf18b2">priceSet[</span><span class="sf12b2">'optionsCountDetails'</span><span class="sf3b2">][</span><span class="sf12b2">'fields'</span><span class="sf3b2">];</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1133</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">1150</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1134</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1151</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">1135</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'optionsMaxValueTotal'</span><span class="sf3b2">, $</span><span class="sf18b2">priceSet)) {</span></code></td>
<td class="ln">1152</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'optionsMaxValueTotal'</span><span class="sf3b2">, $</span><span class="sf18b2">priceSet)) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1136</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">priceMaxFieldDetails = $</span><span class="sf18b2">priceSet[</span><span class="sf12b2">'optionsMaxValueDetails'</span><span class="sf3b2">][</span><span class="sf12b2">'fields'</span><span class="sf3b2">];</span></code></td>
<td class="ln">1153</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">priceMaxFieldDetails = $</span><span class="sf18b2">priceSet[</span><span class="sf12b2">'optionsMaxValueDetails'</span><span class="sf3b2">][</span><span class="sf12b2">'fields'</span><span class="sf3b2">];</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1137</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">1154</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1138</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1155</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">1139</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">addParticipantNum = </span><span class="sf8b2">substr</span><span class="sf3b2">($</span><span class="sf18b2">form-&gt;_name, 12);</span></code></td>
<td class="ln">1156</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">addParticipantNum = </span><span class="sf8b2">substr</span><span class="sf3b2">($</span><span class="sf18b2">form-&gt;_name, 12);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1140</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">foreach</span><span class="sf3b2"> ($</span><span class="sf18b2">params </span><span class="sf7b2">as</span><span class="sf3b2"> $</span><span class="sf18b2">pCnt =&gt; $</span><span class="sf18b2">values) {</span></code></td>
<td class="ln">1157</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">foreach</span><span class="sf3b2"> ($</span><span class="sf18b2">params </span><span class="sf7b2">as</span><span class="sf3b2"> $</span><span class="sf18b2">pCnt =&gt; $</span><span class="sf18b2">values) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1141</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">values == </span><span class="sf12b2">'skip'</span><span class="sf3b2"> ||</span></code></td>
<td class="ln">1158</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">values == </span><span class="sf12b2">'skip'</span><span class="sf3b2"> ||</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1142</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">pCnt == $addParticipantNum</span></code></td>
<td class="ln">1159</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">pCnt == $addParticipantNum</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1143</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;) {</span></code></td>
<td class="ln">1160</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1144</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">continue</span><span class="sf3b2">;</span></code></td>
<td class="ln">1161</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">continue</span><span class="sf3b2">;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1145</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">1162</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1146</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1163</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">1147</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">foreach</span><span class="sf3b2"> ($</span><span class="sf18b2">values </span><span class="sf7b2">as</span><span class="sf3b2"> $</span><span class="sf18b2">valKey =&gt; $</span><span class="sf18b2">value) {</span></code></td>
<td class="ln">1164</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">foreach</span><span class="sf3b2"> ($</span><span class="sf18b2">values </span><span class="sf7b2">as</span><span class="sf3b2"> $</span><span class="sf18b2">valKey =&gt; $</span><span class="sf18b2">value) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1148</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">strpos</span><span class="sf3b2">($</span><span class="sf18b2">valKey, </span><span class="sf12b2">'price_'</span><span class="sf3b2">) === FALSE) {</span></code></td>
<td class="ln">1165</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">strpos</span><span class="sf3b2">($</span><span class="sf18b2">valKey, </span><span class="sf12b2">'price_'</span><span class="sf3b2">) === FALSE) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1149</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">continue</span><span class="sf3b2">;</span></code></td>
<td class="ln">1166</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">continue</span><span class="sf3b2">;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1150</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">1167</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1151</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1168</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">1152</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">priceFieldId = </span><span class="sf8b2">substr</span><span class="sf3b2">($</span><span class="sf18b2">valKey, </span><span class="sf10b2">6</span><span class="sf3b2">);</span></code></td>
<td class="ln">1169</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">priceFieldId = </span><span class="sf8b2">substr</span><span class="sf3b2">($</span><span class="sf18b2">valKey, </span><span class="sf10b2">6</span><span class="sf3b2">);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1153</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!$</span><span class="sf18b2">priceFieldId ||</span></code></td>
<td class="ln">1170</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!$</span><span class="sf18b2">priceFieldId ||</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1154</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;!</span><span class="sf8b2">is_array</span><span class="sf3b2">($</span><span class="sf18b2">value) ||</span></code></td>
<td class="ln">1171</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;!</span><span class="sf8b2">is_array</span><span class="sf3b2">($</span><span class="sf18b2">value) ||</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1155</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;!(</span><span class="sf8b2">array_key_exists</span><span class="sf3b2">($</span><span class="sf18b2">priceFieldId, $</span><span class="sf18b2">priceSetFields) || </span><span class="sf8b2">array_key_exists</span><span class="sf3b2">($</span><span class="sf18b2">priceFieldId, $</span><span class="sf18b2">priceMaxFieldDetails))</span></code></td>
<td class="ln">1172</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;!(</span><span class="sf8b2">array_key_exists</span><span class="sf3b2">($</span><span class="sf18b2">priceFieldId, $</span><span class="sf18b2">priceSetFields) || </span><span class="sf8b2">array_key_exists</span><span class="sf3b2">($</span><span class="sf18b2">priceFieldId, $</span><span class="sf18b2">priceMaxFieldDetails))</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1156</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;) {</span></code></td>
<td class="ln">1173</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1157</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">continue</span><span class="sf3b2">;</span></code></td>
<td class="ln">1174</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">continue</span><span class="sf3b2">;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1158</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">1175</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1159</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1176</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">1160</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">foreach</span><span class="sf3b2"> ($</span><span class="sf18b2">value </span><span class="sf7b2">as</span><span class="sf3b2"> $</span><span class="sf18b2">optId =&gt; $</span><span class="sf18b2">optVal) {</span></code></td>
<td class="ln">1177</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">foreach</span><span class="sf3b2"> ($</span><span class="sf18b2">value </span><span class="sf7b2">as</span><span class="sf3b2"> $</span><span class="sf18b2">optId =&gt; $</span><span class="sf18b2">optVal) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1161</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'html_type'</span><span class="sf3b2">, $</span><span class="sf18b2">priceSet[</span><span class="sf12b2">'fields'</span><span class="sf3b2">][$</span><span class="sf18b2">priceFieldId]) == </span><span class="sf12b2">'Text'</span><span class="sf3b2">) {</span></code></td>
<td class="ln">1178</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'html_type'</span><span class="sf3b2">, $</span><span class="sf18b2">priceSet[</span><span class="sf12b2">'fields'</span><span class="sf3b2">][$</span><span class="sf18b2">priceFieldId]) == </span><span class="sf12b2">'Text'</span><span class="sf3b2">) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1162</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">currentCount = $</span><span class="sf18b2">optVal;</span></code></td>
<td class="ln">1179</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">currentCount = $</span><span class="sf18b2">optVal;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1163</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">1180</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1164</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">else</span><span class="sf3b2"> {</span></code></td>
<td class="ln">1181</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">else</span><span class="sf3b2"> {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1165</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">currentCount = </span><span class="sf10b2">1</span><span class="sf3b2">;</span></code></td>
<td class="ln">1182</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">currentCount = </span><span class="sf10b2">1</span><span class="sf3b2">;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1166</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">1183</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1167</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1184</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">1168</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf7b2">isset</span><span class="sf3b2">($</span><span class="sf18b2">priceSetFields[$</span><span class="sf18b2">priceFieldId]) &amp;&amp; </span><span class="sf7b2">isset</span><span class="sf3b2">($</span><span class="sf18b2">priceSetFields[$</span><span class="sf18b2">priceFieldId][</span><span class="sf12b2">'options'</span><span class="sf3b2">][$</span><span class="sf18b2">op<wbr>tId])) {</span></code></td>
<td class="ln">1185</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf7b2">isset</span><span class="sf3b2">($</span><span class="sf18b2">priceSetFields[$</span><span class="sf18b2">priceFieldId]) &amp;&amp; </span><span class="sf7b2">isset</span><span class="sf3b2">($</span><span class="sf18b2">priceSetFields[$</span><span class="sf18b2">priceFieldId][</span><span class="sf12b2">'options'</span><span class="sf3b2">][$</span><span class="sf18b2">op<wbr>tId])) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1169</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">currentCount = $</span><span class="sf18b2">priceSetFields[$</span><span class="sf18b2">priceFieldId][</span><span class="sf12b2">'options'</span><span class="sf3b2">][$</span><span class="sf18b2">optId] * $</span><span class="sf18b2">optVal;</span></code></td>
<td class="ln">1186</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">currentCount = $</span><span class="sf18b2">priceSetFields[$</span><span class="sf18b2">priceFieldId][</span><span class="sf12b2">'options'</span><span class="sf3b2">][$</span><span class="sf18b2">optId] * $</span><span class="sf18b2">optVal;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1170</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">1187</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1171</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1188</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">1172</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">optionsCount[$</span><span class="sf18b2">optId] = $</span><span class="sf18b2">currentCount + </span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">($</span><span class="sf18b2">optId, $</span><span class="sf18b2">optionsCount, </span><span class="sf10b2">0</span><span class="sf3b2">);</span></code></td>
<td class="ln">1189</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">optionsCount[$</span><span class="sf18b2">optId] = $</span><span class="sf18b2">currentCount + </span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">($</span><span class="sf18b2">optId, $</span><span class="sf18b2">optionsCount, </span><span class="sf10b2">0</span><span class="sf3b2">);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1173</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">1190</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1174</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">1191</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1175</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">1192</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1176</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1193</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">1177</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">return</span><span class="sf3b2"> $</span><span class="sf18b2">optionsCount;</span></code></td>
<td class="ln">1194</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">return</span><span class="sf3b2"> $</span><span class="sf18b2">optionsCount;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1178</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;}</span></code></td>
<td class="ln">1195</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1179</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1196</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">1180</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf7b2">function</span><span class="sf3b2"> </span><span class="sf8b2">checkTemplateFileExists</span><span class="sf3b2">($</span><span class="sf18b2">suffix = </span><span class="sf12b2">''</span><span class="sf3b2">) {</span></code></td>
<td class="ln">1197</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf7b2">function</span><span class="sf3b2"> </span><span class="sf8b2">checkTemplateFileExists</span><span class="sf3b2">($</span><span class="sf18b2">suffix = </span><span class="sf12b2">''</span><span class="sf3b2">) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1181</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">this-&gt;_eventId) {</span></code></td>
<td class="ln">1198</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">this-&gt;_eventId) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1182</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">templateName = $</span><span class="sf18b2">this-&gt;_name;</span></code></td>
<td class="ln">1199</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">templateName = $</span><span class="sf18b2">this-&gt;_name;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1183</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">substr</span><span class="sf3b2">($</span><span class="sf18b2">templateName, </span><span class="sf10b2">0</span><span class="sf3b2">, </span><span class="sf10b2">12</span><span class="sf3b2">) == </span><span class="sf12b2">'Participant_'</span><span class="sf3b2">) {</span></code></td>
<td class="ln">1200</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">substr</span><span class="sf3b2">($</span><span class="sf18b2">templateName, </span><span class="sf10b2">0</span><span class="sf3b2">, </span><span class="sf10b2">12</span><span class="sf3b2">) == </span><span class="sf12b2">'Participant_'</span><span class="sf3b2">) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1184</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">templateName = </span><span class="sf12b2">'AdditionalParticipant'</span><span class="sf3b2">;</span></code></td>
<td class="ln">1201</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">templateName = </span><span class="sf12b2">'AdditionalParticipant'</span><span class="sf3b2">;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1185</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">1202</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1186</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1203</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">1187</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">templateFile = </span><span class="sf12b2">"CRM/Event/Form/Registration/{$this-&gt;_eventId}/{$te<wbr>mplateName}.{$suffix}tpl"</span><span class="sf3b2">;</span></code></td>
<td class="ln">1204</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">templateFile = </span><span class="sf12b2">"CRM/Event/Form/Registration/{$this-&gt;_eventId}/{$te<wbr>mplateName}.{$suffix}tpl"</span><span class="sf3b2">;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1188</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">template = </span><span class="sf8b2">CRM_Core_Form::getTemplate</span><span class="sf3b2">();</span></code></td>
<td class="ln">1205</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">template = </span><span class="sf8b2">CRM_Core_Form::getTemplate</span><span class="sf3b2">();</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1189</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">template-&gt;</span><span class="sf8b2">template_exists</span><span class="sf3b2">($</span><span class="sf18b2">templateFile)) {</span></code></td>
<td class="ln">1206</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">template-&gt;</span><span class="sf8b2">template_exists</span><span class="sf3b2">($</span><span class="sf18b2">templateFile)) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1190</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">return</span><span class="sf3b2"> $</span><span class="sf18b2">templateFile;</span></code></td>
<td class="ln">1207</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">return</span><span class="sf3b2"> $</span><span class="sf18b2">templateFile;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1191</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">1208</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1192</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">1209</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1193</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">return</span><span class="sf3b2"> NULL;</span></code></td>
<td class="ln">1210</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">return</span><span class="sf3b2"> NULL;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1194</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;}</span></code></td>
<td class="ln">1211</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1195</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1212</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">1196</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf7b2">function</span><span class="sf3b2"> </span><span class="sf8b2">getTemplateFileName</span><span class="sf3b2">() {</span></code></td>
<td class="ln">1213</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf7b2">function</span><span class="sf3b2"> </span><span class="sf8b2">getTemplateFileName</span><span class="sf3b2">() {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1197</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">fileName = $</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">checkTemplateFileExists</span><span class="sf3b2">();</span></code></td>
<td class="ln">1214</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">fileName = $</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">checkTemplateFileExists</span><span class="sf3b2">();</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1198</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">return</span><span class="sf3b2"> $</span><span class="sf18b2">fileName ? $</span><span class="sf18b2">fileName : </span><span class="sf8b2">parent::getTemplateFileName</span><span class="sf3b2">();</span></code></td>
<td class="ln">1215</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">return</span><span class="sf3b2"> $</span><span class="sf18b2">fileName ? $</span><span class="sf18b2">fileName : </span><span class="sf8b2">parent::getTemplateFileName</span><span class="sf3b2">();</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1199</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;}</span></code></td>
<td class="ln">1216</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1200</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1217</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">1201</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf7b2">function</span><span class="sf3b2"> </span><span class="sf8b2">overrideExtraTemplateFileName</span><span class="sf3b2">() {</span></code></td>
<td class="ln">1218</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf7b2">function</span><span class="sf3b2"> </span><span class="sf8b2">overrideExtraTemplateFileName</span><span class="sf3b2">() {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1202</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">fileName = $</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">checkTemplateFileExists</span><span class="sf3b2">(</span><span class="sf12b2">'extra.'</span><span class="sf3b2">);</span></code></td>
<td class="ln">1219</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">fileName = $</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">checkTemplateFileExists</span><span class="sf3b2">(</span><span class="sf12b2">'extra.'</span><span class="sf3b2">);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1203</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">return</span><span class="sf3b2"> $</span><span class="sf18b2">fileName ? $</span><span class="sf18b2">fileName : </span><span class="sf8b2">parent::overrideExtraTemplateFileName</span><span class="sf3b2">();</span></code></td>
<td class="ln">1220</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">return</span><span class="sf3b2"> $</span><span class="sf18b2">fileName ? $</span><span class="sf18b2">fileName : </span><span class="sf8b2">parent::overrideExtraTemplateFileName</span><span class="sf3b2">();</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1204</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;}</span></code></td>
<td class="ln">1221</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1205</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1222</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">1206</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf7b2">function</span><span class="sf3b2"> </span><span class="sf8b2">getContactID</span><span class="sf3b2">() {</span></code></td>
<td class="ln">1223</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf7b2">function</span><span class="sf3b2"> </span><span class="sf8b2">getContactID</span><span class="sf3b2">() {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1207</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">tempID = </span><span class="sf8b2">CRM_Utils_Request::retrieve</span><span class="sf3b2">(</span><span class="sf12b2">'cid'</span><span class="sf3b2">, </span><span class="sf12b2">'Positive'</span><span class="sf3b2">, $</span><span class="sf18b2">this);</span></code></td>
<td class="ln">1224</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">tempID = </span><span class="sf8b2">CRM_Utils_Request::retrieve</span><span class="sf3b2">(</span><span class="sf12b2">'cid'</span><span class="sf3b2">, </span><span class="sf12b2">'Positive'</span><span class="sf3b2">, $</span><span class="sf18b2">this);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1208</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1225</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">1209</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// force to ignore the authenticated user</span></code></td>
<td class="ln">1226</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// force to ignore the authenticated user</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1210</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">tempID === </span><span class="sf12b2">'0'</span><span class="sf3b2">) {</span></code></td>
<td class="ln">1227</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">tempID === </span><span class="sf12b2">'0'</span><span class="sf3b2">) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1211</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">return</span><span class="sf3b2"> $</span><span class="sf18b2">tempID;</span></code></td>
<td class="ln">1228</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">return</span><span class="sf3b2"> $</span><span class="sf18b2">tempID;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1212</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">1229</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1213</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1230</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">1214</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">//check if this is a checksum authentication</span></code></td>
<td class="ln">1231</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">//check if this is a checksum authentication</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1215</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">userChecksum = </span><span class="sf8b2">CRM_Utils_Request::retrieve</span><span class="sf3b2">(</span><span class="sf12b2">'cs'</span><span class="sf3b2">, </span><span class="sf12b2">'String'</span><span class="sf3b2">, $</span><span class="sf18b2">this);</span></code></td>
<td class="ln">1232</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">userChecksum = </span><span class="sf8b2">CRM_Utils_Request::retrieve</span><span class="sf3b2">(</span><span class="sf12b2">'cs'</span><span class="sf3b2">, </span><span class="sf12b2">'String'</span><span class="sf3b2">, $</span><span class="sf18b2">this);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1216</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">userChecksum) {</span></code></td>
<td class="ln">1233</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">userChecksum) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1217</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">//check for anonymous user.</span></code></td>
<td class="ln">1234</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">//check for anonymous user.</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1218</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">validUser = </span><span class="sf8b2">CRM_Contact_BAO_Contact_Utils::validChecksum</span><span class="sf3b2">($</span><span class="sf18b2">tempI<wbr>D, $</span><span class="sf18b2">userChecksum);</span></code></td>
<td class="ln">1235</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">validUser = </span><span class="sf8b2">CRM_Contact_BAO_Contact_Utils::validChecksum</span><span class="sf3b2">($</span><span class="sf18b2">tempI<wbr>D, $</span><span class="sf18b2">userChecksum);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1219</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">validUser) {</span></code></td>
<td class="ln">1236</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">validUser) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1220</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">return</span><span class="sf3b2"> $</span><span class="sf18b2">tempID;</span></code></td>
<td class="ln">1237</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">return</span><span class="sf3b2"> $</span><span class="sf18b2">tempID;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1221</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">1238</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1222</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">1239</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1223</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1240</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">1224</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// check if the user is registered and we have a contact ID</span></code></td>
<td class="ln">1241</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// check if the user is registered and we have a contact ID</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1225</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">session = </span><span class="sf8b2">CRM_Core_Session::singleton</span><span class="sf3b2">();</span></code></td>
<td class="ln">1242</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">session = </span><span class="sf8b2">CRM_Core_Session::singleton</span><span class="sf3b2">();</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1226</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">return</span><span class="sf3b2"> $</span><span class="sf18b2">session-&gt;</span><span class="sf8b2">get</span><span class="sf3b2">(</span><span class="sf12b2">'userID'</span><span class="sf3b2">);</span></code></td>
<td class="ln">1243</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">return</span><span class="sf3b2"> $</span><span class="sf18b2">session-&gt;</span><span class="sf8b2">get</span><span class="sf3b2">(</span><span class="sf12b2">'userID'</span><span class="sf3b2">);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1227</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;}</span></code></td>
<td class="ln">1244</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1228</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1245</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">1229</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf9b2">/* Validate price set submitted params for price option limit,</span></code></td>
<td class="ln">1246</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf9b2">/* Validate price set submitted params for price option limit,</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1230</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; &nbsp; * as well as user should select at least one price field option.</span></code></td>
<td class="ln">1247</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; &nbsp; * as well as user should select at least one price field option.</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1231</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; &nbsp; *</span></code></td>
<td class="ln">1248</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; &nbsp; *</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1232</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; &nbsp; */</span>&nbsp;</code></td>
<td class="ln">1249</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; &nbsp; */</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">1233</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf7b2">function</span><span class="sf3b2"> </span><span class="sf8b2">validatePriceSet</span><span class="sf3b2">(&amp;$</span><span class="sf18b2">form, $</span><span class="sf18b2">params) {</span></code></td>
<td class="ln">1250</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf7b2">function</span><span class="sf3b2"> </span><span class="sf8b2">validatePriceSet</span><span class="sf3b2">(&amp;$</span><span class="sf18b2">form, $</span><span class="sf18b2">params) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1234</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">errors = </span><span class="sf7b2">array</span><span class="sf3b2">();</span></code></td>
<td class="ln">1251</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">errors = </span><span class="sf7b2">array</span><span class="sf3b2">();</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1235</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">hasOptMaxValue = FALSE;</span></code></td>
<td class="ln">1252</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">hasOptMaxValue = FALSE;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1236</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!</span><span class="sf8b2">is_array</span><span class="sf3b2">($</span><span class="sf18b2">params) || </span><span class="sf7b2">empty</span><span class="sf3b2">($</span><span class="sf18b2">params)) {</span></code></td>
<td class="ln">1253</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!</span><span class="sf8b2">is_array</span><span class="sf3b2">($</span><span class="sf18b2">params) || </span><span class="sf7b2">empty</span><span class="sf3b2">($</span><span class="sf18b2">params)) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1237</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">return</span><span class="sf3b2"> $</span><span class="sf18b2">errors;</span></code></td>
<td class="ln">1254</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">return</span><span class="sf3b2"> $</span><span class="sf18b2">errors;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1238</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">1255</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1239</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1256</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">1240</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">currentParticipantNum = </span><span class="sf8b2">substr</span><span class="sf3b2">($</span><span class="sf18b2">form-&gt;_name, 12);</span></code></td>
<td class="ln">1257</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">currentParticipantNum = </span><span class="sf8b2">substr</span><span class="sf3b2">($</span><span class="sf18b2">form-&gt;_name, 12);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1241</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!$</span><span class="sf18b2">currentParticipantNum) {</span></code></td>
<td class="ln">1258</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!$</span><span class="sf18b2">currentParticipantNum) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1242</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">currentParticipantNum = </span><span class="sf10b2">0</span><span class="sf3b2">;</span></code></td>
<td class="ln">1259</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">currentParticipantNum = </span><span class="sf10b2">0</span><span class="sf3b2">;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1243</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">1260</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1244</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1261</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">1245</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">priceSetId = $</span><span class="sf18b2">form-&gt;</span><span class="sf8b2">get</span><span class="sf3b2">(</span><span class="sf12b2">'priceSetId'</span><span class="sf3b2">);</span></code></td>
<td class="ln">1262</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">priceSetId = $</span><span class="sf18b2">form-&gt;</span><span class="sf8b2">get</span><span class="sf3b2">(</span><span class="sf12b2">'priceSetId'</span><span class="sf3b2">);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1246</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">priceSetDetails = $</span><span class="sf18b2">form-&gt;</span><span class="sf8b2">get</span><span class="sf3b2">(</span><span class="sf12b2">'priceSet'</span><span class="sf3b2">);</span></code></td>
<td class="ln">1263</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">priceSetDetails = $</span><span class="sf18b2">form-&gt;</span><span class="sf8b2">get</span><span class="sf3b2">(</span><span class="sf12b2">'priceSet'</span><span class="sf3b2">);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1247</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!$</span><span class="sf18b2">priceSetId ||</span></code></td>
<td class="ln">1264</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!$</span><span class="sf18b2">priceSetId ||</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1248</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;!</span><span class="sf8b2">is_array</span><span class="sf3b2">($</span><span class="sf18b2">priceSetDetails) ||</span></code></td>
<td class="ln">1265</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;!</span><span class="sf8b2">is_array</span><span class="sf3b2">($</span><span class="sf18b2">priceSetDetails) ||</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1249</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">empty</span><span class="sf3b2">($</span><span class="sf18b2">priceSetDetails)</span></code></td>
<td class="ln">1266</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">empty</span><span class="sf3b2">($</span><span class="sf18b2">priceSetDetails)</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1250</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;) {</span></code></td>
<td class="ln">1267</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1251</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">return</span><span class="sf3b2"> $</span><span class="sf18b2">errors;</span></code></td>
<td class="ln">1268</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">return</span><span class="sf3b2"> $</span><span class="sf18b2">errors;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1252</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">1269</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1253</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1270</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">1254</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">optionsCountDetails = $</span><span class="sf18b2">optionsMaxValueDetails = </span><span class="sf7b2">array</span><span class="sf3b2">();</span></code></td>
<td class="ln">1271</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">optionsCountDetails = $</span><span class="sf18b2">optionsMaxValueDetails = </span><span class="sf7b2">array</span><span class="sf3b2">();</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1255</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf7b2">isset</span><span class="sf3b2">($</span><span class="sf18b2">priceSetDetails[</span><span class="sf12b2">'optionsMaxValueTotal'</span><span class="sf3b2">])</span></code></td>
<td class="ln">1272</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf7b2">isset</span><span class="sf3b2">($</span><span class="sf18b2">priceSetDetails[</span><span class="sf12b2">'optionsMaxValueTotal'</span><span class="sf3b2">])</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1256</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;&amp;&amp; $</span><span class="sf18b2">priceSetDetails[</span><span class="sf12b2">'optionsMaxValueTotal'</span><span class="sf3b2">]</span></code></td>
<td class="ln">1273</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;&amp;&amp; $</span><span class="sf18b2">priceSetDetails[</span><span class="sf12b2">'optionsMaxValueTotal'</span><span class="sf3b2">]</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1257</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;) {</span></code></td>
<td class="ln">1274</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1258</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">hasOptMaxValue = TRUE;</span></code></td>
<td class="ln">1275</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">hasOptMaxValue = TRUE;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1259</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">optionsMaxValueDetails = $</span><span class="sf18b2">priceSetDetails[</span><span class="sf12b2">'optionsMaxValueDetails'</span><span class="sf3b2">][</span><span class="sf12b2">'fields'<wbr></span><span class="sf3b2">];</span></code></td>
<td class="ln">1276</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">optionsMaxValueDetails = $</span><span class="sf18b2">priceSetDetails[</span><span class="sf12b2">'optionsMaxValueDetails'</span><span class="sf3b2">][</span><span class="sf12b2">'fields'<wbr></span><span class="sf3b2">];</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1260</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">1277</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1261</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf7b2">isset</span><span class="sf3b2">($</span><span class="sf18b2">priceSetDetails[</span><span class="sf12b2">'optionsCountTotal'</span><span class="sf3b2">])</span></code></td>
<td class="ln">1278</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf7b2">isset</span><span class="sf3b2">($</span><span class="sf18b2">priceSetDetails[</span><span class="sf12b2">'optionsCountTotal'</span><span class="sf3b2">])</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1262</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;&amp;&amp; $</span><span class="sf18b2">priceSetDetails[</span><span class="sf12b2">'optionsCountTotal'</span><span class="sf3b2">]</span></code></td>
<td class="ln">1279</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;&amp;&amp; $</span><span class="sf18b2">priceSetDetails[</span><span class="sf12b2">'optionsCountTotal'</span><span class="sf3b2">]</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1263</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;) {</span></code></td>
<td class="ln">1280</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1264</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">hasOptCount = TRUE;</span></code></td>
<td class="ln">1281</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">hasOptCount = TRUE;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1265</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">optionsCountDetails = $</span><span class="sf18b2">priceSetDetails[</span><span class="sf12b2">'optionsCountDetails'</span><span class="sf3b2">][</span><span class="sf12b2">'fields'</span><span class="sf3b2">];</span></code></td>
<td class="ln">1282</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">optionsCountDetails = $</span><span class="sf18b2">priceSetDetails[</span><span class="sf12b2">'optionsCountDetails'</span><span class="sf3b2">][</span><span class="sf12b2">'fields'</span><span class="sf3b2">];</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1266</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">1283</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1267</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">feeBlock = $</span><span class="sf18b2">form-&gt;_feeBlock;</span></code></td>
<td class="ln">1284</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">feeBlock = $</span><span class="sf18b2">form-&gt;_feeBlock;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1268</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf7b2">empty</span><span class="sf3b2">($</span><span class="sf18b2">feeBlock)) {</span></code></td>
<td class="ln">1285</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf7b2">empty</span><span class="sf3b2">($</span><span class="sf18b2">feeBlock)) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1269</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">feeBlock = $</span><span class="sf18b2">priceSetDetails[</span><span class="sf12b2">'fields'</span><span class="sf3b2">];</span></code></td>
<td class="ln">1286</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">feeBlock = $</span><span class="sf18b2">priceSetDetails[</span><span class="sf12b2">'fields'</span><span class="sf3b2">];</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1270</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">1287</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1271</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1288</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">1272</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">optionMaxValues = $</span><span class="sf18b2">fieldSelected = </span><span class="sf7b2">array</span><span class="sf3b2">();</span></code></td>
<td class="ln">1289</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">optionMaxValues = $</span><span class="sf18b2">fieldSelected = </span><span class="sf7b2">array</span><span class="sf3b2">();</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1273</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">foreach</span><span class="sf3b2"> ($</span><span class="sf18b2">params </span><span class="sf7b2">as</span><span class="sf3b2"> $</span><span class="sf18b2">pNum =&gt; $</span><span class="sf18b2">values) {</span></code></td>
<td class="ln">1290</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">foreach</span><span class="sf3b2"> ($</span><span class="sf18b2">params </span><span class="sf7b2">as</span><span class="sf3b2"> $</span><span class="sf18b2">pNum =&gt; $</span><span class="sf18b2">values) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1274</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!</span><span class="sf8b2">is_array</span><span class="sf3b2">($</span><span class="sf18b2">values) || $</span><span class="sf18b2">values == </span><span class="sf12b2">'skip'</span><span class="sf3b2">) {</span></code></td>
<td class="ln">1291</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!</span><span class="sf8b2">is_array</span><span class="sf3b2">($</span><span class="sf18b2">values) || $</span><span class="sf18b2">values == </span><span class="sf12b2">'skip'</span><span class="sf3b2">) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1275</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">continue</span><span class="sf3b2">;</span></code></td>
<td class="ln">1292</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">continue</span><span class="sf3b2">;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1276</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">1293</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1277</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">foreach</span><span class="sf3b2"> ($</span><span class="sf18b2">values </span><span class="sf7b2">as</span><span class="sf3b2"> $</span><span class="sf18b2">valKey =&gt; $</span><span class="sf18b2">value) {</span></code></td>
<td class="ln">1294</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">foreach</span><span class="sf3b2"> ($</span><span class="sf18b2">values </span><span class="sf7b2">as</span><span class="sf3b2"> $</span><span class="sf18b2">valKey =&gt; $</span><span class="sf18b2">value) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1278</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">strpos</span><span class="sf3b2">($</span><span class="sf18b2">valKey, </span><span class="sf12b2">'price_'</span><span class="sf3b2">) === FALSE) {</span></code></td>
<td class="ln">1295</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">strpos</span><span class="sf3b2">($</span><span class="sf18b2">valKey, </span><span class="sf12b2">'price_'</span><span class="sf3b2">) === FALSE) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1279</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">continue</span><span class="sf3b2">;</span></code></td>
<td class="ln">1296</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">continue</span><span class="sf3b2">;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1280</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">1297</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1281</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">priceFieldId = </span><span class="sf8b2">substr</span><span class="sf3b2">($</span><span class="sf18b2">valKey, </span><span class="sf10b2">6</span><span class="sf3b2">);</span></code></td>
<td class="ln">1298</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">priceFieldId = </span><span class="sf8b2">substr</span><span class="sf3b2">($</span><span class="sf18b2">valKey, </span><span class="sf10b2">6</span><span class="sf3b2">);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1282</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!$</span><span class="sf18b2">priceFieldId ||</span></code></td>
<td class="ln">1299</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!$</span><span class="sf18b2">priceFieldId ||</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1283</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;!</span><span class="sf8b2">is_array</span><span class="sf3b2">($</span><span class="sf18b2">value)</span></code></td>
<td class="ln">1300</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;!</span><span class="sf8b2">is_array</span><span class="sf3b2">($</span><span class="sf18b2">value)</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1284</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;) {</span></code></td>
<td class="ln">1301</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1285</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">continue</span><span class="sf3b2">;</span></code></td>
<td class="ln">1302</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">continue</span><span class="sf3b2">;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1286</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">1303</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1287</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">fieldSelected[$</span><span class="sf18b2">pNum] = TRUE;</span></code></td>
<td class="ln">1304</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">fieldSelected[$</span><span class="sf18b2">pNum] = TRUE;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1288</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!$</span><span class="sf18b2">hasOptMaxValue) {</span></code></td>
<td class="ln">1305</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!$</span><span class="sf18b2">hasOptMaxValue) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1289</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">continue</span><span class="sf3b2">;</span></code></td>
<td class="ln">1306</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">continue</span><span class="sf3b2">;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1290</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">1307</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1291</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1308</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">1292</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">foreach</span><span class="sf3b2"> ($</span><span class="sf18b2">value </span><span class="sf7b2">as</span><span class="sf3b2"> $</span><span class="sf18b2">optId =&gt; $</span><span class="sf18b2">optVal) {</span></code></td>
<td class="ln">1309</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">foreach</span><span class="sf3b2"> ($</span><span class="sf18b2">value </span><span class="sf7b2">as</span><span class="sf3b2"> $</span><span class="sf18b2">optId =&gt; $</span><span class="sf18b2">optVal) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1293</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'html_type'</span><span class="sf3b2">, $</span><span class="sf18b2">feeBlock[$</span><span class="sf18b2">priceFieldId]) == </span><span class="sf12b2">'Text'</span><span class="sf3b2">) {</span></code></td>
<td class="ln">1310</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'html_type'</span><span class="sf3b2">, $</span><span class="sf18b2">feeBlock[$</span><span class="sf18b2">priceFieldId]) == </span><span class="sf12b2">'Text'</span><span class="sf3b2">) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1294</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">currentMaxValue = $</span><span class="sf18b2">optVal;</span></code></td>
<td class="ln">1311</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">currentMaxValue = $</span><span class="sf18b2">optVal;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1295</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">1312</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1296</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">else</span><span class="sf3b2"> {</span></code></td>
<td class="ln">1313</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">else</span><span class="sf3b2"> {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1297</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">currentMaxValue = </span><span class="sf10b2">1</span><span class="sf3b2">;</span></code></td>
<td class="ln">1314</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">currentMaxValue = </span><span class="sf10b2">1</span><span class="sf3b2">;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1298</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">1315</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1299</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1316</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">1300</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf7b2">isset</span><span class="sf3b2">($</span><span class="sf18b2">optionsCountDetails[$</span><span class="sf18b2">priceFieldId]) &amp;&amp; </span><span class="sf7b2">isset</span><span class="sf3b2">($</span><span class="sf18b2">optionsCountDetails[$</span><span class="sf18b2">priceFieldId][</span><span class="sf12b2">'options'<wbr></span><span class="sf3b2">][$</span><span class="sf18b2">optId])) {</span></code></td>
<td class="ln">1317</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf7b2">isset</span><span class="sf3b2">($</span><span class="sf18b2">optionsCountDetails[$</span><span class="sf18b2">priceFieldId]) &amp;&amp; </span><span class="sf7b2">isset</span><span class="sf3b2">($</span><span class="sf18b2">optionsCountDetails[$</span><span class="sf18b2">priceFieldId][</span><span class="sf12b2">'options'<wbr></span><span class="sf3b2">][$</span><span class="sf18b2">optId])) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1301</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">currentMaxValue = $</span><span class="sf18b2">optionsCountDetails[$</span><span class="sf18b2">priceFieldId][</span><span class="sf12b2">'options'</span><span class="sf3b2">][$</span><span class="sf18b2">opt<wbr>Id] * $</span><span class="sf18b2">optVal;</span></code></td>
<td class="ln">1318</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">currentMaxValue = $</span><span class="sf18b2">optionsCountDetails[$</span><span class="sf18b2">priceFieldId][</span><span class="sf12b2">'options'</span><span class="sf3b2">][$</span><span class="sf18b2">opt<wbr>Id] * $</span><span class="sf18b2">optVal;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1302</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">1319</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1303</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1320</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">1304</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">optionMaxValues[$</span><span class="sf18b2">priceFieldId][$</span><span class="sf18b2">optId] = $</span><span class="sf18b2">currentMaxValue + </span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">($</span><span class="sf18b2">optId, $</span><span class="sf18b2">optionMaxValues[$</span><span class="sf18b2">priceFieldId], </span><span class="sf10b2">0</span><span class="sf3b2">);</span></code></td>
<td class="ln">1321</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">optionMaxValues[$</span><span class="sf18b2">priceFieldId][$</span><span class="sf18b2">optId] = $</span><span class="sf18b2">currentMaxValue + </span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">($</span><span class="sf18b2">optId, $</span><span class="sf18b2">optionMaxValues[$</span><span class="sf18b2">priceFieldId], </span><span class="sf10b2">0</span><span class="sf3b2">);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1305</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">1322</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1306</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">1323</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1307</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">1324</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1308</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1325</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">1309</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">//validate for option max value.</span></code></td>
<td class="ln">1326</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">//validate for option max value.</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1310</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">foreach</span><span class="sf3b2"> ($</span><span class="sf18b2">optionMaxValues </span><span class="sf7b2">as</span><span class="sf3b2"> $</span><span class="sf18b2">fieldId =&gt; $</span><span class="sf18b2">values) {</span></code></td>
<td class="ln">1327</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">foreach</span><span class="sf3b2"> ($</span><span class="sf18b2">optionMaxValues </span><span class="sf7b2">as</span><span class="sf3b2"> $</span><span class="sf18b2">fieldId =&gt; $</span><span class="sf18b2">values) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1311</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">options = </span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'options'</span><span class="sf3b2">, $</span><span class="sf18b2">feeBlock[$</span><span class="sf18b2">fieldId], </span><span class="sf7b2">array</span><span class="sf3b2">());</span></code></td>
<td class="ln">1328</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">options = </span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'options'</span><span class="sf3b2">, $</span><span class="sf18b2">feeBlock[$</span><span class="sf18b2">fieldId], </span><span class="sf7b2">array</span><span class="sf3b2">());</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1312</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">foreach</span><span class="sf3b2"> ($</span><span class="sf18b2">values </span><span class="sf7b2">as</span><span class="sf3b2"> $</span><span class="sf18b2">optId =&gt; $</span><span class="sf18b2">total) {</span></code></td>
<td class="ln">1329</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">foreach</span><span class="sf3b2"> ($</span><span class="sf18b2">values </span><span class="sf7b2">as</span><span class="sf3b2"> $</span><span class="sf18b2">optId =&gt; $</span><span class="sf18b2">total) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1313</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">optMax = $</span><span class="sf18b2">optionsMaxValueDetails[$</span><span class="sf18b2">fieldId][</span><span class="sf12b2">'options'</span><span class="sf3b2">][$</span><span class="sf18b2">optId<wbr>];</span></code></td>
<td class="ln">1330</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">optMax = $</span><span class="sf18b2">optionsMaxValueDetails[$</span><span class="sf18b2">fieldId][</span><span class="sf12b2">'options'</span><span class="sf3b2">][$</span><span class="sf18b2">optId<wbr>];</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1314</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">opDbCount = </span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'db_total_count'</span><span class="sf3b2">, $</span><span class="sf18b2">options[$</span><span class="sf18b2">optId], </span><span class="sf10b2">0</span><span class="sf3b2">);</span></code></td>
<td class="ln">1331</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">opDbCount = </span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'db_total_count'</span><span class="sf3b2">, $</span><span class="sf18b2">options[$</span><span class="sf18b2">optId], </span><span class="sf10b2">0</span><span class="sf3b2">);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1315</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">total += $</span><span class="sf18b2">opDbCount;</span></code></td>
<td class="ln">1332</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">total += $</span><span class="sf18b2">opDbCount;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1316</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">optMax &amp;&amp; $</span><span class="sf18b2">total &gt; $</span><span class="sf18b2">optMax) {</span></code></td>
<td class="ln">1333</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">optMax &amp;&amp; $</span><span class="sf18b2">total &gt; $</span><span class="sf18b2">optMax) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1317</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">opDbCount &amp;&amp; ($</span><span class="sf18b2">opDbCount &gt;= $</span><span class="sf18b2">optMax)) {</span></code></td>
<td class="ln">1334</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">opDbCount &amp;&amp; ($</span><span class="sf18b2">opDbCount &gt;= $</span><span class="sf18b2">optMax)) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1318</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">errors[$</span><span class="sf18b2">currentParticipantNum][</span><span class="sf12b2">"price_{$fieldId}"</span><span class="sf3b2">]<wbr> = </span><span class="sf8b2">ts</span><span class="sf3b2">(</span><span class="sf12b2">'Sorry, this option is currently sold out.'</span><span class="sf3b2">);</span></code></td>
<td class="ln">1335</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">errors[$</span><span class="sf18b2">currentParticipantNum][</span><span class="sf12b2">"price_{$fieldId}"</span><span class="sf3b2">]<wbr> = </span><span class="sf8b2">ts</span><span class="sf3b2">(</span><span class="sf12b2">'Sorry, this option is currently sold out.'</span><span class="sf3b2">);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1319</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">1336</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1320</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">elseif</span><span class="sf3b2"> (($</span><span class="sf18b2">optMax - $</span><span class="sf18b2">opDbCount) == </span><span class="sf10b2">1</span><span class="sf3b2">) {</span></code></td>
<td class="ln">1337</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">elseif</span><span class="sf3b2"> (($</span><span class="sf18b2">optMax - $</span><span class="sf18b2">opDbCount) == </span><span class="sf10b2">1</span><span class="sf3b2">) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1321</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">errors[$</span><span class="sf18b2">currentParticipantNum][</span><span class="sf12b2">"price_{$fieldId}"</span><span class="sf3b2">]<wbr> = </span><span class="sf8b2">ts</span><span class="sf3b2">(</span><span class="sf12b2">'Sorry, currently only a single seat is available for this option.'</span><span class="sf3b2">, </span><span class="sf7b2">array</span><span class="sf3b2">(</span><span class="sf10b2">1</span><span class="sf3b2"> =&gt; ($</span><span class="sf18b2">optMax - $</span><span class="sf18b2">opDbCount)));</span></code></td>
<td class="ln">1338</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">errors[$</span><span class="sf18b2">currentParticipantNum][</span><span class="sf12b2">"price_{$fieldId}"</span><span class="sf3b2">]<wbr> = </span><span class="sf8b2">ts</span><span class="sf3b2">(</span><span class="sf12b2">'Sorry, currently only a single seat is available for this option.'</span><span class="sf3b2">, </span><span class="sf7b2">array</span><span class="sf3b2">(</span><span class="sf10b2">1</span><span class="sf3b2"> =&gt; ($</span><span class="sf18b2">optMax - $</span><span class="sf18b2">opDbCount)));</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1322</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">1339</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1323</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">else</span><span class="sf3b2"> {</span></code></td>
<td class="ln">1340</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">else</span><span class="sf3b2"> {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1324</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">errors[$</span><span class="sf18b2">currentParticipantNum][</span><span class="sf12b2">"price_{$fieldId}"</span><span class="sf3b2">]<wbr> = </span><span class="sf8b2">ts</span><span class="sf3b2">(</span><span class="sf12b2">'Sorry, currently only %1 seats are available for this option.'</span><span class="sf3b2">, </span><span class="sf7b2">array</span><span class="sf3b2">(</span><span class="sf10b2">1</span><span class="sf3b2"> =&gt; ($</span><span class="sf18b2">optMax - $</span><span class="sf18b2">opDbCount)));</span></code></td>
<td class="ln">1341</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">errors[$</span><span class="sf18b2">currentParticipantNum][</span><span class="sf12b2">"price_{$fieldId}"</span><span class="sf3b2">]<wbr> = </span><span class="sf8b2">ts</span><span class="sf3b2">(</span><span class="sf12b2">'Sorry, currently only %1 seats are available for this option.'</span><span class="sf3b2">, </span><span class="sf7b2">array</span><span class="sf3b2">(</span><span class="sf10b2">1</span><span class="sf3b2"> =&gt; ($</span><span class="sf18b2">optMax - $</span><span class="sf18b2">opDbCount)));</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1325</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">1342</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1326</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">1343</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1327</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">1344</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1328</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">1345</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1329</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1346</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">1330</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">//validate for price field selection.</span></code></td>
<td class="ln">1347</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">//validate for price field selection.</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1331</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">foreach</span><span class="sf3b2"> ($</span><span class="sf18b2">params </span><span class="sf7b2">as</span><span class="sf3b2"> $</span><span class="sf18b2">pNum =&gt; $</span><span class="sf18b2">values) {</span></code></td>
<td class="ln">1348</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">foreach</span><span class="sf3b2"> ($</span><span class="sf18b2">params </span><span class="sf7b2">as</span><span class="sf3b2"> $</span><span class="sf18b2">pNum =&gt; $</span><span class="sf18b2">values) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1332</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!</span><span class="sf8b2">is_array</span><span class="sf3b2">($</span><span class="sf18b2">values) || $</span><span class="sf18b2">values == </span><span class="sf12b2">'skip'</span><span class="sf3b2">) {</span></code></td>
<td class="ln">1349</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!</span><span class="sf8b2">is_array</span><span class="sf3b2">($</span><span class="sf18b2">values) || $</span><span class="sf18b2">values == </span><span class="sf12b2">'skip'</span><span class="sf3b2">) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1333</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">continue</span><span class="sf3b2">;</span></code></td>
<td class="ln">1350</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">continue</span><span class="sf3b2">;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1334</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">1351</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1335</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">($</span><span class="sf18b2">pNum, $</span><span class="sf18b2">fieldSelected)) {</span></code></td>
<td class="ln">1352</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">($</span><span class="sf18b2">pNum, $</span><span class="sf18b2">fieldSelected)) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1336</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">errors[$</span><span class="sf18b2">pNum][</span><span class="sf12b2">'_qf_default'</span><span class="sf3b2">] = </span><span class="sf8b2">ts</span><span class="sf3b2">(</span><span class="sf12b2">'Select at least one option from Event Fee(s).'</span><span class="sf3b2">);</span></code></td>
<td class="ln">1353</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">errors[$</span><span class="sf18b2">pNum][</span><span class="sf12b2">'_qf_default'</span><span class="sf3b2">] = </span><span class="sf8b2">ts</span><span class="sf3b2">(</span><span class="sf12b2">'Select at least one option from Event Fee(s).'</span><span class="sf3b2">);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1337</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">1354</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1338</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">1355</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1339</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1356</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">1340</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">return</span><span class="sf3b2"> $</span><span class="sf18b2">errors;</span></code></td>
<td class="ln">1357</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">return</span><span class="sf3b2"> $</span><span class="sf18b2">errors;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1341</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;}</span></code></td>
<td class="ln">1358</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1342</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1359</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">1343</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf9b2">// set the first participant ID if not set, CRM-10032</span></code></td>
<td class="ln">1360</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf9b2">// set the first participant ID if not set, CRM-10032</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1344</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf7b2">function</span><span class="sf3b2"> </span><span class="sf8b2">processFirstParticipant</span><span class="sf3b2">($</span><span class="sf18b2">participantID) {</span></code></td>
<td class="ln">1361</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf7b2">function</span><span class="sf3b2"> </span><span class="sf8b2">processFirstParticipant</span><span class="sf3b2">($</span><span class="sf18b2">participantID) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1345</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_participantId = $</span><span class="sf18b2">participantID;</span></code></td>
<td class="ln">1362</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_participantId = $</span><span class="sf18b2">participantID;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1346</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">set</span><span class="sf3b2">(</span><span class="sf12b2">'participantId'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_participantId);</span></code></td>
<td class="ln">1363</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">set</span><span class="sf3b2">(</span><span class="sf12b2">'participantId'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_participantId);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1347</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1364</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">1348</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">ids = $</span><span class="sf18b2">participantValues = </span><span class="sf7b2">array</span><span class="sf3b2">();</span></code></td>
<td class="ln">1365</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">ids = $</span><span class="sf18b2">participantValues = </span><span class="sf7b2">array</span><span class="sf3b2">();</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1349</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">participantParams = </span><span class="sf7b2">array</span><span class="sf3b2">(</span><span class="sf12b2">'id'</span><span class="sf3b2"> =&gt; $</span><span class="sf18b2">this-&gt;_participantId);</span></code></td>
<td class="ln">1366</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">participantParams = </span><span class="sf7b2">array</span><span class="sf3b2">(</span><span class="sf12b2">'id'</span><span class="sf3b2"> =&gt; $</span><span class="sf18b2">this-&gt;_participantId);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1350</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf8b2">CRM_Event_BAO_Participant::getValues</span><span class="sf3b2">($</span><span class="sf18b2">participantPa<wbr>rams, $</span><span class="sf18b2">participantValues, $</span><span class="sf18b2">ids);</span></code></td>
<td class="ln">1367</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf8b2">CRM_Event_BAO_Participant::getValues</span><span class="sf3b2">($</span><span class="sf18b2">participantPa<wbr>rams, $</span><span class="sf18b2">participantValues, $</span><span class="sf18b2">ids);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1351</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'participant'</span><span class="sf3b2">] = $</span><span class="sf18b2">participantValues[$</span><span class="sf18b2">this-&gt;_participantId];</span></code></td>
<td class="ln">1368</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'participant'</span><span class="sf3b2">] = $</span><span class="sf18b2">participantValues[$</span><span class="sf18b2">this-&gt;_participantId];</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1352</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">set</span><span class="sf3b2">(</span><span class="sf12b2">'values'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_values);</span></code></td>
<td class="ln">1369</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">set</span><span class="sf3b2">(</span><span class="sf12b2">'values'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_values);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1353</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1370</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">1354</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// also set the allow confirmation stuff</span></code></td>
<td class="ln">1371</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// also set the allow confirmation stuff</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1355</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">array_key_exists</span><span class="sf3b2">(</span></code></td>
<td class="ln">1372</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">array_key_exists</span><span class="sf3b2">(</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1356</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'participant'</span><span class="sf3b2">][</span><span class="sf12b2">'status_id'</span><span class="sf3b2">],</span></code></td>
<td class="ln">1373</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'participant'</span><span class="sf3b2">][</span><span class="sf12b2">'status_id'</span><span class="sf3b2">],</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1357</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">CRM_Event_PseudoConstant::participantStatus</span><span class="sf3b2">(NULL, </span><span class="sf12b2">"class = 'Pending'"</span><span class="sf3b2">)</span></code></td>
<td class="ln">1374</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">CRM_Event_PseudoConstant::participantStatus</span><span class="sf3b2">(NULL, </span><span class="sf12b2">"class = 'Pending'"</span><span class="sf3b2">)</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1358</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;)) {</span></code></td>
<td class="ln">1375</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;)) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1359</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_allowConfirmation = TRUE;</span></code></td>
<td class="ln">1376</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_allowConfirmation = TRUE;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1360</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">set</span><span class="sf3b2">(</span><span class="sf12b2">'allowConfirmation'</span><span class="sf3b2">, TRUE);</span></code></td>
<td class="ln">1377</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">set</span><span class="sf3b2">(</span><span class="sf12b2">'allowConfirmation'</span><span class="sf3b2">, TRUE);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1361</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">1378</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1362</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;}</span></code></td>
<td class="ln">1379</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1363</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1380</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">1364</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf7b2">function</span><span class="sf3b2"> </span><span class="sf8b2">checkValidEvent</span><span class="sf3b2">() {</span></code></td>
<td class="ln">1381</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf7b2">function</span><span class="sf3b2"> </span><span class="sf8b2">checkValidEvent</span><span class="sf3b2">() {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1365</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// is the event active (enabled)?</span></code></td>
<td class="ln">1382</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// is the event active (enabled)?</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1366</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!$</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">][</span><span class="sf12b2">'is_active'</span><span class="sf3b2">]) {</span></code></td>
<td class="ln">1383</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!$</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">][</span><span class="sf12b2">'is_active'</span><span class="sf3b2">]) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1367</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">// form is inactive, die a fatal death</span></code></td>
<td class="ln">1384</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">// form is inactive, die a fatal death</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1368</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">CRM_Core_Error::statusBounce</span><span class="sf3b2">(</span><span class="sf8b2">ts</span><span class="sf3b2">(</span><span class="sf12b2">'The event you requested is currently unavailable (contact the site administrator for assistance).'</span><span class="sf3b2">));</span></code></td>
<td class="ln">1385</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">CRM_Core_Error::statusBounce</span><span class="sf3b2">(</span><span class="sf8b2">ts</span><span class="sf3b2">(</span><span class="sf12b2">'The event you requested is currently unavailable (contact the site administrator for assistance).'</span><span class="sf3b2">));</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1369</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">1386</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1370</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1387</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">1371</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// is online registration is enabled?</span></code></td>
<td class="ln">1388</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// is online registration is enabled?</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1372</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!$</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">][</span><span class="sf12b2">'is_online_registration'</span><span class="sf3b2">]<wbr>) {</span></code></td>
<td class="ln">1389</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!$</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">][</span><span class="sf12b2">'is_online_registration'</span><span class="sf3b2">]<wbr>) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1373</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">CRM_Core_Error::statusBounce</span><span class="sf3b2">(</span><span class="sf8b2">ts</span><span class="sf3b2">(</span><span class="sf12b2">'Online registration is not currently available for this event (contact the site administrator for assistance).'</span><span class="sf3b2">), $</span><span class="sf18b2">infoUrl);</span></code></td>
<td class="ln">1390</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">CRM_Core_Error::statusBounce</span><span class="sf3b2">(</span><span class="sf8b2">ts</span><span class="sf3b2">(</span><span class="sf12b2">'Online registration is not currently available for this event (contact the site administrator for assistance).'</span><span class="sf3b2">), $</span><span class="sf18b2">infoUrl);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1374</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">1391</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1375</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1392</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">1376</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// is this an event template ?</span></code></td>
<td class="ln">1393</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// is this an event template ?</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1377</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'is_template'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">])) {</span></code></td>
<td class="ln">1394</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'is_template'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">])) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1378</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">CRM_Core_Error::statusBounce</span><span class="sf3b2">(</span><span class="sf8b2">ts</span><span class="sf3b2">(</span><span class="sf12b2">'Event templates are not meant to be registered.'</span><span class="sf3b2">), $</span><span class="sf18b2">infoUrl);</span></code></td>
<td class="ln">1395</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">CRM_Core_Error::statusBounce</span><span class="sf3b2">(</span><span class="sf8b2">ts</span><span class="sf3b2">(</span><span class="sf12b2">'Event templates are not meant to be registered.'</span><span class="sf3b2">), $</span><span class="sf18b2">infoUrl);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1379</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">1396</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1380</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1397</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">1381</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">now = </span><span class="sf8b2">date</span><span class="sf3b2">(</span><span class="sf12b2">'YmdHis'</span><span class="sf3b2">);</span></code></td>
<td class="ln">1398</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">now = </span><span class="sf8b2">date</span><span class="sf3b2">(</span><span class="sf12b2">'YmdHis'</span><span class="sf3b2">);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1382</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">startDate = </span><span class="sf8b2">CRM_Utils_Date::processDate</span><span class="sf3b2">(</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(<wbr></span><span class="sf12b2">'registration_start_date'</span><span class="sf3b2">,</span></code></td>
<td class="ln">1399</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">startDate = </span><span class="sf8b2">CRM_Utils_Date::processDate</span><span class="sf3b2">(</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(<wbr></span><span class="sf12b2">'registration_start_date'</span><span class="sf3b2">,</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1383</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">]</span></code></td>
<td class="ln">1400</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">]</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1384</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;));</span></code></td>
<td class="ln">1401</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;));</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1385</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1402</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">1386</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span></code></td>
<td class="ln">1403</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1387</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">startDate &amp;&amp;</span></code></td>
<td class="ln">1404</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">startDate &amp;&amp;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1388</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">startDate &gt;= $now</span></code></td>
<td class="ln">1405</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">startDate &gt;= $now</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1389</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;) {</span></code></td>
<td class="ln">1406</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1390</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">CRM_Core_Error::statusBounce</span><span class="sf3b2">(</span><span class="sf8b2">ts</span><span class="sf3b2">(</span><span class="sf12b2">'Registration for this event begins on %1'</span><span class="sf3b2">, </span><span class="sf7b2">array</span><span class="sf3b2">(</span><span class="sf10b2">1</span><span class="sf3b2"> =&gt; </span><span class="sf8b2">CRM_Utils_Date::customFormat</span><span class="sf3b2">(</span><span class="sf8b2">CRM_Utils_Array::value<wbr></span><span class="sf3b2">(</span><span class="sf12b2">'registration_start_date'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">])))), $</span><span class="sf18b2">infoUrl);</span></code></td>
<td class="ln">1407</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">CRM_Core_Error::statusBounce</span><span class="sf3b2">(</span><span class="sf8b2">ts</span><span class="sf3b2">(</span><span class="sf12b2">'Registration for this event begins on %1'</span><span class="sf3b2">, </span><span class="sf7b2">array</span><span class="sf3b2">(</span><span class="sf10b2">1</span><span class="sf3b2"> =&gt; </span><span class="sf8b2">CRM_Utils_Date::customFormat</span><span class="sf3b2">(</span><span class="sf8b2">CRM_Utils_Array::value<wbr></span><span class="sf3b2">(</span><span class="sf12b2">'registration_start_date'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">])))), $</span><span class="sf18b2">infoUrl);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1391</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">1408</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1392</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1409</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">1393</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">endDate = </span><span class="sf8b2">CRM_Utils_Date::processDate</span><span class="sf3b2">(</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(<wbr></span><span class="sf12b2">'registration_end_date'</span><span class="sf3b2">,</span></code></td>
<td class="ln">1410</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">endDate = </span><span class="sf8b2">CRM_Utils_Date::processDate</span><span class="sf3b2">(</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(<wbr></span><span class="sf12b2">'registration_end_date'</span><span class="sf3b2">,</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1394</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">]</span></code></td>
<td class="ln">1411</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">]</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1395</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;));</span></code></td>
<td class="ln">1412</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;));</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1396</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span></code></td>
<td class="ln">1413</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1397</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">endDate &amp;&amp;</span></code></td>
<td class="ln">1414</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">endDate &amp;&amp;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1398</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">endDate &lt; $now</span></code></td>
<td class="ln">1415</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">endDate &lt; $now</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1399</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;) {</span></code></td>
<td class="ln">1416</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1400</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">CRM_Core_Error::statusBounce</span><span class="sf3b2">(</span><span class="sf8b2">ts</span><span class="sf3b2">(</span><span class="sf12b2">'Registration for this event ended on %1'</span><span class="sf3b2">, </span><span class="sf7b2">array</span><span class="sf3b2">(</span><span class="sf10b2">1</span><span class="sf3b2"> =&gt; </span><span class="sf8b2">CRM_Utils_Date::customFormat</span><span class="sf3b2">(</span><span class="sf8b2">CRM_Utils_Array::value<wbr></span><span class="sf3b2">(</span><span class="sf12b2">'registration_end_date'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">])))), $</span><span class="sf18b2">infoUrl);</span></code></td>
<td class="ln">1417</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">CRM_Core_Error::statusBounce</span><span class="sf3b2">(</span><span class="sf8b2">ts</span><span class="sf3b2">(</span><span class="sf12b2">'Registration for this event ended on %1'</span><span class="sf3b2">, </span><span class="sf7b2">array</span><span class="sf3b2">(</span><span class="sf10b2">1</span><span class="sf3b2"> =&gt; </span><span class="sf8b2">CRM_Utils_Date::customFormat</span><span class="sf3b2">(</span><span class="sf8b2">CRM_Utils_Array::value<wbr></span><span class="sf3b2">(</span><span class="sf12b2">'registration_end_date'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">])))), $</span><span class="sf18b2">infoUrl);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1401</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">1418</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1402</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;}</span></code></td>
<td class="ln">1419</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1403</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; ">}</span><span class="sf17b16">
</span>&nbsp;</code></td>
<td class="ln">1420</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; ">}</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">1404</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16">
</span>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">1405</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln"></td><td></td>
</tr>
</tbody>
</table>
</body>
</html>
