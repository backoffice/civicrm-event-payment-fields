<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
	"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>WinMerge File Compare Report</title>
<style type="text/css">
<!--
td,th {font-size: 12pt;}
.ln {text-align: right; background-color: lightgrey;}
.title {color: white; background-color: blue; vertical-align: top;}
.sf3b2 {color: #000000; background-color: #ffffff; }
.sf3b5 {color: #000000; background-color: #000000; }
.sf3b14 {color: #000000; background-color: #ffa0a0; }
.sf3b16 {color: #000000; background-color: #f1e2ad; }
.sf6b2 {color: #ffffff; background-color: #ffffff; }
.sf6b5 {color: #ffffff; background-color: #000000; }
.sf6b14 {color: #ffffff; background-color: #ffa0a0; }
.sf6b16 {color: #ffffff; background-color: #f1e2ad; }
.sf7b2 {color: #0000ff; background-color: #ffffff; font-weight: bold; }
.sf7b5 {color: #0000ff; background-color: #000000; font-weight: bold; }
.sf7b14 {color: #0000ff; background-color: #ffa0a0; font-weight: bold; }
.sf7b16 {color: #0000ff; background-color: #f1e2ad; font-weight: bold; }
.sf8b2 {color: #800080; background-color: #ffffff; }
.sf8b5 {color: #800080; background-color: #000000; }
.sf8b14 {color: #800080; background-color: #ffa0a0; }
.sf8b16 {color: #800080; background-color: #f1e2ad; }
.sf9b2 {color: #008000; background-color: #ffffff; }
.sf9b5 {color: #008000; background-color: #000000; }
.sf9b14 {color: #008000; background-color: #ffa0a0; }
.sf9b16 {color: #008000; background-color: #f1e2ad; }
.sf10b2 {color: #ff0000; background-color: #ffffff; }
.sf10b5 {color: #ff0000; background-color: #000000; }
.sf10b14 {color: #ff0000; background-color: #ffa0a0; }
.sf10b16 {color: #ff0000; background-color: #f1e2ad; }
.sf11b2 {color: #606060; background-color: #ffffff; }
.sf11b5 {color: #606060; background-color: #000000; }
.sf11b14 {color: #606060; background-color: #ffa0a0; }
.sf11b16 {color: #606060; background-color: #f1e2ad; }
.sf12b2 {color: #800000; background-color: #ffffff; }
.sf12b5 {color: #800000; background-color: #000000; }
.sf12b14 {color: #800000; background-color: #ffa0a0; }
.sf12b16 {color: #800000; background-color: #f1e2ad; }
.sf13b2 {color: #0080c0; background-color: #ffffff; }
.sf13b5 {color: #0080c0; background-color: #000000; }
.sf13b14 {color: #0080c0; background-color: #ffa0a0; }
.sf13b16 {color: #0080c0; background-color: #f1e2ad; }
.sf15b2 {color: #000000; background-color: #ffffff; }
.sf15b5 {color: #000000; background-color: #000000; }
.sf15b14 {color: #000000; background-color: #ffa0a0; }
.sf15b16 {color: #000000; background-color: #f1e2ad; }
.sf17b2 {color: #000000; background-color: #ffffff; }
.sf17b5 {color: #000000; background-color: #000000; }
.sf17b14 {color: #000000; background-color: #ffa0a0; }
.sf17b16 {color: #000000; background-color: #f1e2ad; }
.sf18b2 {color: #000080; background-color: #ffffff; }
.sf18b5 {color: #000080; background-color: #000000; }
.sf18b14 {color: #000080; background-color: #ffa0a0; }
.sf18b16 {color: #000080; background-color: #f1e2ad; }
.sf19b2 {color: #0080c0; background-color: #ffffff; }
.sf19b5 {color: #0080c0; background-color: #000000; }
.sf19b14 {color: #0080c0; background-color: #ffa0a0; }
.sf19b16 {color: #0080c0; background-color: #f1e2ad; }
-->
</style>
</head>
<body>
<table cellspacing="0" cellpadding="0" style="width: 100%; margin: 0; border: none;">
<thead>
<tr>
<th class="title" style="width:1%"></th><th class="title" style="width:49.000000%">Original\Event\Form\Registration\Confirm.php</th>
<th class="title" style="width:1%"></th><th class="title" style="width:49.000000%">Custom\Event\Form\Registration\Confirm.php</th>
</tr>
</thead>
<tbody>
<tr valign="top">
<td class="ln">1</td><td class="sf3b2"><code><span class="sf3b2">&lt;?php</span></code></td>
<td class="ln">1</td><td class="sf3b2"><code><span class="sf3b2">&lt;?php</span></code></td>
</tr>
<tr valign="top">
<td class="ln">2</td><td class="sf3b2"><code><span class="sf9b2">/*</span></code></td>
<td class="ln">2</td><td class="sf3b2"><code><span class="sf9b2">/*</span></code></td>
</tr>
<tr valign="top">
<td class="ln">3</td><td class="sf3b2"><code><span class="sf9b2"> +--------------------------------------------------<wbr>------------------+</span></code></td>
<td class="ln">3</td><td class="sf3b2"><code><span class="sf9b2"> +--------------------------------------------------<wbr>------------------+</span></code></td>
</tr>
<tr valign="top">
<td class="ln">4</td><td class="sf3b2"><code><span class="sf9b2"> | CiviCRM version 4.2 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|</span></code></td>
<td class="ln">4</td><td class="sf3b2"><code><span class="sf9b2"> | CiviCRM version 4.2 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|</span></code></td>
</tr>
<tr valign="top">
<td class="ln">5</td><td class="sf3b2"><code><span class="sf9b2"> +--------------------------------------------------<wbr>------------------+</span></code></td>
<td class="ln">5</td><td class="sf3b2"><code><span class="sf9b2"> +--------------------------------------------------<wbr>------------------+</span></code></td>
</tr>
<tr valign="top">
<td class="ln">6</td><td class="sf3b2"><code><span class="sf9b2"> | Copyright CiviCRM LLC (c) 2004-2012 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|</span></code></td>
<td class="ln">6</td><td class="sf3b2"><code><span class="sf9b2"> | Copyright CiviCRM LLC (c) 2004-2012 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|</span></code></td>
</tr>
<tr valign="top">
<td class="ln">7</td><td class="sf3b2"><code><span class="sf9b2"> +--------------------------------------------------<wbr>------------------+</span></code></td>
<td class="ln">7</td><td class="sf3b2"><code><span class="sf9b2"> +--------------------------------------------------<wbr>------------------+</span></code></td>
</tr>
<tr valign="top">
<td class="ln">8</td><td class="sf3b2"><code><span class="sf9b2"> | This file is a part of CiviCRM. &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|</span></code></td>
<td class="ln">8</td><td class="sf3b2"><code><span class="sf9b2"> | This file is a part of CiviCRM. &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|</span></code></td>
</tr>
<tr valign="top">
<td class="ln">9</td><td class="sf3b2"><code><span class="sf9b2"> | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|</span></code></td>
<td class="ln">9</td><td class="sf3b2"><code><span class="sf9b2"> | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|</span></code></td>
</tr>
<tr valign="top">
<td class="ln">10</td><td class="sf3b2"><code><span class="sf9b2"> | CiviCRM is free software; you can copy, modify, and distribute it &nbsp;|</span></code></td>
<td class="ln">10</td><td class="sf3b2"><code><span class="sf9b2"> | CiviCRM is free software; you can copy, modify, and distribute it &nbsp;|</span></code></td>
</tr>
<tr valign="top">
<td class="ln">11</td><td class="sf3b2"><code><span class="sf9b2"> | under the terms of the GNU Affero General Public License &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |</span></code></td>
<td class="ln">11</td><td class="sf3b2"><code><span class="sf9b2"> | under the terms of the GNU Affero General Public License &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |</span></code></td>
</tr>
<tr valign="top">
<td class="ln">12</td><td class="sf3b2"><code><span class="sf9b2"> | Version 3, 19 November 2007 and the CiviCRM Licensing Exception. &nbsp; |</span></code></td>
<td class="ln">12</td><td class="sf3b2"><code><span class="sf9b2"> | Version 3, 19 November 2007 and the CiviCRM Licensing Exception. &nbsp; |</span></code></td>
</tr>
<tr valign="top">
<td class="ln">13</td><td class="sf3b2"><code><span class="sf9b2"> | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|</span></code></td>
<td class="ln">13</td><td class="sf3b2"><code><span class="sf9b2"> | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|</span></code></td>
</tr>
<tr valign="top">
<td class="ln">14</td><td class="sf3b2"><code><span class="sf9b2"> | CiviCRM is distributed in the hope that it will be useful, but &nbsp; &nbsp; |</span></code></td>
<td class="ln">14</td><td class="sf3b2"><code><span class="sf9b2"> | CiviCRM is distributed in the hope that it will be useful, but &nbsp; &nbsp; |</span></code></td>
</tr>
<tr valign="top">
<td class="ln">15</td><td class="sf3b2"><code><span class="sf9b2"> | WITHOUT ANY WARRANTY; without even the implied warranty of &nbsp; &nbsp; &nbsp; &nbsp; |</span></code></td>
<td class="ln">15</td><td class="sf3b2"><code><span class="sf9b2"> | WITHOUT ANY WARRANTY; without even the implied warranty of &nbsp; &nbsp; &nbsp; &nbsp; |</span></code></td>
</tr>
<tr valign="top">
<td class="ln">16</td><td class="sf3b2"><code><span class="sf9b2"> | MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |</span></code></td>
<td class="ln">16</td><td class="sf3b2"><code><span class="sf9b2"> | MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |</span></code></td>
</tr>
<tr valign="top">
<td class="ln">17</td><td class="sf3b2"><code><span class="sf9b2"> | See the GNU Affero General Public License for more details. &nbsp; &nbsp; &nbsp; &nbsp;|</span></code></td>
<td class="ln">17</td><td class="sf3b2"><code><span class="sf9b2"> | See the GNU Affero General Public License for more details. &nbsp; &nbsp; &nbsp; &nbsp;|</span></code></td>
</tr>
<tr valign="top">
<td class="ln">18</td><td class="sf3b2"><code><span class="sf9b2"> | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|</span></code></td>
<td class="ln">18</td><td class="sf3b2"><code><span class="sf9b2"> | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|</span></code></td>
</tr>
<tr valign="top">
<td class="ln">19</td><td class="sf3b2"><code><span class="sf9b2"> | You should have received a copy of the GNU Affero General Public &nbsp; |</span></code></td>
<td class="ln">19</td><td class="sf3b2"><code><span class="sf9b2"> | You should have received a copy of the GNU Affero General Public &nbsp; |</span></code></td>
</tr>
<tr valign="top">
<td class="ln">20</td><td class="sf3b2"><code><span class="sf9b2"> | License and the CiviCRM Licensing Exception along &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|</span></code></td>
<td class="ln">20</td><td class="sf3b2"><code><span class="sf9b2"> | License and the CiviCRM Licensing Exception along &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|</span></code></td>
</tr>
<tr valign="top">
<td class="ln">21</td><td class="sf3b2"><code><span class="sf9b2"> | with this program; if not, contact CiviCRM LLC &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |</span></code></td>
<td class="ln">21</td><td class="sf3b2"><code><span class="sf9b2"> | with this program; if not, contact CiviCRM LLC &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |</span></code></td>
</tr>
<tr valign="top">
<td class="ln">22</td><td class="sf3b2"><code><span class="sf9b2"> | at info[AT]civicrm[DOT]org. If you have questions about the &nbsp; &nbsp; &nbsp; &nbsp;|</span></code></td>
<td class="ln">22</td><td class="sf3b2"><code><span class="sf9b2"> | at info[AT]civicrm[DOT]org. If you have questions about the &nbsp; &nbsp; &nbsp; &nbsp;|</span></code></td>
</tr>
<tr valign="top">
<td class="ln">23</td><td class="sf3b2"><code><span class="sf9b2"> | GNU Affero General Public License or the licensing of CiviCRM, &nbsp; &nbsp; |</span></code></td>
<td class="ln">23</td><td class="sf3b2"><code><span class="sf9b2"> | GNU Affero General Public License or the licensing of CiviCRM, &nbsp; &nbsp; |</span></code></td>
</tr>
<tr valign="top">
<td class="ln">24</td><td class="sf3b2"><code><span class="sf9b2"> | see the CiviCRM license FAQ at http://civicrm.org/licensing &nbsp; &nbsp; &nbsp; &nbsp;|</span></code></td>
<td class="ln">24</td><td class="sf3b2"><code><span class="sf9b2"> | see the CiviCRM license FAQ at http://civicrm.org/licensing &nbsp; &nbsp; &nbsp; &nbsp;|</span></code></td>
</tr>
<tr valign="top">
<td class="ln">25</td><td class="sf3b2"><code><span class="sf9b2"> +--------------------------------------------------<wbr>------------------+</span></code></td>
<td class="ln">25</td><td class="sf3b2"><code><span class="sf9b2"> +--------------------------------------------------<wbr>------------------+</span></code></td>
</tr>
<tr valign="top">
<td class="ln">26</td><td class="sf3b2"><code><span class="sf9b2">*/</span>&nbsp;</code></td>
<td class="ln">26</td><td class="sf3b2"><code><span class="sf9b2">*/</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">27</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">27</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">28</td><td class="sf3b2"><code><span class="sf9b2">/**</span></code></td>
<td class="ln">28</td><td class="sf3b2"><code><span class="sf9b2">/**</span></code></td>
</tr>
<tr valign="top">
<td class="ln">29</td><td class="sf3b2"><code><span class="sf9b2"> *</span></code></td>
<td class="ln">29</td><td class="sf3b2"><code><span class="sf9b2"> *</span></code></td>
</tr>
<tr valign="top">
<td class="ln">30</td><td class="sf3b2"><code><span class="sf9b2"> *</span></code></td>
<td class="ln">30</td><td class="sf3b2"><code><span class="sf9b2"> *</span></code></td>
</tr>
<tr valign="top">
<td class="ln">31</td><td class="sf3b2"><code><span class="sf9b2"> * @package CRM</span></code></td>
<td class="ln">31</td><td class="sf3b2"><code><span class="sf9b2"> * @package CRM</span></code></td>
</tr>
<tr valign="top">
<td class="ln">32</td><td class="sf3b2"><code><span class="sf9b2"> * @copyright CiviCRM LLC (c) 2004-2012</span></code></td>
<td class="ln">32</td><td class="sf3b2"><code><span class="sf9b2"> * @copyright CiviCRM LLC (c) 2004-2012</span></code></td>
</tr>
<tr valign="top">
<td class="ln">33</td><td class="sf3b2"><code><span class="sf9b2"> * $Id$</span></code></td>
<td class="ln">33</td><td class="sf3b2"><code><span class="sf9b2"> * $Id$</span></code></td>
</tr>
<tr valign="top">
<td class="ln">34</td><td class="sf3b2"><code><span class="sf9b2"> *</span></code></td>
<td class="ln">34</td><td class="sf3b2"><code><span class="sf9b2"> *</span></code></td>
</tr>
<tr valign="top">
<td class="ln">35</td><td class="sf3b2"><code><span class="sf9b2"> */</span>&nbsp;</code></td>
<td class="ln">35</td><td class="sf3b2"><code><span class="sf9b2"> */</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">36</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">36</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">37</td><td class="sf3b2"><code><span class="sf9b2">/**</span></code></td>
<td class="ln">37</td><td class="sf3b2"><code><span class="sf9b2">/**</span></code></td>
</tr>
<tr valign="top">
<td class="ln">38</td><td class="sf3b2"><code><span class="sf9b2"> * This class generates form components for processing Event</span></code></td>
<td class="ln">38</td><td class="sf3b2"><code><span class="sf9b2"> * This class generates form components for processing Event</span></code></td>
</tr>
<tr valign="top">
<td class="ln">39</td><td class="sf3b2"><code><span class="sf9b2"> *</span></code></td>
<td class="ln">39</td><td class="sf3b2"><code><span class="sf9b2"> *</span></code></td>
</tr>
<tr valign="top">
<td class="ln">40</td><td class="sf3b2"><code><span class="sf9b2"> */</span>&nbsp;</code></td>
<td class="ln">40</td><td class="sf3b2"><code><span class="sf9b2"> */</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">41</td><td class="sf3b2"><code><span class="sf7b2">class</span><span class="sf3b2"> CRM_Event_Form_Registration_Confirm extends CRM_Event_Form_Registration {</span></code></td>
<td class="ln">41</td><td class="sf3b2"><code><span class="sf7b2">class</span><span class="sf3b2"> CRM_Event_Form_Registration_Confirm extends CRM_Event_Form_Registration {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">42</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">42</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">43</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf9b2">/**</span></code></td>
<td class="ln">43</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf9b2">/**</span></code></td>
</tr>
<tr valign="top">
<td class="ln">44</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * the values for the contribution db object</span></code></td>
<td class="ln">44</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * the values for the contribution db object</span></code></td>
</tr>
<tr valign="top">
<td class="ln">45</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; *</span></code></td>
<td class="ln">45</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; *</span></code></td>
</tr>
<tr valign="top">
<td class="ln">46</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @var array</span></code></td>
<td class="ln">46</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @var array</span></code></td>
</tr>
<tr valign="top">
<td class="ln">47</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @protected</span></code></td>
<td class="ln">47</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @protected</span></code></td>
</tr>
<tr valign="top">
<td class="ln">48</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; */</span>&nbsp;</code></td>
<td class="ln">48</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; */</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">49</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;public $</span><span class="sf18b2">_values;</span></code></td>
<td class="ln">49</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;public $</span><span class="sf18b2">_values;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">50</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">50</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">51</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf9b2">/**</span></code></td>
<td class="ln">51</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf9b2">/**</span></code></td>
</tr>
<tr valign="top">
<td class="ln">52</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * the total amount</span></code></td>
<td class="ln">52</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * the total amount</span></code></td>
</tr>
<tr valign="top">
<td class="ln">53</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; *</span></code></td>
<td class="ln">53</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; *</span></code></td>
</tr>
<tr valign="top">
<td class="ln">54</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @var float</span></code></td>
<td class="ln">54</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @var float</span></code></td>
</tr>
<tr valign="top">
<td class="ln">55</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @public</span></code></td>
<td class="ln">55</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @public</span></code></td>
</tr>
<tr valign="top">
<td class="ln">56</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; */</span>&nbsp;</code></td>
<td class="ln">56</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; */</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">57</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;public $</span><span class="sf18b2">_totalAmount;</span></code></td>
<td class="ln">57</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;public $</span><span class="sf18b2">_totalAmount;</span></code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">58</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp;
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">59</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp;public $</span><span class="sf17b16">_ppTypeConfirm;
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">58</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">60</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">59</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf9b2">/**</span></code></td>
<td class="ln">61</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf9b2">/**</span></code></td>
</tr>
<tr valign="top">
<td class="ln">60</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * Function to set variables up before form is built</span></code></td>
<td class="ln">62</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * Function to set variables up before form is built</span></code></td>
</tr>
<tr valign="top">
<td class="ln">61</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; *</span></code></td>
<td class="ln">63</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; *</span></code></td>
</tr>
<tr valign="top">
<td class="ln">62</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @return void</span></code></td>
<td class="ln">64</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @return void</span></code></td>
</tr>
<tr valign="top">
<td class="ln">63</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @access public</span></code></td>
<td class="ln">65</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @access public</span></code></td>
</tr>
<tr valign="top">
<td class="ln">64</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; */</span><span class="sf3b2"> </span><span class="sf7b2">function</span><span class="sf3b2"> </span><span class="sf8b2">preProcess</span><span class="sf3b2">() {</span></code></td>
<td class="ln">66</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; */</span><span class="sf3b2"> </span><span class="sf7b2">function</span><span class="sf3b2"> </span><span class="sf8b2">preProcess</span><span class="sf3b2">() {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">65</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf8b2">parent::preProcess</span><span class="sf3b2">();</span></code></td>
<td class="ln">67</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf8b2">parent::preProcess</span><span class="sf3b2">();</span></code></td>
</tr>
<tr valign="top">
<td class="ln">66</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16">
</span>&nbsp;</code></td>
<td class="ln">68</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp;
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">69</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp;</span><span class="sf17b16">// BOT - get pptype from URL on payment processor selection action
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">70</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp;$</span><span class="sf17b16">this-&gt;</span><span class="sf17b16">_ppTypeConfirm = CRM_Utils_Array::value</span><span class="sf17b16">(</span><span class="sf17b16">'type'</span><span class="sf17b16">, $</span><span class="sf17b16">_GET);
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">71</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; 
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">72</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp;$</span><span class="sf17b16">this-&gt;</span><span class="sf17b16">assign</span><span class="sf17b16">(</span><span class="sf17b16">'ppTypeConfirm'</span><span class="sf17b16">, FALSE);
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">73</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp;</span><span class="sf17b16">if</span><span class="sf17b16"> ($</span><span class="sf17b16">this-&gt;_ppTypeConfirm) {
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">74</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp;$</span><span class="sf17b16">this-&gt;</span><span class="sf17b16">assign</span><span class="sf17b16">(</span><span class="sf17b16">'ppTypeConfirm'</span><span class="sf17b16">, TRUE);
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">75</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp;</span><span class="sf17b16">return</span><span class="sf17b16"> </span><span class="sf17b16">CRM_Core_Payment_ProcessorForm::preProcess</span><span class="sf17b16">($</span><span class="sf17b16">this);
<wbr></span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">76</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp;}
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">77</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp;</span><span class="sf17b16">//Ends
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">78</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp;
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">67</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// lineItem isn't set until Register postProcess</span></code></td>
<td class="ln">79</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// lineItem isn't set until Register postProcess</span></code></td>
</tr>
<tr valign="top">
<td class="ln">68</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_lineItem = $</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">get</span><span class="sf3b2">(</span><span class="sf12b2">'lineItem'</span><span class="sf3b2">);</span></code></td>
<td class="ln">80</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_lineItem = $</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">get</span><span class="sf3b2">(</span><span class="sf12b2">'lineItem'</span><span class="sf3b2">);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">69</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_params = $</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">get</span><span class="sf3b2">(</span><span class="sf12b2">'params'</span><span class="sf3b2">);</span></code></td>
<td class="ln">81</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_params = $</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">get</span><span class="sf3b2">(</span><span class="sf12b2">'params'</span><span class="sf3b2">);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">70</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16">
</span>&nbsp;</code></td>
<td class="ln">82</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; 
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">71</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_params[0][</span><span class="sf12b2">'is_pay_later'</span><span class="sf3b2">] = $</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">get</span><span class="sf3b2">(</span><span class="sf12b2">'is_pay_later'</span><span class="sf3b2">);</span></code></td>
<td class="ln">83</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_params[0][</span><span class="sf12b2">'is_pay_later'</span><span class="sf3b2">] = $</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">get</span><span class="sf3b2">(</span><span class="sf12b2">'is_pay_later'</span><span class="sf3b2">);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">72</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">assign</span><span class="sf3b2">(</span><span class="sf12b2">'is_pay_later'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_params[0][</span><span class="sf12b2">'is_pay_later'</span><span class="sf3b2">]);</span></code></td>
<td class="ln">84</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">assign</span><span class="sf3b2">(</span><span class="sf12b2">'is_pay_later'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_params[0][</span><span class="sf12b2">'is_pay_later'</span><span class="sf3b2">]);</span></code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">85</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; 
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">73</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">this-&gt;_params[0][</span><span class="sf12b2">'is_pay_later'</span><span class="sf3b2">]) {</span></code></td>
<td class="ln">86</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">this-&gt;_params[0][</span><span class="sf12b2">'is_pay_later'</span><span class="sf3b2">]) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">74</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">assign</span><span class="sf3b2">(</span><span class="sf12b2">'pay_later_receipt'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">][</span><span class="sf12b2">'pay_later_receipt'</span><span class="sf3b2">]);</span></code></td>
<td class="ln">87</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">assign</span><span class="sf3b2">(</span><span class="sf12b2">'pay_later_receipt'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">][</span><span class="sf12b2">'pay_later_receipt'</span><span class="sf3b2">]);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">75</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">88</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">76</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">89</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">77</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf8b2">CRM_Utils_Hook::eventDiscount</span><span class="sf3b2">($</span><span class="sf18b2">this, $</span><span class="sf18b2">this-&gt;_params);</span></code></td>
<td class="ln">90</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf8b2">CRM_Utils_Hook::eventDiscount</span><span class="sf3b2">($</span><span class="sf18b2">this, $</span><span class="sf18b2">this-&gt;_params);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">78</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">91</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">79</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'discount'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_params[0]) &amp;&amp;</span></code></td>
<td class="ln">92</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'discount'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_params[0]) &amp;&amp;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">80</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'applied'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_params[0][</span><span class="sf12b2">'discount'</span><span class="sf3b2">])</span></code></td>
<td class="ln">93</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'applied'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_params[0][</span><span class="sf12b2">'discount'</span><span class="sf3b2">])</span></code></td>
</tr>
<tr valign="top">
<td class="ln">81</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;) {</span></code></td>
<td class="ln">94</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">82</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">set</span><span class="sf3b2">(</span><span class="sf12b2">'hookDiscount'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_params[0][</span><span class="sf12b2">'discount'</span><span class="sf3b2">]);</span></code></td>
<td class="ln">95</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">set</span><span class="sf3b2">(</span><span class="sf12b2">'hookDiscount'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_params[0][</span><span class="sf12b2">'discount'</span><span class="sf3b2">]);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">83</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">assign</span><span class="sf3b2">(</span><span class="sf12b2">'hookDiscount'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_params[0][</span><span class="sf12b2">'discount'</span><span class="sf3b2">]);</span></code></td>
<td class="ln">96</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">assign</span><span class="sf3b2">(</span><span class="sf12b2">'hookDiscount'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_params[0][</span><span class="sf12b2">'discount'</span><span class="sf3b2">]);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">84</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">97</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">85</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">98</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">86</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">config = </span><span class="sf8b2">CRM_Core_Config::singleton</span><span class="sf3b2">();</span></code></td>
<td class="ln">99</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">config = </span><span class="sf8b2">CRM_Core_Config::singleton</span><span class="sf3b2">();</span></code></td>
</tr>
<tr valign="top">
<td class="ln">87</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">this-&gt;_contributeMode == </span><span class="sf12b2">'express'</span><span class="sf3b2">) {</span></code></td>
<td class="ln">100</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">this-&gt;_contributeMode == </span><span class="sf12b2">'express'</span><span class="sf3b2">) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">88</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">params = </span><span class="sf7b2">array</span><span class="sf3b2">();</span></code></td>
<td class="ln">101</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">params = </span><span class="sf7b2">array</span><span class="sf3b2">();</span></code></td>
</tr>
<tr valign="top">
<td class="ln">89</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">// rfp == redirect from paypal</span></code></td>
<td class="ln">102</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">// rfp == redirect from paypal</span></code></td>
</tr>
<tr valign="top">
<td class="ln">90</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">rfp = </span><span class="sf8b2">CRM_Utils_Request::retrieve</span><span class="sf3b2">(</span><span class="sf12b2">'rfp'</span><span class="sf3b2">, </span><span class="sf12b2">'Boolean'</span><span class="sf3b2">,</span></code></td>
<td class="ln">103</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">rfp = </span><span class="sf8b2">CRM_Utils_Request::retrieve</span><span class="sf3b2">(</span><span class="sf12b2">'rfp'</span><span class="sf3b2">, </span><span class="sf12b2">'Boolean'</span><span class="sf3b2">,</span></code></td>
</tr>
<tr valign="top">
<td class="ln">91</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;CRM_Core_DAO::$</span><span class="sf18b2">_nullObject, FALSE, NULL, </span><span class="sf12b2">'GET'</span>&nbsp;</code></td>
<td class="ln">104</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;CRM_Core_DAO::$</span><span class="sf18b2">_nullObject, FALSE, NULL, </span><span class="sf12b2">'GET'</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">92</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;);</span></code></td>
<td class="ln">105</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">93</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">106</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">94</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">//we lost rfp in case of additional participant. So set it explicitly.</span></code></td>
<td class="ln">107</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">//we lost rfp in case of additional participant. So set it explicitly.</span></code></td>
</tr>
<tr valign="top">
<td class="ln">95</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">rfp || </span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'additional_participants'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_params[0], FALSE)) {</span></code></td>
<td class="ln">108</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">rfp || </span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'additional_participants'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_params[0], FALSE)) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">96</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">payment = </span><span class="sf8b2">CRM_Core_Payment::singleton</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;_mode, $</span><span class="sf18b2">this-&gt;_paymentProcessor, $</span><span class="sf18b2">this);</span></code></td>
<td class="ln">109</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">payment = </span><span class="sf8b2">CRM_Core_Payment::singleton</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;_mode, $</span><span class="sf18b2">this-&gt;_paymentProcessor, $</span><span class="sf18b2">this);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">97</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">paymentObjError = </span><span class="sf8b2">ts</span><span class="sf3b2">(</span><span class="sf12b2">'The system did not record payment details for this payment and so could not process the transaction. Please report this error to the site administrator.'</span><span class="sf3b2">);</span></code></td>
<td class="ln">110</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">paymentObjError = </span><span class="sf8b2">ts</span><span class="sf3b2">(</span><span class="sf12b2">'The system did not record payment details for this payment and so could not process the transaction. Please report this error to the site administrator.'</span><span class="sf3b2">);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">98</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">is_object</span><span class="sf3b2">($</span><span class="sf18b2">payment)) </span></code></td>
<td class="ln">111</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">is_object</span><span class="sf3b2">($</span><span class="sf18b2">payment)) </span></code></td>
</tr>
<tr valign="top">
<td class="ln">99</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">expressParams = $</span><span class="sf18b2">payment-&gt;</span><span class="sf8b2">getExpressCheckoutDetails</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">get</span><span class="sf3b2">(</span><span class="sf12b2">'tok<wbr>en'</span><span class="sf3b2">));</span></code></td>
<td class="ln">112</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">expressParams = $</span><span class="sf18b2">payment-&gt;</span><span class="sf8b2">getExpressCheckoutDetails</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">get</span><span class="sf3b2">(</span><span class="sf12b2">'tok<wbr>en'</span><span class="sf3b2">));</span></code></td>
</tr>
<tr valign="top">
<td class="ln">100</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">else</span></code></td>
<td class="ln">113</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">else</span></code></td>
</tr>
<tr valign="top">
<td class="ln">101</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">CRM_Core_Error::fatal</span><span class="sf3b2">($</span><span class="sf18b2">paymentObjError);</span></code></td>
<td class="ln">114</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">CRM_Core_Error::fatal</span><span class="sf3b2">($</span><span class="sf18b2">paymentObjError);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">102</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span>&nbsp;</code></td>
<td class="ln">115</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">103</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">params[</span><span class="sf12b2">'payer'</span><span class="sf3b2">] = $</span><span class="sf18b2">expressParams[</span><span class="sf12b2">'payer'</span><span class="sf3b2">];</span></code></td>
<td class="ln">116</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">params[</span><span class="sf12b2">'payer'</span><span class="sf3b2">] = $</span><span class="sf18b2">expressParams[</span><span class="sf12b2">'payer'</span><span class="sf3b2">];</span></code></td>
</tr>
<tr valign="top">
<td class="ln">104</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">params[</span><span class="sf12b2">'payer_id'</span><span class="sf3b2">] = $</span><span class="sf18b2">expressParams[</span><span class="sf12b2">'payer_id'</span><span class="sf3b2">];</span></code></td>
<td class="ln">117</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">params[</span><span class="sf12b2">'payer_id'</span><span class="sf3b2">] = $</span><span class="sf18b2">expressParams[</span><span class="sf12b2">'payer_id'</span><span class="sf3b2">];</span></code></td>
</tr>
<tr valign="top">
<td class="ln">105</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">params[</span><span class="sf12b2">'payer_status'</span><span class="sf3b2">] = $</span><span class="sf18b2">expressParams[</span><span class="sf12b2">'payer_status'</span><span class="sf3b2">];</span></code></td>
<td class="ln">118</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">params[</span><span class="sf12b2">'payer_status'</span><span class="sf3b2">] = $</span><span class="sf18b2">expressParams[</span><span class="sf12b2">'payer_status'</span><span class="sf3b2">];</span></code></td>
</tr>
<tr valign="top">
<td class="ln">106</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">119</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">107</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">CRM_Core_Payment_Form::mapParams</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;_bltID, $</span><span class="sf18b2">expressParams, $</span><span class="sf18b2">params, FALSE);</span></code></td>
<td class="ln">120</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">CRM_Core_Payment_Form::mapParams</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;_bltID, $</span><span class="sf18b2">expressParams, $</span><span class="sf18b2">params, FALSE);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">108</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">121</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">109</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">// fix state and country id if present</span></code></td>
<td class="ln">122</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">// fix state and country id if present</span></code></td>
</tr>
<tr valign="top">
<td class="ln">110</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf7b2">isset</span><span class="sf3b2">($</span><span class="sf18b2">params[</span><span class="sf12b2">"billing_state_province_id-{$this-&gt;_<wbr>bltID}"</span><span class="sf3b2">])) {</span></code></td>
<td class="ln">123</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf7b2">isset</span><span class="sf3b2">($</span><span class="sf18b2">params[</span><span class="sf12b2">"billing_state_province_id-{$this-&gt;_<wbr>bltID}"</span><span class="sf3b2">])) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">111</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">params[</span><span class="sf12b2">"billing_state_province-{$this-&gt;_bltID}"</span><span class="sf3b2">] = </span><span class="sf8b2">CRM_Core_PseudoConstant::stateProvinceAbbreviation</span><span class="sf3b2">(<wbr>$</span><span class="sf18b2">params[</span><span class="sf12b2">"billing_state_province_id-{$this-&gt;_bltID}"<wbr></span><span class="sf3b2">]);</span></code></td>
<td class="ln">124</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">params[</span><span class="sf12b2">"billing_state_province-{$this-&gt;_bltID}"</span><span class="sf3b2">] = </span><span class="sf8b2">CRM_Core_PseudoConstant::stateProvinceAbbreviation</span><span class="sf3b2">(<wbr>$</span><span class="sf18b2">params[</span><span class="sf12b2">"billing_state_province_id-{$this-&gt;_bltID}"<wbr></span><span class="sf3b2">]);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">112</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">125</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">113</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf7b2">isset</span><span class="sf3b2">($</span><span class="sf18b2">params[</span><span class="sf12b2">'billing_country_id'</span><span class="sf3b2">])) {</span></code></td>
<td class="ln">126</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf7b2">isset</span><span class="sf3b2">($</span><span class="sf18b2">params[</span><span class="sf12b2">'billing_country_id'</span><span class="sf3b2">])) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">114</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">params[</span><span class="sf12b2">"billing_country-{$this-&gt;_bltID}"</span><span class="sf3b2">] = </span><span class="sf8b2">CRM_Core_PseudoConstant::countryIsoCode</span><span class="sf3b2">($</span><span class="sf18b2">params[</span><span class="sf12b2">"bi<wbr>lling_country_id-{$this-&gt;_bltID}"</span><span class="sf3b2">]);</span></code></td>
<td class="ln">127</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">params[</span><span class="sf12b2">"billing_country-{$this-&gt;_bltID}"</span><span class="sf3b2">] = </span><span class="sf8b2">CRM_Core_PseudoConstant::countryIsoCode</span><span class="sf3b2">($</span><span class="sf18b2">params[</span><span class="sf12b2">"bi<wbr>lling_country_id-{$this-&gt;_bltID}"</span><span class="sf3b2">]);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">115</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">128</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">116</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">129</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">117</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">// set a few other parameters for PayPal</span></code></td>
<td class="ln">130</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">// set a few other parameters for PayPal</span></code></td>
</tr>
<tr valign="top">
<td class="ln">118</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">params[</span><span class="sf12b2">'token'</span><span class="sf3b2">] = $</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">get</span><span class="sf3b2">(</span><span class="sf12b2">'token'</span><span class="sf3b2">);</span></code></td>
<td class="ln">131</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">params[</span><span class="sf12b2">'token'</span><span class="sf3b2">] = $</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">get</span><span class="sf3b2">(</span><span class="sf12b2">'token'</span><span class="sf3b2">);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">119</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">params[</span><span class="sf12b2">'amount'</span><span class="sf3b2">] = $</span><span class="sf18b2">this-&gt;_params[0][</span><span class="sf12b2">'amount'</span><span class="sf3b2">];</span></code></td>
<td class="ln">132</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">params[</span><span class="sf12b2">'amount'</span><span class="sf3b2">] = $</span><span class="sf18b2">this-&gt;_params[0][</span><span class="sf12b2">'amount'</span><span class="sf3b2">];</span></code></td>
</tr>
<tr valign="top">
<td class="ln">120</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'discount'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_params[0])) {</span></code></td>
<td class="ln">133</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'discount'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_params[0])) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">121</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">params[</span><span class="sf12b2">'discount'</span><span class="sf3b2">] = $</span><span class="sf18b2">this-&gt;_params[0][</span><span class="sf12b2">'discount'</span><span class="sf3b2">];</span></code></td>
<td class="ln">134</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">params[</span><span class="sf12b2">'discount'</span><span class="sf3b2">] = $</span><span class="sf18b2">this-&gt;_params[0][</span><span class="sf12b2">'discount'</span><span class="sf3b2">];</span></code></td>
</tr>
<tr valign="top">
<td class="ln">122</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">params[</span><span class="sf12b2">'discountAmount'</span><span class="sf3b2">] = $</span><span class="sf18b2">this-&gt;_params[0][</span><span class="sf12b2">'discountAmount'</span><span class="sf3b2">];</span></code></td>
<td class="ln">135</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">params[</span><span class="sf12b2">'discountAmount'</span><span class="sf3b2">] = $</span><span class="sf18b2">this-&gt;_params[0][</span><span class="sf12b2">'discountAmount'</span><span class="sf3b2">];</span></code></td>
</tr>
<tr valign="top">
<td class="ln">123</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">params[</span><span class="sf12b2">'discountMessage'</span><span class="sf3b2">] = $</span><span class="sf18b2">this-&gt;_params[0][</span><span class="sf12b2">'discountMessage'</span><span class="sf3b2">];</span></code></td>
<td class="ln">136</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">params[</span><span class="sf12b2">'discountMessage'</span><span class="sf3b2">] = $</span><span class="sf18b2">this-&gt;_params[0][</span><span class="sf12b2">'discountMessage'</span><span class="sf3b2">];</span></code></td>
</tr>
<tr valign="top">
<td class="ln">124</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">137</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">125</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">params[</span><span class="sf12b2">'amount_level'</span><span class="sf3b2">] = $</span><span class="sf18b2">this-&gt;_params[0][</span><span class="sf12b2">'amount_level'</span><span class="sf3b2">];</span></code></td>
<td class="ln">138</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">params[</span><span class="sf12b2">'amount_level'</span><span class="sf3b2">] = $</span><span class="sf18b2">this-&gt;_params[0][</span><span class="sf12b2">'amount_level'</span><span class="sf3b2">];</span></code></td>
</tr>
<tr valign="top">
<td class="ln">126</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">params[</span><span class="sf12b2">'currencyID'</span><span class="sf3b2">] = $</span><span class="sf18b2">this-&gt;_params[0][</span><span class="sf12b2">'currencyID'</span><span class="sf3b2">];</span></code></td>
<td class="ln">139</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">params[</span><span class="sf12b2">'currencyID'</span><span class="sf3b2">] = $</span><span class="sf18b2">this-&gt;_params[0][</span><span class="sf12b2">'currencyID'</span><span class="sf3b2">];</span></code></td>
</tr>
<tr valign="top">
<td class="ln">127</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">params[</span><span class="sf12b2">'payment_action'</span><span class="sf3b2">] = </span><span class="sf12b2">'Sale'</span><span class="sf3b2">;</span></code></td>
<td class="ln">140</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">params[</span><span class="sf12b2">'payment_action'</span><span class="sf3b2">] = </span><span class="sf12b2">'Sale'</span><span class="sf3b2">;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">128</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">141</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">129</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">// also merge all the other values from the profile fields</span></code></td>
<td class="ln">142</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">// also merge all the other values from the profile fields</span></code></td>
</tr>
<tr valign="top">
<td class="ln">130</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp;</span><span class="sf17b16"> &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">$</span><span style="color: #000000; background-color: #efcb05; ">values = $</span><span style="color: #000000; background-color: #efcb05; ">this-&gt;</span><span style="color: #000000; background-color: #efcb05; ">controller-&gt;exportValues</span><span style="color: #000000; background-color: #efcb05; ">(</span><span style="color: #000000; background-color: #efcb05; ">'Register'</span><span style="color: #000000; background-color: #efcb05; ">);</span></code></td>
<td class="ln">143</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp;</span><span class="sf17b16">//</span><span style="color: #000000; background-color: #efcb05; "> &nbsp;$values = $this-&gt;controller-&gt;exportValues('Register');</span></code></td>
</tr>
<tr valign="top">
<td class="ln">131</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">skipFields = </span><span class="sf7b2">array</span><span class="sf3b2">(</span></code></td>
<td class="ln">144</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">skipFields = </span><span class="sf7b2">array</span><span class="sf3b2">(</span></code></td>
</tr>
<tr valign="top">
<td class="ln">132</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'amount'</span><span class="sf3b2">,</span></code></td>
<td class="ln">145</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'amount'</span><span class="sf3b2">,</span></code></td>
</tr>
<tr valign="top">
<td class="ln">133</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">"street_address-{$this-&gt;_bltID}"</span><span class="sf3b2">,</span></code></td>
<td class="ln">146</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">"street_address-{$this-&gt;_bltID}"</span><span class="sf3b2">,</span></code></td>
</tr>
<tr valign="top">
<td class="ln">134</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">"city-{$this-&gt;_bltID}"</span><span class="sf3b2">,</span></code></td>
<td class="ln">147</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">"city-{$this-&gt;_bltID}"</span><span class="sf3b2">,</span></code></td>
</tr>
<tr valign="top">
<td class="ln">135</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">"state_province_id-{$this-&gt;_bltID}"</span><span class="sf3b2">,</span></code></td>
<td class="ln">148</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">"state_province_id-{$this-&gt;_bltID}"</span><span class="sf3b2">,</span></code></td>
</tr>
<tr valign="top">
<td class="ln">136</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">"postal_code-{$this-&gt;_bltID}"</span><span class="sf3b2">,</span></code></td>
<td class="ln">149</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">"postal_code-{$this-&gt;_bltID}"</span><span class="sf3b2">,</span></code></td>
</tr>
<tr valign="top">
<td class="ln">137</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">"country_id-{$this-&gt;_bltID}"</span><span class="sf3b2">,</span></code></td>
<td class="ln">150</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">"country_id-{$this-&gt;_bltID}"</span><span class="sf3b2">,</span></code></td>
</tr>
<tr valign="top">
<td class="ln">138</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;);</span></code></td>
<td class="ln">151</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">139</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">152</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">140</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">foreach</span><span class="sf3b2"> ($</span><span class="sf18b2">values </span><span class="sf7b2">as</span><span class="sf3b2"> $</span><span class="sf18b2">name =&gt; $</span><span class="sf18b2">value) {</span></code></td>
<td class="ln">153</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">foreach</span><span class="sf3b2"> ($</span><span class="sf18b2">values </span><span class="sf7b2">as</span><span class="sf3b2"> $</span><span class="sf18b2">name =&gt; $</span><span class="sf18b2">value) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">141</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">// skip amount field</span></code></td>
<td class="ln">154</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">// skip amount field</span></code></td>
</tr>
<tr valign="top">
<td class="ln">142</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!</span><span class="sf8b2">in_array</span><span class="sf3b2">($</span><span class="sf18b2">name, $</span><span class="sf18b2">skipFields)) {</span></code></td>
<td class="ln">155</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!</span><span class="sf8b2">in_array</span><span class="sf3b2">($</span><span class="sf18b2">name, $</span><span class="sf18b2">skipFields)) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">143</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">params[$</span><span class="sf18b2">name] = $</span><span class="sf18b2">value;</span></code></td>
<td class="ln">156</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">params[$</span><span class="sf18b2">name] = $</span><span class="sf18b2">value;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">144</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">157</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">145</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">158</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">146</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">set</span><span class="sf3b2">(</span><span class="sf12b2">'getExpressCheckoutDetails'</span><span class="sf3b2">, $</span><span class="sf18b2">params);</span></code></td>
<td class="ln">159</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">set</span><span class="sf3b2">(</span><span class="sf12b2">'getExpressCheckoutDetails'</span><span class="sf3b2">, $</span><span class="sf18b2">params);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">147</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">160</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">148</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">else</span><span class="sf3b2"> {</span></code></td>
<td class="ln">161</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">else</span><span class="sf3b2"> {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">149</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">params = $</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">get</span><span class="sf3b2">(</span><span class="sf12b2">'getExpressCheckoutDetails'</span><span class="sf3b2">);</span></code></td>
<td class="ln">162</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">params = $</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">get</span><span class="sf3b2">(</span><span class="sf12b2">'getExpressCheckoutDetails'</span><span class="sf3b2">);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">150</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">163</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">151</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_params[0] = $</span><span class="sf18b2">params;</span></code></td>
<td class="ln">164</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_params[0] = $</span><span class="sf18b2">params;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">152</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_params[0][</span><span class="sf12b2">'is_primary'</span><span class="sf3b2">] = 1;</span></code></td>
<td class="ln">165</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_params[0][</span><span class="sf12b2">'is_primary'</span><span class="sf3b2">] = 1;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">153</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">166</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">154</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">else</span><span class="sf3b2"> {</span></code></td>
<td class="ln">167</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">else</span><span class="sf3b2"> {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">155</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">//process only primary participant params.</span></code></td>
<td class="ln">168</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">//process only primary participant params.</span></code></td>
</tr>
<tr valign="top">
<td class="ln">156</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">registerParams = $</span><span class="sf18b2">this-&gt;_params[0];</span></code></td>
<td class="ln">169</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">registerParams = $</span><span class="sf18b2">this-&gt;_params[0];</span></code></td>
</tr>
<tr valign="top">
<td class="ln">157</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf7b2">isset</span><span class="sf3b2">($</span><span class="sf18b2">registerParams[</span><span class="sf12b2">"billing_state_province_id-{<wbr>$this-&gt;_bltID}"</span><span class="sf3b2">])</span></code></td>
<td class="ln">170</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf7b2">isset</span><span class="sf3b2">($</span><span class="sf18b2">registerParams[</span><span class="sf12b2">"billing_state_province_id-{<wbr>$this-&gt;_bltID}"</span><span class="sf3b2">])</span></code></td>
</tr>
<tr valign="top">
<td class="ln">158</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;&amp;&amp; $</span><span class="sf18b2">registerParams[</span><span class="sf12b2">"billing_state_province_id-{$this-&gt;<wbr>_bltID}"</span><span class="sf3b2">]</span></code></td>
<td class="ln">171</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;&amp;&amp; $</span><span class="sf18b2">registerParams[</span><span class="sf12b2">"billing_state_province_id-{$this-&gt;<wbr>_bltID}"</span><span class="sf3b2">]</span></code></td>
</tr>
<tr valign="top">
<td class="ln">159</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;) {</span></code></td>
<td class="ln">172</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">160</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">registerParams[</span><span class="sf12b2">"billing_state_province-{$this-&gt;_bl<wbr>tID}"</span><span class="sf3b2">] = </span><span class="sf8b2">CRM_Core_PseudoConstant::stateProvinceAbbreviation</span><span class="sf3b2">(<wbr>$</span><span class="sf18b2">registerParams[</span><span class="sf12b2">"billing_state_province_id-{$this-&gt;<wbr>_bltID}"</span><span class="sf3b2">]);</span></code></td>
<td class="ln">173</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">registerParams[</span><span class="sf12b2">"billing_state_province-{$this-&gt;_bl<wbr>tID}"</span><span class="sf3b2">] = </span><span class="sf8b2">CRM_Core_PseudoConstant::stateProvinceAbbreviation</span><span class="sf3b2">(<wbr>$</span><span class="sf18b2">registerParams[</span><span class="sf12b2">"billing_state_province_id-{$this-&gt;<wbr>_bltID}"</span><span class="sf3b2">]);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">161</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">174</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">162</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">175</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">163</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf7b2">isset</span><span class="sf3b2">($</span><span class="sf18b2">registerParams[</span><span class="sf12b2">"billing_country_id-{$this-&gt;<wbr>_bltID}"</span><span class="sf3b2">]) &amp;&amp; $</span><span class="sf18b2">registerParams[</span><span class="sf12b2">"billing_country_id-{$this-&gt;_bltID}<wbr>"</span><span class="sf3b2">]) {</span></code></td>
<td class="ln">176</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf7b2">isset</span><span class="sf3b2">($</span><span class="sf18b2">registerParams[</span><span class="sf12b2">"billing_country_id-{$this-&gt;<wbr>_bltID}"</span><span class="sf3b2">]) &amp;&amp; $</span><span class="sf18b2">registerParams[</span><span class="sf12b2">"billing_country_id-{$this-&gt;_bltID}<wbr>"</span><span class="sf3b2">]) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">164</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">registerParams[</span><span class="sf12b2">"billing_country-{$this-&gt;_bltID}"</span><span class="sf3b2">] = </span><span class="sf8b2">CRM_Core_PseudoConstant::countryIsoCode</span><span class="sf3b2">($</span><span class="sf18b2">registerPa<wbr>rams[</span><span class="sf12b2">"billing_country_id-{$this-&gt;_bltID}"</span><span class="sf3b2">]);</span></code></td>
<td class="ln">177</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">registerParams[</span><span class="sf12b2">"billing_country-{$this-&gt;_bltID}"</span><span class="sf3b2">] = </span><span class="sf8b2">CRM_Core_PseudoConstant::countryIsoCode</span><span class="sf3b2">($</span><span class="sf18b2">registerPa<wbr>rams[</span><span class="sf12b2">"billing_country_id-{$this-&gt;_bltID}"</span><span class="sf3b2">]);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">165</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">178</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">166</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf7b2">isset</span><span class="sf3b2">($</span><span class="sf18b2">registerParams[</span><span class="sf12b2">'credit_card_exp_date'</span><span class="sf3b2">])) {</span></code></td>
<td class="ln">179</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf7b2">isset</span><span class="sf3b2">($</span><span class="sf18b2">registerParams[</span><span class="sf12b2">'credit_card_exp_date'</span><span class="sf3b2">])) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">167</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">registerParams[</span><span class="sf12b2">'year'</span><span class="sf3b2">] = </span><span class="sf8b2">CRM_Core_Payment_Form::getCreditCardExpirationYear</span><span class="sf3b2">(<wbr>$</span><span class="sf18b2">registerParams);</span></code></td>
<td class="ln">180</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">registerParams[</span><span class="sf12b2">'year'</span><span class="sf3b2">] = </span><span class="sf8b2">CRM_Core_Payment_Form::getCreditCardExpirationYear</span><span class="sf3b2">(<wbr>$</span><span class="sf18b2">registerParams);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">168</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">registerParams[</span><span class="sf12b2">'month'</span><span class="sf3b2">] = </span><span class="sf8b2">CRM_Core_Payment_Form::getCreditCardExpirationMonth<wbr></span><span class="sf3b2">($</span><span class="sf18b2">registerParams);</span></code></td>
<td class="ln">181</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">registerParams[</span><span class="sf12b2">'month'</span><span class="sf3b2">] = </span><span class="sf8b2">CRM_Core_Payment_Form::getCreditCardExpirationMonth<wbr></span><span class="sf3b2">($</span><span class="sf18b2">registerParams);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">169</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">182</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">170</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">][</span><span class="sf12b2">'is_monetary'</span><span class="sf3b2">]) {</span></code></td>
<td class="ln">183</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">][</span><span class="sf12b2">'is_monetary'</span><span class="sf3b2">]) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">171</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">registerParams[</span><span class="sf12b2">'ip_address'</span><span class="sf3b2">] = </span><span class="sf8b2">CRM_Utils_System::ipAddress</span><span class="sf3b2">();</span></code></td>
<td class="ln">184</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">registerParams[</span><span class="sf12b2">'ip_address'</span><span class="sf3b2">] = </span><span class="sf8b2">CRM_Utils_System::ipAddress</span><span class="sf3b2">();</span></code></td>
</tr>
<tr valign="top">
<td class="ln">172</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">registerParams[</span><span class="sf12b2">'currencyID'</span><span class="sf3b2">] = $</span><span class="sf18b2">this-&gt;_params[0][</span><span class="sf12b2">'currencyID'</span><span class="sf3b2">];</span></code></td>
<td class="ln">185</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">registerParams[</span><span class="sf12b2">'currencyID'</span><span class="sf3b2">] = $</span><span class="sf18b2">this-&gt;_params[0][</span><span class="sf12b2">'currencyID'</span><span class="sf3b2">];</span></code></td>
</tr>
<tr valign="top">
<td class="ln">173</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">registerParams[</span><span class="sf12b2">'payment_action'</span><span class="sf3b2">] = </span><span class="sf12b2">'Sale'</span><span class="sf3b2">;</span></code></td>
<td class="ln">186</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">registerParams[</span><span class="sf12b2">'payment_action'</span><span class="sf3b2">] = </span><span class="sf12b2">'Sale'</span><span class="sf3b2">;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">174</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">187</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">175</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">//assign back primary participant params.</span></code></td>
<td class="ln">188</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">//assign back primary participant params.</span></code></td>
</tr>
<tr valign="top">
<td class="ln">176</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_params[0] = $</span><span class="sf18b2">registerParams;</span></code></td>
<td class="ln">189</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_params[0] = $</span><span class="sf18b2">registerParams;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">177</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">190</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">178</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">191</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">179</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">][</span><span class="sf12b2">'is_monetary'</span><span class="sf3b2">]) {</span></code></td>
<td class="ln">192</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">][</span><span class="sf12b2">'is_monetary'</span><span class="sf3b2">]) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">180</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_params[0][</span><span class="sf12b2">'invoiceID'</span><span class="sf3b2">] = $</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">get</span><span class="sf3b2">(</span><span class="sf12b2">'invoiceID'</span><span class="sf3b2">);</span></code></td>
<td class="ln">193</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_params[0][</span><span class="sf12b2">'invoiceID'</span><span class="sf3b2">] = $</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">get</span><span class="sf3b2">(</span><span class="sf12b2">'invoiceID'</span><span class="sf3b2">);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">181</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">194</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">182</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">assign</span><span class="sf3b2">(</span><span class="sf12b2">'defaultRole'</span><span class="sf3b2">, FALSE);</span></code></td>
<td class="ln">195</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">assign</span><span class="sf3b2">(</span><span class="sf12b2">'defaultRole'</span><span class="sf3b2">, FALSE);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">183</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'defaultRole'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_params[0]) == 1) {</span></code></td>
<td class="ln">196</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'defaultRole'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_params[0]) == 1) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">184</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">assign</span><span class="sf3b2">(</span><span class="sf12b2">'defaultRole'</span><span class="sf3b2">, TRUE);</span></code></td>
<td class="ln">197</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">assign</span><span class="sf3b2">(</span><span class="sf12b2">'defaultRole'</span><span class="sf3b2">, TRUE);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">185</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">198</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">186</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">199</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">187</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'participant_role_id'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_params[0]) &amp;&amp;</span></code></td>
<td class="ln">200</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'participant_role_id'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_params[0]) &amp;&amp;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">188</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">][</span><span class="sf12b2">'default_role_id'</span><span class="sf3b2">]</span></code></td>
<td class="ln">201</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">][</span><span class="sf12b2">'default_role_id'</span><span class="sf3b2">]</span></code></td>
</tr>
<tr valign="top">
<td class="ln">189</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;) {</span></code></td>
<td class="ln">202</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">190</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_params[0][</span><span class="sf12b2">'participant_role_id'</span><span class="sf3b2">] = $</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">][</span><span class="sf12b2">'default_role_id'</span><span class="sf3b2">];</span></code></td>
<td class="ln">203</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_params[0][</span><span class="sf12b2">'participant_role_id'</span><span class="sf3b2">] = $</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">][</span><span class="sf12b2">'default_role_id'</span><span class="sf3b2">];</span></code></td>
</tr>
<tr valign="top">
<td class="ln">191</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">204</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">192</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">205</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">193</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf7b2">isset</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">][</span><span class="sf12b2">'confirm_title'</span><span class="sf3b2">])) {</span></code></td>
<td class="ln">206</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf7b2">isset</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">][</span><span class="sf12b2">'confirm_title'</span><span class="sf3b2">])) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">194</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">CRM_Utils_System::setTitle</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">][<wbr></span><span class="sf12b2">'confirm_title'</span><span class="sf3b2">]);</span></code></td>
<td class="ln">207</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">CRM_Utils_System::setTitle</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">][<wbr></span><span class="sf12b2">'confirm_title'</span><span class="sf3b2">]);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">195</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">208</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">196</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">209</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">197</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">this-&gt;_pcpId) {</span></code></td>
<td class="ln">210</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">this-&gt;_pcpId) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">198</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">params = </span><span class="sf8b2">CRM_Contribute_Form_Contribution_Confirm::processPc<wbr>p</span><span class="sf3b2">($</span><span class="sf18b2">this, $</span><span class="sf18b2">this-&gt;_params[0]);</span></code></td>
<td class="ln">211</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">params = </span><span class="sf8b2">CRM_Contribute_Form_Contribution_Confirm::processPc<wbr>p</span><span class="sf3b2">($</span><span class="sf18b2">this, $</span><span class="sf18b2">this-&gt;_params[0]);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">199</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_params[0] = $</span><span class="sf18b2">params;</span></code></td>
<td class="ln">212</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_params[0] = $</span><span class="sf18b2">params;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">200</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">213</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">201</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16">
</span>&nbsp;</code></td>
<td class="ln">214</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp;
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">202</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">set</span><span class="sf3b2">(</span><span class="sf12b2">'params'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_params);</span></code></td>
<td class="ln">215</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">set</span><span class="sf3b2">(</span><span class="sf12b2">'params'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_params);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">203</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;}</span></code></td>
<td class="ln">216</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">204</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">217</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">205</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf9b2">/**</span></code></td>
<td class="ln">218</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf9b2">/**</span></code></td>
</tr>
<tr valign="top">
<td class="ln">206</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * overwrite action, since we are only showing elements in frozen mode</span></code></td>
<td class="ln">219</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * overwrite action, since we are only showing elements in frozen mode</span></code></td>
</tr>
<tr valign="top">
<td class="ln">207</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * no help display needed</span></code></td>
<td class="ln">220</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * no help display needed</span></code></td>
</tr>
<tr valign="top">
<td class="ln">208</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; *</span></code></td>
<td class="ln">221</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; *</span></code></td>
</tr>
<tr valign="top">
<td class="ln">209</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @return int</span></code></td>
<td class="ln">222</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @return int</span></code></td>
</tr>
<tr valign="top">
<td class="ln">210</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @access public</span></code></td>
<td class="ln">223</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @access public</span></code></td>
</tr>
<tr valign="top">
<td class="ln">211</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; */</span>&nbsp;</code></td>
<td class="ln">224</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; */</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">212</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf7b2">function</span><span class="sf3b2"> </span><span class="sf8b2">getAction</span><span class="sf3b2">() {</span></code></td>
<td class="ln">225</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf7b2">function</span><span class="sf3b2"> </span><span class="sf8b2">getAction</span><span class="sf3b2">() {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">213</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">this-&gt;_action &amp; CRM_Core_Action::PREVIEW) {</span></code></td>
<td class="ln">226</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">this-&gt;_action &amp; CRM_Core_Action::PREVIEW) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">214</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">return</span><span class="sf3b2"> CRM_Core_Action::VIEW | CRM_Core_Action::PREVIEW;</span></code></td>
<td class="ln">227</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">return</span><span class="sf3b2"> CRM_Core_Action::VIEW | CRM_Core_Action::PREVIEW;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">215</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">228</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">216</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">else</span><span class="sf3b2"> {</span></code></td>
<td class="ln">229</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">else</span><span class="sf3b2"> {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">217</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">return</span><span class="sf3b2"> CRM_Core_Action::VIEW;</span></code></td>
<td class="ln">230</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">return</span><span class="sf3b2"> CRM_Core_Action::VIEW;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">218</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">231</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">219</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;}</span></code></td>
<td class="ln">232</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">220</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">233</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">234</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> 
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">221</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf9b2">/**</span></code></td>
<td class="ln">235</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf9b2">/**</span></code></td>
</tr>
<tr valign="top">
<td class="ln">222</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * Function to build the form</span></code></td>
<td class="ln">236</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * Function to build the form</span></code></td>
</tr>
<tr valign="top">
<td class="ln">223</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; *</span></code></td>
<td class="ln">237</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; *</span></code></td>
</tr>
<tr valign="top">
<td class="ln">224</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @return None</span></code></td>
<td class="ln">238</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @return None</span></code></td>
</tr>
<tr valign="top">
<td class="ln">225</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @access public</span></code></td>
<td class="ln">239</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @access public</span></code></td>
</tr>
<tr valign="top">
<td class="ln">226</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; */</span>&nbsp;</code></td>
<td class="ln">240</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; */</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">227</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf8b2">public function buildQuickForm</span><span class="sf3b2">() {</span></code></td>
<td class="ln">241</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf8b2">public function buildQuickForm</span><span class="sf3b2">() {</span></code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">242</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp;</span><span class="sf17b16">//BOT - Add payment fields to the confirm page
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">243</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp;</span><span class="sf17b16">//If ppTypeConfirm is set then call to payment processor build form and return
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">244</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp;</span><span class="sf17b16">if</span><span class="sf17b16"> ($</span><span class="sf17b16">this-&gt;_ppTypeConfirm) {
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">245</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp;$</span><span class="sf17b16">this-&gt;</span><span class="sf17b16">assign</span><span class="sf17b16">(</span><span class="sf17b16">'display_name'</span><span class="sf17b16">, $</span><span class="sf17b16">display_name);
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">246</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp;</span><span class="sf17b16">CRM_Core_Payment_ProcessorForm::buildQuickForm</span><span class="sf17b16">($</span><span class="sf17b16">thi<wbr>s);
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">247</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp;</span><span class="sf17b16">return</span><span class="sf17b16">;
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">248</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp;}
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">249</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp;
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">250</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp;</span><span class="sf17b16">//if payment fields have to be shown on confirm page
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">251</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp;$</span><span class="sf17b16">this-&gt;_showPaymentFields = TRUE;
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">252</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp;</span><span class="sf17b16">if</span><span class="sf17b16"> ( $</span><span class="sf17b16">this-&gt;_params[0][</span><span class="sf17b16">'showPaymentFields'</span><span class="sf17b16">] ) {
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">253</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp;$</span><span class="sf17b16">this-&gt;_showPaymentFields = False;
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">254</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp;} &nbsp; &nbsp;
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">255</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16">
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">256</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp;$</span><span class="sf17b16">this-&gt;</span><span class="sf17b16">assign</span><span class="sf17b16">(</span><span class="sf17b16">'showPaymentFields'</span><span class="sf17b16">, $</span><span class="sf17b16">this-&gt;_showPaymentFields);
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">257</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp;</span><span class="sf17b16">if</span><span class="sf17b16"> ( $</span><span class="sf17b16">this-&gt;_showPaymentFields ) {
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">258</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp;$</span><span class="sf17b16">this-&gt;_bypassPayment = FALSE;
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">259</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp;</span><span class="sf17b16">//Call to function to add payment fields to the form
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">260</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp;</span><span class="sf17b16">require_once</span><span class="sf17b16"> </span><span class="sf17b16">'CRM/Event/Form/Registration/Register.php'</span><span class="sf17b16">; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">261</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp;</span><span class="sf17b16">CRM_Event_Form_Registration_Register::buildPaymentF<wbr>ields</span><span class="sf17b16">( $</span><span class="sf17b16">this );
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">262</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16">
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">263</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp;</span><span class="sf17b16">//Add the elements to the confirm page so as to match the errors with form elements
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">264</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp;$</span><span class="sf17b16">this-&gt;</span><span class="sf17b16">addElement</span><span class="sf17b16">(</span><span class="sf17b16">'text'</span><span class="sf17b16">, </span><span class="sf17b16">'credit_card_type'</span><span class="sf17b16">, NULL, true);
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">265</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp;$</span><span class="sf17b16">this-&gt;</span><span class="sf17b16">addElement</span><span class="sf17b16">(</span><span class="sf17b16">'text'</span><span class="sf17b16">, </span><span class="sf17b16">'credit_card_number'</span><span class="sf17b16">, NULL);
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">266</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp;$</span><span class="sf17b16">this-&gt;</span><span class="sf17b16">addElement</span><span class="sf17b16">(</span><span class="sf17b16">'text'</span><span class="sf17b16">, </span><span class="sf17b16">'cvv2'</span><span class="sf17b16">, NULL);
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">267</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp;$</span><span class="sf17b16">this-&gt;</span><span class="sf17b16">addElement</span><span class="sf17b16">(</span><span class="sf17b16">'text'</span><span class="sf17b16">, </span><span class="sf17b16">'credit_card_exp_date'</span><span class="sf17b16">, NULL);
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">268</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp;$</span><span class="sf17b16">this-&gt;</span><span class="sf17b16">addElement</span><span class="sf17b16">(</span><span class="sf17b16">'text'</span><span class="sf17b16">, </span><span class="sf17b16">'billing_first_name'</span><span class="sf17b16">, NULL);
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">269</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp;$</span><span class="sf17b16">this-&gt;</span><span class="sf17b16">addElement</span><span class="sf17b16">(</span><span class="sf17b16">'text'</span><span class="sf17b16">, </span><span class="sf17b16">'billing_last_name'</span><span class="sf17b16">, NULL);
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">270</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp;$</span><span class="sf17b16">this-&gt;</span><span class="sf17b16">addElement</span><span class="sf17b16">(</span><span class="sf17b16">'text'</span><span class="sf17b16">, </span><span class="sf17b16">'billing_street_address-5'</span><span class="sf17b16">, NULL);
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">271</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp;$</span><span class="sf17b16">this-&gt;</span><span class="sf17b16">addElement</span><span class="sf17b16">(</span><span class="sf17b16">'text'</span><span class="sf17b16">, </span><span class="sf17b16">'billing_city-5'</span><span class="sf17b16">, NULL);
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">272</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp;$</span><span class="sf17b16">this-&gt;</span><span class="sf17b16">addElement</span><span class="sf17b16">(</span><span class="sf17b16">'text'</span><span class="sf17b16">, </span><span class="sf17b16">'billing_country_id-5'</span><span class="sf17b16">, NULL);
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">273</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp;$</span><span class="sf17b16">this-&gt;</span><span class="sf17b16">addElement</span><span class="sf17b16">(</span><span class="sf17b16">'text'</span><span class="sf17b16">, </span><span class="sf17b16">'billing_postal_code-5'</span><span class="sf17b16">, NULL);
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">274</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp;$</span><span class="sf17b16">this-&gt;</span><span class="sf17b16">addElement</span><span class="sf17b16">(</span><span class="sf17b16">'text'</span><span class="sf17b16">, </span><span class="sf17b16">'billing_state_province_id-5'</span><span class="sf17b16">, NULL);
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">275</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; 
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">276</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp;$</span><span class="sf17b16">params = $</span><span class="sf17b16">this-&gt;</span><span class="sf17b16">get</span><span class="sf17b16">(</span><span class="sf17b16">'params'</span><span class="sf17b16">);
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">277</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp;</span><span class="sf17b16">//Add an element for selecting the payer for the event fees
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">278</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp;$</span><span class="sf17b16">payerOptions[</span><span class="sf17b16">''</span><span class="sf17b16">] = </span><span class="sf17b16">'Please Choose...'</span><span class="sf17b16">;
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">279</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp;$</span><span class="sf17b16">payerOptions[</span><span class="sf17b16">'payer_not_attending'</span><span class="sf17b16">] = </span><span class="sf17b16">'Payer is not attending'</span><span class="sf17b16">;
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">280</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp;
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">281</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp;</span><span class="sf17b16">foreach</span><span class="sf17b16">( $</span><span class="sf17b16">params </span><span class="sf17b16">as</span><span class="sf17b16"> $</span><span class="sf17b16">k =&gt; $</span><span class="sf17b16">v ) {
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">282</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf17b16">if</span><span class="sf17b16"> ( (</span><span class="sf17b16">isset</span><span class="sf17b16">($</span><span class="sf17b16">v[</span><span class="sf17b16">'first_name'</span><span class="sf17b16">]) &amp;&amp; $</span><span class="sf17b16">v[</span><span class="sf17b16">'first_name'</span><span class="sf17b16">]) || (</span><span class="sf17b16">isset</span><span class="sf17b16">($</span><span class="sf17b16">v[</span><span class="sf17b16">'last_name'</span><span class="sf17b16">]) &amp;&amp; $</span><span class="sf17b16">v[</span><span class="sf17b16">'last_name'</span><span class="sf17b16">]) ) {
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">283</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf17b16">payerOptions[$</span><span class="sf17b16">k] = $</span><span class="sf17b16">v[</span><span class="sf17b16">'first_name'</span><span class="sf17b16">].</span><span class="sf17b16">' '</span><span class="sf17b16">.$</span><span class="sf17b16">v[</span><span class="sf17b16">'last_name'</span><span class="sf17b16">];
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">284</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp;} </span><span class="sf17b16">else</span><span class="sf17b16"> {
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">285</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf17b16">payerOptions[$</span><span class="sf17b16">k] = $</span><span class="sf17b16">v[</span><span class="sf17b16">'email-Primary'</span><span class="sf17b16">];
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">286</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp;}
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">287</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp;
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">288</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp;}
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">289</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp;
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">290</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp;$</span><span class="sf17b16">this-&gt;</span><span class="sf17b16">add</span><span class="sf17b16">(</span><span class="sf17b16">'select'</span><span class="sf17b16">, </span><span class="sf17b16">'payer_id'</span><span class="sf17b16">,
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">291</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf17b16">ts</span><span class="sf17b16">(</span><span class="sf17b16">'Which attendee is paying for the registration'</span><span class="sf17b16">),
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">292</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf17b16">payerOptions,
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">293</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;TRUE
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">294</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp;);
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">295</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16">
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">296</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp;$</span><span class="sf17b16">this-&gt;</span><span class="sf17b16">add</span><span class="sf17b16">(</span><span class="sf17b16">'text'</span><span class="sf17b16">, </span><span class="sf17b16">'receipt_email'</span><span class="sf17b16">, </span><span class="sf17b16">ts</span><span class="sf17b16">(</span><span class="sf17b16">'Payer email address'</span><span class="sf17b16">), </span><span class="sf17b16">array</span><span class="sf17b16">(</span><span class="sf17b16">'size'</span><span class="sf17b16">=&gt;</span><span class="sf17b16">35</span><span class="sf17b16">), FALSE);
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">297</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp;$</span><span class="sf17b16">this-&gt;</span><span class="sf17b16">assign</span><span class="sf17b16">(</span><span class="sf17b16">'isConfirm'</span><span class="sf17b16">, </span><span class="sf17b16">'1'</span><span class="sf17b16">);
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">298</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp;}
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">299</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp;</span><span class="sf17b16">// ends
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">300</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp;
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">228</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">assignToTemplate</span><span class="sf3b2">();</span></code></td>
<td class="ln">301</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">assignToTemplate</span><span class="sf3b2">();</span></code></td>
</tr>
<tr valign="top">
<td class="ln">229</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">this-&gt;_params[0][</span><span class="sf12b2">'amount'</span><span class="sf3b2">] || $</span><span class="sf18b2">this-&gt;_params[0][</span><span class="sf12b2">'amount'</span><span class="sf3b2">] == 0) {</span></code></td>
<td class="ln">302</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">this-&gt;_params[0][</span><span class="sf12b2">'amount'</span><span class="sf3b2">] || $</span><span class="sf18b2">this-&gt;_params[0][</span><span class="sf12b2">'amount'</span><span class="sf3b2">] == 0) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">230</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">_amount = array</span><span class="sf3b2">();</span></code></td>
<td class="ln">303</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">_amount = array</span><span class="sf3b2">();</span></code></td>
</tr>
<tr valign="top">
<td class="ln">231</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16">
</span>&nbsp;</code></td>
<td class="ln">304</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp;
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">232</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">foreach</span><span class="sf3b2"> ($</span><span class="sf18b2">this-&gt;_params as $</span><span class="sf18b2">k =&gt; $</span><span class="sf18b2">v) {</span></code></td>
<td class="ln">305</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">foreach</span><span class="sf3b2"> ($</span><span class="sf18b2">this-&gt;_params as $</span><span class="sf18b2">k =&gt; $</span><span class="sf18b2">v) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">233</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">is_array</span><span class="sf3b2">($</span><span class="sf18b2">v)) {</span></code></td>
<td class="ln">306</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">is_array</span><span class="sf3b2">($</span><span class="sf18b2">v)) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">234</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">foreach</span><span class="sf3b2"> (</span><span class="sf7b2">array</span><span class="sf3b2">(</span></code></td>
<td class="ln">307</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">foreach</span><span class="sf3b2"> (</span><span class="sf7b2">array</span><span class="sf3b2">(</span></code></td>
</tr>
<tr valign="top">
<td class="ln">235</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'first_name'</span><span class="sf3b2">, </span><span class="sf12b2">'last_name'</span><span class="sf3b2">) </span><span class="sf7b2">as</span><span class="sf3b2"> $</span><span class="sf18b2">name) {</span></code></td>
<td class="ln">308</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'first_name'</span><span class="sf3b2">, </span><span class="sf12b2">'last_name'</span><span class="sf3b2">) </span><span class="sf7b2">as</span><span class="sf3b2"> $</span><span class="sf18b2">name) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">236</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf7b2">isset</span><span class="sf3b2">($</span><span class="sf18b2">v[</span><span class="sf12b2">'billing_'</span><span class="sf3b2"> . $</span><span class="sf18b2">name]) &amp;&amp;</span></code></td>
<td class="ln">309</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf7b2">isset</span><span class="sf3b2">($</span><span class="sf18b2">v[</span><span class="sf12b2">'billing_'</span><span class="sf3b2"> . $</span><span class="sf18b2">name]) &amp;&amp;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">237</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;!</span><span class="sf7b2">isset</span><span class="sf3b2">($</span><span class="sf18b2">v[$</span><span class="sf18b2">name])</span></code></td>
<td class="ln">310</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;!</span><span class="sf7b2">isset</span><span class="sf3b2">($</span><span class="sf18b2">v[$</span><span class="sf18b2">name])</span></code></td>
</tr>
<tr valign="top">
<td class="ln">238</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;) {</span></code></td>
<td class="ln">311</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">239</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">v[$</span><span class="sf18b2">name] = $</span><span class="sf18b2">v[</span><span class="sf12b2">'billing_'</span><span class="sf3b2"> . $</span><span class="sf18b2">name];</span></code></td>
<td class="ln">312</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">v[$</span><span class="sf18b2">name] = $</span><span class="sf18b2">v[</span><span class="sf12b2">'billing_'</span><span class="sf3b2"> . $</span><span class="sf18b2">name];</span></code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">313</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf17b16">this-&gt;</span><span class="sf17b16">assign</span><span class="sf17b16">(</span><span class="sf17b16">'billing_'</span><span class="sf17b16"> . $</span><span class="sf17b16">name);
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">240</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">314</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">241</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">315</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">242</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">316</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">243</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'first_name'</span><span class="sf3b2">, $</span><span class="sf18b2">v) &amp;&amp; </span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'last_name'</span><span class="sf3b2">, $</span><span class="sf18b2">v)) {</span></code></td>
<td class="ln">317</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'first_name'</span><span class="sf3b2">, $</span><span class="sf18b2">v) &amp;&amp; </span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'last_name'</span><span class="sf3b2">, $</span><span class="sf18b2">v)) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">244</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">append = $</span><span class="sf18b2">v[</span><span class="sf12b2">'first_name'</span><span class="sf3b2">] . </span><span class="sf12b2">' '</span><span class="sf3b2"> . $</span><span class="sf18b2">v[</span><span class="sf12b2">'last_name'</span><span class="sf3b2">];</span></code></td>
<td class="ln">318</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">append = $</span><span class="sf18b2">v[</span><span class="sf12b2">'first_name'</span><span class="sf3b2">] . </span><span class="sf12b2">' '</span><span class="sf3b2"> . $</span><span class="sf18b2">v[</span><span class="sf12b2">'last_name'</span><span class="sf3b2">];</span></code></td>
</tr>
<tr valign="top">
<td class="ln">245</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">319</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">246</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">else</span><span class="sf3b2"> {</span></code></td>
<td class="ln">320</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">else</span><span class="sf3b2"> {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">247</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">//use an email if we have one</span></code></td>
<td class="ln">321</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">//use an email if we have one</span></code></td>
</tr>
<tr valign="top">
<td class="ln">248</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">foreach</span><span class="sf3b2"> ($</span><span class="sf18b2">v </span><span class="sf7b2">as</span><span class="sf3b2"> $</span><span class="sf18b2">v_key =&gt; $</span><span class="sf18b2">v_val) {</span></code></td>
<td class="ln">322</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">foreach</span><span class="sf3b2"> ($</span><span class="sf18b2">v </span><span class="sf7b2">as</span><span class="sf3b2"> $</span><span class="sf18b2">v_key =&gt; $</span><span class="sf18b2">v_val) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">249</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">substr</span><span class="sf3b2">($</span><span class="sf18b2">v_key, </span><span class="sf10b2">0</span><span class="sf3b2">, </span><span class="sf10b2">6</span><span class="sf3b2">) == </span><span class="sf12b2">'email-'</span><span class="sf3b2">) {</span></code></td>
<td class="ln">323</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">substr</span><span class="sf3b2">($</span><span class="sf18b2">v_key, </span><span class="sf10b2">0</span><span class="sf3b2">, </span><span class="sf10b2">6</span><span class="sf3b2">) == </span><span class="sf12b2">'email-'</span><span class="sf3b2">) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">250</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">append = $</span><span class="sf18b2">v[$</span><span class="sf18b2">v_key];</span></code></td>
<td class="ln">324</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">append = $</span><span class="sf18b2">v[$</span><span class="sf18b2">v_key];</span></code></td>
</tr>
<tr valign="top">
<td class="ln">251</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">325</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">252</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">326</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">253</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">327</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">254</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">328</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">255</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_amount[$</span><span class="sf18b2">k][</span><span class="sf12b2">'amount'</span><span class="sf3b2">] = $</span><span class="sf18b2">v[</span><span class="sf12b2">'amount'</span><span class="sf3b2">];</span></code></td>
<td class="ln">329</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_amount[$</span><span class="sf18b2">k][</span><span class="sf12b2">'amount'</span><span class="sf3b2">] = $</span><span class="sf18b2">v[</span><span class="sf12b2">'amount'</span><span class="sf3b2">];</span></code></td>
</tr>
<tr valign="top">
<td class="ln">256</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'discountAmount'</span><span class="sf3b2">, $</span><span class="sf18b2">v)) {</span></code></td>
<td class="ln">330</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'discountAmount'</span><span class="sf3b2">, $</span><span class="sf18b2">v)) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">257</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_amount[$</span><span class="sf18b2">k][</span><span class="sf12b2">'amount'</span><span class="sf3b2">] -= $</span><span class="sf18b2">v[</span><span class="sf12b2">'discountAmount'</span><span class="sf3b2">];</span></code></td>
<td class="ln">331</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_amount[$</span><span class="sf18b2">k][</span><span class="sf12b2">'amount'</span><span class="sf3b2">] -= $</span><span class="sf18b2">v[</span><span class="sf12b2">'discountAmount'</span><span class="sf3b2">];</span></code></td>
</tr>
<tr valign="top">
<td class="ln">258</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">332</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">259</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">333</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">260</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_amount[$</span><span class="sf18b2">k][</span><span class="sf12b2">'label'</span><span class="sf3b2">] = </span><span class="sf8b2">preg_replace</span><span class="sf3b2">(</span><span class="sf12b2">'/	01/'</span><span class="sf3b2">, </span><span class="sf12b2">''</span><span class="sf3b2">, $</span><span class="sf18b2">v[</span><span class="sf12b2">'amount_level'</span><span class="sf3b2">]) . </span><span class="sf12b2">' &nbsp;- &nbsp;'</span><span class="sf3b2"> . $</span><span class="sf18b2">append;</span></code></td>
<td class="ln">334</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_amount[$</span><span class="sf18b2">k][</span><span class="sf12b2">'label'</span><span class="sf3b2">] = </span><span class="sf8b2">preg_replace</span><span class="sf3b2">(</span><span class="sf12b2">'/	01/'</span><span class="sf3b2">, </span><span class="sf12b2">''</span><span class="sf3b2">, $</span><span class="sf18b2">v[</span><span class="sf12b2">'amount_level'</span><span class="sf3b2">]) . </span><span class="sf12b2">' &nbsp;- &nbsp;'</span><span class="sf3b2"> . $</span><span class="sf18b2">append;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">261</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_part[$</span><span class="sf18b2">k][</span><span class="sf12b2">'info'</span><span class="sf3b2">] = </span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'first_name'</span><span class="sf3b2">, $</span><span class="sf18b2">v) . </span><span class="sf12b2">' '</span><span class="sf3b2"> . CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'last_name'</span><span class="sf3b2">, $</span><span class="sf18b2">v);</span></code></td>
<td class="ln">335</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_part[$</span><span class="sf18b2">k][</span><span class="sf12b2">'info'</span><span class="sf3b2">] = </span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'first_name'</span><span class="sf3b2">, $</span><span class="sf18b2">v) . </span><span class="sf12b2">' '</span><span class="sf3b2"> . CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'last_name'</span><span class="sf3b2">, $</span><span class="sf18b2">v);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">262</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'first_name'</span><span class="sf3b2">, $</span><span class="sf18b2">v)) {</span></code></td>
<td class="ln">336</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'first_name'</span><span class="sf3b2">, $</span><span class="sf18b2">v)) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">263</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_part[$</span><span class="sf18b2">k][</span><span class="sf12b2">'info'</span><span class="sf3b2">] = $</span><span class="sf18b2">append;</span></code></td>
<td class="ln">337</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_part[$</span><span class="sf18b2">k][</span><span class="sf12b2">'info'</span><span class="sf3b2">] = $</span><span class="sf18b2">append;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">264</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">338</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">265</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_totalAmount = $</span><span class="sf18b2">this-&gt;_totalAmount + $</span><span class="sf18b2">this-&gt;_amount[$</span><span class="sf18b2">k][</span><span class="sf12b2">'amount'</span><span class="sf3b2">];</span></code></td>
<td class="ln">339</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_totalAmount = $</span><span class="sf18b2">this-&gt;_totalAmount + $</span><span class="sf18b2">this-&gt;_amount[$</span><span class="sf18b2">k][</span><span class="sf12b2">'amount'</span><span class="sf3b2">];</span></code></td>
</tr>
<tr valign="top">
<td class="ln">266</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'is_primary'</span><span class="sf3b2">, $</span><span class="sf18b2">v)) {</span></code></td>
<td class="ln">340</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'is_primary'</span><span class="sf3b2">, $</span><span class="sf18b2">v)) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">267</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">set</span><span class="sf3b2">(</span><span class="sf12b2">'primaryParticipantAmount'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_amount[$</span><span class="sf18b2">k][</span><span class="sf12b2">'amount'</span><span class="sf3b2">]);</span></code></td>
<td class="ln">341</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">set</span><span class="sf3b2">(</span><span class="sf12b2">'primaryParticipantAmount'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_amount[$</span><span class="sf18b2">k][</span><span class="sf12b2">'amount'</span><span class="sf3b2">]);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">268</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">342</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">269</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">343</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">270</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">344</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">271</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">345</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">272</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">assign</span><span class="sf3b2">(</span><span class="sf12b2">'part'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_part);</span></code></td>
<td class="ln">346</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">assign</span><span class="sf3b2">(</span><span class="sf12b2">'part'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_part);</span></code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">347</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp;
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">273</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">set</span><span class="sf3b2">(</span><span class="sf12b2">'part'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_part);</span></code></td>
<td class="ln">348</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">set</span><span class="sf3b2">(</span><span class="sf12b2">'part'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_part);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">274</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">assign</span><span class="sf3b2">(</span><span class="sf12b2">'amounts'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_amount);</span></code></td>
<td class="ln">349</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">assign</span><span class="sf3b2">(</span><span class="sf12b2">'amounts'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_amount);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">275</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">assign</span><span class="sf3b2">(</span><span class="sf12b2">'totalAmount'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_totalAmount);</span></code></td>
<td class="ln">350</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">assign</span><span class="sf3b2">(</span><span class="sf12b2">'totalAmount'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_totalAmount);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">276</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">set</span><span class="sf3b2">(</span><span class="sf12b2">'totalAmount'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_totalAmount);</span></code></td>
<td class="ln">351</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">set</span><span class="sf3b2">(</span><span class="sf12b2">'totalAmount'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_totalAmount);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">277</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">352</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">278</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">353</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">279</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">config = </span><span class="sf8b2">CRM_Core_Config::singleton</span><span class="sf3b2">();</span></code></td>
<td class="ln">354</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">config = </span><span class="sf8b2">CRM_Core_Config::singleton</span><span class="sf3b2">();</span></code></td>
</tr>
<tr valign="top">
<td class="ln">280</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">355</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">281</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">buildCustom</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'custom_pre_id'</span><span class="sf3b2">],<wbr> </span><span class="sf12b2">'customPre'</span><span class="sf3b2">, TRUE);</span></code></td>
<td class="ln">356</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">buildCustom</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'custom_pre_id'</span><span class="sf3b2">],<wbr> </span><span class="sf12b2">'customPre'</span><span class="sf3b2">, TRUE);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">282</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">buildCustom</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'custom_post_id'</span><span class="sf3b2">]<wbr>, </span><span class="sf12b2">'customPost'</span><span class="sf3b2">, TRUE);</span></code></td>
<td class="ln">357</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">buildCustom</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'custom_post_id'</span><span class="sf3b2">]<wbr>, </span><span class="sf12b2">'customPost'</span><span class="sf3b2">, TRUE);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">283</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">358</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">284</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">_priceSetId &amp;&amp; !CRM_Core_DAO::getFieldValue</span><span class="sf3b2">(</span><span class="sf12b2">'CRM_Price_DAO_Set'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_priceSetId, </span><span class="sf12b2">'is_quick_config'</span><span class="sf3b2">)) {</span></code></td>
<td class="ln">359</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">_priceSetId &amp;&amp; !CRM_Core_DAO::getFieldValue</span><span class="sf3b2">(</span><span class="sf12b2">'CRM_Price_DAO_Set'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_priceSetId, </span><span class="sf12b2">'is_quick_config'</span><span class="sf3b2">)) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">285</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">360</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">286</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">assign</span><span class="sf3b2">(</span><span class="sf12b2">'lineItem'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_lineItem);</span></code></td>
<td class="ln">361</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">assign</span><span class="sf3b2">(</span><span class="sf12b2">'lineItem'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_lineItem);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">287</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">362</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">288</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">363</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">289</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">//display additional participants profile.</span></code></td>
<td class="ln">364</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">//display additional participants profile.</span></code></td>
</tr>
<tr valign="top">
<td class="ln">290</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">365</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">291</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">participantParams = $</span><span class="sf18b2">this-&gt;_params;</span></code></td>
<td class="ln">366</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">participantParams = $</span><span class="sf18b2">this-&gt;_params;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">292</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">formattedValues &nbsp; = </span><span class="sf7b2">array</span><span class="sf3b2">();</span></code></td>
<td class="ln">367</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">formattedValues &nbsp; = </span><span class="sf7b2">array</span><span class="sf3b2">();</span></code></td>
</tr>
<tr valign="top">
<td class="ln">293</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">count &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; = </span><span class="sf10b2">1</span><span class="sf3b2">;</span></code></td>
<td class="ln">368</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">count &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; = </span><span class="sf10b2">1</span><span class="sf3b2">;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">294</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">foreach</span><span class="sf3b2"> ($</span><span class="sf18b2">participantParams </span><span class="sf7b2">as</span><span class="sf3b2"> $</span><span class="sf18b2">participantNum =&gt; $</span><span class="sf18b2">participantValue) {</span></code></td>
<td class="ln">369</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">foreach</span><span class="sf3b2"> ($</span><span class="sf18b2">participantParams </span><span class="sf7b2">as</span><span class="sf3b2"> $</span><span class="sf18b2">participantNum =&gt; $</span><span class="sf18b2">participantValue) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">295</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">participantNum &amp;&amp; $</span><span class="sf18b2">participantValue != </span><span class="sf12b2">'skip'</span><span class="sf3b2">) {</span></code></td>
<td class="ln">370</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">participantNum &amp;&amp; $</span><span class="sf18b2">participantValue != </span><span class="sf12b2">'skip'</span><span class="sf3b2">) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">296</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">//get the customPre profile info</span></code></td>
<td class="ln">371</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">//get the customPre profile info</span></code></td>
</tr>
<tr valign="top">
<td class="ln">297</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'additional_custom_pre_id'</span><span class="sf3b2">,<wbr> $</span><span class="sf18b2">this-&gt;_values)) {</span></code></td>
<td class="ln">372</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'additional_custom_pre_id'</span><span class="sf3b2">,<wbr> $</span><span class="sf18b2">this-&gt;_values)) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">298</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">values = $</span><span class="sf18b2">groupName = </span><span class="sf7b2">array</span><span class="sf3b2">();</span></code></td>
<td class="ln">373</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">values = $</span><span class="sf18b2">groupName = </span><span class="sf7b2">array</span><span class="sf3b2">();</span></code></td>
</tr>
<tr valign="top">
<td class="ln">299</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">CRM_Event_BAO_Event::displayProfile</span><span class="sf3b2">($</span><span class="sf18b2">participantVal<wbr>ue,</span></code></td>
<td class="ln">374</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">CRM_Event_BAO_Event::displayProfile</span><span class="sf3b2">($</span><span class="sf18b2">participantVal<wbr>ue,</span></code></td>
</tr>
<tr valign="top">
<td class="ln">300</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'additional_custom_pre_id'</span><span class="sf3b2">],</span></code></td>
<td class="ln">375</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'additional_custom_pre_id'</span><span class="sf3b2">],</span></code></td>
</tr>
<tr valign="top">
<td class="ln">301</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">groupName,</span></code></td>
<td class="ln">376</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">groupName,</span></code></td>
</tr>
<tr valign="top">
<td class="ln">302</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$values</span></code></td>
<td class="ln">377</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$values</span></code></td>
</tr>
<tr valign="top">
<td class="ln">303</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;);</span></code></td>
<td class="ln">378</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">304</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">379</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">305</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">count</span><span class="sf3b2">($</span><span class="sf18b2">values)) {</span></code></td>
<td class="ln">380</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">count</span><span class="sf3b2">($</span><span class="sf18b2">values)) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">306</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">formattedValues[$</span><span class="sf18b2">count][</span><span class="sf12b2">'additionalCustomPre'</span><span class="sf3b2">] = $</span><span class="sf18b2">values;</span></code></td>
<td class="ln">381</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">formattedValues[$</span><span class="sf18b2">count][</span><span class="sf12b2">'additionalCustomPre'</span><span class="sf3b2">] = $</span><span class="sf18b2">values;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">307</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">382</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">308</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">formattedValues[$</span><span class="sf18b2">count][</span><span class="sf12b2">'additionalCustomPreGroupT<wbr>itle'</span><span class="sf3b2">] = </span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'groupTitle'</span><span class="sf3b2">, $</span><span class="sf18b2">groupName);</span></code></td>
<td class="ln">383</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">formattedValues[$</span><span class="sf18b2">count][</span><span class="sf12b2">'additionalCustomPreGroupT<wbr>itle'</span><span class="sf3b2">] = </span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'groupTitle'</span><span class="sf3b2">, $</span><span class="sf18b2">groupName);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">309</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">384</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">310</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">//get the customPost profile info</span></code></td>
<td class="ln">385</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">//get the customPost profile info</span></code></td>
</tr>
<tr valign="top">
<td class="ln">311</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'additional_custom_post_id'<wbr></span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_values)) {</span></code></td>
<td class="ln">386</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'additional_custom_post_id'<wbr></span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_values)) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">312</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">values = $</span><span class="sf18b2">groupName = </span><span class="sf7b2">array</span><span class="sf3b2">();</span></code></td>
<td class="ln">387</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">values = $</span><span class="sf18b2">groupName = </span><span class="sf7b2">array</span><span class="sf3b2">();</span></code></td>
</tr>
<tr valign="top">
<td class="ln">313</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">foreach</span><span class="sf3b2"> ($</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'additional_custom_post_id'</span><span class="sf3b2">] as $</span><span class="sf18b2">gids) {</span></code></td>
<td class="ln">388</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">foreach</span><span class="sf3b2"> ($</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'additional_custom_post_id'</span><span class="sf3b2">] as $</span><span class="sf18b2">gids) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">314</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">val = </span><span class="sf7b2">array</span><span class="sf3b2">();</span></code></td>
<td class="ln">389</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">val = </span><span class="sf7b2">array</span><span class="sf3b2">();</span></code></td>
</tr>
<tr valign="top">
<td class="ln">315</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">CRM_Event_BAO_Event::displayProfile</span><span class="sf3b2">($</span><span class="sf18b2">participantVal<wbr>ue,</span></code></td>
<td class="ln">390</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">CRM_Event_BAO_Event::displayProfile</span><span class="sf3b2">($</span><span class="sf18b2">participantVal<wbr>ue,</span></code></td>
</tr>
<tr valign="top">
<td class="ln">316</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">gids,</span></code></td>
<td class="ln">391</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">gids,</span></code></td>
</tr>
<tr valign="top">
<td class="ln">317</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">group,</span></code></td>
<td class="ln">392</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">group,</span></code></td>
</tr>
<tr valign="top">
<td class="ln">318</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$val</span></code></td>
<td class="ln">393</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$val</span></code></td>
</tr>
<tr valign="top">
<td class="ln">319</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;);</span></code></td>
<td class="ln">394</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">320</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">values[$</span><span class="sf18b2">gids] = $</span><span class="sf18b2">val;</span></code></td>
<td class="ln">395</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">values[$</span><span class="sf18b2">gids] = $</span><span class="sf18b2">val;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">321</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">groupName[$</span><span class="sf18b2">gids] = $</span><span class="sf18b2">group;</span></code></td>
<td class="ln">396</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">groupName[$</span><span class="sf18b2">gids] = $</span><span class="sf18b2">group;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">322</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">397</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">323</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">398</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">324</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">count</span><span class="sf3b2">($</span><span class="sf18b2">values)) {</span></code></td>
<td class="ln">399</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">count</span><span class="sf3b2">($</span><span class="sf18b2">values)) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">325</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">formattedValues[$</span><span class="sf18b2">count][</span><span class="sf12b2">'additionalCustomPost'</span><span class="sf3b2">] = $</span><span class="sf18b2">values;</span></code></td>
<td class="ln">400</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">formattedValues[$</span><span class="sf18b2">count][</span><span class="sf12b2">'additionalCustomPost'</span><span class="sf3b2">] = $</span><span class="sf18b2">values;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">326</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">401</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">327</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">402</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">328</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf7b2">isset</span><span class="sf3b2">($</span><span class="sf18b2">formattedValues[$</span><span class="sf18b2">count][</span><span class="sf12b2">'additionalCustomPr<wbr>e'</span><span class="sf3b2">])) {</span></code></td>
<td class="ln">403</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf7b2">isset</span><span class="sf3b2">($</span><span class="sf18b2">formattedValues[$</span><span class="sf18b2">count][</span><span class="sf12b2">'additionalCustomPr<wbr>e'</span><span class="sf3b2">])) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">329</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">formattedValues[$</span><span class="sf18b2">count][</span><span class="sf12b2">'additionalCustomPost'</span><span class="sf3b2">] = </span><span class="sf8b2">array_diff_assoc</span><span class="sf3b2">($</span><span class="sf18b2">formattedValues[$</span><span class="sf18b2">count][</span><span class="sf12b2">'addition<wbr>alCustomPost'</span><span class="sf3b2">],</span></code></td>
<td class="ln">404</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">formattedValues[$</span><span class="sf18b2">count][</span><span class="sf12b2">'additionalCustomPost'</span><span class="sf3b2">] = </span><span class="sf8b2">array_diff_assoc</span><span class="sf3b2">($</span><span class="sf18b2">formattedValues[$</span><span class="sf18b2">count][</span><span class="sf12b2">'addition<wbr>alCustomPost'</span><span class="sf3b2">],</span></code></td>
</tr>
<tr valign="top">
<td class="ln">330</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">formattedValues[$</span><span class="sf18b2">count][</span><span class="sf12b2">'additionalCustomPre'</span><span class="sf3b2">]</span></code></td>
<td class="ln">405</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">formattedValues[$</span><span class="sf18b2">count][</span><span class="sf12b2">'additionalCustomPre'</span><span class="sf3b2">]</span></code></td>
</tr>
<tr valign="top">
<td class="ln">331</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;);</span></code></td>
<td class="ln">406</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">332</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">407</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">333</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">408</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">334</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">formattedValues[$</span><span class="sf18b2">count][</span><span class="sf12b2">'additionalCustomPostGroup<wbr>Title'</span><span class="sf3b2">] = $</span><span class="sf18b2">groupName;</span></code></td>
<td class="ln">409</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">formattedValues[$</span><span class="sf18b2">count][</span><span class="sf12b2">'additionalCustomPostGroup<wbr>Title'</span><span class="sf3b2">] = $</span><span class="sf18b2">groupName;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">335</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">410</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">336</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">count++;</span></code></td>
<td class="ln">411</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">count++;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">337</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">412</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">338</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">413</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">339</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">414</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">340</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!</span><span class="sf7b2">empty</span><span class="sf3b2">($</span><span class="sf18b2">formattedValues) &amp;&amp; $</span><span class="sf18b2">count &gt; </span><span class="sf10b2">1</span><span class="sf3b2">) {</span></code></td>
<td class="ln">415</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!</span><span class="sf7b2">empty</span><span class="sf3b2">($</span><span class="sf18b2">formattedValues) &amp;&amp; $</span><span class="sf18b2">count &gt; </span><span class="sf10b2">1</span><span class="sf3b2">) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">341</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">assign</span><span class="sf3b2">(</span><span class="sf12b2">'addParticipantProfile'</span><span class="sf3b2">, $</span><span class="sf18b2">formattedValues);</span></code></td>
<td class="ln">416</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">assign</span><span class="sf3b2">(</span><span class="sf12b2">'addParticipantProfile'</span><span class="sf3b2">, $</span><span class="sf18b2">formattedValues);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">342</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">set</span><span class="sf3b2">(</span><span class="sf12b2">'addParticipantProfile'</span><span class="sf3b2">, $</span><span class="sf18b2">formattedValues);</span></code></td>
<td class="ln">417</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">set</span><span class="sf3b2">(</span><span class="sf12b2">'addParticipantProfile'</span><span class="sf3b2">, $</span><span class="sf18b2">formattedValues);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">343</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">418</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">344</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">419</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">345</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">//cosider total amount.</span></code></td>
<td class="ln">420</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">//cosider total amount.</span></code></td>
</tr>
<tr valign="top">
<td class="ln">346</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">assign</span><span class="sf3b2">(</span><span class="sf12b2">'isAmountzero'</span><span class="sf3b2">, ($</span><span class="sf18b2">this-&gt;_totalAmount &lt;= 0) ? TRUE : FALSE);</span></code></td>
<td class="ln">421</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">assign</span><span class="sf3b2">(</span><span class="sf12b2">'isAmountzero'</span><span class="sf3b2">, ($</span><span class="sf18b2">this-&gt;_totalAmount &lt;= 0) ? TRUE : FALSE);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">347</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">422</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">348</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">this-&gt;_paymentProcessor[</span><span class="sf12b2">'payment_processor_type'</span><span class="sf3b2">]<wbr> == </span><span class="sf12b2">'Google_Checkout'</span><span class="sf3b2"> &amp;&amp;</span></code></td>
<td class="ln">423</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">this-&gt;_paymentProcessor[</span><span class="sf12b2">'payment_processor_type'</span><span class="sf3b2">]<wbr> == </span><span class="sf12b2">'Google_Checkout'</span><span class="sf3b2"> &amp;&amp;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">349</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;!</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'is_pay_later'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">_params[0]) &amp;&amp; !</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;_params[0][</span><span class="sf12b2">'amount'</span><span class="sf3b2">] == 0) &amp;&amp;</span></code></td>
<td class="ln">424</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;!</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'is_pay_later'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">_params[0]) &amp;&amp; !</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;_params[0][</span><span class="sf12b2">'amount'</span><span class="sf3b2">] == 0) &amp;&amp;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">350</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;!$</span><span class="sf18b2">this-&gt;_allowWaitlist &amp;&amp; !$</span><span class="sf18b2">this-&gt;_requireApproval</span></code></td>
<td class="ln">425</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;!$</span><span class="sf18b2">this-&gt;_allowWaitlist &amp;&amp; !$</span><span class="sf18b2">this-&gt;_requireApproval</span></code></td>
</tr>
<tr valign="top">
<td class="ln">351</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;) {</span></code></td>
<td class="ln">426</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">352</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_checkoutButtonName = $</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">getButtonName</span><span class="sf3b2">(</span><span class="sf12b2">'next'</span><span class="sf3b2">, </span><span class="sf12b2">'checkout'</span><span class="sf3b2">);</span></code></td>
<td class="ln">427</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_checkoutButtonName = $</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">getButtonName</span><span class="sf3b2">(</span><span class="sf12b2">'next'</span><span class="sf3b2">, </span><span class="sf12b2">'checkout'</span><span class="sf3b2">);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">353</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">add</span><span class="sf3b2">(</span><span class="sf12b2">'image'</span><span class="sf3b2">,</span></code></td>
<td class="ln">428</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">add</span><span class="sf3b2">(</span><span class="sf12b2">'image'</span><span class="sf3b2">,</span></code></td>
</tr>
<tr valign="top">
<td class="ln">354</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_checkoutButtonName,</span></code></td>
<td class="ln">429</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_checkoutButtonName,</span></code></td>
</tr>
<tr valign="top">
<td class="ln">355</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_paymentProcessor[</span><span class="sf12b2">'url_button'</span><span class="sf3b2">],</span></code></td>
<td class="ln">430</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_paymentProcessor[</span><span class="sf12b2">'url_button'</span><span class="sf3b2">],</span></code></td>
</tr>
<tr valign="top">
<td class="ln">356</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">array</span><span class="sf3b2">(</span><span class="sf12b2">'class'</span><span class="sf3b2"> =&gt; </span><span class="sf12b2">'form-submit'</span><span class="sf3b2">)</span></code></td>
<td class="ln">431</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">array</span><span class="sf3b2">(</span><span class="sf12b2">'class'</span><span class="sf3b2"> =&gt; </span><span class="sf12b2">'form-submit'</span><span class="sf3b2">)</span></code></td>
</tr>
<tr valign="top">
<td class="ln">357</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;);</span></code></td>
<td class="ln">432</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">358</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">433</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">359</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">addButtons</span><span class="sf3b2">(</span><span class="sf7b2">array</span><span class="sf3b2">(</span></code></td>
<td class="ln">434</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">addButtons</span><span class="sf3b2">(</span><span class="sf7b2">array</span><span class="sf3b2">(</span></code></td>
</tr>
<tr valign="top">
<td class="ln">360</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">array</span><span class="sf3b2">(</span></code></td>
<td class="ln">435</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">array</span><span class="sf3b2">(</span></code></td>
</tr>
<tr valign="top">
<td class="ln">361</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'type'</span><span class="sf3b2"> =&gt; </span><span class="sf12b2">'back'</span><span class="sf3b2">,</span></code></td>
<td class="ln">436</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'type'</span><span class="sf3b2"> =&gt; </span><span class="sf12b2">'back'</span><span class="sf3b2">,</span></code></td>
</tr>
<tr valign="top">
<td class="ln">362</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'name'</span><span class="sf3b2"> =&gt; </span><span class="sf8b2">ts</span><span class="sf3b2">(</span><span class="sf12b2">'&lt;&lt; Go Back'</span><span class="sf3b2">),</span></code></td>
<td class="ln">437</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'name'</span><span class="sf3b2"> =&gt; </span><span class="sf8b2">ts</span><span class="sf3b2">(</span><span class="sf12b2">'&lt;&lt; Go Back'</span><span class="sf3b2">),</span></code></td>
</tr>
<tr valign="top">
<td class="ln">363</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;),</span></code></td>
<td class="ln">438</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;),</span></code></td>
</tr>
<tr valign="top">
<td class="ln">364</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;)</span></code></td>
<td class="ln">439</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;)</span></code></td>
</tr>
<tr valign="top">
<td class="ln">365</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;);</span></code></td>
<td class="ln">440</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">366</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">441</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">367</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">else</span><span class="sf3b2"> {</span></code></td>
<td class="ln">442</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">else</span><span class="sf3b2"> {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">368</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp;</span><span class="sf17b16">$</span><span class="sf17b16">contribButton = </span><span class="sf17b16">ts</span><span class="sf17b16">(</span><span class="sf17b16">'Continue'</span><span class="sf17b16">);</span>&nbsp;</code></td>
<td class="ln">443</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp;</span><span class="sf17b16">//BOT - To change the button name to Make payment if payment fields are on confirm page</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">444</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp;</span><span class="sf17b16">if</span><span class="sf17b16"> ( $</span><span class="sf17b16">this-&gt;_showPaymentFields ) {
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">445</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf17b16">contribButton = </span><span class="sf17b16">ts</span><span class="sf17b16">(</span><span class="sf17b16">'Make Payment'</span><span class="sf17b16">);
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">446</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp;} </span><span class="sf17b16">else</span><span class="sf17b16"> {
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">447</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf17b16">contribButton = </span><span class="sf17b16">ts</span><span class="sf17b16">(</span><span class="sf17b16">'Continue'</span><span class="sf17b16">);
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">448</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp;}
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">449</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp;</span><span class="sf17b16">//ends
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">369</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">addButtons</span><span class="sf3b2">(</span><span class="sf7b2">array</span><span class="sf3b2">(</span></code></td>
<td class="ln">450</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">addButtons</span><span class="sf3b2">(</span><span class="sf7b2">array</span><span class="sf3b2">(</span></code></td>
</tr>
<tr valign="top">
<td class="ln">370</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">array</span><span class="sf3b2">(</span></code></td>
<td class="ln">451</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">array</span><span class="sf3b2">(</span></code></td>
</tr>
<tr valign="top">
<td class="ln">371</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'type'</span><span class="sf3b2"> =&gt; </span><span class="sf12b2">'next'</span><span class="sf3b2">,</span></code></td>
<td class="ln">452</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'type'</span><span class="sf3b2"> =&gt; </span><span class="sf12b2">'next'</span><span class="sf3b2">,</span></code></td>
</tr>
<tr valign="top">
<td class="ln">372</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'name'</span><span class="sf3b2"> =&gt; $</span><span class="sf18b2">contribButton,</span></code></td>
<td class="ln">453</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'name'</span><span class="sf3b2"> =&gt; $</span><span class="sf18b2">contribButton,</span></code></td>
</tr>
<tr valign="top">
<td class="ln">373</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'isDefault'</span><span class="sf3b2"> =&gt; TRUE,</span></code></td>
<td class="ln">454</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'isDefault'</span><span class="sf3b2"> =&gt; TRUE,</span></code></td>
</tr>
<tr valign="top">
<td class="ln">374</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'js'</span><span class="sf3b2"> =&gt; </span><span class="sf7b2">array</span><span class="sf3b2">(</span><span class="sf12b2">'onclick'</span><span class="sf3b2"> =&gt; </span><span class="sf12b2">"return submitOnce(this,'"</span><span class="sf3b2"> . $</span><span class="sf18b2">this-&gt;_name . </span><span class="sf12b2">"','"</span><span class="sf3b2"> . ts</span><span class="sf3b2">(</span><span class="sf12b2">'Processing'</span><span class="sf3b2">) . </span><span class="sf12b2">"');"</span><span class="sf3b2">),</span></code></td>
<td class="ln">455</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'js'</span><span class="sf3b2"> =&gt; </span><span class="sf7b2">array</span><span class="sf3b2">(</span><span class="sf12b2">'onclick'</span><span class="sf3b2"> =&gt; </span><span class="sf12b2">"return submitOnce(this,'"</span><span class="sf3b2"> . $</span><span class="sf18b2">this-&gt;_name . </span><span class="sf12b2">"','"</span><span class="sf3b2"> . ts</span><span class="sf3b2">(</span><span class="sf12b2">'Processing'</span><span class="sf3b2">) . </span><span class="sf12b2">"');"</span><span class="sf3b2">),</span></code></td>
</tr>
<tr valign="top">
<td class="ln">375</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;),</span></code></td>
<td class="ln">456</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;),</span></code></td>
</tr>
<tr valign="top">
<td class="ln">376</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">array</span><span class="sf3b2">(</span></code></td>
<td class="ln">457</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">array</span><span class="sf3b2">(</span></code></td>
</tr>
<tr valign="top">
<td class="ln">377</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'type'</span><span class="sf3b2"> =&gt; </span><span class="sf12b2">'back'</span><span class="sf3b2">,</span></code></td>
<td class="ln">458</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'type'</span><span class="sf3b2"> =&gt; </span><span class="sf12b2">'back'</span><span class="sf3b2">,</span></code></td>
</tr>
<tr valign="top">
<td class="ln">378</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'spacing'</span><span class="sf3b2"> =&gt; </span><span class="sf12b2">'&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;'</span><span class="sf3b2">,</span></code></td>
<td class="ln">459</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'spacing'</span><span class="sf3b2"> =&gt; </span><span class="sf12b2">'&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;'</span><span class="sf3b2">,</span></code></td>
</tr>
<tr valign="top">
<td class="ln">379</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'name'</span><span class="sf3b2"> =&gt; </span><span class="sf8b2">ts</span><span class="sf3b2">(</span><span class="sf12b2">'Go Back'</span><span class="sf3b2">),</span></code></td>
<td class="ln">460</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'name'</span><span class="sf3b2"> =&gt; </span><span class="sf8b2">ts</span><span class="sf3b2">(</span><span class="sf12b2">'Go Back'</span><span class="sf3b2">),</span></code></td>
</tr>
<tr valign="top">
<td class="ln">380</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;),</span></code></td>
<td class="ln">461</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;),</span></code></td>
</tr>
<tr valign="top">
<td class="ln">381</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;)</span></code></td>
<td class="ln">462</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;)</span></code></td>
</tr>
<tr valign="top">
<td class="ln">382</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;);</span></code></td>
<td class="ln">463</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">383</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">464</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">384</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">465</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">385</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">defaults = </span><span class="sf7b2">array</span><span class="sf3b2">();</span></code></td>
<td class="ln">466</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">defaults = </span><span class="sf7b2">array</span><span class="sf3b2">();</span></code></td>
</tr>
<tr valign="top">
<td class="ln">386</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">fields = </span><span class="sf7b2">array</span><span class="sf3b2">();</span></code></td>
<td class="ln">467</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">fields = </span><span class="sf7b2">array</span><span class="sf3b2">();</span></code></td>
</tr>
<tr valign="top">
<td class="ln">387</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!</span><span class="sf7b2">empty</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;_fields)) {</span></code></td>
<td class="ln">468</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!</span><span class="sf7b2">empty</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;_fields)) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">388</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">foreach</span><span class="sf3b2"> ($</span><span class="sf18b2">this-&gt;_fields as $</span><span class="sf18b2">name =&gt; $</span><span class="sf18b2">dontCare) {</span></code></td>
<td class="ln">469</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">foreach</span><span class="sf3b2"> ($</span><span class="sf18b2">this-&gt;_fields as $</span><span class="sf18b2">name =&gt; $</span><span class="sf18b2">dontCare) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">389</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">fields[$</span><span class="sf18b2">name] = </span><span class="sf10b2">1</span><span class="sf3b2">;</span></code></td>
<td class="ln">470</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">fields[$</span><span class="sf18b2">name] = </span><span class="sf10b2">1</span><span class="sf3b2">;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">390</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">471</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">391</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">472</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">392</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">fields[</span><span class="sf12b2">"billing_state_province-{$this-&gt;_bltID}"</span><span class="sf3b2">] = $</span><span class="sf18b2">fields[</span><span class="sf12b2">"billing_country-{$this-&gt;_bltID}"</span><span class="sf3b2">] = $</span><span class="sf18b2">fields[</span><span class="sf12b2">"email-{$this-&gt;_bltID}"</span><span class="sf3b2">] = </span><span class="sf10b2">1</span><span class="sf3b2">;</span></code></td>
<td class="ln">473</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">fields[</span><span class="sf12b2">"billing_state_province-{$this-&gt;_bltID}"</span><span class="sf3b2">] = $</span><span class="sf18b2">fields[</span><span class="sf12b2">"billing_country-{$this-&gt;_bltID}"</span><span class="sf3b2">] = $</span><span class="sf18b2">fields[</span><span class="sf12b2">"email-{$this-&gt;_bltID}"</span><span class="sf3b2">] = </span><span class="sf10b2">1</span><span class="sf3b2">;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">393</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">foreach</span><span class="sf3b2"> ($</span><span class="sf18b2">fields </span><span class="sf7b2">as</span><span class="sf3b2"> $</span><span class="sf18b2">name =&gt; $</span><span class="sf18b2">dontCare) {</span></code></td>
<td class="ln">474</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">foreach</span><span class="sf3b2"> ($</span><span class="sf18b2">fields </span><span class="sf7b2">as</span><span class="sf3b2"> $</span><span class="sf18b2">name =&gt; $</span><span class="sf18b2">dontCare) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">394</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf7b2">isset</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;_params[0][$</span><span class="sf18b2">name])) {</span></code></td>
<td class="ln">475</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf7b2">isset</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;_params[0][$</span><span class="sf18b2">name])) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">395</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">defaults[$</span><span class="sf18b2">name] = $</span><span class="sf18b2">this-&gt;_params[0][$</span><span class="sf18b2">name];</span></code></td>
<td class="ln">476</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">defaults[$</span><span class="sf18b2">name] = $</span><span class="sf18b2">this-&gt;_params[0][$</span><span class="sf18b2">name];</span></code></td>
</tr>
<tr valign="top">
<td class="ln">396</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">substr</span><span class="sf3b2">($</span><span class="sf18b2">name, </span><span class="sf10b2">0</span><span class="sf3b2">, </span><span class="sf10b2">7</span><span class="sf3b2">) == </span><span class="sf12b2">'custom_'</span><span class="sf3b2">) {</span></code></td>
<td class="ln">477</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">substr</span><span class="sf3b2">($</span><span class="sf18b2">name, </span><span class="sf10b2">0</span><span class="sf3b2">, </span><span class="sf10b2">7</span><span class="sf3b2">) == </span><span class="sf12b2">'custom_'</span><span class="sf3b2">) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">397</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">timeField = </span><span class="sf12b2">"{$name}_time"</span><span class="sf3b2">;</span></code></td>
<td class="ln">478</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">timeField = </span><span class="sf12b2">"{$name}_time"</span><span class="sf3b2">;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">398</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf7b2">isset</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;_params[0][$</span><span class="sf18b2">timeField])) {</span></code></td>
<td class="ln">479</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf7b2">isset</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;_params[0][$</span><span class="sf18b2">timeField])) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">399</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">defaults[$</span><span class="sf18b2">timeField] = $</span><span class="sf18b2">this-&gt;_params[0][$</span><span class="sf18b2">timeField];</span></code></td>
<td class="ln">480</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">defaults[$</span><span class="sf18b2">timeField] = $</span><span class="sf18b2">this-&gt;_params[0][$</span><span class="sf18b2">timeField];</span></code></td>
</tr>
<tr valign="top">
<td class="ln">400</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">481</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">401</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf7b2">isset</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;_params[0][</span><span class="sf12b2">"{$name}_id"</span><span class="sf3b2">])) {</span></code></td>
<td class="ln">482</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf7b2">isset</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;_params[0][</span><span class="sf12b2">"{$name}_id"</span><span class="sf3b2">])) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">402</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">defaults[</span><span class="sf12b2">"{$name}_id"</span><span class="sf3b2">] = $</span><span class="sf18b2">this-&gt;_params[0][</span><span class="sf12b2">"{$name}_id"</span><span class="sf3b2">];</span></code></td>
<td class="ln">483</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">defaults[</span><span class="sf12b2">"{$name}_id"</span><span class="sf3b2">] = $</span><span class="sf18b2">this-&gt;_params[0][</span><span class="sf12b2">"{$name}_id"</span><span class="sf3b2">];</span></code></td>
</tr>
<tr valign="top">
<td class="ln">403</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">484</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">404</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">485</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">405</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">elseif</span><span class="sf3b2"> (</span><span class="sf8b2">in_array</span><span class="sf3b2">($</span><span class="sf18b2">name, CRM_Contact_BAO_Contact::$</span><span class="sf18b2">_greetingTypes)</span></code></td>
<td class="ln">486</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">elseif</span><span class="sf3b2"> (</span><span class="sf8b2">in_array</span><span class="sf3b2">($</span><span class="sf18b2">name, CRM_Contact_BAO_Contact::$</span><span class="sf18b2">_greetingTypes)</span></code></td>
</tr>
<tr valign="top">
<td class="ln">406</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&amp;&amp; !</span><span class="sf7b2">empty</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;_params[0][$</span><span class="sf18b2">name . </span><span class="sf12b2">'_custom'</span><span class="sf3b2">])</span></code></td>
<td class="ln">487</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&amp;&amp; !</span><span class="sf7b2">empty</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;_params[0][$</span><span class="sf18b2">name . </span><span class="sf12b2">'_custom'</span><span class="sf3b2">])</span></code></td>
</tr>
<tr valign="top">
<td class="ln">407</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;) {</span></code></td>
<td class="ln">488</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">408</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">defaults[$</span><span class="sf18b2">name . </span><span class="sf12b2">'_custom'</span><span class="sf3b2">] = $</span><span class="sf18b2">this-&gt;_params[0][$</span><span class="sf18b2">name . </span><span class="sf12b2">'_custom'</span><span class="sf3b2">];</span></code></td>
<td class="ln">489</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">defaults[$</span><span class="sf18b2">name . </span><span class="sf12b2">'_custom'</span><span class="sf3b2">] = $</span><span class="sf18b2">this-&gt;_params[0][$</span><span class="sf18b2">name . </span><span class="sf12b2">'_custom'</span><span class="sf3b2">];</span></code></td>
</tr>
<tr valign="top">
<td class="ln">409</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">490</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">410</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">491</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">411</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">492</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">412</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">493</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">413</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// now fix all state country selectors</span></code></td>
<td class="ln">494</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// now fix all state country selectors</span></code></td>
</tr>
<tr valign="top">
<td class="ln">414</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf8b2">CRM_Core_BAO_Address::fixAllStateSelects</span><span class="sf3b2">($</span><span class="sf18b2">this, $</span><span class="sf18b2">defaults);</span></code></td>
<td class="ln">495</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf8b2">CRM_Core_BAO_Address::fixAllStateSelects</span><span class="sf3b2">($</span><span class="sf18b2">this, $</span><span class="sf18b2">defaults);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">415</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">496</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">416</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">setDefaults</span><span class="sf3b2">($</span><span class="sf18b2">defaults);</span></code></td>
<td class="ln">497</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">setDefaults</span><span class="sf3b2">($</span><span class="sf18b2">defaults);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">417</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">freeze</span><span class="sf3b2">();</span></code></td>
<td class="ln">498</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">freeze</span><span class="sf3b2">();</span></code></td>
</tr>
<tr valign="top">
<td class="ln">418</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">499</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">500</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp;
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">501</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp;</span><span class="sf17b16">//BOT - To unfreeze the fields on the form and add form rule
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">502</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp;</span><span class="sf17b16">if</span><span class="sf17b16"> ( $</span><span class="sf17b16">this-&gt;_showPaymentFields ) {
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">503</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp;</span><span class="sf17b16">//Unfreeze the payment fields
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">504</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp;</span><span class="sf17b16">foreach</span><span class="sf17b16">( $</span><span class="sf17b16">this-&gt;_elements as $</span><span class="sf17b16">key =&gt; $</span><span class="sf17b16">val ) {
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">505</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf17b16">if</span><span class="sf17b16"> ( $</span><span class="sf17b16">val-&gt;_name ) {
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">506</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf17b16">if</span><span class="sf17b16"> ( $</span><span class="sf17b16">val-&gt;_name == </span><span class="sf17b16">'payment_processor'</span><span class="sf17b16"> ) {
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">507</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf17b16">foreach</span><span class="sf17b16">( $</span><span class="sf17b16">val-&gt;_elements as $</span><span class="sf17b16">element ) {
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">508</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf17b16">element-&gt;_flagFrozen = 0;
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">509</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">510</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} 
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">511</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp;}
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">512</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf17b16">if</span><span class="sf17b16">( $</span><span class="sf17b16">val-&gt;_attributes[</span><span class="sf17b16">'name'</span><span class="sf17b16">] == </span><span class="sf17b16">'payer_id'</span><span class="sf17b16">) {
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">513</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf17b16">val-&gt;_flagFrozen = 0; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">514</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp;}
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">515</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> </span><span class="sf17b16">if</span><span class="sf17b16">( $</span><span class="sf17b16">val-&gt;_attributes[</span><span class="sf17b16">'name'</span><span class="sf17b16">] == </span><span class="sf17b16">'receipt_email'</span><span class="sf17b16">) {
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">516</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf17b16">val-&gt;_flagFrozen = 0;
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">517</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp;}
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">518</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp;}
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">519</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp;
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">520</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp;$</span><span class="sf17b16">this-&gt;</span><span class="sf17b16">addFormRule</span><span class="sf17b16">(</span><span class="sf17b16">array</span><span class="sf17b16">(</span><span class="sf17b16">'CRM_Event_Form_Registrati<wbr>on_Confirm'</span><span class="sf17b16">, </span><span class="sf17b16">'formRule'</span><span class="sf17b16">),
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">521</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$this
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">522</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp;);
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">523</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp;} &nbsp;
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">524</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp;</span><span class="sf17b16">//Ends
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">525</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp;
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">526</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16">
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">527</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp;</span><span class="sf17b16">//
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">419</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">//lets give meaningful status message, CRM-4320.</span></code></td>
<td class="ln">528</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">//lets give meaningful status message, CRM-4320.</span></code></td>
</tr>
<tr valign="top">
<td class="ln">420</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">assign</span><span class="sf3b2">(</span><span class="sf12b2">'isOnWaitlist'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_allowWaitlist);</span></code></td>
<td class="ln">529</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">assign</span><span class="sf3b2">(</span><span class="sf12b2">'isOnWaitlist'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_allowWaitlist);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">421</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">assign</span><span class="sf3b2">(</span><span class="sf12b2">'isRequireApproval'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_requireApproval);</span></code></td>
<td class="ln">530</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">assign</span><span class="sf3b2">(</span><span class="sf12b2">'isRequireApproval'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_requireApproval);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">422</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">531</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">423</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// Assign Participant Count to Lineitem Table</span></code></td>
<td class="ln">532</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// Assign Participant Count to Lineitem Table</span></code></td>
</tr>
<tr valign="top">
<td class="ln">424</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">assign</span><span class="sf3b2">(</span><span class="sf12b2">'pricesetFieldsCount'</span><span class="sf3b2">, </span><span class="sf8b2">CRM_Price_BAO_Set::getPricesetCount</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;_priceSe<wbr>tId));</span></code></td>
<td class="ln">533</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">assign</span><span class="sf3b2">(</span><span class="sf12b2">'pricesetFieldsCount'</span><span class="sf3b2">, </span><span class="sf8b2">CRM_Price_BAO_Set::getPricesetCount</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;_priceSe<wbr>tId));</span></code></td>
</tr>
<tr valign="top">
<td class="ln">425</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;}</span></code></td>
<td class="ln">534</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">426</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">535</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">536</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp;</span><span class="sf17b16">//BOT - Form rule added to handle the payment fields validation 
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">537</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp;</span><span class="sf17b16">static</span><span class="sf17b16"> </span><span class="sf17b16">function</span><span class="sf17b16"> </span><span class="sf17b16">formRule</span><span class="sf17b16">($</span><span class="sf17b16">fields, $</span><span class="sf17b16">files, $</span><span class="sf17b16">self) {
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">538</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; </span><span class="sf17b16">if</span><span class="sf17b16"> ( !</span><span class="sf17b16">isset</span><span class="sf17b16">($</span><span class="sf17b16">fields[</span><span class="sf17b16">'_qf_Confirm_back'</span><span class="sf17b16">]) ) {
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">539</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp;$</span><span class="sf17b16">errors = </span><span class="sf17b16">array</span><span class="sf17b16">();
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">540</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp;</span><span class="sf17b16">if</span><span class="sf17b16"> ( $</span><span class="sf17b16">self-&gt;_showPaymentFields ) {
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">541</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp;</span><span class="sf17b16">if</span><span class="sf17b16"> ( !</span><span class="sf17b16">isset</span><span class="sf17b16">($</span><span class="sf17b16">fields[</span><span class="sf17b16">'payment_processor'</span><span class="sf17b16">]) ) {
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">542</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf17b16">errors[</span><span class="sf17b16">'payment_processor'</span><span class="sf17b16">] = </span><span class="sf17b16">ts</span><span class="sf17b16">(</span><span class="sf17b16">'Payment method is a required field.'</span><span class="sf17b16">);
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">543</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp;}
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">544</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp;}
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">545</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp;
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">546</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp;</span><span class="sf17b16">if</span><span class="sf17b16">( $</span><span class="sf17b16">fields[</span><span class="sf17b16">'payment_processor'</span><span class="sf17b16">] ) {
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">547</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp;$</span><span class="sf17b16">required = </span><span class="sf17b16">array</span><span class="sf17b16">(
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">548</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf17b16">'credit_card_type'</span><span class="sf17b16"> &nbsp; =&gt; </span><span class="sf17b16">'Credit Card Type'</span><span class="sf17b16">,
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">549</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf17b16">'credit_card_number'</span><span class="sf17b16"> =&gt; </span><span class="sf17b16">'Credit Card Number'</span><span class="sf17b16">,
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">550</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf17b16">'cvv2'</span><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; =&gt; </span><span class="sf17b16">'CVV'</span><span class="sf17b16">,
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">551</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf17b16">'billing_first_name'</span><span class="sf17b16"> =&gt; </span><span class="sf17b16">'Billing First Name'</span><span class="sf17b16">,
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">552</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf17b16">'billing_last_name'</span><span class="sf17b16"> =&gt; </span><span class="sf17b16">'Billing Last Name'</span><span class="sf17b16">,
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">553</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf17b16">'billing_street_address-5'</span><span class="sf17b16"> &nbsp;=&gt; </span><span class="sf17b16">'Billing Street Address'</span><span class="sf17b16">,
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">554</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf17b16">'billing_city-5'</span><span class="sf17b16"> =&gt; </span><span class="sf17b16">'City'</span><span class="sf17b16">,
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">555</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf17b16">'billing_state_province_id-5'</span><span class="sf17b16"> =&gt; </span><span class="sf17b16">'State Province'</span><span class="sf17b16">,
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">556</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf17b16">'billing_postal_code-5'</span><span class="sf17b16"> =&gt; </span><span class="sf17b16">'Postal Code'</span><span class="sf17b16">,
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">557</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf17b16">'billing_country_id-5'</span><span class="sf17b16"> =&gt; </span><span class="sf17b16">'Country'</span><span class="sf17b16">
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">558</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp;);
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">559</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; 
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">560</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp;</span><span class="sf17b16">foreach</span><span class="sf17b16"> ( $</span><span class="sf17b16">required </span><span class="sf17b16">as</span><span class="sf17b16"> $</span><span class="sf17b16">name =&gt; $</span><span class="sf17b16">fld) {
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">561</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf17b16">if</span><span class="sf17b16"> ( !$</span><span class="sf17b16">fields[$</span><span class="sf17b16">name] ) {
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">562</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf17b16">errors[$</span><span class="sf17b16">name] = </span><span class="sf17b16">ts</span><span class="sf17b16">(</span><span class="sf17b16">'%1 is a required field.'</span><span class="sf17b16">, </span><span class="sf17b16">array</span><span class="sf17b16">(</span><span class="sf17b16">1</span><span class="sf17b16"> =&gt; $</span><span class="sf17b16">fld) );
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">563</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp; 
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">564</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp;}
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">565</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp;}
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">566</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp;}
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">567</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16">
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">568</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp;</span><span class="sf17b16">if</span><span class="sf17b16"> ( $</span><span class="sf17b16">fields[</span><span class="sf17b16">'payer_id'</span><span class="sf17b16">] == </span><span class="sf17b16">'payer_not_attending'</span><span class="sf17b16"> ) {
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">569</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; </span><span class="sf17b16">if</span><span class="sf17b16"> ( &nbsp;!$</span><span class="sf17b16">fields[</span><span class="sf17b16">'receipt_email'</span><span class="sf17b16">] ) {
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">570</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp; $</span><span class="sf17b16">errors[</span><span class="sf17b16">'receipt_email'</span><span class="sf17b16">] = </span><span class="sf17b16">ts</span><span class="sf17b16">(</span><span class="sf17b16">'Receipt Email is a required field.'</span><span class="sf17b16">);
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">571</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; }
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">572</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; 
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">573</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; }
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">574</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp;</span><span class="sf17b16">// make sure that credit card number and cvv are valid
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">575</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp;</span><span class="sf17b16">if</span><span class="sf17b16"> (</span><span class="sf17b16">CRM_Utils_Array::value</span><span class="sf17b16">(</span><span class="sf17b16">'credit_card_type'</span><span class="sf17b16">, $</span><span class="sf17b16">fields)) {
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">576</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp;</span><span class="sf17b16">if</span><span class="sf17b16"> (</span><span class="sf17b16">CRM_Utils_Array::value</span><span class="sf17b16">(</span><span class="sf17b16">'credit_card_number'</span><span class="sf17b16">, $</span><span class="sf17b16">fields) &amp;&amp;
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">577</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;!</span><span class="sf17b16">CRM_Utils_Rule::creditCardNumber</span><span class="sf17b16">($</span><span class="sf17b16">fields[</span><span class="sf17b16">'credit_c<wbr>ard_number'</span><span class="sf17b16">], $</span><span class="sf17b16">fields[</span><span class="sf17b16">'credit_card_type'</span><span class="sf17b16">])
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">578</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp;) {
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">579</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; 
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">580</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf17b16">errors[</span><span class="sf17b16">'credit_card_number'</span><span class="sf17b16">] = </span><span class="sf17b16">ts</span><span class="sf17b16">(</span><span class="sf17b16">'Please enter a valid Credit Card Number'</span><span class="sf17b16">);
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">581</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp;}
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">582</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp;
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">583</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp;</span><span class="sf17b16">if</span><span class="sf17b16"> (</span><span class="sf17b16">CRM_Utils_Array::value</span><span class="sf17b16">(</span><span class="sf17b16">'cvv2'</span><span class="sf17b16">, $</span><span class="sf17b16">fields) &amp;&amp;
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">584</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;!</span><span class="sf17b16">CRM_Utils_Rule::cvv</span><span class="sf17b16">($</span><span class="sf17b16">fields[</span><span class="sf17b16">'cvv2'</span><span class="sf17b16">], $</span><span class="sf17b16">fields[</span><span class="sf17b16">'credit_card_type'</span><span class="sf17b16">])
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">585</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp;) {
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">586</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf17b16">errors[</span><span class="sf17b16">'cvv2'</span><span class="sf17b16">] = </span><span class="sf17b16">ts</span><span class="sf17b16">(</span><span class="sf17b16">'Please enter a valid Credit Card Verification Number'</span><span class="sf17b16">);
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">587</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp;}
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">588</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp;
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">589</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp;$</span><span class="sf17b16">currentDate = </span><span class="sf17b16">date</span><span class="sf17b16">(</span><span class="sf17b16">'MY'</span><span class="sf17b16">);
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">590</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp;$</span><span class="sf17b16">expDate &nbsp; &nbsp; = </span><span class="sf17b16">date</span><span class="sf17b16">(</span><span class="sf17b16">'MY'</span><span class="sf17b16">, </span><span class="sf17b16">strtotime</span><span class="sf17b16">(</span><span class="sf17b16">'01'</span><span class="sf17b16">.</span><span class="sf17b16">'-'</span><span class="sf17b16">.$</span><span class="sf17b16">fields[</span><span class="sf17b16">'credit_card_exp_date'</span><span class="sf17b16">][<wbr></span><span class="sf17b16">'M'</span><span class="sf17b16">].</span><span class="sf17b16">'-'</span><span class="sf17b16">.$</span><span class="sf17b16">fields[</span><span class="sf17b16">'credit_card_exp_date'</span><span class="sf17b16">][</span><span class="sf17b16">'Y'</span><span class="sf17b16">])); &nbsp; &nbsp; 
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">591</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp;</span><span class="sf17b16">if</span><span class="sf17b16"> ( !$</span><span class="sf17b16">fields[</span><span class="sf17b16">'credit_card_exp_date'</span><span class="sf17b16">][</span><span class="sf17b16">'M'</span><span class="sf17b16">] &amp;&amp; !$</span><span class="sf17b16">fields[</span><span class="sf17b16">'credit_card_exp_date'</span><span class="sf17b16">][</span><span class="sf17b16">'Y'</span><span class="sf17b16">] ) {
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">592</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf17b16">errors[</span><span class="sf17b16">'credit_card_exp_date'</span><span class="sf17b16">] = </span><span class="sf17b16">ts</span><span class="sf17b16">(</span><span class="sf17b16">'Card Expiration is a required field.'</span><span class="sf17b16"> );
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">593</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp;} </span><span class="sf17b16">elseif</span><span class="sf17b16"> ( ( </span><span class="sf17b16">strtotime</span><span class="sf17b16">($</span><span class="sf17b16">currentDate) &gt; </span><span class="sf17b16">strtotime</span><span class="sf17b16">( $</span><span class="sf17b16">expDate ) )) {
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">594</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf17b16">errors[</span><span class="sf17b16">'credit_card_exp_date'</span><span class="sf17b16">] = </span><span class="sf17b16">ts</span><span class="sf17b16">(</span><span class="sf17b16">'Credit card expiration date cannot be a past date.'</span><span class="sf17b16"> );
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">595</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp;}
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">596</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp;}
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">597</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp;}
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">598</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp;</span><span class="sf17b16">return</span><span class="sf17b16"> </span><span class="sf17b16">empty</span><span class="sf17b16">($</span><span class="sf17b16">errors) ? TRUE : $</span><span class="sf17b16">errors;
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">599</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp;}
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">600</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp;</span><span class="sf17b16">//Ends
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">601</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp;
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">427</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf9b2">/**</span></code></td>
<td class="ln">602</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf9b2">/**</span></code></td>
</tr>
<tr valign="top">
<td class="ln">428</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * Function to process the form</span></code></td>
<td class="ln">603</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * Function to process the form</span></code></td>
</tr>
<tr valign="top">
<td class="ln">429</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; *</span></code></td>
<td class="ln">604</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; *</span></code></td>
</tr>
<tr valign="top">
<td class="ln">430</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @access public</span></code></td>
<td class="ln">605</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @access public</span></code></td>
</tr>
<tr valign="top">
<td class="ln">431</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; *</span></code></td>
<td class="ln">606</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; *</span></code></td>
</tr>
<tr valign="top">
<td class="ln">432</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @return None</span></code></td>
<td class="ln">607</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @return None</span></code></td>
</tr>
<tr valign="top">
<td class="ln">433</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; */</span>&nbsp;</code></td>
<td class="ln">608</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; */</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">434</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf8b2">public function postProcess</span><span class="sf3b2">() {</span></code></td>
<td class="ln">609</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf8b2">public function postProcess</span><span class="sf3b2">() {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">435</td><td style="color: #000000; background-color: #fbf2bf; "><code>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #e9e9e9; "><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">436</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">now &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; = </span><span class="sf8b2">date</span><span class="sf3b2">(</span><span class="sf12b2">'YmdHis'</span><span class="sf3b2">);</span></code></td>
<td class="ln">610</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">now &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; = </span><span class="sf8b2">date</span><span class="sf3b2">(</span><span class="sf12b2">'YmdHis'</span><span class="sf3b2">);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">437</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">config &nbsp; &nbsp; &nbsp; &nbsp;= </span><span class="sf8b2">CRM_Core_Config::singleton</span><span class="sf3b2">();</span></code></td>
<td class="ln">611</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">config &nbsp; &nbsp; &nbsp; &nbsp;= </span><span class="sf8b2">CRM_Core_Config::singleton</span><span class="sf3b2">();</span></code></td>
</tr>
<tr valign="top">
<td class="ln">438</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">session &nbsp; &nbsp; &nbsp; = </span><span class="sf8b2">CRM_Core_Session::singleton</span><span class="sf3b2">();</span></code></td>
<td class="ln">612</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">session &nbsp; &nbsp; &nbsp; = </span><span class="sf8b2">CRM_Core_Session::singleton</span><span class="sf3b2">();</span></code></td>
</tr>
<tr valign="top">
<td class="ln">439</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_params = $</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">get</span><span class="sf3b2">(</span><span class="sf12b2">'params'</span><span class="sf3b2">);</span></code></td>
<td class="ln">613</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_params = $</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">get</span><span class="sf3b2">(</span><span class="sf12b2">'params'</span><span class="sf3b2">);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">440</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp;</span><span class="sf17b16">if</span><span class="sf17b16"> (</span><span class="sf17b16">CRM_Utils_Array::value</span><span class="sf17b16">(</span><span class="sf17b16">'contact_id'</span><span class="sf17b16">, $</span><span class="sf17b16">this-&gt;_params[0])) {</span>&nbsp;</code></td>
<td class="ln">614</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp;</span><span class="sf17b16">//BOT - handle the changes in post process</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">441</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp;</span><span class="sf17b16"> &nbsp;</span><span class="sf17b16">$</span><span class="sf17b16">contactID = $</span><span class="sf17b16">this-&gt;_params[0][</span><span class="sf17b16">'contact_id'</span><span class="sf17b16">];</span>&nbsp;</code></td>
<td class="ln">615</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp;</span><span class="sf17b16">//Instead for 'isPrimary' check for 'isPayer' in the code</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">616</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp;$</span><span class="sf17b16">params = $</span><span class="sf17b16">this-&gt;</span><span class="sf17b16">controller-&gt;exportValues</span><span class="sf17b16">($</span><span class="sf17b16">this-&gt;_name);
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">617</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp;</span><span class="sf17b16">unset</span><span class="sf17b16">($</span><span class="sf17b16">params[</span><span class="sf17b16">'email-Primary'</span><span class="sf17b16">]);
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">618</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp;</span><span class="sf17b16">unset</span><span class="sf17b16">($</span><span class="sf17b16">params[</span><span class="sf17b16">'first_name'</span><span class="sf17b16">]);
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">619</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp;</span><span class="sf17b16">unset</span><span class="sf17b16">($</span><span class="sf17b16">params[</span><span class="sf17b16">'last_name'</span><span class="sf17b16">]);
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">620</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp;$</span><span class="sf17b16">isPayLater = </span><span class="sf17b16">0</span><span class="sf17b16">;
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">621</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp;</span><span class="sf17b16">if</span><span class="sf17b16">( $</span><span class="sf17b16">params[</span><span class="sf17b16">'payment_processor'</span><span class="sf17b16">] == </span><span class="sf17b16">0</span><span class="sf17b16"> ) {
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">622</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp;$</span><span class="sf17b16">isPayLater = </span><span class="sf17b16">1</span><span class="sf17b16">;
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">623</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp;}
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">624</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; 
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">625</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; $</span><span class="sf17b16">payer_email = $</span><span class="sf17b16">params[</span><span class="sf17b16">'payer_id'</span><span class="sf17b16">];
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">626</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; 
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">627</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; $</span><span class="sf17b16">isPayerAttending = TRUE;
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">628</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; </span><span class="sf17b16">if</span><span class="sf17b16"> ( $</span><span class="sf17b16">payer_email == </span><span class="sf17b16">'payer_not_attending'</span><span class="sf17b16"> ) {
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">629</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; $</span><span class="sf17b16">isPayerAttending &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; = FALSE;
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">630</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; $</span><span class="sf17b16">this-&gt;_params[</span><span class="sf17b16">'payer'</span><span class="sf17b16">] &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; = </span><span class="sf17b16">''</span><span class="sf17b16">;
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">631</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; $</span><span class="sf17b16">this-&gt;_params[</span><span class="sf17b16">'payer'</span><span class="sf17b16">] &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; = $</span><span class="sf17b16">params;
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">632</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; $</span><span class="sf17b16">this-&gt;_params[</span><span class="sf17b16">'payer'</span><span class="sf17b16">][</span><span class="sf17b16">'is_pay_later'</span><span class="sf17b16">] = $</span><span class="sf17b16">isPayLater;
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">633</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; $</span><span class="sf17b16">this-&gt;_params[</span><span class="sf17b16">'payer'</span><span class="sf17b16">][</span><span class="sf17b16">'is_payer'</span><span class="sf17b16">] &nbsp; &nbsp; = 1;
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">634</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; $</span><span class="sf17b16">statuses &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; = </span><span class="sf17b16">CRM_Event_PseudoConstant::participantStatus</span><span class="sf17b16">();
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">635</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; $</span><span class="sf17b16">status &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; = </span><span class="sf17b16">'Payer not attending'</span><span class="sf17b16">;
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">636</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; $</span><span class="sf17b16">this-&gt;_params[</span><span class="sf17b16">'payer'</span><span class="sf17b16">][</span><span class="sf17b16">'participant_status_id'</span><span class="sf17b16">] = $</span><span class="sf17b16">this-&gt;_params[</span><span class="sf17b16">'payer'</span><span class="sf17b16">][</span><span class="sf17b16">'participant_status'</span><span class="sf17b16">] = array_search</span><span class="sf17b16">($</span><span class="sf17b16">status, $</span><span class="sf17b16">statuses);
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">637</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; $</span><span class="sf17b16">mapParams = </span><span class="sf17b16">array</span><span class="sf17b16">(</span><span class="sf17b16">'is_primary'</span><span class="sf17b16">, </span><span class="sf17b16">'email-Primary'</span><span class="sf17b16">, </span><span class="sf17b16">'is_pay_later'</span><span class="sf17b16">, </span><span class="sf17b16">'contact_id'</span><span class="sf17b16">, </span><span class="sf17b16">'campaign_id'</span><span class="sf17b16">);
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">638</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; </span><span class="sf17b16">foreach</span><span class="sf17b16"> ( $</span><span class="sf17b16">this-&gt;_params[0] as $</span><span class="sf17b16">k =&gt; $</span><span class="sf17b16">v ) { &nbsp; &nbsp; &nbsp; &nbsp; 
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">639</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf17b16">if</span><span class="sf17b16">( !</span><span class="sf17b16">in_array</span><span class="sf17b16">( $</span><span class="sf17b16">k, $</span><span class="sf17b16">mapParams ) ) {
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">640</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $</span><span class="sf17b16">this-&gt;_params[</span><span class="sf17b16">'payer'</span><span class="sf17b16">][$</span><span class="sf17b16">k] = $</span><span class="sf17b16">v; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">641</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp; } &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">642</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; }
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">643</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; $</span><span class="sf17b16">this-&gt;_params[</span><span class="sf17b16">'payer'</span><span class="sf17b16">][</span><span class="sf17b16">'first_name'</span><span class="sf17b16">] = $</span><span class="sf17b16">this-&gt;_params[</span><span class="sf17b16">'payer'</span><span class="sf17b16">][</span><span class="sf17b16">'billing_first_name'</span><span class="sf17b16">];
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">644</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; $</span><span class="sf17b16">this-&gt;_params[</span><span class="sf17b16">'payer'</span><span class="sf17b16">][</span><span class="sf17b16">'last_name'</span><span class="sf17b16">] &nbsp;= $</span><span class="sf17b16">this-&gt;_params[</span><span class="sf17b16">'payer'</span><span class="sf17b16">][</span><span class="sf17b16">'billing_last_name'</span><span class="sf17b16">];
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">645</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; $</span><span class="sf17b16">payer = </span><span class="sf17b16">'payer'</span><span class="sf17b16">;
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">646</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; $</span><span class="sf17b16">participantRoles = </span><span class="sf17b16">CRM_Event_PseudoConstant::participantRole</span><span class="sf17b16">();
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">647</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; $</span><span class="sf17b16">this-&gt;_params[</span><span class="sf17b16">'payer'</span><span class="sf17b16">][</span><span class="sf17b16">'participant_role_id'</span><span class="sf17b16">] = array_search</span><span class="sf17b16">(</span><span class="sf17b16">'Payer'</span><span class="sf17b16">, $</span><span class="sf17b16">participantRoles);
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">648</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> $</span><span class="sf17b16">this-&gt;_params[</span><span class="sf17b16">'payer'</span><span class="sf17b16">][</span><span class="sf17b16">'email-Primary'</span><span class="sf17b16">] = $</span><span class="sf17b16">this-&gt;_params[</span><span class="sf17b16">'payer'</span><span class="sf17b16">][</span><span class="sf17b16">'receipt_email'</span><span class="sf17b16">];
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">649</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; } 
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">650</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp; 
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">651</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; </span><span class="sf17b16">foreach</span><span class="sf17b16"> ($</span><span class="sf17b16">this-&gt;_params as $</span><span class="sf17b16">k =&gt; $</span><span class="sf17b16">v) { 
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">652</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; </span><span class="sf17b16">if</span><span class="sf17b16"> ( $</span><span class="sf17b16">key != </span><span class="sf17b16">'payer'</span><span class="sf17b16"> || $</span><span class="sf17b16">key === </span><span class="sf17b16">0</span><span class="sf17b16"> ) {
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">653</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; </span><span class="sf17b16">// unset( $this-&gt;_params[$k][is_pay_later] );
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">654</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp; $</span><span class="sf17b16">this-&gt;_params[$</span><span class="sf17b16">k][</span><span class="sf17b16">'is_pay_later'</span><span class="sf17b16">] = $</span><span class="sf17b16">isPayLater;
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">655</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; }
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">656</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; 
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">657</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf17b16">if</span><span class="sf17b16"> ( $</span><span class="sf17b16">isPayerAttending ) {
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">658</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf17b16">if</span><span class="sf17b16"> ( $</span><span class="sf17b16">k == $</span><span class="sf17b16">payer_email ) {
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">659</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $</span><span class="sf17b16">this-&gt;_params[$</span><span class="sf17b16">k][</span><span class="sf17b16">'is_payer'</span><span class="sf17b16">] &nbsp; &nbsp; = </span><span class="sf17b16">1</span><span class="sf17b16">;
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">660</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $</span><span class="sf17b16">this-&gt;_params[$</span><span class="sf17b16">k] &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; = </span><span class="sf17b16">array_merge</span><span class="sf17b16">($</span><span class="sf17b16">this-&gt;_params[$</span><span class="sf17b16">k] , $</span><span class="sf17b16">params);
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">661</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $</span><span class="sf17b16">this-&gt;_params[$</span><span class="sf17b16">k][</span><span class="sf17b16">'is_pay_later'</span><span class="sf17b16">] = $</span><span class="sf17b16">isPayLater;
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">662</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf17b16">/*
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">663</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;* BOT - changed to store the original amount of participant 
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">664</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;* &nbsp;as it gets overwritten further with the total amount to be paid for all participants
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">665</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;*/</span><span class="sf17b16">
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">666</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $</span><span class="sf17b16">this-&gt;_params[$</span><span class="sf17b16">k][</span><span class="sf17b16">'original_amount'</span><span class="sf17b16">] = $</span><span class="sf17b16">this-&gt;_params[$</span><span class="sf17b16">k][</span><span class="sf17b16">'amount'</span><span class="sf17b16">]; 
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">667</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $</span><span class="sf17b16">payer = $</span><span class="sf17b16">k;
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">668</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} &nbsp; &nbsp; &nbsp; 
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">669</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp; } &nbsp; 
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">670</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; }
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">671</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16">
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">672</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; $</span><span class="sf17b16">temp[$</span><span class="sf17b16">payer] = $</span><span class="sf17b16">this-&gt;_params[$</span><span class="sf17b16">payer];
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">673</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; </span><span class="sf17b16">unset</span><span class="sf17b16">($</span><span class="sf17b16">this-&gt;_params[$</span><span class="sf17b16">payer]);
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">674</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; $</span><span class="sf17b16">this-&gt;_params = $</span><span class="sf17b16">temp + $</span><span class="sf17b16">this-&gt;_params;
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">675</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; </span><span class="sf17b16">//Ends
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">676</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp;
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">677</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp;</span><span class="sf17b16">if</span><span class="sf17b16"> (</span><span class="sf17b16">CRM_Utils_Array::value</span><span class="sf17b16">(</span><span class="sf17b16">'contact_id'</span><span class="sf17b16">, $</span><span class="sf17b16">this-&gt;_params[$</span><span class="sf17b16">payer])) {
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">678</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp;$</span><span class="sf17b16">contactID = $</span><span class="sf17b16">this-&gt;_params[$</span><span class="sf17b16">payer][</span><span class="sf17b16">'contact_id'</span><span class="sf17b16">];
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">442</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">679</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">443</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">else</span><span class="sf3b2"> {</span></code></td>
<td class="ln">680</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">else</span><span class="sf3b2"> {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">444</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">contactID = </span><span class="sf8b2">parent::getContactID</span><span class="sf3b2">();</span></code></td>
<td class="ln">681</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">contactID = </span><span class="sf8b2">parent::getContactID</span><span class="sf3b2">();</span></code></td>
</tr>
<tr valign="top">
<td class="ln">445</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">682</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">446</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16">
</span>&nbsp;</code></td>
<td class="ln">683</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; 
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">447</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// if a discount has been applied, lets now deduct it from the amount</span></code></td>
<td class="ln">684</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// if a discount has been applied, lets now deduct it from the amount</span></code></td>
</tr>
<tr valign="top">
<td class="ln">448</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// and fix the fee level</span></code></td>
<td class="ln">685</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// and fix the fee level</span></code></td>
</tr>
<tr valign="top">
<td class="ln">449</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp;</span><span style="color: #000000; background-color: #efcb05; font-weight: bold; ">if</span><span style="color: #000000; background-color: #efcb05; "> (</span><span style="color: #000000; background-color: #efcb05; ">CRM_Utils_Array::value</span><span style="color: #000000; background-color: #efcb05; ">(</span><span style="color: #000000; background-color: #efcb05; ">'discount'</span><span style="color: #000000; background-color: #efcb05; ">, </span><span class="sf17b16">$</span><span class="sf17b16">this-&gt;_params[0])</span><span style="color: #000000; background-color: #efcb05; "> &amp;&amp;</span></code></td>
<td class="ln">686</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp;</span><span style="color: #000000; background-color: #efcb05; font-weight: bold; ">if</span><span style="color: #000000; background-color: #efcb05; "> (</span><span style="color: #000000; background-color: #efcb05; ">CRM_Utils_Array::value</span><span style="color: #000000; background-color: #efcb05; ">(</span><span style="color: #000000; background-color: #efcb05; ">'discount'</span><span style="color: #000000; background-color: #efcb05; ">, </span><span class="sf17b16">$</span><span class="sf17b16">this-&gt;_params[$</span><span class="sf17b16">payer])</span><span style="color: #000000; background-color: #efcb05; "> &amp;&amp;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">450</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">CRM_Utils_Array::value</span><span style="color: #000000; background-color: #efcb05; ">(</span><span style="color: #000000; background-color: #efcb05; ">'applied'</span><span style="color: #000000; background-color: #efcb05; ">, </span><span class="sf17b16">$</span><span class="sf17b16">this-&gt;_params[0][</span><span class="sf17b16">'discount'</span><span class="sf17b16">])</span>&nbsp;</code></td>
<td class="ln">687</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">CRM_Utils_Array::value</span><span style="color: #000000; background-color: #efcb05; ">(</span><span style="color: #000000; background-color: #efcb05; ">'applied'</span><span style="color: #000000; background-color: #efcb05; ">, </span><span class="sf17b16">$</span><span class="sf17b16">this-&gt;_params[$</span><span class="sf17b16">payer][</span><span class="sf17b16">'discount'</span><span class="sf17b16">])</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">451</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;) {</span></code></td>
<td class="ln">688</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">452</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">foreach</span><span class="sf3b2"> ($</span><span class="sf18b2">this-&gt;_params as $</span><span class="sf18b2">k =&gt; $</span><span class="sf18b2">v) {</span></code></td>
<td class="ln">689</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">foreach</span><span class="sf3b2"> ($</span><span class="sf18b2">this-&gt;_params as $</span><span class="sf18b2">k =&gt; $</span><span class="sf18b2">v) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">453</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'amount'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_params[$</span><span class="sf18b2">k]) &gt; </span><span class="sf10b2">0</span><span class="sf3b2"> &amp;&amp;</span></code></td>
<td class="ln">690</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'amount'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_params[$</span><span class="sf18b2">k]) &gt; </span><span class="sf10b2">0</span><span class="sf3b2"> &amp;&amp;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">454</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'discountAmount'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_params[$</span><span class="sf18b2">k])</span></code></td>
<td class="ln">691</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'discountAmount'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_params[$</span><span class="sf18b2">k])</span></code></td>
</tr>
<tr valign="top">
<td class="ln">455</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;) {</span></code></td>
<td class="ln">692</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">456</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_params[$</span><span class="sf18b2">k][</span><span class="sf12b2">'amount'</span><span class="sf3b2">] -= $</span><span class="sf18b2">this-&gt;_params[$</span><span class="sf18b2">k][</span><span class="sf12b2">'discountAmount'</span><span class="sf3b2">];</span></code></td>
<td class="ln">693</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_params[$</span><span class="sf18b2">k][</span><span class="sf12b2">'amount'</span><span class="sf3b2">] -= $</span><span class="sf18b2">this-&gt;_params[$</span><span class="sf18b2">k][</span><span class="sf12b2">'discountAmount'</span><span class="sf3b2">];</span></code></td>
</tr>
<tr valign="top">
<td class="ln">457</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_params[$</span><span class="sf18b2">k][</span><span class="sf12b2">'amount_level'</span><span class="sf3b2">] </span><span class="sf8b2">.= CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'discountMessage'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_params[$</span><span class="sf18b2">k]);</span></code></td>
<td class="ln">694</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_params[$</span><span class="sf18b2">k][</span><span class="sf12b2">'amount_level'</span><span class="sf3b2">] </span><span class="sf8b2">.= CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'discountMessage'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_params[$</span><span class="sf18b2">k]);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">458</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">695</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">459</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">696</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">460</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp;</span><span class="sf17b16">$</span><span class="sf17b16">this-&gt;</span><span class="sf17b16">set</span><span class="sf17b16">(</span><span class="sf17b16">'params'</span><span class="sf17b16">, $</span><span class="sf17b16">this-&gt;_params);
</span>&nbsp;</code></td>
<td class="ln">697</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp;</span><span class="sf17b16">
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">461</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">698</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">462</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16">
</span>&nbsp;</code></td>
<td class="ln">699</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16">$</span><span class="sf17b16">this-&gt;</span><span class="sf17b16">set</span><span class="sf17b16">(</span><span class="sf17b16">'params'</span><span class="sf17b16">, $</span><span class="sf17b16">this-&gt;_params);
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">700</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> $</span><span class="sf17b16">this-&gt;</span><span class="sf17b16">assignToTemplate</span><span class="sf17b16">();
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">463</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// CRM-4320, lets build array of cancelled additional participant ids</span></code></td>
<td class="ln">701</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// CRM-4320, lets build array of cancelled additional participant ids</span></code></td>
</tr>
<tr valign="top">
<td class="ln">464</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// those are drop or skip by primary at the time of confirmation.</span></code></td>
<td class="ln">702</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// those are drop or skip by primary at the time of confirmation.</span></code></td>
</tr>
<tr valign="top">
<td class="ln">465</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// get all in and then unset those we want to process.</span></code></td>
<td class="ln">703</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// get all in and then unset those we want to process.</span></code></td>
</tr>
<tr valign="top">
<td class="ln">466</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">cancelledIds = $</span><span class="sf18b2">this-&gt;_additionalParticipantIds;</span></code></td>
<td class="ln">704</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">cancelledIds = $</span><span class="sf18b2">this-&gt;_additionalParticipantIds;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">467</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">705</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">468</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">params = $</span><span class="sf18b2">this-&gt;_params;</span></code></td>
<td class="ln">706</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">params = $</span><span class="sf18b2">this-&gt;_params;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">469</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">set</span><span class="sf3b2">(</span><span class="sf12b2">'finalAmount'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_amount);</span></code></td>
<td class="ln">707</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">set</span><span class="sf3b2">(</span><span class="sf12b2">'finalAmount'</span><span class="sf3b2">, $</span><span class="sf18b2">this-&gt;_amount);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">470</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">participantCount = </span><span class="sf7b2">array</span><span class="sf3b2">();</span></code></td>
<td class="ln">708</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">participantCount = </span><span class="sf7b2">array</span><span class="sf3b2">();</span></code></td>
</tr>
<tr valign="top">
<td class="ln">471</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">709</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">472</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">//unset the skip participant from params.</span></code></td>
<td class="ln">710</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">//unset the skip participant from params.</span></code></td>
</tr>
<tr valign="top">
<td class="ln">473</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">//build the $participantCount array.</span></code></td>
<td class="ln">711</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">//build the $participantCount array.</span></code></td>
</tr>
<tr valign="top">
<td class="ln">474</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">//maintain record for all participants.</span></code></td>
<td class="ln">712</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">//maintain record for all participants.</span></code></td>
</tr>
<tr valign="top">
<td class="ln">475</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">foreach</span><span class="sf3b2"> ($</span><span class="sf18b2">params </span><span class="sf7b2">as</span><span class="sf3b2"> $</span><span class="sf18b2">participantNum =&gt; $</span><span class="sf18b2">record) {</span></code></td>
<td class="ln">713</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">foreach</span><span class="sf3b2"> ($</span><span class="sf18b2">params </span><span class="sf7b2">as</span><span class="sf3b2"> $</span><span class="sf18b2">participantNum =&gt; $</span><span class="sf18b2">record) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">476</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">record == </span><span class="sf12b2">'skip'</span><span class="sf3b2">) {</span></code></td>
<td class="ln">714</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">record == </span><span class="sf12b2">'skip'</span><span class="sf3b2">) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">477</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">unset</span><span class="sf3b2">($</span><span class="sf18b2">params[$</span><span class="sf18b2">participantNum]);</span></code></td>
<td class="ln">715</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">unset</span><span class="sf3b2">($</span><span class="sf18b2">params[$</span><span class="sf18b2">participantNum]);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">478</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">participantCount[$</span><span class="sf18b2">participantNum] = </span><span class="sf12b2">'skip'</span><span class="sf3b2">;</span></code></td>
<td class="ln">716</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">participantCount[$</span><span class="sf18b2">participantNum] = </span><span class="sf12b2">'skip'</span><span class="sf3b2">;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">479</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">717</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">480</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp;</span><span style="color: #000000; background-color: #efcb05; font-weight: bold; ">elseif</span><span style="color: #000000; background-color: #efcb05; "> </span><span class="sf17b16">($</span><span class="sf17b16">participantNum)</span><span style="color: #000000; background-color: #efcb05; "> {</span></code></td>
<td class="ln">718</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp;</span><span style="color: #000000; background-color: #efcb05; font-weight: bold; ">elseif</span><span style="color: #000000; background-color: #efcb05; "> </span><span class="sf17b16">( &nbsp;$</span><span class="sf17b16">participantNum || $</span><span class="sf17b16">participantNum === </span><span class="sf17b16">0</span><span class="sf17b16"> &nbsp;)</span><span style="color: #000000; background-color: #efcb05; "> {</span></code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">719</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf17b16">if</span><span class="sf17b16"> ( $</span><span class="sf17b16">participantNum === </span><span class="sf17b16">'payer'</span><span class="sf17b16">) {
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">720</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf17b16">continue</span><span class="sf17b16">;
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">721</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp;}
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">481</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">participantCount[$</span><span class="sf18b2">participantNum] = </span><span class="sf12b2">'participant'</span><span class="sf3b2">;</span></code></td>
<td class="ln">722</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">participantCount[$</span><span class="sf18b2">participantNum] = </span><span class="sf12b2">'participant'</span><span class="sf3b2">;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">482</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">723</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">483</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">724</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">484</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">//lets get additional participant id to cancel.</span></code></td>
<td class="ln">725</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">//lets get additional participant id to cancel.</span></code></td>
</tr>
<tr valign="top">
<td class="ln">485</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">_allowConfirmation &amp;&amp; is_array</span><span class="sf3b2">($</span><span class="sf18b2">cancelledIds)) {</span></code></td>
<td class="ln">726</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">_allowConfirmation &amp;&amp; is_array</span><span class="sf3b2">($</span><span class="sf18b2">cancelledIds)) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">486</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">additonalId = </span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'participant_id'</span><span class="sf3b2">, $</span><span class="sf18b2">record);</span></code></td>
<td class="ln">727</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">additonalId = </span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'participant_id'</span><span class="sf3b2">, $</span><span class="sf18b2">record);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">487</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">additonalId &amp;&amp; $</span><span class="sf18b2">key = </span><span class="sf8b2">array_search</span><span class="sf3b2">($</span><span class="sf18b2">additonalId, $</span><span class="sf18b2">cancelledIds)) {</span></code></td>
<td class="ln">728</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">additonalId &amp;&amp; $</span><span class="sf18b2">key = </span><span class="sf8b2">array_search</span><span class="sf3b2">($</span><span class="sf18b2">additonalId, $</span><span class="sf18b2">cancelledIds)) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">488</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">unset</span><span class="sf3b2">($</span><span class="sf18b2">cancelledIds[$</span><span class="sf18b2">key]);</span></code></td>
<td class="ln">729</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">unset</span><span class="sf3b2">($</span><span class="sf18b2">cancelledIds[$</span><span class="sf18b2">key]);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">489</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">730</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">490</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">731</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">491</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">732</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">492</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">733</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">493</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">payment = $</span><span class="sf18b2">registerByID = $</span><span class="sf18b2">primaryCurrencyID = $</span><span class="sf18b2">contribution = NULL;</span></code></td>
<td class="ln">734</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">payment = $</span><span class="sf18b2">registerByID = $</span><span class="sf18b2">primaryCurrencyID = $</span><span class="sf18b2">contribution = NULL;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">494</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">paymentObjError = </span><span class="sf8b2">ts</span><span class="sf3b2">(</span><span class="sf12b2">'The system did not record payment details for this payment and so could not process the transaction. Please report this error to the site administrator.'</span><span class="sf3b2">);</span></code></td>
<td class="ln">735</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">paymentObjError = </span><span class="sf8b2">ts</span><span class="sf3b2">(</span><span class="sf12b2">'The system did not record payment details for this payment and so could not process the transaction. Please report this error to the site administrator.'</span><span class="sf3b2">);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">495</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">736</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">496</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">participantIDS = array</span><span class="sf3b2">();</span></code></td>
<td class="ln">737</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">participantIDS = array</span><span class="sf3b2">();</span></code></td>
</tr>
<tr valign="top">
<td class="ln">497</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16">
</span>&nbsp;</code></td>
<td class="ln">738</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> 
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">739</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; 
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">498</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">foreach</span><span class="sf3b2"> ($</span><span class="sf18b2">params </span><span class="sf7b2">as</span><span class="sf3b2"> $</span><span class="sf18b2">key =&gt; $</span><span class="sf18b2">value) {</span></code></td>
<td class="ln">740</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">foreach</span><span class="sf3b2"> ($</span><span class="sf18b2">params </span><span class="sf7b2">as</span><span class="sf3b2"> $</span><span class="sf18b2">key =&gt; $</span><span class="sf18b2">value) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">499</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; </span><span class="sf17b16">&nbsp;</span><span style="color: #000000; background-color: #efcb05; ">$</span><span style="color: #000000; background-color: #efcb05; ">this-&gt;</span><span style="color: #000000; background-color: #efcb05; ">fixLocationFields</span><span style="color: #000000; background-color: #efcb05; ">($</span><span style="color: #000000; background-color: #efcb05; ">value, $</span><span style="color: #000000; background-color: #efcb05; ">fields);</span></code></td>
<td class="ln">741</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; </span><span style="color: #000000; background-color: #efcb05; ">$</span><span style="color: #000000; background-color: #efcb05; ">this-&gt;</span><span style="color: #000000; background-color: #efcb05; ">fixLocationFields</span><span style="color: #000000; background-color: #efcb05; ">($</span><span style="color: #000000; background-color: #efcb05; ">value, $</span><span style="color: #000000; background-color: #efcb05; ">fields);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">500</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">//unset the billing parameters if it is pay later mode</span></code></td>
<td class="ln">742</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">//unset the billing parameters if it is pay later mode</span></code></td>
</tr>
<tr valign="top">
<td class="ln">501</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">//to avoid creation of billing location</span></code></td>
<td class="ln">743</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">//to avoid creation of billing location</span></code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">744</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16">
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">745</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp;</span><span class="sf17b16">//To set credit card parameters if payment fields are on confirm page
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">746</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; </span><span class="sf17b16">if</span><span class="sf17b16"> ( $</span><span class="sf17b16">this-&gt;</span><span class="sf17b16">_showPaymentFields &amp;&amp; CRM_Utils_Array::value</span><span class="sf17b16">(</span><span class="sf17b16">'is_payer'</span><span class="sf17b16">, $</span><span class="sf17b16">value ) ) {
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">747</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf17b16">if</span><span class="sf17b16"> (</span><span class="sf17b16">isset</span><span class="sf17b16">($</span><span class="sf17b16">value[</span><span class="sf17b16">"billing_state_province_id-{$this-&gt;_b<wbr>ltID}"</span><span class="sf17b16">])
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">748</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp; &amp;&amp; $</span><span class="sf17b16">value[</span><span class="sf17b16">"billing_state_province_id-{$this-&gt;_bltID}"</span><span class="sf17b16">]<wbr>
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">749</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp; ) {
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">750</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $</span><span class="sf17b16">value[</span><span class="sf17b16">"billing_state_province-{$this-&gt;_bltID}"</span><span class="sf17b16">] = &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf17b16">CRM_Core_PseudoConstant::stateProvinceAbbreviation</span><span class="sf17b16">(<wbr>$</span><span class="sf17b16">value[</span><span class="sf17b16">"billing_state_province_id-{$this-&gt;_bltID}"</span><span class="sf17b16">]<wbr>);
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">751</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; }
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">752</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; 
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">753</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf17b16">if</span><span class="sf17b16"> (</span><span class="sf17b16">isset</span><span class="sf17b16">($</span><span class="sf17b16">value[</span><span class="sf17b16">"billing_country_id-{$this-&gt;_bltID}"</span><span class="sf17b16">]<wbr>) &amp;&amp; $</span><span class="sf17b16">value[</span><span class="sf17b16">"billing_country_id-{$this-&gt;_bltID}"</span><span class="sf17b16">]) {
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">754</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $</span><span class="sf17b16">value[</span><span class="sf17b16">"billing_country-{$this-&gt;_bltID}"</span><span class="sf17b16">] = </span><span class="sf17b16">CRM_Core_PseudoConstant::countryIsoCode</span><span class="sf17b16">($</span><span class="sf17b16">value[</span><span class="sf17b16">"bil<wbr>ling_country_id-{$this-&gt;_bltID}"</span><span class="sf17b16">]);
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">755</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; }
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">756</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf17b16">if</span><span class="sf17b16"> (</span><span class="sf17b16">isset</span><span class="sf17b16">($</span><span class="sf17b16">value[</span><span class="sf17b16">'credit_card_exp_date'</span><span class="sf17b16">])) {
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">757</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $</span><span class="sf17b16">value[</span><span class="sf17b16">'year'</span><span class="sf17b16">] = </span><span class="sf17b16">CRM_Core_Payment_Form::getCreditCardExpirationYear</span><span class="sf17b16">(<wbr>$</span><span class="sf17b16">value);
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">758</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $</span><span class="sf17b16">value[</span><span class="sf17b16">'month'</span><span class="sf17b16">] = </span><span class="sf17b16">CRM_Core_Payment_Form::getCreditCardExpirationMonth<wbr></span><span class="sf17b16">($</span><span class="sf17b16">value);
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">759</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp; } &nbsp; &nbsp; &nbsp; 
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">760</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; }
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">761</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16">
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">762</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16">
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">502</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">this-&gt;_allowWaitlist || $</span><span class="sf18b2">this-&gt;_requireApproval ||</span></code></td>
<td class="ln">763</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">this-&gt;_allowWaitlist || $</span><span class="sf18b2">this-&gt;_requireApproval ||</span></code></td>
</tr>
<tr valign="top">
<td class="ln">503</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">CRM_Utils_Array::value</span><span style="color: #000000; background-color: #efcb05; ">(</span><span style="color: #000000; background-color: #efcb05; ">'is_pay_later'</span><span style="color: #000000; background-color: #efcb05; ">, $</span><span style="color: #000000; background-color: #efcb05; ">value) || </span><span class="sf17b16">!</span><span class="sf17b16">CRM_Utils_Array::value</span><span class="sf17b16">(</span><span class="sf17b16">'is_primary'</span><span class="sf17b16">,</span><span style="color: #000000; background-color: #efcb05; "> $</span><span style="color: #000000; background-color: #efcb05; ">value)</span></code></td>
<td class="ln">764</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">CRM_Utils_Array::value</span><span style="color: #000000; background-color: #efcb05; ">(</span><span style="color: #000000; background-color: #efcb05; ">'is_pay_later'</span><span style="color: #000000; background-color: #efcb05; ">, $</span><span style="color: #000000; background-color: #efcb05; ">value) || </span><span class="sf17b16">!</span><span class="sf17b16">CRM_Utils_Array::value</span><span class="sf17b16">(</span><span class="sf17b16">'is_payer'</span><span class="sf17b16">,</span><span style="color: #000000; background-color: #efcb05; "> $</span><span style="color: #000000; background-color: #efcb05; ">value)</span></code></td>
</tr>
<tr valign="top">
<td class="ln">504</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;) {</span></code></td>
<td class="ln">765</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">505</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">billingFields = </span><span class="sf7b2">array</span><span class="sf3b2">(</span></code></td>
<td class="ln">766</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">billingFields = </span><span class="sf7b2">array</span><span class="sf3b2">(</span></code></td>
</tr>
<tr valign="top">
<td class="ln">506</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">"email-{$this-&gt;_bltID}"</span><span class="sf3b2">,</span></code></td>
<td class="ln">767</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">"email-{$this-&gt;_bltID}"</span><span class="sf3b2">,</span></code></td>
</tr>
<tr valign="top">
<td class="ln">507</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">"billing_first_name"</span><span class="sf3b2">,</span></code></td>
<td class="ln">768</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">"billing_first_name"</span><span class="sf3b2">,</span></code></td>
</tr>
<tr valign="top">
<td class="ln">508</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">"billing_middle_name"</span><span class="sf3b2">,</span></code></td>
<td class="ln">769</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">"billing_middle_name"</span><span class="sf3b2">,</span></code></td>
</tr>
<tr valign="top">
<td class="ln">509</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">"billing_last_name"</span><span class="sf3b2">,</span></code></td>
<td class="ln">770</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">"billing_last_name"</span><span class="sf3b2">,</span></code></td>
</tr>
<tr valign="top">
<td class="ln">510</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">"billing_street_address-{$this-&gt;_bltID}"</span><span class="sf3b2">,</span></code></td>
<td class="ln">771</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">"billing_street_address-{$this-&gt;_bltID}"</span><span class="sf3b2">,</span></code></td>
</tr>
<tr valign="top">
<td class="ln">511</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">"billing_city-{$this-&gt;_bltID}"</span><span class="sf3b2">,</span></code></td>
<td class="ln">772</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">"billing_city-{$this-&gt;_bltID}"</span><span class="sf3b2">,</span></code></td>
</tr>
<tr valign="top">
<td class="ln">512</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">"billing_state_province-{$this-&gt;_bltID}"</span><span class="sf3b2">,</span></code></td>
<td class="ln">773</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">"billing_state_province-{$this-&gt;_bltID}"</span><span class="sf3b2">,</span></code></td>
</tr>
<tr valign="top">
<td class="ln">513</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">"billing_state_province_id-{$this-&gt;_bltID}"</span><span class="sf3b2">,</span></code></td>
<td class="ln">774</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">"billing_state_province_id-{$this-&gt;_bltID}"</span><span class="sf3b2">,</span></code></td>
</tr>
<tr valign="top">
<td class="ln">514</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">"billing_postal_code-{$this-&gt;_bltID}"</span><span class="sf3b2">,</span></code></td>
<td class="ln">775</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">"billing_postal_code-{$this-&gt;_bltID}"</span><span class="sf3b2">,</span></code></td>
</tr>
<tr valign="top">
<td class="ln">515</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">"billing_country-{$this-&gt;_bltID}"</span><span class="sf3b2">,</span></code></td>
<td class="ln">776</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">"billing_country-{$this-&gt;_bltID}"</span><span class="sf3b2">,</span></code></td>
</tr>
<tr valign="top">
<td class="ln">516</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">"billing_country_id-{$this-&gt;_bltID}"</span><span class="sf3b2">,</span></code></td>
<td class="ln">777</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">"billing_country_id-{$this-&gt;_bltID}"</span><span class="sf3b2">,</span></code></td>
</tr>
<tr valign="top">
<td class="ln">517</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">"address_name-{$this-&gt;_bltID}"</span><span class="sf3b2">,</span></code></td>
<td class="ln">778</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">"address_name-{$this-&gt;_bltID}"</span><span class="sf3b2">,</span></code></td>
</tr>
<tr valign="top">
<td class="ln">518</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;);</span></code></td>
<td class="ln">779</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;);</span></code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #e9e9e9; "><code>&nbsp;</code></td>
<td class="ln">780</td><td style="color: #000000; background-color: #fbf2bf; "><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">519</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">foreach</span><span class="sf3b2"> ($</span><span class="sf18b2">billingFields </span><span class="sf7b2">as</span><span class="sf3b2"> $</span><span class="sf18b2">field) {</span></code></td>
<td class="ln">781</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">foreach</span><span class="sf3b2"> ($</span><span class="sf18b2">billingFields </span><span class="sf7b2">as</span><span class="sf3b2"> $</span><span class="sf18b2">field) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">520</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">unset</span><span class="sf3b2">($</span><span class="sf18b2">value[$</span><span class="sf18b2">field]);</span></code></td>
<td class="ln">782</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">unset</span><span class="sf3b2">($</span><span class="sf18b2">value[$</span><span class="sf18b2">field]);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">521</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">783</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">522</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'is_pay_later'</span><span class="sf3b2">, $</span><span class="sf18b2">value)) {</span></code></td>
<td class="ln">784</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'is_pay_later'</span><span class="sf3b2">, $</span><span class="sf18b2">value)) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">523</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'params'</span><span class="sf3b2">][</span><span class="sf12b2">'is_pay_later'</span><span class="sf3b2">] = TRUE;</span></code></td>
<td class="ln">785</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'params'</span><span class="sf3b2">][</span><span class="sf12b2">'is_pay_later'</span><span class="sf3b2">] = TRUE;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">524</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">786</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">525</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">787</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">526</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16">
</span>&nbsp;</code></td>
<td class="ln">788</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp;
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">527</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">//Unset ContactID for additional participants and set RegisterBy Id.</span></code></td>
<td class="ln">789</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp;</span><span class="sf17b16"> </span><span style="color: #000000; background-color: #efcb05; ">//Unset ContactID for additional participants and set RegisterBy Id.</span></code></td>
</tr>
<tr valign="top">
<td class="ln">528</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp;</span><span style="color: #000000; background-color: #efcb05; font-weight: bold; ">if</span><span style="color: #000000; background-color: #efcb05; "> </span><span class="sf17b16">(!</span><span class="sf17b16">CRM_Utils_Array::value</span><span class="sf17b16">(</span><span class="sf17b16">'is_primary'</span><span class="sf17b16">,</span><span style="color: #000000; background-color: #efcb05; "> $</span><span style="color: #000000; background-color: #efcb05; ">value)) {</span></code></td>
<td class="ln">790</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp;</span><span style="color: #000000; background-color: #efcb05; font-weight: bold; ">if</span><span style="color: #000000; background-color: #efcb05; "> </span><span class="sf17b16">(!</span><span class="sf17b16">CRM_Utils_Array::value</span><span class="sf17b16">(</span><span class="sf17b16">'is_payer'</span><span class="sf17b16">,</span><span style="color: #000000; background-color: #efcb05; "> $</span><span style="color: #000000; background-color: #efcb05; ">value)) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">529</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span style="color: #000000; background-color: #efcb05; ">contactID = </span><span style="color: #000000; background-color: #efcb05; ">CRM_Utils_Array::value</span><span style="color: #000000; background-color: #efcb05; ">(</span><span style="color: #000000; background-color: #efcb05; ">'contact_id'</span><span style="color: #000000; background-color: #efcb05; ">, $</span><span style="color: #000000; background-color: #efcb05; ">value);</span><span class="sf17b16">
</span>&nbsp;</code></td>
<td class="ln">791</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span style="color: #000000; background-color: #efcb05; ">contactID = </span><span style="color: #000000; background-color: #efcb05; ">CRM_Utils_Array::value</span><span style="color: #000000; background-color: #efcb05; ">(</span><span style="color: #000000; background-color: #efcb05; ">'contact_id'</span><span style="color: #000000; background-color: #efcb05; ">, $</span><span style="color: #000000; background-color: #efcb05; ">value);</span><span class="sf17b16"> &nbsp; 
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">530</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">registerByID = $</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">get</span><span class="sf3b2">(</span><span class="sf12b2">'registerByID'</span><span class="sf3b2">);</span></code></td>
<td class="ln">792</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">registerByID = $</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">get</span><span class="sf3b2">(</span><span class="sf12b2">'registerByID'</span><span class="sf3b2">);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">531</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">registerByID) {</span></code></td>
<td class="ln">793</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">registerByID) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">532</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">value[</span><span class="sf12b2">'registered_by_id'</span><span class="sf3b2">] = $</span><span class="sf18b2">registerByID;</span></code></td>
<td class="ln">794</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">value[</span><span class="sf12b2">'registered_by_id'</span><span class="sf3b2">] = $</span><span class="sf18b2">registerByID;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">533</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">795</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">534</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp;}</span><span class="sf17b16">
</span>&nbsp;</code></td>
<td class="ln">796</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp;}</span><span class="sf17b16"> 
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">535</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">else</span><span class="sf3b2"> {</span></code></td>
<td class="ln">797</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">else</span><span class="sf3b2"> {</span></code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">798</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf17b16">//Contact id reset for each loop iteration
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">799</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf17b16">contactID = </span><span class="sf17b16">CRM_Utils_Array::value</span><span class="sf17b16">(</span><span class="sf17b16">'contact_id'</span><span class="sf17b16">, $</span><span class="sf17b16">value);
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">536</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">value[</span><span class="sf12b2">'amount'</span><span class="sf3b2">] = $</span><span class="sf18b2">this-&gt;_totalAmount;</span></code></td>
<td class="ln">800</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">value[</span><span class="sf12b2">'amount'</span><span class="sf3b2">] = $</span><span class="sf18b2">this-&gt;_totalAmount;</span></code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">801</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp;
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">537</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">802</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">538</td><td style="color: #000000; background-color: #fbf2bf; "><code>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #e9e9e9; "><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">539</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">contactID = &amp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">updateContactFields</span><span class="sf3b2">($</span><span class="sf18b2">contactID, $</span><span class="sf18b2">value, $</span><span class="sf18b2">fields);</span></code></td>
<td class="ln">803</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">contactID = &amp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">updateContactFields</span><span class="sf3b2">($</span><span class="sf18b2">contactID, $</span><span class="sf18b2">value, $</span><span class="sf18b2">fields);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">540</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16">
</span>&nbsp;</code></td>
<td class="ln">804</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> 
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">541</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">// lets store the contactID in the session</span></code></td>
<td class="ln">805</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">// lets store the contactID in the session</span></code></td>
</tr>
<tr valign="top">
<td class="ln">542</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">// we dont store in userID in case the user is doing multiple</span></code></td>
<td class="ln">806</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">// we dont store in userID in case the user is doing multiple</span></code></td>
</tr>
<tr valign="top">
<td class="ln">543</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">// transactions etc</span></code></td>
<td class="ln">807</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">// transactions etc</span></code></td>
</tr>
<tr valign="top">
<td class="ln">544</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">// for things like tell a friend</span></code></td>
<td class="ln">808</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">// for things like tell a friend</span></code></td>
</tr>
<tr valign="top">
<td class="ln">545</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp;</span><span style="color: #000000; background-color: #efcb05; font-weight: bold; ">if</span><span style="color: #000000; background-color: #efcb05; "> (!</span><span style="color: #000000; background-color: #efcb05; ">parent::getContactID</span><span style="color: #000000; background-color: #efcb05; ">() &amp;&amp; </span><span class="sf17b16">CRM_Utils_Array::value</span><span class="sf17b16">(</span><span class="sf17b16">'is_primary'</span><span class="sf17b16">,</span><span style="color: #000000; background-color: #efcb05; "> $</span><span style="color: #000000; background-color: #efcb05; ">value)) {</span></code></td>
<td class="ln">809</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp;</span><span style="color: #000000; background-color: #efcb05; font-weight: bold; ">if</span><span style="color: #000000; background-color: #efcb05; "> (!</span><span style="color: #000000; background-color: #efcb05; ">parent::getContactID</span><span style="color: #000000; background-color: #efcb05; ">() &amp;&amp; </span><span class="sf17b16">CRM_Utils_Array::value</span><span class="sf17b16">(</span><span class="sf17b16">'is_payer'</span><span class="sf17b16">,</span><span style="color: #000000; background-color: #efcb05; "> $</span><span style="color: #000000; background-color: #efcb05; ">value)) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">546</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">session-&gt;</span><span class="sf8b2">set</span><span class="sf3b2">(</span><span class="sf12b2">'transaction.userID'</span><span class="sf3b2">, $</span><span class="sf18b2">contactID);</span></code></td>
<td class="ln">810</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">session-&gt;</span><span class="sf8b2">set</span><span class="sf3b2">(</span><span class="sf12b2">'transaction.userID'</span><span class="sf3b2">, $</span><span class="sf18b2">contactID);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">547</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">811</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">548</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">812</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">549</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">value[</span><span class="sf12b2">'description'</span><span class="sf3b2">] = </span><span class="sf8b2">ts</span><span class="sf3b2">(</span><span class="sf12b2">'Online Event Registration'</span><span class="sf3b2">) . </span><span class="sf12b2">': '</span><span class="sf3b2"> . $</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">][</span><span class="sf12b2">'title'</span><span class="sf3b2">];</span></code></td>
<td class="ln">813</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">value[</span><span class="sf12b2">'description'</span><span class="sf3b2">] = </span><span class="sf8b2">ts</span><span class="sf3b2">(</span><span class="sf12b2">'Online Event Registration'</span><span class="sf3b2">) . </span><span class="sf12b2">': '</span><span class="sf3b2"> . $</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">][</span><span class="sf12b2">'title'</span><span class="sf3b2">];</span></code></td>
</tr>
<tr valign="top">
<td class="ln">550</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">value[</span><span class="sf12b2">'accountingCode'</span><span class="sf3b2">] = </span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'accountingCode'</span><span class="sf3b2">,</span></code></td>
<td class="ln">814</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">value[</span><span class="sf12b2">'accountingCode'</span><span class="sf3b2">] = </span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'accountingCode'</span><span class="sf3b2">,</span></code></td>
</tr>
<tr valign="top">
<td class="ln">551</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">]</span></code></td>
<td class="ln">815</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">]</span></code></td>
</tr>
<tr valign="top">
<td class="ln">552</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;);</span></code></td>
<td class="ln">816</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">553</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16">
</span>&nbsp;</code></td>
<td class="ln">817</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp;
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">554</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">// required only if paid event</span></code></td>
<td class="ln">818</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">// required only if paid event</span></code></td>
</tr>
<tr valign="top">
<td class="ln">555</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp;</span><span style="color: #000000; background-color: #efcb05; font-weight: bold; ">if</span><span style="color: #000000; background-color: #efcb05; "> </span><span class="sf17b16">($</span><span class="sf17b16">this-&gt;_values[</span><span class="sf17b16">'event'</span><span class="sf17b16">][</span><span class="sf17b16">'is_monetary'</span><span class="sf17b16">])</span><span style="color: #000000; background-color: #efcb05; "> {</span></code></td>
<td class="ln">819</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp;</span><span style="color: #000000; background-color: #efcb05; font-weight: bold; ">if</span><span style="color: #000000; background-color: #efcb05; "> </span><span class="sf17b16">($</span><span class="sf17b16">this-&gt;_values[</span><span class="sf17b16">'event'</span><span class="sf17b16">][</span><span class="sf17b16">'is_monetary'</span><span class="sf17b16">] &nbsp;)</span><span style="color: #000000; background-color: #efcb05; "> {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">556</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">is_array</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;_paymentProcessor)) {</span></code></td>
<td class="ln">820</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">is_array</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;_paymentProcessor)) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">557</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">$</span><span style="color: #000000; background-color: #efcb05; ">payment = </span><span style="color: #000000; background-color: #efcb05; ">CRM_Core_Payment::singleton</span><span style="color: #000000; background-color: #efcb05; ">($</span><span style="color: #000000; background-color: #efcb05; ">this-&gt;_mode, $</span><span style="color: #000000; background-color: #efcb05; ">this-&gt;_paymentProcessor, $</span><span style="color: #000000; background-color: #efcb05; ">this);</span></code></td>
<td class="ln">821</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf17b16"> &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">$</span><span style="color: #000000; background-color: #efcb05; ">payment = </span><span style="color: #000000; background-color: #efcb05; ">CRM_Core_Payment::singleton</span><span style="color: #000000; background-color: #efcb05; ">($</span><span style="color: #000000; background-color: #efcb05; ">this-&gt;_mode, $</span><span style="color: #000000; background-color: #efcb05; ">this-&gt;_paymentProcessor, $</span><span style="color: #000000; background-color: #efcb05; ">this);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">558</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">822</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">559</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">pending = FALSE;</span></code></td>
<td class="ln">823</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">pending = FALSE;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">560</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">result = NULL;</span></code></td>
<td class="ln">824</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">result = NULL;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">561</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">825</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">562</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">this-&gt;_allowWaitlist || $</span><span class="sf18b2">this-&gt;_requireApproval) {</span></code></td>
<td class="ln">826</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">this-&gt;_allowWaitlist || $</span><span class="sf18b2">this-&gt;_requireApproval) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">563</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">//get the participant statuses.</span></code></td>
<td class="ln">827</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">//get the participant statuses.</span></code></td>
</tr>
<tr valign="top">
<td class="ln">564</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">waitingStatuses = </span><span class="sf8b2">CRM_Event_PseudoConstant::participantStatus</span><span class="sf3b2">(NULL, </span><span class="sf12b2">"class = 'Waiting'"</span><span class="sf3b2">);</span></code></td>
<td class="ln">828</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">waitingStatuses = </span><span class="sf8b2">CRM_Event_PseudoConstant::participantStatus</span><span class="sf3b2">(NULL, </span><span class="sf12b2">"class = 'Waiting'"</span><span class="sf3b2">);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">565</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">this-&gt;_allowWaitlist) {</span></code></td>
<td class="ln">829</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">this-&gt;_allowWaitlist) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">566</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">value[</span><span class="sf12b2">'participant_status_id'</span><span class="sf3b2">] = $</span><span class="sf18b2">value[</span><span class="sf12b2">'participant_status'</span><span class="sf3b2">] = </span><span class="sf8b2">array_search</span><span class="sf3b2">(</span><span class="sf12b2">'On waitlist'</span><span class="sf3b2">, $</span><span class="sf18b2">waitingStatuses);</span></code></td>
<td class="ln">830</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">value[</span><span class="sf12b2">'participant_status_id'</span><span class="sf3b2">] = $</span><span class="sf18b2">value[</span><span class="sf12b2">'participant_status'</span><span class="sf3b2">] = </span><span class="sf8b2">array_search</span><span class="sf3b2">(</span><span class="sf12b2">'On waitlist'</span><span class="sf3b2">, $</span><span class="sf18b2">waitingStatuses);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">567</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">831</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">568</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">else</span><span class="sf3b2"> {</span></code></td>
<td class="ln">832</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">else</span><span class="sf3b2"> {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">569</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">value[</span><span class="sf12b2">'participant_status_id'</span><span class="sf3b2">] = $</span><span class="sf18b2">value[</span><span class="sf12b2">'participant_status'</span><span class="sf3b2">] = </span><span class="sf8b2">array_search</span><span class="sf3b2">(</span><span class="sf12b2">'Awaiting approval'</span><span class="sf3b2">, $</span><span class="sf18b2">waitingStatuses);</span></code></td>
<td class="ln">833</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">value[</span><span class="sf12b2">'participant_status_id'</span><span class="sf3b2">] = $</span><span class="sf18b2">value[</span><span class="sf12b2">'participant_status'</span><span class="sf3b2">] = </span><span class="sf8b2">array_search</span><span class="sf3b2">(</span><span class="sf12b2">'Awaiting approval'</span><span class="sf3b2">, $</span><span class="sf18b2">waitingStatuses);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">570</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">834</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">571</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">835</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">572</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">//there might be case user seleted pay later and</span></code></td>
<td class="ln">836</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">//there might be case user seleted pay later and</span></code></td>
</tr>
<tr valign="top">
<td class="ln">573</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">//now becomes part of run time waiting list.</span></code></td>
<td class="ln">837</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">//now becomes part of run time waiting list.</span></code></td>
</tr>
<tr valign="top">
<td class="ln">574</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">value[</span><span class="sf12b2">'is_pay_later'</span><span class="sf3b2">] = FALSE;</span></code></td>
<td class="ln">838</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">value[</span><span class="sf12b2">'is_pay_later'</span><span class="sf3b2">] = FALSE;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">575</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">839</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">576</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">elseif</span><span class="sf3b2"> (</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'is_pay_later'</span><span class="sf3b2">, $</span><span class="sf18b2">value) ||</span></code></td>
<td class="ln">840</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">elseif</span><span class="sf3b2"> (</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'is_pay_later'</span><span class="sf3b2">, $</span><span class="sf18b2">value) ||</span></code></td>
</tr>
<tr valign="top">
<td class="ln">577</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">value[</span><span class="sf12b2">'amount'</span><span class="sf3b2">] == </span><span class="sf10b2">0</span><span class="sf3b2"> ||</span></code></td>
<td class="ln">841</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">value[</span><span class="sf12b2">'amount'</span><span class="sf3b2">] == </span><span class="sf10b2">0</span><span class="sf3b2"> ||</span></code></td>
</tr>
<tr valign="top">
<td class="ln">578</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_contributeMode == </span><span class="sf12b2">'checkout'</span><span class="sf3b2"> ||</span></code></td>
<td class="ln">842</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_contributeMode == </span><span class="sf12b2">'checkout'</span><span class="sf3b2"> ||</span></code></td>
</tr>
<tr valign="top">
<td class="ln">579</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_contributeMode == </span><span class="sf12b2">'notify'</span>&nbsp;</code></td>
<td class="ln">843</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_contributeMode == </span><span class="sf12b2">'notify'</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">580</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;) {</span></code></td>
<td class="ln">844</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">581</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">value[</span><span class="sf12b2">'amount'</span><span class="sf3b2">] != </span><span class="sf10b2">0</span><span class="sf3b2">) {</span></code></td>
<td class="ln">845</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">value[</span><span class="sf12b2">'amount'</span><span class="sf3b2">] != </span><span class="sf10b2">0</span><span class="sf3b2">) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">582</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">pending = TRUE;</span></code></td>
<td class="ln">846</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">pending = TRUE;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">583</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">//get the participant statuses.</span></code></td>
<td class="ln">847</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">//get the participant statuses.</span></code></td>
</tr>
<tr valign="top">
<td class="ln">584</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">pendingStatuses = </span><span class="sf8b2">CRM_Event_PseudoConstant::participantStatus</span><span class="sf3b2">(NULL, </span><span class="sf12b2">"class = 'Pending'"</span><span class="sf3b2">);</span></code></td>
<td class="ln">848</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">pendingStatuses = </span><span class="sf8b2">CRM_Event_PseudoConstant::participantStatus</span><span class="sf3b2">(NULL, </span><span class="sf12b2">"class = 'Pending'"</span><span class="sf3b2">);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">585</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">status = </span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'is_pay_later'</span><span class="sf3b2">, $</span><span class="sf18b2">value) ? </span><span class="sf12b2">'Pending from pay later'</span><span class="sf3b2"> : </span><span class="sf12b2">'Pending from incomplete transaction'</span><span class="sf3b2">;</span></code></td>
<td class="ln">849</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">status = </span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'is_pay_later'</span><span class="sf3b2">, $</span><span class="sf18b2">value) ? </span><span class="sf12b2">'Pending from pay later'</span><span class="sf3b2"> : </span><span class="sf12b2">'Pending from incomplete transaction'</span><span class="sf3b2">;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">586</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf17b16">$</span><span class="sf17b16">value[</span><span class="sf17b16">'participant_status_id'</span><span class="sf17b16">] = $</span><span class="sf17b16">value[</span><span class="sf17b16">'participant_status'</span><span class="sf17b16">] = </span><span class="sf17b16">array_search</span><span class="sf17b16">($</span><span class="sf17b16">status, $</span><span class="sf17b16">pendingStatuses);</span>&nbsp;</code></td>
<td class="ln">850</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf17b16">if</span><span class="sf17b16"> ( $</span><span class="sf17b16">key != </span><span class="sf17b16">'payer'</span><span class="sf17b16"> || $</span><span class="sf17b16">key === </span><span class="sf17b16">0</span><span class="sf17b16"> ) {</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">851</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf17b16">value[</span><span class="sf17b16">'participant_status_id'</span><span class="sf17b16">] = $</span><span class="sf17b16">value[</span><span class="sf17b16">'participant_status'</span><span class="sf17b16">] = </span><span class="sf17b16">array_search</span><span class="sf17b16">($</span><span class="sf17b16">status, $</span><span class="sf17b16">pendingStatuses);
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">852</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">587</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">853</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">588</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">854</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">589</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #000000; background-color: #efcb05; font-weight: bold; ">elseif</span><span style="color: #000000; background-color: #efcb05; "> ($</span><span style="color: #000000; background-color: #efcb05; ">this-&gt;_contributeMode == </span><span style="color: #000000; background-color: #efcb05; ">'express'</span><span style="color: #000000; background-color: #efcb05; "> &amp;&amp; </span><span class="sf17b16">CRM_Utils_Array::value</span><span class="sf17b16">(</span><span class="sf17b16">'is_primary'</span><span class="sf17b16">,</span><span style="color: #000000; background-color: #efcb05; "> $</span><span style="color: #000000; background-color: #efcb05; ">value)) {</span></code></td>
<td class="ln">855</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #000000; background-color: #efcb05; font-weight: bold; ">elseif</span><span style="color: #000000; background-color: #efcb05; "> ($</span><span style="color: #000000; background-color: #efcb05; ">this-&gt;_contributeMode == </span><span style="color: #000000; background-color: #efcb05; ">'express'</span><span style="color: #000000; background-color: #efcb05; "> &amp;&amp; </span><span class="sf17b16">CRM_Utils_Array::value</span><span class="sf17b16">(</span><span class="sf17b16">'is_payer'</span><span class="sf17b16">,</span><span style="color: #000000; background-color: #efcb05; "> $</span><span style="color: #000000; background-color: #efcb05; ">value)) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">590</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #000000; background-color: #efcb05; font-weight: bold; ">if</span><span style="color: #000000; background-color: #efcb05; "> (</span><span style="color: #000000; background-color: #efcb05; ">is_object</span><span style="color: #000000; background-color: #efcb05; ">($</span><span style="color: #000000; background-color: #efcb05; ">payment)) </span></code></td>
<td class="ln">856</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf17b16"> </span><span style="color: #000000; background-color: #efcb05; font-weight: bold; ">if</span><span style="color: #000000; background-color: #efcb05; "> (</span><span style="color: #000000; background-color: #efcb05; ">is_object</span><span style="color: #000000; background-color: #efcb05; ">($</span><span style="color: #000000; background-color: #efcb05; ">payment)) </span></code></td>
</tr>
<tr valign="top">
<td class="ln">591</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">result = &amp;$</span><span class="sf18b2">payment-&gt;</span><span class="sf8b2">doExpressCheckout</span><span class="sf3b2">($</span><span class="sf18b2">value);</span></code></td>
<td class="ln">857</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">result = &amp;$</span><span class="sf18b2">payment-&gt;</span><span class="sf8b2">doExpressCheckout</span><span class="sf3b2">($</span><span class="sf18b2">value);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">592</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">else</span><span class="sf3b2"> </span>&nbsp;</code></td>
<td class="ln">858</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">else</span><span class="sf3b2"> </span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">593</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">CRM_Core_Error::fatal</span><span class="sf3b2">($</span><span class="sf18b2">paymentObjError);</span></code></td>
<td class="ln">859</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">CRM_Core_Error::fatal</span><span class="sf3b2">($</span><span class="sf18b2">paymentObjError);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">594</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">860</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">595</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #000000; background-color: #efcb05; font-weight: bold; ">elseif</span><span style="color: #000000; background-color: #efcb05; "> </span><span class="sf17b16">(</span><span class="sf17b16">CRM_Utils_Array::value</span><span class="sf17b16">(</span><span class="sf17b16">'is_primary'</span><span class="sf17b16">,</span><span style="color: #000000; background-color: #efcb05; "> $</span><span style="color: #000000; background-color: #efcb05; ">value)) {</span></code></td>
<td class="ln">861</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #000000; background-color: #efcb05; font-weight: bold; ">elseif</span><span style="color: #000000; background-color: #efcb05; "> </span><span class="sf17b16">(</span><span class="sf17b16">CRM_Utils_Array::value</span><span class="sf17b16">(</span><span class="sf17b16">'is_payer'</span><span class="sf17b16">,</span><span style="color: #000000; background-color: #efcb05; "> $</span><span style="color: #000000; background-color: #efcb05; ">value)) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">596</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">CRM_Core_Payment_Form::mapParams</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;_bltID, $</span><span class="sf18b2">value, $</span><span class="sf18b2">value, TRUE);</span></code></td>
<td class="ln">862</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">CRM_Core_Payment_Form::mapParams</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;_bltID, $</span><span class="sf18b2">value, $</span><span class="sf18b2">value, TRUE);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">597</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf17b16">if</span><span class="sf17b16"> (</span><span class="sf17b16">is_object</span><span class="sf17b16">($</span><span class="sf17b16">payment)) 
</span>&nbsp;</code></td>
<td class="ln">863</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16">
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">864</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf17b16">if</span><span class="sf17b16"> (</span><span class="sf17b16">is_object</span><span class="sf17b16">($</span><span class="sf17b16">payment)) {
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">598</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">result = &amp;$</span><span class="sf18b2">payment-&gt;</span><span class="sf8b2">doDirectPayment</span><span class="sf3b2">($</span><span class="sf18b2">value);</span></code></td>
<td class="ln">865</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">result = &amp;$</span><span class="sf18b2">payment-&gt;</span><span class="sf8b2">doDirectPayment</span><span class="sf3b2">($</span><span class="sf18b2">value);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">599</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #000000; background-color: #efcb05; font-weight: bold; ">else</span><span style="color: #000000; background-color: #efcb05; "> </span><span class="sf17b16">
</span>&nbsp;</code></td>
<td class="ln">866</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf17b16">}</span><span style="color: #000000; background-color: #efcb05; "> </span><span style="color: #000000; background-color: #efcb05; font-weight: bold; ">else</span><span style="color: #000000; background-color: #efcb05; "> </span><span class="sf17b16">{
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">600</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">CRM_Core_Error::fatal</span><span style="color: #000000; background-color: #efcb05; ">($</span><span style="color: #000000; background-color: #efcb05; ">paymentObjError);</span></code></td>
<td class="ln">867</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf17b16"> </span><span style="color: #000000; background-color: #efcb05; ">CRM_Core_Error::fatal</span><span style="color: #000000; background-color: #efcb05; ">($</span><span style="color: #000000; background-color: #efcb05; ">paymentObjError);</span></code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">868</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">601</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">869</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">602</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16">
</span>&nbsp;</code></td>
<td class="ln">870</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; 
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">603</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">is_a</span><span class="sf3b2">($</span><span class="sf18b2">result, </span><span class="sf12b2">'CRM_Core_Error'</span><span class="sf3b2">)) {</span></code></td>
<td class="ln">871</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">is_a</span><span class="sf3b2">($</span><span class="sf18b2">result, </span><span class="sf12b2">'CRM_Core_Error'</span><span class="sf3b2">)) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">604</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf17b16">&nbsp;</span><span style="color: #000000; background-color: #efcb05; ">CRM_Core_Error::displaySessionError</span><span style="color: #000000; background-color: #efcb05; ">($</span><span style="color: #000000; background-color: #efcb05; ">result);</span></code></td>
<td class="ln">872</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp; </span><span style="color: #000000; background-color: #efcb05; ">CRM_Core_Error::displaySessionError</span><span style="color: #000000; background-color: #efcb05; ">($</span><span style="color: #000000; background-color: #efcb05; ">result);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">605</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf17b16">&nbsp;</span><span style="color: #000000; background-color: #efcb05; ">CRM_Utils_System::redirect</span><span style="color: #000000; background-color: #efcb05; ">(</span><span style="color: #000000; background-color: #efcb05; ">CRM_Utils_System::url</span><span style="color: #000000; background-color: #efcb05; ">(</span><span style="color: #000000; background-color: #efcb05; ">'c<wbr>ivicrm/event/register'</span><span style="color: #000000; background-color: #efcb05; ">, </span><span style="color: #000000; background-color: #efcb05; ">"id={$this-&gt;_eventId}"</span><span style="color: #000000; background-color: #efcb05; ">));</span></code></td>
<td class="ln">873</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp; </span><span style="color: #000000; background-color: #efcb05; ">CRM_Utils_System::redirect</span><span style="color: #000000; background-color: #efcb05; ">(</span><span style="color: #000000; background-color: #efcb05; ">CRM_Utils_System::url</span><span style="color: #000000; background-color: #efcb05; ">(</span><span style="color: #000000; background-color: #efcb05; ">'c<wbr>ivicrm/event/register'</span><span style="color: #000000; background-color: #efcb05; ">, </span><span style="color: #000000; background-color: #efcb05; ">"id={$this-&gt;_eventId}"</span><span style="color: #000000; background-color: #efcb05; ">));</span></code></td>
</tr>
<tr valign="top">
<td class="ln">606</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">874</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">607</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16">
</span>&nbsp;</code></td>
<td class="ln">875</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; 
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">608</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">result) {</span></code></td>
<td class="ln">876</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">result) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">609</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">value = </span><span class="sf8b2">array_merge</span><span class="sf3b2">($</span><span class="sf18b2">value, $</span><span class="sf18b2">result);</span></code></td>
<td class="ln">877</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">value = </span><span class="sf8b2">array_merge</span><span class="sf3b2">($</span><span class="sf18b2">value, $</span><span class="sf18b2">result);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">610</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">878</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">611</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">879</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">612</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">value[</span><span class="sf12b2">'receive_date'</span><span class="sf3b2">] = $</span><span class="sf18b2">now;</span></code></td>
<td class="ln">880</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">value[</span><span class="sf12b2">'receive_date'</span><span class="sf3b2">] = $</span><span class="sf18b2">now;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">613</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">this-&gt;_allowConfirmation) {</span></code></td>
<td class="ln">881</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">this-&gt;_allowConfirmation) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">614</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">value[</span><span class="sf12b2">'participant_register_date'</span><span class="sf3b2">] = $</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'participant'</span><span class="sf3b2">][</span><span class="sf12b2">'register_date'</span><span class="sf3b2">];</span></code></td>
<td class="ln">882</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">value[</span><span class="sf12b2">'participant_register_date'</span><span class="sf3b2">] = $</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'participant'</span><span class="sf3b2">][</span><span class="sf12b2">'register_date'</span><span class="sf3b2">];</span></code></td>
</tr>
<tr valign="top">
<td class="ln">615</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">883</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">616</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">884</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">617</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">createContrib = ($</span><span class="sf18b2">value[</span><span class="sf12b2">'amount'</span><span class="sf3b2">] != </span><span class="sf10b2">0</span><span class="sf3b2">) ? TRUE : FALSE;</span></code></td>
<td class="ln">885</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">createContrib = ($</span><span class="sf18b2">value[</span><span class="sf12b2">'amount'</span><span class="sf3b2">] != </span><span class="sf10b2">0</span><span class="sf3b2">) ? TRUE : FALSE;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">618</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">// force to create zero amount contribution, CRM-5095</span></code></td>
<td class="ln">886</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">// force to create zero amount contribution, CRM-5095</span></code></td>
</tr>
<tr valign="top">
<td class="ln">619</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!$</span><span class="sf18b2">createContrib &amp;&amp; ($</span><span class="sf18b2">value[</span><span class="sf12b2">'amount'</span><span class="sf3b2">] == </span><span class="sf10b2">0</span><span class="sf3b2">)</span></code></td>
<td class="ln">887</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!$</span><span class="sf18b2">createContrib &amp;&amp; ($</span><span class="sf18b2">value[</span><span class="sf12b2">'amount'</span><span class="sf3b2">] == </span><span class="sf10b2">0</span><span class="sf3b2">)</span></code></td>
</tr>
<tr valign="top">
<td class="ln">620</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&amp;&amp; $</span><span class="sf18b2">this-&gt;_priceSetId &amp;&amp; $</span><span class="sf18b2">this-&gt;_lineItem</span></code></td>
<td class="ln">888</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&amp;&amp; $</span><span class="sf18b2">this-&gt;_priceSetId &amp;&amp; $</span><span class="sf18b2">this-&gt;_lineItem</span></code></td>
</tr>
<tr valign="top">
<td class="ln">621</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;) {</span></code></td>
<td class="ln">889</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">622</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">createContrib = TRUE;</span></code></td>
<td class="ln">890</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">createContrib = TRUE;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">623</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">891</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">624</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">892</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">625</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #000000; background-color: #efcb05; font-weight: bold; ">if</span><span style="color: #000000; background-color: #efcb05; "> ($</span><span style="color: #000000; background-color: #efcb05; ">createContrib &amp;&amp; </span><span class="sf17b16">CRM_Utils_Array::value</span><span class="sf17b16">(</span><span class="sf17b16">'is_primary'</span><span class="sf17b16">,</span><span style="color: #000000; background-color: #efcb05; "> $</span><span style="color: #000000; background-color: #efcb05; ">value) &amp;&amp;</span></code></td>
<td class="ln">893</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #000000; background-color: #efcb05; font-weight: bold; ">if</span><span style="color: #000000; background-color: #efcb05; "> ($</span><span style="color: #000000; background-color: #efcb05; ">createContrib &amp;&amp; </span><span class="sf17b16">CRM_Utils_Array::value</span><span class="sf17b16">(</span><span class="sf17b16">'is_payer'</span><span class="sf17b16">,</span><span style="color: #000000; background-color: #efcb05; "> $</span><span style="color: #000000; background-color: #efcb05; ">value) &amp;&amp;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">626</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;!$</span><span class="sf18b2">this-&gt;_allowWaitlist &amp;&amp; !$</span><span class="sf18b2">this-&gt;_requireApproval</span></code></td>
<td class="ln">894</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;!$</span><span class="sf18b2">this-&gt;_allowWaitlist &amp;&amp; !$</span><span class="sf18b2">this-&gt;_requireApproval</span></code></td>
</tr>
<tr valign="top">
<td class="ln">627</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;) {</span></code></td>
<td class="ln">895</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">628</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">// if paid event add a contribution record</span></code></td>
<td class="ln">896</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">// if paid event add a contribution record</span></code></td>
</tr>
<tr valign="top">
<td class="ln">629</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">//if primary participant contributing additional amount</span></code></td>
<td class="ln">897</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">//if primary participant contributing additional amount</span></code></td>
</tr>
<tr valign="top">
<td class="ln">630</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">//append (multiple participants) to its fee level. CRM-4196.</span></code></td>
<td class="ln">898</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">//append (multiple participants) to its fee level. CRM-4196.</span></code></td>
</tr>
<tr valign="top">
<td class="ln">631</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">isAdditionalAmount = FALSE;</span></code></td>
<td class="ln">899</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">isAdditionalAmount = FALSE;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">632</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">count</span><span class="sf3b2">($</span><span class="sf18b2">params) &gt; </span><span class="sf10b2">1</span><span class="sf3b2">) {</span></code></td>
<td class="ln">900</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">count</span><span class="sf3b2">($</span><span class="sf18b2">params) &gt; </span><span class="sf10b2">1</span><span class="sf3b2">) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">633</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">isAdditionalAmount = TRUE;</span></code></td>
<td class="ln">901</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">isAdditionalAmount = TRUE;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">634</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">902</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">635</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">903</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">904</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; 
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">636</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">//passing contribution id is already registered.</span></code></td>
<td class="ln">905</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">//passing contribution id is already registered.</span></code></td>
</tr>
<tr valign="top">
<td class="ln">637</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">contribution = &amp;</span><span class="sf8b2">self::processContribution</span><span class="sf3b2">($</span><span class="sf18b2">this, $</span><span class="sf18b2">value, $</span><span class="sf18b2">result, $</span><span class="sf18b2">contactID,</span></code></td>
<td class="ln">906</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">contribution = &amp;</span><span class="sf8b2">self::processContribution</span><span class="sf3b2">($</span><span class="sf18b2">this, $</span><span class="sf18b2">value, $</span><span class="sf18b2">result, $</span><span class="sf18b2">contactID,</span></code></td>
</tr>
<tr valign="top">
<td class="ln">638</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">pending, $isAdditionalAmount</span></code></td>
<td class="ln">907</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">pending, $isAdditionalAmount</span></code></td>
</tr>
<tr valign="top">
<td class="ln">639</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;);</span></code></td>
<td class="ln">908</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">640</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">909</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">641</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">value[</span><span class="sf12b2">'contributionID'</span><span class="sf3b2">] = $</span><span class="sf18b2">contribution-&gt;id;</span></code></td>
<td class="ln">910</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">value[</span><span class="sf12b2">'contributionID'</span><span class="sf3b2">] = $</span><span class="sf18b2">contribution-&gt;id;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">642</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">value[</span><span class="sf12b2">'contributionTypeID'</span><span class="sf3b2">] = $</span><span class="sf18b2">contribution-&gt;contribution_type_id;</span></code></td>
<td class="ln">911</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">value[</span><span class="sf12b2">'contributionTypeID'</span><span class="sf3b2">] = $</span><span class="sf18b2">contribution-&gt;contribution_type_id;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">643</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">value[</span><span class="sf12b2">'receive_date'</span><span class="sf3b2">] = $</span><span class="sf18b2">contribution-&gt;receive_date;</span></code></td>
<td class="ln">912</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">value[</span><span class="sf12b2">'receive_date'</span><span class="sf3b2">] = $</span><span class="sf18b2">contribution-&gt;receive_date;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">644</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">value[</span><span class="sf12b2">'trxn_id'</span><span class="sf3b2">] = $</span><span class="sf18b2">contribution-&gt;trxn_id;</span></code></td>
<td class="ln">913</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">value[</span><span class="sf12b2">'trxn_id'</span><span class="sf3b2">] = $</span><span class="sf18b2">contribution-&gt;trxn_id;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">645</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">value[</span><span class="sf12b2">'contributionID'</span><span class="sf3b2">] = $</span><span class="sf18b2">contribution-&gt;id;</span></code></td>
<td class="ln">914</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">value[</span><span class="sf12b2">'contributionID'</span><span class="sf3b2">] = $</span><span class="sf18b2">contribution-&gt;id;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">646</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">value[</span><span class="sf12b2">'contributionTypeID'</span><span class="sf3b2">] = $</span><span class="sf18b2">contribution-&gt;contribution_type_id;</span></code></td>
<td class="ln">915</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">value[</span><span class="sf12b2">'contributionTypeID'</span><span class="sf3b2">] = $</span><span class="sf18b2">contribution-&gt;contribution_type_id;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">647</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">916</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">648</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">value[</span><span class="sf12b2">'contactID'</span><span class="sf3b2">] = $</span><span class="sf18b2">contactID;</span></code></td>
<td class="ln">917</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">value[</span><span class="sf12b2">'contactID'</span><span class="sf3b2">] = $</span><span class="sf18b2">contactID;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">649</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">value[</span><span class="sf12b2">'eventID'</span><span class="sf3b2">] &nbsp; = $</span><span class="sf18b2">this-&gt;_eventId;</span></code></td>
<td class="ln">918</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">value[</span><span class="sf12b2">'eventID'</span><span class="sf3b2">] &nbsp; = $</span><span class="sf18b2">this-&gt;_eventId;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">650</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">value[</span><span class="sf12b2">'item_name'</span><span class="sf3b2">] = $</span><span class="sf18b2">value[</span><span class="sf12b2">'description'</span><span class="sf3b2">];</span></code></td>
<td class="ln">919</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">value[</span><span class="sf12b2">'item_name'</span><span class="sf3b2">] = $</span><span class="sf18b2">value[</span><span class="sf12b2">'description'</span><span class="sf3b2">];</span></code></td>
</tr>
<tr valign="top">
<td class="ln">651</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">920</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">652</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16">
</span>&nbsp;</code></td>
<td class="ln">921</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp;
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">653</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">//CRM-4453.</span></code></td>
<td class="ln">922</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">//CRM-4453.</span></code></td>
</tr>
<tr valign="top">
<td class="ln">654</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp;</span><span style="color: #000000; background-color: #efcb05; font-weight: bold; ">if</span><span style="color: #000000; background-color: #efcb05; "> </span><span class="sf17b16">(</span><span class="sf17b16">CRM_Utils_Array::value</span><span class="sf17b16">(</span><span class="sf17b16">'is_primary'</span><span class="sf17b16">,</span><span style="color: #000000; background-color: #efcb05; "> $</span><span style="color: #000000; background-color: #efcb05; ">value)) {</span></code></td>
<td class="ln">923</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp;</span><span style="color: #000000; background-color: #efcb05; font-weight: bold; ">if</span><span style="color: #000000; background-color: #efcb05; "> </span><span class="sf17b16">(</span><span class="sf17b16">CRM_Utils_Array::value</span><span class="sf17b16">(</span><span class="sf17b16">'is_payer'</span><span class="sf17b16">,</span><span style="color: #000000; background-color: #efcb05; "> $</span><span style="color: #000000; background-color: #efcb05; ">value)) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">655</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">primaryCurrencyID = </span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'currencyID'</span><span class="sf3b2">, $</span><span class="sf18b2">value);</span></code></td>
<td class="ln">924</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">primaryCurrencyID = </span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'currencyID'</span><span class="sf3b2">, $</span><span class="sf18b2">value);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">656</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">925</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">657</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'currencyID'</span><span class="sf3b2">, $</span><span class="sf18b2">value)) {</span></code></td>
<td class="ln">926</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'currencyID'</span><span class="sf3b2">, $</span><span class="sf18b2">value)) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">658</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">value[</span><span class="sf12b2">'currencyID'</span><span class="sf3b2">] = $</span><span class="sf18b2">primaryCurrencyID;</span></code></td>
<td class="ln">927</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">value[</span><span class="sf12b2">'currencyID'</span><span class="sf3b2">] = $</span><span class="sf18b2">primaryCurrencyID;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">659</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">928</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">660</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16">
</span>&nbsp;</code></td>
<td class="ln">929</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; 
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">661</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp;</span><span style="color: #000000; background-color: #efcb05; font-weight: bold; ">if</span><span style="color: #000000; background-color: #efcb05; "> (!$</span><span style="color: #000000; background-color: #efcb05; ">pending &amp;&amp; </span><span class="sf17b16">CRM_Utils_Array::value</span><span class="sf17b16">(</span><span class="sf17b16">'is_primary'</span><span class="sf17b16">,</span><span style="color: #000000; background-color: #efcb05; "> $</span><span style="color: #000000; background-color: #efcb05; ">value) &amp;&amp;</span></code></td>
<td class="ln">930</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp;</span><span style="color: #000000; background-color: #efcb05; font-weight: bold; ">if</span><span style="color: #000000; background-color: #efcb05; "> (!$</span><span style="color: #000000; background-color: #efcb05; ">pending &amp;&amp; </span><span class="sf17b16">CRM_Utils_Array::value</span><span class="sf17b16">(</span><span class="sf17b16">'is_payer'</span><span class="sf17b16">,</span><span style="color: #000000; background-color: #efcb05; "> $</span><span style="color: #000000; background-color: #efcb05; ">value) &amp;&amp;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">662</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;!$</span><span class="sf18b2">this-&gt;_allowWaitlist &amp;&amp; !$</span><span class="sf18b2">this-&gt;_requireApproval</span></code></td>
<td class="ln">931</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;!$</span><span class="sf18b2">this-&gt;_allowWaitlist &amp;&amp; !$</span><span class="sf18b2">this-&gt;_requireApproval</span></code></td>
</tr>
<tr valign="top">
<td class="ln">663</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;) {</span></code></td>
<td class="ln">932</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">664</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">// transactionID &amp; receive date required while building email template</span></code></td>
<td class="ln">933</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">// transactionID &amp; receive date required while building email template</span></code></td>
</tr>
<tr valign="top">
<td class="ln">665</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">assign</span><span class="sf3b2">(</span><span class="sf12b2">'trxn_id'</span><span class="sf3b2">, $</span><span class="sf18b2">value[</span><span class="sf12b2">'trxn_id'</span><span class="sf3b2">]);</span></code></td>
<td class="ln">934</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">assign</span><span class="sf3b2">(</span><span class="sf12b2">'trxn_id'</span><span class="sf3b2">, $</span><span class="sf18b2">value[</span><span class="sf12b2">'trxn_id'</span><span class="sf3b2">]);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">666</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">assign</span><span class="sf3b2">(</span><span class="sf12b2">'receive_date'</span><span class="sf3b2">, </span><span class="sf8b2">CRM_Utils_Date::mysqlToIso</span><span class="sf3b2">($</span><span class="sf18b2">value[</span><span class="sf12b2">'receive_date'</span><span class="sf3b2">]))<wbr>;</span></code></td>
<td class="ln">935</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">assign</span><span class="sf3b2">(</span><span class="sf12b2">'receive_date'</span><span class="sf3b2">, </span><span class="sf8b2">CRM_Utils_Date::mysqlToIso</span><span class="sf3b2">($</span><span class="sf18b2">value[</span><span class="sf12b2">'receive_date'</span><span class="sf3b2">]))<wbr>;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">667</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">set</span><span class="sf3b2">(</span><span class="sf12b2">'receiveDate'</span><span class="sf3b2">, </span><span class="sf8b2">CRM_Utils_Date::mysqlToIso</span><span class="sf3b2">($</span><span class="sf18b2">value[</span><span class="sf12b2">'receive_date'</span><span class="sf3b2">]))<wbr>;</span></code></td>
<td class="ln">936</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">set</span><span class="sf3b2">(</span><span class="sf12b2">'receiveDate'</span><span class="sf3b2">, </span><span class="sf8b2">CRM_Utils_Date::mysqlToIso</span><span class="sf3b2">($</span><span class="sf18b2">value[</span><span class="sf12b2">'receive_date'</span><span class="sf3b2">]))<wbr>;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">668</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">set</span><span class="sf3b2">(</span><span class="sf12b2">'trxnId'</span><span class="sf3b2">, </span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'trxn_id'</span><span class="sf3b2">, $</span><span class="sf18b2">value));</span></code></td>
<td class="ln">937</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">set</span><span class="sf3b2">(</span><span class="sf12b2">'trxnId'</span><span class="sf3b2">, </span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'trxn_id'</span><span class="sf3b2">, $</span><span class="sf18b2">value));</span></code></td>
</tr>
<tr valign="top">
<td class="ln">669</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">938</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">670</td><td style="color: #000000; background-color: #fbf2bf; "><code>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #e9e9e9; "><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">671</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">value[</span><span class="sf12b2">'fee_amount'</span><span class="sf3b2">] = $</span><span class="sf18b2">value[</span><span class="sf12b2">'amount'</span><span class="sf3b2">];</span></code></td>
<td class="ln">939</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">value[</span><span class="sf12b2">'fee_amount'</span><span class="sf3b2">] = $</span><span class="sf18b2">value[</span><span class="sf12b2">'amount'</span><span class="sf3b2">];</span></code></td>
</tr>
<tr valign="top">
<td class="ln">672</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">set</span><span class="sf3b2">(</span><span class="sf12b2">'value'</span><span class="sf3b2">, $</span><span class="sf18b2">value);</span></code></td>
<td class="ln">940</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">set</span><span class="sf3b2">(</span><span class="sf12b2">'value'</span><span class="sf3b2">, $</span><span class="sf18b2">value);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">673</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16">
</span>&nbsp;</code></td>
<td class="ln">941</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; 
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">674</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">// handle register date CRM-4320</span></code></td>
<td class="ln">942</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">// handle register date CRM-4320</span></code></td>
</tr>
<tr valign="top">
<td class="ln">675</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">this-&gt;_allowConfirmation) {</span></code></td>
<td class="ln">943</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">this-&gt;_allowConfirmation) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">676</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">registerDate = </span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">( </span><span class="sf12b2">'participant_register_date'</span><span class="sf3b2">, $</span><span class="sf18b2">params );</span></code></td>
<td class="ln">944</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">registerDate = </span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">( </span><span class="sf12b2">'participant_register_date'</span><span class="sf3b2">, $</span><span class="sf18b2">params );</span></code></td>
</tr>
<tr valign="top">
<td class="ln">677</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">945</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">678</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">elseif</span><span class="sf3b2"> (</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'participant_register_date'<wbr></span><span class="sf3b2">, $</span><span class="sf18b2">params) &amp;&amp;</span></code></td>
<td class="ln">946</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">elseif</span><span class="sf3b2"> (</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'participant_register_date'<wbr></span><span class="sf3b2">, $</span><span class="sf18b2">params) &amp;&amp;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">679</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">is_array</span><span class="sf3b2">($</span><span class="sf18b2">params[</span><span class="sf12b2">'participant_register_date'</span><span class="sf3b2">]) &amp;&amp;</span></code></td>
<td class="ln">947</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">is_array</span><span class="sf3b2">($</span><span class="sf18b2">params[</span><span class="sf12b2">'participant_register_date'</span><span class="sf3b2">]) &amp;&amp;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">680</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;!</span><span class="sf7b2">empty</span><span class="sf3b2">($</span><span class="sf18b2">params[</span><span class="sf12b2">'participant_register_date'</span><span class="sf3b2">])</span></code></td>
<td class="ln">948</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;!</span><span class="sf7b2">empty</span><span class="sf3b2">($</span><span class="sf18b2">params[</span><span class="sf12b2">'participant_register_date'</span><span class="sf3b2">])</span></code></td>
</tr>
<tr valign="top">
<td class="ln">681</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;) {</span></code></td>
<td class="ln">949</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">682</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">registerDate = </span><span class="sf8b2">CRM_Utils_Date::format</span><span class="sf3b2">($</span><span class="sf18b2">params[</span><span class="sf12b2">'participant_registe<wbr>r_date'</span><span class="sf3b2">]);</span></code></td>
<td class="ln">950</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">registerDate = </span><span class="sf8b2">CRM_Utils_Date::format</span><span class="sf3b2">($</span><span class="sf18b2">params[</span><span class="sf12b2">'participant_registe<wbr>r_date'</span><span class="sf3b2">]);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">683</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">951</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">684</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">else</span><span class="sf3b2"> {</span></code></td>
<td class="ln">952</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">else</span><span class="sf3b2"> {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">685</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">registerDate = </span><span class="sf8b2">date</span><span class="sf3b2">(</span><span class="sf12b2">'YmdHis'</span><span class="sf3b2">);</span></code></td>
<td class="ln">953</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">registerDate = </span><span class="sf8b2">date</span><span class="sf3b2">(</span><span class="sf12b2">'YmdHis'</span><span class="sf3b2">);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">686</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">954</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">687</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">assign</span><span class="sf3b2">(</span><span class="sf12b2">'register_date'</span><span class="sf3b2">, $</span><span class="sf18b2">registerDate);</span></code></td>
<td class="ln">955</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">assign</span><span class="sf3b2">(</span><span class="sf12b2">'register_date'</span><span class="sf3b2">, $</span><span class="sf18b2">registerDate);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">688</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16">
</span>&nbsp;</code></td>
<td class="ln">956</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp; 
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">689</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">$</span><span style="color: #000000; background-color: #efcb05; ">this-&gt;</span><span style="color: #000000; background-color: #efcb05; ">confirmPostProcess</span><span style="color: #000000; background-color: #efcb05; ">($</span><span style="color: #000000; background-color: #efcb05; ">contactID, $</span><span style="color: #000000; background-color: #efcb05; ">contribution, </span><span class="sf17b16">$</span><span class="sf17b16">payment);</span>&nbsp;</code></td>
<td class="ln">957</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp;</span><span class="sf17b16"> </span><span style="color: #000000; background-color: #efcb05; ">$</span><span style="color: #000000; background-color: #efcb05; ">this-&gt;</span><span style="color: #000000; background-color: #efcb05; ">confirmPostProcess</span><span style="color: #000000; background-color: #efcb05; ">($</span><span style="color: #000000; background-color: #efcb05; ">contactID, $</span><span style="color: #000000; background-color: #efcb05; ">contribution, </span><span class="sf17b16">$</span><span class="sf17b16">payment );</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">690</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp;}
</span>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">691</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16">
</span>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">692</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp;</span><span class="sf17b16">//handle if no additional participant.
</span>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">693</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp;</span><span class="sf17b16">if</span><span class="sf17b16"> (!$</span><span class="sf17b16">registerByID) {
</span>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">694</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp;$</span><span class="sf17b16">registerByID = $</span><span class="sf17b16">this-&gt;</span><span class="sf17b16">get</span><span class="sf17b16">(</span><span class="sf17b16">'registerByID'</span><span class="sf17b16">);
</span>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">695</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">958</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">696</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16">
</span>&nbsp;</code></td>
<td class="ln">959</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> 
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">697</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp;</span><span class="sf17b16">$</span><span class="sf17b16">this-&gt;</span><span class="sf17b16">set</span><span class="sf17b16">(</span><span class="sf17b16">'participantIDs'</span><span class="sf17b16">, $</span><span class="sf17b16">this-&gt;_participantIDS);</span>&nbsp;</code></td>
<td class="ln">960</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp;</span><span class="sf17b16"> &nbsp;</span><span class="sf17b16">//handle if no additional participant.</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">698</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16">
</span>&nbsp;</code></td>
<td class="ln">961</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp;</span><span class="sf17b16">if</span><span class="sf17b16"> (!$</span><span class="sf17b16">registerByID) {
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">699</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp;</span><span class="sf17b16">// create line items, CRM-5313</span>&nbsp;</code></td>
<td class="ln">962</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp;</span><span class="sf17b16"> &nbsp; &nbsp;</span><span class="sf17b16">$</span><span class="sf17b16">registerByID = $</span><span class="sf17b16">this-&gt;_participantIDS[0];</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">700</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp;</span><span class="sf17b16">if</span><span class="sf17b16"> ($</span><span class="sf17b16">this-&gt;_priceSetId &amp;&amp;</span>&nbsp;</code></td>
<td class="ln">963</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp;</span><span class="sf17b16"> &nbsp;</span><span class="sf17b16">}</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">701</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp;</span><span class="sf17b16">!</span><span class="sf17b16">empty</span><span class="sf17b16">($</span><span class="sf17b16">this-&gt;_lineItem)
</span>&nbsp;</code></td>
<td class="ln">964</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp;</span><span class="sf17b16">
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">702</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp;</span><span class="sf17b16">) {</span>&nbsp;</code></td>
<td class="ln">965</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp;</span><span class="sf17b16"> &nbsp;</span><span class="sf17b16">$</span><span class="sf17b16">this-&gt;</span><span class="sf17b16">set</span><span class="sf17b16">(</span><span class="sf17b16">'participantIDs'</span><span class="sf17b16">, $</span><span class="sf17b16">this-&gt;_participantIDS);</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">703</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16">
</span>&nbsp;</code></td>
<td class="ln">966</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp;
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">704</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">// </span><span class="sf17b16">take all processed participant ids.</span>&nbsp;</code></td>
<td class="ln">967</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">// </span><span class="sf17b16">create line items, CRM-5313</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">705</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp;</span><span class="sf17b16">$</span><span class="sf17b16">allParticipantIds = $</span><span class="sf17b16">this-&gt;_participantIDS;</span>&nbsp;</code></td>
<td class="ln">968</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp;</span><span class="sf17b16">if</span><span class="sf17b16"> ($</span><span class="sf17b16">this-&gt;_priceSetId &amp;&amp;</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">706</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16">
</span>&nbsp;</code></td>
<td class="ln">969</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp;!</span><span class="sf17b16">empty</span><span class="sf17b16">($</span><span class="sf17b16">this-&gt;_lineItem)
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">707</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp;</span><span class="sf17b16">// when participant re-walk wizard.
</span>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">708</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp;</span><span class="sf17b16">if</span><span class="sf17b16"> ($</span><span class="sf17b16">this-&gt;_allowConfirmation &amp;&amp;
</span>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">709</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp;!</span><span class="sf17b16">empty</span><span class="sf17b16">($</span><span class="sf17b16">this-&gt;_additionalParticipantIds)
</span>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">710</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;) {</span></code></td>
<td class="ln">970</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">711</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp;</span><span class="sf17b16"> &nbsp; &nbsp; &nbsp;$</span><span class="sf17b16">allParticipantIds = </span><span class="sf17b16">array_merge</span><span class="sf17b16">(</span><span class="sf17b16">array</span><span class="sf17b16">($</span><span class="sf17b16">registerByID), $</span><span class="sf17b16">this-&gt;_additionalParticipantIds);
</span>&nbsp;</code></td>
<td class="ln">971</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp;</span><span class="sf17b16">
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">712</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp;</span><span class="sf17b16">}</span>&nbsp;</code></td>
<td class="ln">972</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp;</span><span class="sf17b16"> &nbsp;</span><span class="sf17b16">// take all processed participant ids.</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">713</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16">
</span>&nbsp;</code></td>
<td class="ln">973</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf17b16">allParticipantIds = $</span><span class="sf17b16">this-&gt;_participantIDS;
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">714</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp;</span><span class="sf17b16"> &nbsp; &nbsp;$</span><span class="sf17b16">entityTable = </span><span class="sf17b16">'civicrm_participant'</span><span class="sf17b16">;
</span>&nbsp;</code></td>
<td class="ln">974</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp;</span><span class="sf17b16">
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">715</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp;</span><span class="sf17b16">foreach</span><span class="sf17b16"> ($</span><span class="sf17b16">this-&gt;_lineItem as $</span><span class="sf17b16">key =&gt; $</span><span class="sf17b16">value) {</span>&nbsp;</code></td>
<td class="ln">975</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp;</span><span class="sf17b16"> &nbsp;</span><span class="sf17b16">// when participant re-walk wizard.</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">716</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #000000; background-color: #efcb05; font-weight: bold; ">if</span><span style="color: #000000; background-color: #efcb05; "> </span><span class="sf17b16">(($</span><span class="sf17b16">value != </span><span class="sf17b16">'skip'</span><span class="sf17b16">)</span><span style="color: #000000; background-color: #efcb05; "> &amp;&amp;</span></code></td>
<td class="ln">976</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #000000; background-color: #efcb05; font-weight: bold; ">if</span><span style="color: #000000; background-color: #efcb05; "> </span><span class="sf17b16">($</span><span class="sf17b16">this-&gt;_allowConfirmation</span><span style="color: #000000; background-color: #efcb05; "> &amp;&amp;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">717</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf17b16">($</span><span class="sf17b16">entityId = </span><span class="sf17b16">CRM_Utils_Array::value</span><span class="sf17b16">($</span><span class="sf17b16">key, $</span><span class="sf17b16">allParticipantIds))</span>&nbsp;</code></td>
<td class="ln">977</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf17b16">!</span><span class="sf17b16">empty</span><span class="sf17b16">($</span><span class="sf17b16">this-&gt;_additionalParticipantIds)</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">718</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;) {</span></code></td>
<td class="ln">978</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">719</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16">
</span>&nbsp;</code></td>
<td class="ln">979</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf17b16">allParticipantIds = </span><span class="sf17b16">array_merge</span><span class="sf17b16">(</span><span class="sf17b16">array</span><span class="sf17b16">($</span><span class="sf17b16">registerByID), $</span><span class="sf17b16">this-&gt;_additionalParticipantIds);
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">720</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf17b16"> &nbsp;</span><span class="sf17b16">// do cleanup line &nbsp;items if participant re-walking wizard.</span>&nbsp;</code></td>
<td class="ln">980</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf17b16">}</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">721</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf17b16">&nbsp;</span><span class="sf17b16">if</span><span class="sf17b16"> ($</span><span class="sf17b16">this-&gt;_allowConfirmation) {
</span>&nbsp;</code></td>
<td class="ln">981</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf17b16">
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">722</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf17b16">&nbsp; &nbsp;</span><span class="sf17b16">CRM_Price_BAO_LineItem::deleteLineItems</span><span class="sf17b16">($</span><span class="sf17b16">entityId, $</span><span class="sf17b16">entityTable);</span>&nbsp;</code></td>
<td class="ln">982</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf17b16">$</span><span class="sf17b16">pids = $</span><span class="sf17b16">allParticipantIds;</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">983</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf17b16">allParticipantIds = </span><span class="sf17b16">array</span><span class="sf17b16">();
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">984</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf17b16">foreach</span><span class="sf17b16">( $</span><span class="sf17b16">pids </span><span class="sf17b16">as</span><span class="sf17b16"> $</span><span class="sf17b16">key=&gt; $</span><span class="sf17b16">val ) {
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">985</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf17b16">if</span><span class="sf17b16"> ($</span><span class="sf17b16">payer === </span><span class="sf17b16">'payer'</span><span class="sf17b16"> &amp;&amp; $</span><span class="sf17b16">val == $</span><span class="sf17b16">registerByID ) &nbsp;{
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">986</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf17b16">continue</span><span class="sf17b16">;
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">987</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} </span><span class="sf17b16">else</span><span class="sf17b16"> {
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">988</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf17b16">allParticipantIds[] = $</span><span class="sf17b16">val;
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">723</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">989</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">990</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp;}
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">724</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">991</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">725</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf17b16"> &nbsp;</span><span class="sf17b16">// create line.</span>&nbsp;</code></td>
<td class="ln">992</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf17b16">$</span><span class="sf17b16">entityTable = </span><span class="sf17b16">'civicrm_participant'</span><span class="sf17b16">;</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">726</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf17b16"> &nbsp;</span><span style="color: #000000; background-color: #efcb05; font-weight: bold; ">foreach</span><span style="color: #000000; background-color: #efcb05; "> </span><span class="sf17b16">($</span><span class="sf17b16">value</span><span style="color: #000000; background-color: #efcb05; "> </span><span style="color: #000000; background-color: #efcb05; font-weight: bold; ">as</span><span style="color: #000000; background-color: #efcb05; "> </span><span class="sf17b16">$</span><span class="sf17b16">line)</span><span style="color: #000000; background-color: #efcb05; "> {</span></code></td>
<td class="ln">993</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #000000; background-color: #efcb05; font-weight: bold; ">foreach</span><span style="color: #000000; background-color: #efcb05; "> </span><span class="sf17b16">($</span><span class="sf17b16">this-&gt;_lineItem</span><span style="color: #000000; background-color: #efcb05; "> as </span><span class="sf17b16">$</span><span class="sf17b16">key =&gt; $</span><span class="sf17b16">value)</span><span style="color: #000000; background-color: #efcb05; "> {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">727</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf17b16"> &nbsp;</span><span class="sf17b16">$</span><span class="sf17b16">line[</span><span class="sf17b16">'entity_id'</span><span class="sf17b16">] = $</span><span class="sf17b16">entityId;</span>&nbsp;</code></td>
<td class="ln">994</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf17b16">if</span><span class="sf17b16"> (($</span><span class="sf17b16">value != </span><span class="sf17b16">'skip'</span><span class="sf17b16">) &amp;&amp;</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">728</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf17b16">$</span><span class="sf17b16">line[</span><span class="sf17b16">'entity_table'</span><span class="sf17b16">]</span><span style="color: #000000; background-color: #efcb05; "> = </span><span class="sf17b16">$</span><span class="sf17b16">entityTable;</span>&nbsp;</code></td>
<td class="ln">995</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf17b16">($</span><span class="sf17b16">entityId</span><span style="color: #000000; background-color: #efcb05; "> = </span><span class="sf17b16">CRM_Utils_Array::value</span><span class="sf17b16">($</span><span class="sf17b16">key, $</span><span class="sf17b16">allParticipantIds))</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">729</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf17b16"> &nbsp;</span><span class="sf17b16">CRM_Price_BAO_LineItem::create</span><span class="sf17b16">($</span><span class="sf17b16">line);</span>&nbsp;</code></td>
<td class="ln">996</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf17b16">) {</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">997</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp;
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">998</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf17b16">// do cleanup line &nbsp;items if participant re-walking wizard.
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">999</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf17b16">if</span><span class="sf17b16"> ($</span><span class="sf17b16">this-&gt;_allowConfirmation) {
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">1000</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf17b16">CRM_Price_BAO_LineItem::deleteLineItems</span><span class="sf17b16">($</span><span class="sf17b16">entityId, $</span><span class="sf17b16">entityTable);
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">1001</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">1002</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp;
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">1003</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf17b16">// create line.
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">1004</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf17b16">foreach</span><span class="sf17b16"> ($</span><span class="sf17b16">value </span><span class="sf17b16">as</span><span class="sf17b16"> $</span><span class="sf17b16">line) {
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">1005</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf17b16">line[</span><span class="sf17b16">'entity_id'</span><span class="sf17b16">] = $</span><span class="sf17b16">entityId;
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">1006</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf17b16">line[</span><span class="sf17b16">'entity_table'</span><span class="sf17b16">] = $</span><span class="sf17b16">entityTable;
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">1007</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf17b16">CRM_Price_BAO_LineItem::create</span><span class="sf17b16">($</span><span class="sf17b16">line);
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">1008</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">730</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">1009</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">731</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">1010</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">732</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">1011</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">733</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp;</span><span class="sf17b16">}
</span>&nbsp;</code></td>
<td class="ln">1012</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp;</span><span class="sf17b16"> 
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">734</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16">
</span>&nbsp;</code></td>
<td class="ln">1013</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp;</span><span class="sf17b16">//update status and send mail to cancelled additonal participants, CRM-4320
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">735</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp;</span><span class="sf17b16">//update status and send mail to cancelled additonal participants, CRM-4320</span>&nbsp;</code></td>
<td class="ln">1014</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp;</span><span class="sf17b16"> &nbsp;</span><span class="sf17b16">if</span><span class="sf17b16"> ($</span><span class="sf17b16">this-&gt;</span><span class="sf17b16">_allowConfirmation &amp;&amp; is_array</span><span class="sf17b16">($</span><span class="sf17b16">cancelledIds) &amp;&amp; !</span><span class="sf17b16">empty</span><span class="sf17b16">($</span><span class="sf17b16">cancelledIds)) {</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">736</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp;</span><span class="sf17b16">if</span><span class="sf17b16"> ($</span><span class="sf17b16">this-&gt;</span><span class="sf17b16">_allowConfirmation &amp;&amp; is_array</span><span class="sf17b16">($</span><span class="sf17b16">cancelledIds) &amp;&amp; !</span><span class="sf17b16">empty</span><span class="sf17b16">($</span><span class="sf17b16">cancelledIds)) {</span>&nbsp;</code></td>
<td class="ln">1015</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp;</span><span class="sf17b16"> &nbsp; &nbsp;</span><span class="sf17b16">$</span><span class="sf17b16">cancelledId = </span><span class="sf17b16">array_search</span><span class="sf17b16">(</span><span class="sf17b16">'Cancelled'</span><span class="sf17b16">,</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">737</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp;</span><span class="sf17b16">$</span><span class="sf17b16">cancelledId</span><span style="color: #000000; background-color: #efcb05; "> = </span><span class="sf17b16">array_search</span><span class="sf17b16">(</span><span class="sf17b16">'Cancelled'</span><span class="sf17b16">,</span>&nbsp;</code></td>
<td class="ln">1016</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp;</span><span class="sf17b16"> &nbsp; &nbsp;</span><span class="sf17b16">CRM_Event_PseudoConstant::participantStatus</span><span class="sf17b16">(NULL, </span><span class="sf17b16">"class</span><span style="color: #000000; background-color: #efcb05; "> = </span><span class="sf17b16">'Negative'"</span><span class="sf17b16">)</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">738</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf17b16">CRM_Event_PseudoConstant::participantStatus</span><span class="sf17b16">(NULL, </span><span class="sf17b16">"class = 'Negative'"</span><span class="sf17b16">)</span>&nbsp;</code></td>
<td class="ln">1017</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf17b16">);</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">739</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp;</span><span class="sf17b16">);</span>&nbsp;</code></td>
<td class="ln">1018</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp;</span><span class="sf17b16"> &nbsp;</span><span class="sf17b16">CRM_Event_BAO_Participant::transitionParticipants</span><span class="sf17b16">($<wbr></span><span class="sf17b16">cancelledIds, $</span><span class="sf17b16">cancelledId);</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">740</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp;</span><span class="sf17b16">CRM_Event_BAO_Participant::transitionParticipants</span><span class="sf17b16">($<wbr></span><span class="sf17b16">cancelledIds, $</span><span class="sf17b16">cancelledId);
</span>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">741</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp;}
</span>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">742</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16">
</span>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">743</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp;$</span><span class="sf17b16">isTest = FALSE;
</span>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">744</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp;</span><span class="sf17b16">if</span><span class="sf17b16"> ($</span><span class="sf17b16">this-&gt;_action &amp; CRM_Core_Action::PREVIEW) {
</span>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">745</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp;$</span><span class="sf17b16">isTest = TRUE;
</span>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">746</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp;}
</span>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">747</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16">
</span>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">748</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp;</span><span class="sf17b16">// for Transfer checkout.
</span>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">749</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp;</span><span class="sf17b16">if</span><span class="sf17b16"> (($</span><span class="sf17b16">this-&gt;_contributeMode == </span><span class="sf17b16">'checkout'</span><span class="sf17b16"> ||
</span>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">750</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf17b16">this-&gt;_contributeMode == </span><span class="sf17b16">'notify'</span><span class="sf17b16">
</span>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">751</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp;) &amp;&amp;
</span>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">752</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp;!</span><span class="sf17b16">CRM_Utils_Array::value</span><span class="sf17b16">(</span><span class="sf17b16">'is_pay_later'</span><span class="sf17b16">, $</span><span class="sf17b16">params[</span><span class="sf17b16">0</span><span class="sf17b16">]) &amp;&amp;
</span>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">753</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp;!$</span><span class="sf17b16">this-&gt;_allowWaitlist &amp;&amp; !$</span><span class="sf17b16">this-&gt;_requireApproval &amp;&amp;
</span>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">754</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp;$</span><span class="sf17b16">this-&gt;_totalAmount &gt; 0
</span>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">755</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp;) {
</span>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">756</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16">
</span>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">757</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp;$</span><span class="sf17b16">primaryParticipant = $</span><span class="sf17b16">this-&gt;</span><span class="sf17b16">get</span><span class="sf17b16">(</span><span class="sf17b16">'primaryParticipant'</span><span class="sf17b16">);
</span>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">758</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16">
</span>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">759</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp;</span><span class="sf17b16">if</span><span class="sf17b16"> (!</span><span class="sf17b16">CRM_Utils_Array::value</span><span class="sf17b16">(</span><span class="sf17b16">'participantID'</span><span class="sf17b16">, $</span><span class="sf17b16">primaryParticipant)) {
</span>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">760</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf17b16">primaryParticipant[</span><span class="sf17b16">'participantID'</span><span class="sf17b16">] = $</span><span class="sf17b16">registerByID;
</span>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">761</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp;}
</span>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">762</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16">
</span>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">763</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp;</span><span class="sf17b16">//build an array of custom profile and assigning it to template
</span>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">764</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp;$</span><span class="sf17b16">customProfile = </span><span class="sf17b16">CRM_Event_BAO_Event::buildCustomProfile</span><span class="sf17b16">($</span><span class="sf17b16">registerBy<wbr>ID, $</span><span class="sf17b16">this-&gt;_values, NULL, $</span><span class="sf17b16">isTest);
</span>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">765</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp;</span><span class="sf17b16">if</span><span class="sf17b16"> (</span><span class="sf17b16">count</span><span class="sf17b16">($</span><span class="sf17b16">customProfile)) {
</span>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">766</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf17b16">this-&gt;</span><span class="sf17b16">assign</span><span class="sf17b16">(</span><span class="sf17b16">'customProfile'</span><span class="sf17b16">, $</span><span class="sf17b16">customProfile);
</span>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">767</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf17b16">this-&gt;</span><span class="sf17b16">set</span><span class="sf17b16">(</span><span class="sf17b16">'customProfile'</span><span class="sf17b16">, $</span><span class="sf17b16">customProfile);
</span>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">768</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">1019</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">769</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16">
</span>&nbsp;</code></td>
<td class="ln">1020</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp;
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">770</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp;</span><span class="sf17b16">// do a transfer only if a monetary payment greater than 0</span>&nbsp;</code></td>
<td class="ln">1021</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp;</span><span class="sf17b16">$</span><span class="sf17b16">isTest = FALSE;</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">771</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp;</span><span style="color: #000000; background-color: #efcb05; font-weight: bold; ">if</span><span style="color: #000000; background-color: #efcb05; "> </span><span class="sf17b16">($</span><span class="sf17b16">this-&gt;_values[</span><span class="sf17b16">'event'</span><span class="sf17b16">][</span><span class="sf17b16">'is_monetary'</span><span class="sf17b16">] &amp;&amp; $</span><span class="sf17b16">primaryParticipant)</span><span style="color: #000000; background-color: #efcb05; "> {</span></code></td>
<td class="ln">1022</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp;</span><span style="color: #000000; background-color: #efcb05; font-weight: bold; ">if</span><span style="color: #000000; background-color: #efcb05; "> </span><span class="sf17b16">($</span><span class="sf17b16">this-&gt;_action &amp; CRM_Core_Action::PREVIEW)</span><span style="color: #000000; background-color: #efcb05; "> {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">772</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf17b16">if</span><span class="sf17b16"> ($</span><span class="sf17b16">payment &amp;&amp; </span><span class="sf17b16">is_object</span><span class="sf17b16">($</span><span class="sf17b16">payment))</span><span class="sf17b16"> 
</span>&nbsp;</code></td>
<td class="ln">1023</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf17b16">$</span><span class="sf17b16">isTest = TRUE;</span><span class="sf17b16">
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">773</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp;</span><span class="sf17b16"> &nbsp; &nbsp;</span><span class="sf17b16">$</span><span class="sf17b16">payment-&gt;</span><span class="sf17b16">doTransferCheckout</span><span class="sf17b16">($</span><span class="sf17b16">primaryParticipant, </span><span class="sf17b16">'event'</span><span class="sf17b16">);</span>&nbsp;</code></td>
<td class="ln">1024</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp;</span><span class="sf17b16">}</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">774</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp;</span><span class="sf17b16"> &nbsp; &nbsp; &nbsp;</span><span class="sf17b16">else</span><span class="sf17b16"> 
</span>&nbsp;</code></td>
<td class="ln">1025</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp;</span><span class="sf17b16">
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">775</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp;</span><span class="sf17b16"> &nbsp; &nbsp;</span><span class="sf17b16">CRM_Core_Error::fatal</span><span class="sf17b16">($</span><span class="sf17b16">paymentObjError);</span>&nbsp;</code></td>
<td class="ln">1026</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp;</span><span class="sf17b16">// for Transfer checkout.</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">1027</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp;</span><span class="sf17b16">if</span><span class="sf17b16"> (($</span><span class="sf17b16">this-&gt;_contributeMode == </span><span class="sf17b16">'checkout'</span><span class="sf17b16"> ||
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">1028</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf17b16">this-&gt;_contributeMode == </span><span class="sf17b16">'notify'</span><span class="sf17b16">
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">1029</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp;) &amp;&amp;
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">1030</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp;!</span><span class="sf17b16">CRM_Utils_Array::value</span><span class="sf17b16">(</span><span class="sf17b16">'is_pay_later'</span><span class="sf17b16">, $</span><span class="sf17b16">params[</span><span class="sf17b16">0</span><span class="sf17b16">]) &amp;&amp;
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">1031</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp;!$</span><span class="sf17b16">this-&gt;_allowWaitlist &amp;&amp; !$</span><span class="sf17b16">this-&gt;_requireApproval &amp;&amp;
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">1032</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf17b16">this-&gt;_totalAmount &gt; 0
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">1033</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp;) {
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">1034</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp;
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">1035</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf17b16">primaryParticipant = $</span><span class="sf17b16">this-&gt;</span><span class="sf17b16">get</span><span class="sf17b16">(</span><span class="sf17b16">'primaryParticipant'</span><span class="sf17b16">);
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">1036</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp;
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">1037</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf17b16">if</span><span class="sf17b16"> (!</span><span class="sf17b16">CRM_Utils_Array::value</span><span class="sf17b16">(</span><span class="sf17b16">'participantID'</span><span class="sf17b16">, $</span><span class="sf17b16">primaryParticipant)) {
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">1038</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf17b16">primaryParticipant[</span><span class="sf17b16">'participantID'</span><span class="sf17b16">] = $</span><span class="sf17b16">registerByID;
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">1039</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp;}
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">1040</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp;
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">1041</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf17b16">//build an array of custom profile and assigning it to template
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">1042</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf17b16">customProfile = </span><span class="sf17b16">CRM_Event_BAO_Event::buildCustomProfile</span><span class="sf17b16">($</span><span class="sf17b16">registerBy<wbr>ID, $</span><span class="sf17b16">this-&gt;_values, NULL, $</span><span class="sf17b16">isTest);
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">1043</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf17b16">if</span><span class="sf17b16"> (</span><span class="sf17b16">count</span><span class="sf17b16">($</span><span class="sf17b16">customProfile)) {
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">1044</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf17b16">this-&gt;</span><span class="sf17b16">assign</span><span class="sf17b16">(</span><span class="sf17b16">'customProfile'</span><span class="sf17b16">, $</span><span class="sf17b16">customProfile);
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">1045</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf17b16">this-&gt;</span><span class="sf17b16">set</span><span class="sf17b16">(</span><span class="sf17b16">'customProfile'</span><span class="sf17b16">, $</span><span class="sf17b16">customProfile);
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">1046</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp;}
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">1047</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp;
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">1048</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf17b16">// do a transfer only if a monetary payment greater than 0
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">1049</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf17b16">if</span><span class="sf17b16"> ($</span><span class="sf17b16">this-&gt;_values[</span><span class="sf17b16">'event'</span><span class="sf17b16">][</span><span class="sf17b16">'is_monetary'</span><span class="sf17b16">] &amp;&amp; $</span><span class="sf17b16">primaryParticipant) {
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">1050</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf17b16">if</span><span class="sf17b16"> ($</span><span class="sf17b16">payment &amp;&amp; </span><span class="sf17b16">is_object</span><span class="sf17b16">($</span><span class="sf17b16">payment)) 
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">1051</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf17b16">payment-&gt;</span><span class="sf17b16">doTransferCheckout</span><span class="sf17b16">($</span><span class="sf17b16">primaryParticipant, </span><span class="sf17b16">'event'</span><span class="sf17b16">);
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">1052</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf17b16">else</span><span class="sf17b16"> 
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">1053</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf17b16">CRM_Core_Error::fatal</span><span class="sf17b16">($</span><span class="sf17b16">paymentObjError);
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">1054</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp;}
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">776</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">1055</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">777</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp;</span><span class="sf17b16">}</span>&nbsp;</code></td>
<td class="ln">1056</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp;</span><span class="sf17b16"> &nbsp;</span><span class="sf17b16">else</span><span class="sf17b16"> {</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">778</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp;</span><span class="sf17b16">else</span><span class="sf17b16"> {</span>&nbsp;</code></td>
<td class="ln">1057</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp;</span><span class="sf17b16"> &nbsp; &nbsp;</span><span class="sf17b16">//otherwise send mail Confirmation/Receipt</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">779</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp;</span><span class="sf17b16">//otherwise send mail Confirmation/Receipt</span>&nbsp;</code></td>
<td class="ln">1058</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp;</span><span class="sf17b16"> &nbsp;</span><span class="sf17b16">$</span><span class="sf17b16">primaryContactId = $</span><span class="sf17b16">this-&gt;</span><span class="sf17b16">get</span><span class="sf17b16">(</span><span class="sf17b16">'primaryContactId'</span><span class="sf17b16">);</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">780</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp;</span><span class="sf17b16">$</span><span class="sf17b16">primaryContactId = $</span><span class="sf17b16">this-&gt;</span><span class="sf17b16">get</span><span class="sf17b16">(</span><span class="sf17b16">'primaryContactId'</span><span class="sf17b16">);
</span>&nbsp;</code></td>
<td class="ln">1059</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp;</span><span class="sf17b16">
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">781</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16">
</span>&nbsp;</code></td>
<td class="ln">1060</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf17b16">//build an array of cId/pId of participants
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">782</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp;</span><span class="sf17b16">//build an array of cId/pId of participants</span>&nbsp;</code></td>
<td class="ln">1061</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp;</span><span class="sf17b16"> &nbsp;</span><span class="sf17b16">$</span><span class="sf17b16">additionalIDs = </span><span class="sf17b16">CRM_Event_BAO_Event::buildCustomProfile</span><span class="sf17b16">($</span><span class="sf17b16">registerBy<wbr>ID,</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">783</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp;</span><span class="sf17b16">$</span><span class="sf17b16">additionalIDs = </span><span class="sf17b16">CRM_Event_BAO_Event::buildCustomProfile</span><span class="sf17b16">($</span><span class="sf17b16">registerBy<wbr>ID,</span>&nbsp;</code></td>
<td class="ln">1062</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp;</span><span class="sf17b16"> &nbsp; &nbsp;</span><span class="sf17b16">NULL, $</span><span class="sf17b16">primaryContactId, $</span><span class="sf17b16">isTest,</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">784</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf17b16">NULL, $</span><span class="sf17b16">primaryContactId, $</span><span class="sf17b16">isTest,</span>&nbsp;</code></td>
<td class="ln">1063</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf17b16"> &nbsp;</span><span class="sf17b16">TRUE</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">785</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf17b16">TRUE</span>&nbsp;</code></td>
<td class="ln">1064</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf17b16">);</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">786</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp;);
</span>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">787</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">//lets send &nbsp;mails to all with meaningful text, CRM-4320.</span></code></td>
<td class="ln">1065</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">//lets send &nbsp;mails to all with meaningful text, CRM-4320.</span></code></td>
</tr>
<tr valign="top">
<td class="ln">788</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">$</span><span style="color: #000000; background-color: #efcb05; ">this-&gt;</span><span style="color: #000000; background-color: #efcb05; ">assign</span><span style="color: #000000; background-color: #efcb05; ">(</span><span style="color: #000000; background-color: #efcb05; ">'isOnWaitlist'</span><span style="color: #000000; background-color: #efcb05; ">, $</span><span style="color: #000000; background-color: #efcb05; ">this-&gt;_allowWaitlist);</span></code></td>
<td class="ln">1066</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp;</span><span class="sf17b16"> &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">$</span><span style="color: #000000; background-color: #efcb05; ">this-&gt;</span><span style="color: #000000; background-color: #efcb05; ">assign</span><span style="color: #000000; background-color: #efcb05; ">(</span><span style="color: #000000; background-color: #efcb05; ">'isOnWaitlist'</span><span style="color: #000000; background-color: #efcb05; ">, $</span><span style="color: #000000; background-color: #efcb05; ">this-&gt;_allowWaitlist);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">789</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">$</span><span style="color: #000000; background-color: #efcb05; ">this-&gt;</span><span style="color: #000000; background-color: #efcb05; ">assign</span><span style="color: #000000; background-color: #efcb05; ">(</span><span style="color: #000000; background-color: #efcb05; ">'isRequireApproval'</span><span style="color: #000000; background-color: #efcb05; ">, $</span><span style="color: #000000; background-color: #efcb05; ">this-&gt;_requireApproval);</span></code></td>
<td class="ln">1067</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp;</span><span class="sf17b16"> &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">$</span><span style="color: #000000; background-color: #efcb05; ">this-&gt;</span><span style="color: #000000; background-color: #efcb05; ">assign</span><span style="color: #000000; background-color: #efcb05; ">(</span><span style="color: #000000; background-color: #efcb05; ">'isRequireApproval'</span><span style="color: #000000; background-color: #efcb05; ">, $</span><span style="color: #000000; background-color: #efcb05; ">this-&gt;_requireApproval);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">790</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16">
</span>&nbsp;</code></td>
<td class="ln">1068</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp;
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">791</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">//need to copy, since we are unsetting on the way.</span></code></td>
<td class="ln">1069</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp;</span><span class="sf17b16"> &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">//need to copy, since we are unsetting on the way.</span></code></td>
</tr>
<tr valign="top">
<td class="ln">792</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">$</span><span style="color: #000000; background-color: #efcb05; ">copyParticipantCount = $</span><span style="color: #000000; background-color: #efcb05; ">participantCount;</span></code></td>
<td class="ln">1070</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp;</span><span class="sf17b16"> &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">$</span><span style="color: #000000; background-color: #efcb05; ">copyParticipantCount = $</span><span style="color: #000000; background-color: #efcb05; ">participantCount;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">793</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16">
</span>&nbsp;</code></td>
<td class="ln">1071</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp;
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">794</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">//lets carry all paticipant params w/ values.</span></code></td>
<td class="ln">1072</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp;</span><span class="sf17b16"> &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">//lets carry all paticipant params w/ values.</span></code></td>
</tr>
<tr valign="top">
<td class="ln">795</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp;</span><span style="color: #000000; background-color: #efcb05; font-weight: bold; ">foreach</span><span style="color: #000000; background-color: #efcb05; "> ($</span><span style="color: #000000; background-color: #efcb05; ">additionalIDs </span><span style="color: #000000; background-color: #efcb05; font-weight: bold; ">as</span><span style="color: #000000; background-color: #efcb05; "> $</span><span style="color: #000000; background-color: #efcb05; ">participantID =&gt; $</span><span style="color: #000000; background-color: #efcb05; ">contactId) {</span></code></td>
<td class="ln">1073</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp;</span><span class="sf17b16"> &nbsp;</span><span style="color: #000000; background-color: #efcb05; font-weight: bold; ">foreach</span><span style="color: #000000; background-color: #efcb05; "> ($</span><span style="color: #000000; background-color: #efcb05; ">additionalIDs </span><span style="color: #000000; background-color: #efcb05; font-weight: bold; ">as</span><span style="color: #000000; background-color: #efcb05; "> $</span><span style="color: #000000; background-color: #efcb05; ">participantID =&gt; $</span><span style="color: #000000; background-color: #efcb05; ">contactId) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">796</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">$</span><span style="color: #000000; background-color: #efcb05; ">participantNum = NULL;</span></code></td>
<td class="ln">1074</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf17b16"> &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">$</span><span style="color: #000000; background-color: #efcb05; ">participantNum = NULL;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">797</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #000000; background-color: #efcb05; font-weight: bold; ">if</span><span style="color: #000000; background-color: #efcb05; "> ($</span><span style="color: #000000; background-color: #efcb05; ">participantID == $</span><span style="color: #000000; background-color: #efcb05; ">registerByID) {</span></code></td>
<td class="ln">1075</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf17b16"> &nbsp;</span><span style="color: #000000; background-color: #efcb05; font-weight: bold; ">if</span><span style="color: #000000; background-color: #efcb05; "> ($</span><span style="color: #000000; background-color: #efcb05; ">participantID == $</span><span style="color: #000000; background-color: #efcb05; ">registerByID) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">798</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">$</span><span style="color: #000000; background-color: #efcb05; ">participantNum = </span><span style="color: #000000; background-color: #efcb05; ">0</span><span style="color: #000000; background-color: #efcb05; ">;</span></code></td>
<td class="ln">1076</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf17b16"> &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">$</span><span style="color: #000000; background-color: #efcb05; ">participantNum = </span><span style="color: #000000; background-color: #efcb05; ">0</span><span style="color: #000000; background-color: #efcb05; ">;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">799</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">}</span></code></td>
<td class="ln">1077</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf17b16"> &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">800</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #000000; background-color: #efcb05; font-weight: bold; ">else</span><span style="color: #000000; background-color: #efcb05; "> {</span></code></td>
<td class="ln">1078</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf17b16"> &nbsp;</span><span style="color: #000000; background-color: #efcb05; font-weight: bold; ">else</span><span style="color: #000000; background-color: #efcb05; "> {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">801</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #000000; background-color: #efcb05; font-weight: bold; ">if</span><span style="color: #000000; background-color: #efcb05; "> ($</span><span style="color: #000000; background-color: #efcb05; ">participantNum = </span><span style="color: #000000; background-color: #efcb05; ">array_search</span><span style="color: #000000; background-color: #efcb05; ">(</span><span style="color: #000000; background-color: #efcb05; ">'participant'</span><span style="color: #000000; background-color: #efcb05; ">, $</span><span style="color: #000000; background-color: #efcb05; ">copyParticipantCount)) {</span></code></td>
<td class="ln">1079</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf17b16"> &nbsp;</span><span style="color: #000000; background-color: #efcb05; font-weight: bold; ">if</span><span style="color: #000000; background-color: #efcb05; "> ($</span><span style="color: #000000; background-color: #efcb05; ">participantNum = </span><span style="color: #000000; background-color: #efcb05; ">array_search</span><span style="color: #000000; background-color: #efcb05; ">(</span><span style="color: #000000; background-color: #efcb05; ">'participant'</span><span style="color: #000000; background-color: #efcb05; ">, $</span><span style="color: #000000; background-color: #efcb05; ">copyParticipantCount)) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">802</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #000000; background-color: #efcb05; font-weight: bold; ">unset</span><span style="color: #000000; background-color: #efcb05; ">($</span><span style="color: #000000; background-color: #efcb05; ">copyParticipantCount[$</span><span style="color: #000000; background-color: #efcb05; ">participantNum]);</span></code></td>
<td class="ln">1080</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf17b16"> &nbsp;</span><span style="color: #000000; background-color: #efcb05; font-weight: bold; ">unset</span><span style="color: #000000; background-color: #efcb05; ">($</span><span style="color: #000000; background-color: #efcb05; ">copyParticipantCount[$</span><span style="color: #000000; background-color: #efcb05; ">participantNum]);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">803</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">}</span></code></td>
<td class="ln">1081</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf17b16"> &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">804</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">}</span></code></td>
<td class="ln">1082</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf17b16"> &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">805</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #000000; background-color: #efcb05; font-weight: bold; ">if</span><span style="color: #000000; background-color: #efcb05; "> ($</span><span style="color: #000000; background-color: #efcb05; ">participantNum === NULL)</span></code></td>
<td class="ln">1083</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf17b16"> &nbsp;</span><span style="color: #000000; background-color: #efcb05; font-weight: bold; ">if</span><span style="color: #000000; background-color: #efcb05; "> ($</span><span style="color: #000000; background-color: #efcb05; ">participantNum === NULL)</span></code></td>
</tr>
<tr valign="top">
<td class="ln">806</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #000000; background-color: #efcb05; font-weight: bold; ">break</span><span style="color: #000000; background-color: #efcb05; ">;</span></code></td>
<td class="ln">1084</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf17b16"> &nbsp;</span><span style="color: #000000; background-color: #efcb05; font-weight: bold; ">break</span><span style="color: #000000; background-color: #efcb05; ">;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">807</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16">
</span>&nbsp;</code></td>
<td class="ln">1085</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp;
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">808</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">//carry the participant submitted values.</span></code></td>
<td class="ln">1086</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf17b16"> &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">//carry the participant submitted values.</span></code></td>
</tr>
<tr valign="top">
<td class="ln">809</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">$</span><span style="color: #000000; background-color: #efcb05; ">this-&gt;_values[</span><span style="color: #000000; background-color: #efcb05; ">'params'</span><span style="color: #000000; background-color: #efcb05; ">][$</span><span style="color: #000000; background-color: #efcb05; ">participantID] = $</span><span style="color: #000000; background-color: #efcb05; ">params[$</span><span style="color: #000000; background-color: #efcb05; ">participantNum];</span></code></td>
<td class="ln">1087</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf17b16"> &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">$</span><span style="color: #000000; background-color: #efcb05; ">this-&gt;_values[</span><span style="color: #000000; background-color: #efcb05; ">'params'</span><span style="color: #000000; background-color: #efcb05; ">][$</span><span style="color: #000000; background-color: #efcb05; ">participantID] = $</span><span style="color: #000000; background-color: #efcb05; ">params[$</span><span style="color: #000000; background-color: #efcb05; ">participantNum];</span></code></td>
</tr>
<tr valign="top">
<td class="ln">810</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">}</span></code></td>
<td class="ln">1088</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp;</span><span class="sf17b16"> &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">811</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16">
</span>&nbsp;</code></td>
<td class="ln">1089</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; 
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">812</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp;</span><span style="color: #000000; background-color: #efcb05; font-weight: bold; ">foreach</span><span style="color: #000000; background-color: #efcb05; "> ($</span><span style="color: #000000; background-color: #efcb05; ">additionalIDs </span><span style="color: #000000; background-color: #efcb05; font-weight: bold; ">as</span><span style="color: #000000; background-color: #efcb05; "> $</span><span style="color: #000000; background-color: #efcb05; ">participantID =&gt; $</span><span style="color: #000000; background-color: #efcb05; ">contactId) {</span></code></td>
<td class="ln">1090</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp;</span><span class="sf17b16"> &nbsp;</span><span style="color: #000000; background-color: #efcb05; font-weight: bold; ">foreach</span><span style="color: #000000; background-color: #efcb05; "> ($</span><span style="color: #000000; background-color: #efcb05; ">additionalIDs </span><span style="color: #000000; background-color: #efcb05; font-weight: bold; ">as</span><span style="color: #000000; background-color: #efcb05; "> $</span><span style="color: #000000; background-color: #efcb05; ">participantID =&gt; $</span><span style="color: #000000; background-color: #efcb05; ">contactId) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">813</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">$</span><span style="color: #000000; background-color: #efcb05; ">participantNum = </span><span class="sf17b16">0</span><span class="sf17b16">;</span>&nbsp;</code></td>
<td class="ln">1091</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf17b16"> &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">$</span><span style="color: #000000; background-color: #efcb05; ">participantNum = </span><span class="sf17b16">$</span><span class="sf17b16">payer;</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">814</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #000000; background-color: #efcb05; font-weight: bold; ">if</span><span style="color: #000000; background-color: #efcb05; "> ($</span><span style="color: #000000; background-color: #efcb05; ">participantID == $</span><span style="color: #000000; background-color: #efcb05; ">registerByID) {</span></code></td>
<td class="ln">1092</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf17b16"> &nbsp;</span><span style="color: #000000; background-color: #efcb05; font-weight: bold; ">if</span><span style="color: #000000; background-color: #efcb05; "> ($</span><span style="color: #000000; background-color: #efcb05; ">participantID == $</span><span style="color: #000000; background-color: #efcb05; ">registerByID) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">815</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">//set as Primary Participant</span></code></td>
<td class="ln">1093</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf17b16"> &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">//set as Primary Participant</span></code></td>
</tr>
<tr valign="top">
<td class="ln">816</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">$</span><span style="color: #000000; background-color: #efcb05; ">this-&gt;</span><span style="color: #000000; background-color: #efcb05; ">assign</span><span style="color: #000000; background-color: #efcb05; ">(</span><span style="color: #000000; background-color: #efcb05; ">'isPrimary'</span><span style="color: #000000; background-color: #efcb05; ">, </span><span style="color: #000000; background-color: #efcb05; ">1</span><span style="color: #000000; background-color: #efcb05; ">);</span></code></td>
<td class="ln">1094</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf17b16"> &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">$</span><span style="color: #000000; background-color: #efcb05; ">this-&gt;</span><span style="color: #000000; background-color: #efcb05; ">assign</span><span style="color: #000000; background-color: #efcb05; ">(</span><span style="color: #000000; background-color: #efcb05; ">'isPrimary'</span><span style="color: #000000; background-color: #efcb05; ">, </span><span style="color: #000000; background-color: #efcb05; ">1</span><span style="color: #000000; background-color: #efcb05; ">);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">817</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">//build an array of custom profile and assigning it to template.</span></code></td>
<td class="ln">1095</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf17b16"> &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">//build an array of custom profile and assigning it to template.</span></code></td>
</tr>
<tr valign="top">
<td class="ln">818</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">$</span><span style="color: #000000; background-color: #efcb05; ">customProfile = </span><span style="color: #000000; background-color: #efcb05; ">CRM_Event_BAO_Event::buildCustomProfile</span><span style="color: #000000; background-color: #efcb05; ">($</span><span style="color: #000000; background-color: #efcb05; ">participan<wbr>tID, $</span><span style="color: #000000; background-color: #efcb05; ">this-&gt;_values, NULL, $</span><span style="color: #000000; background-color: #efcb05; ">isTest);</span></code></td>
<td class="ln">1096</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf17b16"> &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">$</span><span style="color: #000000; background-color: #efcb05; ">customProfile = </span><span style="color: #000000; background-color: #efcb05; ">CRM_Event_BAO_Event::buildCustomProfile</span><span style="color: #000000; background-color: #efcb05; ">($</span><span style="color: #000000; background-color: #efcb05; ">participan<wbr>tID, $</span><span style="color: #000000; background-color: #efcb05; ">this-&gt;_values, NULL, $</span><span style="color: #000000; background-color: #efcb05; ">isTest);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">819</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16">
</span>&nbsp;</code></td>
<td class="ln">1097</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp;
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">820</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #000000; background-color: #efcb05; font-weight: bold; ">if</span><span style="color: #000000; background-color: #efcb05; "> (</span><span style="color: #000000; background-color: #efcb05; ">count</span><span style="color: #000000; background-color: #efcb05; ">($</span><span style="color: #000000; background-color: #efcb05; ">customProfile)) {</span></code></td>
<td class="ln">1098</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf17b16"> &nbsp;</span><span style="color: #000000; background-color: #efcb05; font-weight: bold; ">if</span><span style="color: #000000; background-color: #efcb05; "> (</span><span style="color: #000000; background-color: #efcb05; ">count</span><span style="color: #000000; background-color: #efcb05; ">($</span><span style="color: #000000; background-color: #efcb05; ">customProfile)) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">821</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">$</span><span style="color: #000000; background-color: #efcb05; ">this-&gt;</span><span style="color: #000000; background-color: #efcb05; ">assign</span><span style="color: #000000; background-color: #efcb05; ">(</span><span style="color: #000000; background-color: #efcb05; ">'customProfile'</span><span style="color: #000000; background-color: #efcb05; ">, $</span><span style="color: #000000; background-color: #efcb05; ">customProfile);</span></code></td>
<td class="ln">1099</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf17b16"> &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">$</span><span style="color: #000000; background-color: #efcb05; ">this-&gt;</span><span style="color: #000000; background-color: #efcb05; ">assign</span><span style="color: #000000; background-color: #efcb05; ">(</span><span style="color: #000000; background-color: #efcb05; ">'customProfile'</span><span style="color: #000000; background-color: #efcb05; ">, $</span><span style="color: #000000; background-color: #efcb05; ">customProfile);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">822</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">$</span><span style="color: #000000; background-color: #efcb05; ">this-&gt;</span><span style="color: #000000; background-color: #efcb05; ">set</span><span style="color: #000000; background-color: #efcb05; ">(</span><span style="color: #000000; background-color: #efcb05; ">'customProfile'</span><span style="color: #000000; background-color: #efcb05; ">, $</span><span style="color: #000000; background-color: #efcb05; ">customProfile);</span></code></td>
<td class="ln">1100</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf17b16"> &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">$</span><span style="color: #000000; background-color: #efcb05; ">this-&gt;</span><span style="color: #000000; background-color: #efcb05; ">set</span><span style="color: #000000; background-color: #efcb05; ">(</span><span style="color: #000000; background-color: #efcb05; ">'customProfile'</span><span style="color: #000000; background-color: #efcb05; ">, $</span><span style="color: #000000; background-color: #efcb05; ">customProfile);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">823</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">}</span></code></td>
<td class="ln">1101</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf17b16"> &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">824</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">$</span><span style="color: #000000; background-color: #efcb05; ">this-&gt;_values[</span><span style="color: #000000; background-color: #efcb05; ">'params'</span><span style="color: #000000; background-color: #efcb05; ">][</span><span style="color: #000000; background-color: #efcb05; ">'additionalParticipant'</span><span style="color: #000000; background-color: #efcb05; ">] = FALSE;</span></code></td>
<td class="ln">1102</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf17b16"> &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">$</span><span style="color: #000000; background-color: #efcb05; ">this-&gt;_values[</span><span style="color: #000000; background-color: #efcb05; ">'params'</span><span style="color: #000000; background-color: #efcb05; ">][</span><span style="color: #000000; background-color: #efcb05; ">'additionalParticipant'</span><span style="color: #000000; background-color: #efcb05; ">] = FALSE;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">825</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">}</span></code></td>
<td class="ln">1103</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf17b16"> &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">826</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #000000; background-color: #efcb05; font-weight: bold; ">else</span><span style="color: #000000; background-color: #efcb05; "> {</span></code></td>
<td class="ln">1104</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf17b16"> &nbsp;</span><span style="color: #000000; background-color: #efcb05; font-weight: bold; ">else</span><span style="color: #000000; background-color: #efcb05; "> {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">827</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">//take the Additional participant number.</span></code></td>
<td class="ln">1105</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf17b16"> &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">//take the Additional participant number.</span></code></td>
</tr>
<tr valign="top">
<td class="ln">828</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf17b16">if</span><span class="sf17b16"> ($</span><span class="sf17b16">participantNum</span><span style="color: #000000; background-color: #efcb05; "> = </span><span style="color: #000000; background-color: #efcb05; ">array_search</span><span style="color: #000000; background-color: #efcb05; ">(</span><span style="color: #000000; background-color: #efcb05; ">'participant'</span><span style="color: #000000; background-color: #efcb05; ">, </span><span class="sf17b16">$</span><span class="sf17b16">participantCount)) {</span>&nbsp;</code></td>
<td class="ln">1106</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf17b16"> &nbsp;</span><span class="sf17b16">$</span><span class="sf17b16">participantNum</span><span style="color: #000000; background-color: #efcb05; "> = </span><span style="color: #000000; background-color: #efcb05; ">array_search</span><span style="color: #000000; background-color: #efcb05; ">(</span><span style="color: #000000; background-color: #efcb05; ">'participant'</span><span style="color: #000000; background-color: #efcb05; ">, </span><span class="sf17b16">$</span><span class="sf17b16">participantCount);</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">829</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #000000; background-color: #efcb05; font-weight: bold; ">unset</span><span style="color: #000000; background-color: #efcb05; ">($</span><span style="color: #000000; background-color: #efcb05; ">participantCount[$</span><span style="color: #000000; background-color: #efcb05; ">participantNum]);</span></code></td>
<td class="ln">1107</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf17b16"> &nbsp;</span><span style="color: #000000; background-color: #efcb05; font-weight: bold; ">unset</span><span style="color: #000000; background-color: #efcb05; ">($</span><span style="color: #000000; background-color: #efcb05; ">participantCount[$</span><span style="color: #000000; background-color: #efcb05; ">participantNum]);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">830</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf17b16">}
</span>&nbsp;</code></td>
<td class="ln">1108</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf17b16"> &nbsp;
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">831</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">$</span><span style="color: #000000; background-color: #efcb05; ">this-&gt;</span><span style="color: #000000; background-color: #efcb05; ">assign</span><span style="color: #000000; background-color: #efcb05; ">(</span><span style="color: #000000; background-color: #efcb05; ">'isPrimary'</span><span style="color: #000000; background-color: #efcb05; ">, </span><span style="color: #000000; background-color: #efcb05; ">0</span><span style="color: #000000; background-color: #efcb05; ">);</span></code></td>
<td class="ln">1109</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf17b16"> &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">$</span><span style="color: #000000; background-color: #efcb05; ">this-&gt;</span><span style="color: #000000; background-color: #efcb05; ">assign</span><span style="color: #000000; background-color: #efcb05; ">(</span><span style="color: #000000; background-color: #efcb05; ">'isPrimary'</span><span style="color: #000000; background-color: #efcb05; ">, </span><span style="color: #000000; background-color: #efcb05; ">0</span><span style="color: #000000; background-color: #efcb05; ">);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">832</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">$</span><span style="color: #000000; background-color: #efcb05; ">this-&gt;</span><span style="color: #000000; background-color: #efcb05; ">assign</span><span style="color: #000000; background-color: #efcb05; ">(</span><span style="color: #000000; background-color: #efcb05; ">'customProfile'</span><span style="color: #000000; background-color: #efcb05; ">, NULL);</span></code></td>
<td class="ln">1110</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf17b16"> &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">$</span><span style="color: #000000; background-color: #efcb05; ">this-&gt;</span><span style="color: #000000; background-color: #efcb05; ">assign</span><span style="color: #000000; background-color: #efcb05; ">(</span><span style="color: #000000; background-color: #efcb05; ">'customProfile'</span><span style="color: #000000; background-color: #efcb05; ">, NULL);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">833</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">//Additional Participant should get only it's payment information</span></code></td>
<td class="ln">1111</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf17b16"> &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">//Additional Participant should get only it's payment information</span></code></td>
</tr>
<tr valign="top">
<td class="ln">834</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #000000; background-color: #efcb05; font-weight: bold; ">if</span><span style="color: #000000; background-color: #efcb05; "> ($</span><span style="color: #000000; background-color: #efcb05; ">this-&gt;_amount) {</span></code></td>
<td class="ln">1112</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf17b16"> &nbsp;</span><span style="color: #000000; background-color: #efcb05; font-weight: bold; ">if</span><span style="color: #000000; background-color: #efcb05; "> ($</span><span style="color: #000000; background-color: #efcb05; ">this-&gt;_amount) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">835</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">$</span><span style="color: #000000; background-color: #efcb05; ">amount = </span><span style="color: #000000; background-color: #efcb05; font-weight: bold; ">array</span><span style="color: #000000; background-color: #efcb05; ">();</span></code></td>
<td class="ln">1113</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf17b16"> &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">$</span><span style="color: #000000; background-color: #efcb05; ">amount = </span><span style="color: #000000; background-color: #efcb05; font-weight: bold; ">array</span><span style="color: #000000; background-color: #efcb05; ">();</span></code></td>
</tr>
<tr valign="top">
<td class="ln">836</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">$</span><span style="color: #000000; background-color: #efcb05; ">params = $</span><span style="color: #000000; background-color: #efcb05; ">this-&gt;</span><span style="color: #000000; background-color: #efcb05; ">get</span><span style="color: #000000; background-color: #efcb05; ">(</span><span style="color: #000000; background-color: #efcb05; ">'params'</span><span style="color: #000000; background-color: #efcb05; ">);</span></code></td>
<td class="ln">1114</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf17b16"> &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">$</span><span style="color: #000000; background-color: #efcb05; ">params = $</span><span style="color: #000000; background-color: #efcb05; ">this-&gt;</span><span style="color: #000000; background-color: #efcb05; ">get</span><span style="color: #000000; background-color: #efcb05; ">(</span><span style="color: #000000; background-color: #efcb05; ">'params'</span><span style="color: #000000; background-color: #efcb05; ">);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">837</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">$</span><span style="color: #000000; background-color: #efcb05; ">amount[$</span><span style="color: #000000; background-color: #efcb05; ">participantNum][</span><span style="color: #000000; background-color: #efcb05; ">'label'</span><span style="color: #000000; background-color: #efcb05; ">] = $</span><span style="color: #000000; background-color: #efcb05; ">params[$</span><span style="color: #000000; background-color: #efcb05; ">participantNum][</span><span style="color: #000000; background-color: #efcb05; ">'amount_level'</span><span style="color: #000000; background-color: #efcb05; ">];</span></code></td>
<td class="ln">1115</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf17b16"> &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">$</span><span style="color: #000000; background-color: #efcb05; ">amount[$</span><span style="color: #000000; background-color: #efcb05; ">participantNum][</span><span style="color: #000000; background-color: #efcb05; ">'label'</span><span style="color: #000000; background-color: #efcb05; ">] = $</span><span style="color: #000000; background-color: #efcb05; ">params[$</span><span style="color: #000000; background-color: #efcb05; ">participantNum][</span><span style="color: #000000; background-color: #efcb05; ">'amount_level'</span><span style="color: #000000; background-color: #efcb05; ">];</span></code></td>
</tr>
<tr valign="top">
<td class="ln">838</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">$</span><span style="color: #000000; background-color: #efcb05; ">amount[$</span><span style="color: #000000; background-color: #efcb05; ">participantNum][</span><span style="color: #000000; background-color: #efcb05; ">'amount'</span><span style="color: #000000; background-color: #efcb05; ">] = $</span><span style="color: #000000; background-color: #efcb05; ">params[$</span><span style="color: #000000; background-color: #efcb05; ">participantNum][</span><span style="color: #000000; background-color: #efcb05; ">'amount'</span><span style="color: #000000; background-color: #efcb05; ">];</span></code></td>
<td class="ln">1116</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf17b16"> &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">$</span><span style="color: #000000; background-color: #efcb05; ">amount[$</span><span style="color: #000000; background-color: #efcb05; ">participantNum][</span><span style="color: #000000; background-color: #efcb05; ">'amount'</span><span style="color: #000000; background-color: #efcb05; ">] = $</span><span style="color: #000000; background-color: #efcb05; ">params[$</span><span style="color: #000000; background-color: #efcb05; ">participantNum][</span><span style="color: #000000; background-color: #efcb05; ">'amount'</span><span style="color: #000000; background-color: #efcb05; ">];</span></code></td>
</tr>
<tr valign="top">
<td class="ln">839</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">$</span><span style="color: #000000; background-color: #efcb05; ">this-&gt;</span><span style="color: #000000; background-color: #efcb05; ">assign</span><span style="color: #000000; background-color: #efcb05; ">(</span><span style="color: #000000; background-color: #efcb05; ">'amount'</span><span style="color: #000000; background-color: #efcb05; ">, $</span><span style="color: #000000; background-color: #efcb05; ">amount);</span></code></td>
<td class="ln">1117</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf17b16"> &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">$</span><span style="color: #000000; background-color: #efcb05; ">this-&gt;</span><span style="color: #000000; background-color: #efcb05; ">assign</span><span style="color: #000000; background-color: #efcb05; ">(</span><span style="color: #000000; background-color: #efcb05; ">'amount'</span><span style="color: #000000; background-color: #efcb05; ">, $</span><span style="color: #000000; background-color: #efcb05; ">amount);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">840</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">}</span></code></td>
<td class="ln">1118</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf17b16"> &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">841</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #000000; background-color: #efcb05; font-weight: bold; ">if</span><span style="color: #000000; background-color: #efcb05; "> ($</span><span style="color: #000000; background-color: #efcb05; ">this-&gt;_lineItem) {</span></code></td>
<td class="ln">1119</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf17b16"> &nbsp;</span><span style="color: #000000; background-color: #efcb05; font-weight: bold; ">if</span><span style="color: #000000; background-color: #efcb05; "> ($</span><span style="color: #000000; background-color: #efcb05; ">this-&gt;_lineItem) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">842</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">$</span><span style="color: #000000; background-color: #efcb05; ">lineItems &nbsp;= $</span><span style="color: #000000; background-color: #efcb05; ">this-&gt;_lineItem;</span></code></td>
<td class="ln">1120</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf17b16"> &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">$</span><span style="color: #000000; background-color: #efcb05; ">lineItems &nbsp;= $</span><span style="color: #000000; background-color: #efcb05; ">this-&gt;_lineItem;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">843</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">$</span><span style="color: #000000; background-color: #efcb05; ">lineItem &nbsp; = </span><span style="color: #000000; background-color: #efcb05; font-weight: bold; ">array</span><span style="color: #000000; background-color: #efcb05; ">();</span></code></td>
<td class="ln">1121</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf17b16"> &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">$</span><span style="color: #000000; background-color: #efcb05; ">lineItem &nbsp; = </span><span style="color: #000000; background-color: #efcb05; font-weight: bold; ">array</span><span style="color: #000000; background-color: #efcb05; ">();</span></code></td>
</tr>
<tr valign="top">
<td class="ln">844</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">$</span><span style="color: #000000; background-color: #efcb05; ">lineItem[] = </span><span style="color: #000000; background-color: #efcb05; ">CRM_Utils_Array::value</span><span style="color: #000000; background-color: #efcb05; ">($</span><span style="color: #000000; background-color: #efcb05; ">participantNum, $</span><span style="color: #000000; background-color: #efcb05; ">lineItems);</span></code></td>
<td class="ln">1122</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf17b16"> &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">$</span><span style="color: #000000; background-color: #efcb05; ">lineItem[] = </span><span style="color: #000000; background-color: #efcb05; ">CRM_Utils_Array::value</span><span style="color: #000000; background-color: #efcb05; ">($</span><span style="color: #000000; background-color: #efcb05; ">participantNum, $</span><span style="color: #000000; background-color: #efcb05; ">lineItems);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">845</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">$</span><span style="color: #000000; background-color: #efcb05; ">this-&gt;</span><span style="color: #000000; background-color: #efcb05; ">assign</span><span style="color: #000000; background-color: #efcb05; ">(</span><span style="color: #000000; background-color: #efcb05; ">'lineItem'</span><span style="color: #000000; background-color: #efcb05; ">, $</span><span style="color: #000000; background-color: #efcb05; ">lineItem);</span></code></td>
<td class="ln">1123</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf17b16"> &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">$</span><span style="color: #000000; background-color: #efcb05; ">this-&gt;</span><span style="color: #000000; background-color: #efcb05; ">assign</span><span style="color: #000000; background-color: #efcb05; ">(</span><span style="color: #000000; background-color: #efcb05; ">'lineItem'</span><span style="color: #000000; background-color: #efcb05; ">, $</span><span style="color: #000000; background-color: #efcb05; ">lineItem);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">846</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">}</span></code></td>
<td class="ln">1124</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf17b16"> &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">847</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">$</span><span style="color: #000000; background-color: #efcb05; ">this-&gt;_values[</span><span style="color: #000000; background-color: #efcb05; ">'params'</span><span style="color: #000000; background-color: #efcb05; ">][</span><span style="color: #000000; background-color: #efcb05; ">'additionalParticipant'</span><span style="color: #000000; background-color: #efcb05; ">] = TRUE;</span></code></td>
<td class="ln">1125</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf17b16"> &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">$</span><span style="color: #000000; background-color: #efcb05; ">this-&gt;_values[</span><span style="color: #000000; background-color: #efcb05; ">'params'</span><span style="color: #000000; background-color: #efcb05; ">][</span><span style="color: #000000; background-color: #efcb05; ">'additionalParticipant'</span><span style="color: #000000; background-color: #efcb05; ">] = TRUE;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">848</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">}</span></code></td>
<td class="ln">1126</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf17b16"> &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">849</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16">
</span>&nbsp;</code></td>
<td class="ln">1127</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp;
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">850</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">//pass these variables since these are run time calculated.</span></code></td>
<td class="ln">1128</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf17b16"> &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">//pass these variables since these are run time calculated.</span></code></td>
</tr>
<tr valign="top">
<td class="ln">851</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">$</span><span style="color: #000000; background-color: #efcb05; ">this-&gt;_values[</span><span style="color: #000000; background-color: #efcb05; ">'params'</span><span style="color: #000000; background-color: #efcb05; ">][</span><span style="color: #000000; background-color: #efcb05; ">'isOnWaitlist'</span><span style="color: #000000; background-color: #efcb05; ">] = $</span><span style="color: #000000; background-color: #efcb05; ">this-&gt;_allowWaitlist;</span></code></td>
<td class="ln">1129</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf17b16"> &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">$</span><span style="color: #000000; background-color: #efcb05; ">this-&gt;_values[</span><span style="color: #000000; background-color: #efcb05; ">'params'</span><span style="color: #000000; background-color: #efcb05; ">][</span><span style="color: #000000; background-color: #efcb05; ">'isOnWaitlist'</span><span style="color: #000000; background-color: #efcb05; ">] = $</span><span style="color: #000000; background-color: #efcb05; ">this-&gt;_allowWaitlist;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">852</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">$</span><span style="color: #000000; background-color: #efcb05; ">this-&gt;_values[</span><span style="color: #000000; background-color: #efcb05; ">'params'</span><span style="color: #000000; background-color: #efcb05; ">][</span><span style="color: #000000; background-color: #efcb05; ">'isRequireApproval'</span><span style="color: #000000; background-color: #efcb05; ">] = $</span><span style="color: #000000; background-color: #efcb05; ">this-&gt;_requireApproval;</span></code></td>
<td class="ln">1130</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf17b16"> &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">$</span><span style="color: #000000; background-color: #efcb05; ">this-&gt;_values[</span><span style="color: #000000; background-color: #efcb05; ">'params'</span><span style="color: #000000; background-color: #efcb05; ">][</span><span style="color: #000000; background-color: #efcb05; ">'isRequireApproval'</span><span style="color: #000000; background-color: #efcb05; ">] = $</span><span style="color: #000000; background-color: #efcb05; ">this-&gt;_requireApproval;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">853</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16">
</span>&nbsp;</code></td>
<td class="ln">1131</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp;
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">854</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">//send mail to primary as well as additional participants.</span></code></td>
<td class="ln">1132</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf17b16"> &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">//send mail to primary as well as additional participants.</span></code></td>
</tr>
<tr valign="top">
<td class="ln">855</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">$</span><span style="color: #000000; background-color: #efcb05; ">this-&gt;</span><span style="color: #000000; background-color: #efcb05; ">assign</span><span style="color: #000000; background-color: #efcb05; ">(</span><span style="color: #000000; background-color: #efcb05; ">'contactID'</span><span style="color: #000000; background-color: #efcb05; ">, $</span><span style="color: #000000; background-color: #efcb05; ">contactId);</span></code></td>
<td class="ln">1133</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf17b16"> &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">$</span><span style="color: #000000; background-color: #efcb05; ">this-&gt;</span><span style="color: #000000; background-color: #efcb05; ">assign</span><span style="color: #000000; background-color: #efcb05; ">(</span><span style="color: #000000; background-color: #efcb05; ">'contactID'</span><span style="color: #000000; background-color: #efcb05; ">, $</span><span style="color: #000000; background-color: #efcb05; ">contactId);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">856</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">$</span><span style="color: #000000; background-color: #efcb05; ">this-&gt;</span><span style="color: #000000; background-color: #efcb05; ">assign</span><span style="color: #000000; background-color: #efcb05; ">(</span><span style="color: #000000; background-color: #efcb05; ">'participantID'</span><span style="color: #000000; background-color: #efcb05; ">, $</span><span style="color: #000000; background-color: #efcb05; ">participantID);</span></code></td>
<td class="ln">1134</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf17b16"> &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">$</span><span style="color: #000000; background-color: #efcb05; ">this-&gt;</span><span style="color: #000000; background-color: #efcb05; ">assign</span><span style="color: #000000; background-color: #efcb05; ">(</span><span style="color: #000000; background-color: #efcb05; ">'participantID'</span><span style="color: #000000; background-color: #efcb05; ">, $</span><span style="color: #000000; background-color: #efcb05; ">participantID);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">857</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">CRM_Event_BAO_Event::sendMail</span><span style="color: #000000; background-color: #efcb05; ">($</span><span style="color: #000000; background-color: #efcb05; ">contactId, $</span><span style="color: #000000; background-color: #efcb05; ">this-&gt;_values, $</span><span style="color: #000000; background-color: #efcb05; ">participantID, $</span><span style="color: #000000; background-color: #efcb05; ">isTest);</span></code></td>
<td class="ln">1135</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf17b16"> &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">CRM_Event_BAO_Event::sendMail</span><span style="color: #000000; background-color: #efcb05; ">($</span><span style="color: #000000; background-color: #efcb05; ">contactId, $</span><span style="color: #000000; background-color: #efcb05; ">this-&gt;_values, $</span><span style="color: #000000; background-color: #efcb05; ">participantID, $</span><span style="color: #000000; background-color: #efcb05; ">isTest);</span></code></td>
</tr>
<tr valign="top">
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">1136</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp; &nbsp; &nbsp; &nbsp;}
</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">858</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">1137</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">859</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; </span><span class="sf17b16">&nbsp;</span><span style="color: #000000; background-color: #efcb05; ">}</span></code></td>
<td class="ln">1138</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; </span><span style="color: #000000; background-color: #efcb05; ">}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">860</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp;}
</span>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">861</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf9b2">//end of function</span></code></td>
<td class="ln">1139</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf9b2">//end of function</span></code></td>
</tr>
<tr valign="top">
<td class="ln">862</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1140</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">863</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf9b2">/**</span></code></td>
<td class="ln">1141</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf9b2">/**</span></code></td>
</tr>
<tr valign="top">
<td class="ln">864</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * Process the contribution</span></code></td>
<td class="ln">1142</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * Process the contribution</span></code></td>
</tr>
<tr valign="top">
<td class="ln">865</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; *</span></code></td>
<td class="ln">1143</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; *</span></code></td>
</tr>
<tr valign="top">
<td class="ln">866</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @return void</span></code></td>
<td class="ln">1144</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @return void</span></code></td>
</tr>
<tr valign="top">
<td class="ln">867</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @access public</span></code></td>
<td class="ln">1145</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @access public</span></code></td>
</tr>
<tr valign="top">
<td class="ln">868</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; */</span>&nbsp;</code></td>
<td class="ln">1146</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; */</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">869</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf7b2">static</span></code></td>
<td class="ln">1147</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf7b2">static</span></code></td>
</tr>
<tr valign="top">
<td class="ln">870</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf7b2">function</span><span class="sf3b2"> </span><span class="sf8b2">processContribution</span><span class="sf3b2">(&amp;$</span><span class="sf18b2">form, $</span><span class="sf18b2">params, $</span><span class="sf18b2">result, $</span><span class="sf18b2">contactID,</span></code></td>
<td class="ln">1148</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf7b2">function</span><span class="sf3b2"> </span><span class="sf8b2">processContribution</span><span class="sf3b2">(&amp;$</span><span class="sf18b2">form, $</span><span class="sf18b2">params, $</span><span class="sf18b2">result, $</span><span class="sf18b2">contactID,</span></code></td>
</tr>
<tr valign="top">
<td class="ln">871</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">pending = FALSE, $</span><span class="sf18b2">isAdditionalAmount = FALSE</span></code></td>
<td class="ln">1149</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">pending = FALSE, $</span><span class="sf18b2">isAdditionalAmount = FALSE</span></code></td>
</tr>
<tr valign="top">
<td class="ln">872</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;) {</span></code></td>
<td class="ln">1150</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">873</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">require_once</span><span class="sf3b2"> </span><span class="sf12b2">'CRM/Core/Transaction.php'</span><span class="sf3b2">;</span></code></td>
<td class="ln">1151</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">require_once</span><span class="sf3b2"> </span><span class="sf12b2">'CRM/Core/Transaction.php'</span><span class="sf3b2">;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">874</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">transaction = </span><span class="sf7b2">new</span><span class="sf3b2"> </span><span class="sf8b2">CRM_Core_Transaction</span><span class="sf3b2">();</span></code></td>
<td class="ln">1152</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">transaction = </span><span class="sf7b2">new</span><span class="sf3b2"> </span><span class="sf8b2">CRM_Core_Transaction</span><span class="sf3b2">();</span></code></td>
</tr>
<tr valign="top">
<td class="ln">875</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1153</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">876</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">config &nbsp; &nbsp; &nbsp;= </span><span class="sf8b2">CRM_Core_Config::singleton</span><span class="sf3b2">();</span></code></td>
<td class="ln">1154</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">config &nbsp; &nbsp; &nbsp;= </span><span class="sf8b2">CRM_Core_Config::singleton</span><span class="sf3b2">();</span></code></td>
</tr>
<tr valign="top">
<td class="ln">877</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">now &nbsp; &nbsp; &nbsp; &nbsp; = </span><span class="sf8b2">date</span><span class="sf3b2">(</span><span class="sf12b2">'YmdHis'</span><span class="sf3b2">);</span></code></td>
<td class="ln">1155</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">now &nbsp; &nbsp; &nbsp; &nbsp; = </span><span class="sf8b2">date</span><span class="sf3b2">(</span><span class="sf12b2">'YmdHis'</span><span class="sf3b2">);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">878</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">receiptDate = NULL;</span></code></td>
<td class="ln">1156</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">receiptDate = NULL;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">879</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1157</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">880</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">form-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">][</span><span class="sf12b2">'is_email_confirm'</span><span class="sf3b2">]) {</span></code></td>
<td class="ln">1158</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">form-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">][</span><span class="sf12b2">'is_email_confirm'</span><span class="sf3b2">]) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">881</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">receiptDate = $</span><span class="sf18b2">now;</span></code></td>
<td class="ln">1159</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">receiptDate = $</span><span class="sf18b2">now;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">882</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">1160</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">883</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">//CRM-4196</span></code></td>
<td class="ln">1161</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">//CRM-4196</span></code></td>
</tr>
<tr valign="top">
<td class="ln">884</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">isAdditionalAmount) {</span></code></td>
<td class="ln">1162</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">isAdditionalAmount) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">885</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">params[</span><span class="sf12b2">'amount_level'</span><span class="sf3b2">] = $</span><span class="sf18b2">params[</span><span class="sf12b2">'amount_level'</span><span class="sf3b2">] </span><span class="sf8b2">. ts</span><span class="sf3b2">(</span><span class="sf12b2">' (multiple participants)'</span><span class="sf3b2">) . CRM_Core_DAO::VALUE_SEPARATOR;</span></code></td>
<td class="ln">1163</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">params[</span><span class="sf12b2">'amount_level'</span><span class="sf3b2">] = $</span><span class="sf18b2">params[</span><span class="sf12b2">'amount_level'</span><span class="sf3b2">] </span><span class="sf8b2">. ts</span><span class="sf3b2">(</span><span class="sf12b2">' (multiple participants)'</span><span class="sf3b2">) . CRM_Core_DAO::VALUE_SEPARATOR;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">886</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">1164</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">887</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1165</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">888</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">contribParams = </span><span class="sf7b2">array</span><span class="sf3b2">(</span></code></td>
<td class="ln">1166</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">contribParams = </span><span class="sf7b2">array</span><span class="sf3b2">(</span></code></td>
</tr>
<tr valign="top">
<td class="ln">889</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'contact_id'</span><span class="sf3b2"> =&gt; $</span><span class="sf18b2">contactID,</span></code></td>
<td class="ln">1167</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'contact_id'</span><span class="sf3b2"> =&gt; $</span><span class="sf18b2">contactID,</span></code></td>
</tr>
<tr valign="top">
<td class="ln">890</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'contribution_type_id'</span><span class="sf3b2"> =&gt; $</span><span class="sf18b2">form-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">][</span><span class="sf12b2">'contribution_type_id'</span><span class="sf3b2">] ?</span></code></td>
<td class="ln">1168</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'contribution_type_id'</span><span class="sf3b2"> =&gt; $</span><span class="sf18b2">form-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">][</span><span class="sf12b2">'contribution_type_id'</span><span class="sf3b2">] ?</span></code></td>
</tr>
<tr valign="top">
<td class="ln">891</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">form-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">][</span><span class="sf12b2">'contribution_type_id'</span><span class="sf3b2">] : $</span><span class="sf18b2">params[</span><span class="sf12b2">'contribution_type_id'</span><span class="sf3b2">],</span></code></td>
<td class="ln">1169</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">form-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">][</span><span class="sf12b2">'contribution_type_id'</span><span class="sf3b2">] : $</span><span class="sf18b2">params[</span><span class="sf12b2">'contribution_type_id'</span><span class="sf3b2">],</span></code></td>
</tr>
<tr valign="top">
<td class="ln">892</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'receive_date'</span><span class="sf3b2"> =&gt; $</span><span class="sf18b2">now,</span></code></td>
<td class="ln">1170</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'receive_date'</span><span class="sf3b2"> =&gt; $</span><span class="sf18b2">now,</span></code></td>
</tr>
<tr valign="top">
<td class="ln">893</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'total_amount'</span><span class="sf3b2"> =&gt; $</span><span class="sf18b2">params[</span><span class="sf12b2">'amount'</span><span class="sf3b2">],</span></code></td>
<td class="ln">1171</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'total_amount'</span><span class="sf3b2"> =&gt; $</span><span class="sf18b2">params[</span><span class="sf12b2">'amount'</span><span class="sf3b2">],</span></code></td>
</tr>
<tr valign="top">
<td class="ln">894</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'amount_level'</span><span class="sf3b2"> =&gt; $</span><span class="sf18b2">params[</span><span class="sf12b2">'amount_level'</span><span class="sf3b2">],</span></code></td>
<td class="ln">1172</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'amount_level'</span><span class="sf3b2"> =&gt; $</span><span class="sf18b2">params[</span><span class="sf12b2">'amount_level'</span><span class="sf3b2">],</span></code></td>
</tr>
<tr valign="top">
<td class="ln">895</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'invoice_id'</span><span class="sf3b2"> =&gt; $</span><span class="sf18b2">params[</span><span class="sf12b2">'invoiceID'</span><span class="sf3b2">],</span></code></td>
<td class="ln">1173</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'invoice_id'</span><span class="sf3b2"> =&gt; $</span><span class="sf18b2">params[</span><span class="sf12b2">'invoiceID'</span><span class="sf3b2">],</span></code></td>
</tr>
<tr valign="top">
<td class="ln">896</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'currency'</span><span class="sf3b2"> =&gt; $</span><span class="sf18b2">params[</span><span class="sf12b2">'currencyID'</span><span class="sf3b2">],</span></code></td>
<td class="ln">1174</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'currency'</span><span class="sf3b2"> =&gt; $</span><span class="sf18b2">params[</span><span class="sf12b2">'currencyID'</span><span class="sf3b2">],</span></code></td>
</tr>
<tr valign="top">
<td class="ln">897</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'source'</span><span class="sf3b2"> =&gt; $</span><span class="sf18b2">params[</span><span class="sf12b2">'description'</span><span class="sf3b2">],</span></code></td>
<td class="ln">1175</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'source'</span><span class="sf3b2"> =&gt; $</span><span class="sf18b2">params[</span><span class="sf12b2">'description'</span><span class="sf3b2">],</span></code></td>
</tr>
<tr valign="top">
<td class="ln">898</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'is_pay_later'</span><span class="sf3b2"> =&gt; </span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'is_pay_later'</span><span class="sf3b2">, $</span><span class="sf18b2">params, </span><span class="sf10b2">0</span><span class="sf3b2">),</span></code></td>
<td class="ln">1176</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'is_pay_later'</span><span class="sf3b2"> =&gt; </span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'is_pay_later'</span><span class="sf3b2">, $</span><span class="sf18b2">params, </span><span class="sf10b2">0</span><span class="sf3b2">),</span></code></td>
</tr>
<tr valign="top">
<td class="ln">899</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'campaign_id'</span><span class="sf3b2"> =&gt; </span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'campaign_id'</span><span class="sf3b2">, $</span><span class="sf18b2">params),</span></code></td>
<td class="ln">1177</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'campaign_id'</span><span class="sf3b2"> =&gt; </span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'campaign_id'</span><span class="sf3b2">, $</span><span class="sf18b2">params),</span></code></td>
</tr>
<tr valign="top">
<td class="ln">900</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;);</span></code></td>
<td class="ln">1178</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">901</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1179</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">902</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'is_pay_later'</span><span class="sf3b2">, $</span><span class="sf18b2">params)) {</span></code></td>
<td class="ln">1180</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'is_pay_later'</span><span class="sf3b2">, $</span><span class="sf18b2">params)) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">903</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">contribParams[</span><span class="sf12b2">'payment_instrument_id'</span><span class="sf3b2">] = </span><span class="sf10b2">1</span><span class="sf3b2">;</span></code></td>
<td class="ln">1181</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">contribParams[</span><span class="sf12b2">'payment_instrument_id'</span><span class="sf3b2">] = </span><span class="sf10b2">1</span><span class="sf3b2">;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">904</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">1182</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">905</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1183</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">906</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!$</span><span class="sf18b2">pending &amp;&amp; $</span><span class="sf18b2">result) {</span></code></td>
<td class="ln">1184</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!$</span><span class="sf18b2">pending &amp;&amp; $</span><span class="sf18b2">result) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">907</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">contribParams += </span><span class="sf7b2">array</span><span class="sf3b2">(</span></code></td>
<td class="ln">1185</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">contribParams += </span><span class="sf7b2">array</span><span class="sf3b2">(</span></code></td>
</tr>
<tr valign="top">
<td class="ln">908</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'fee_amount'</span><span class="sf3b2"> =&gt; </span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'fee_amount'</span><span class="sf3b2">, $</span><span class="sf18b2">result),</span></code></td>
<td class="ln">1186</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'fee_amount'</span><span class="sf3b2"> =&gt; </span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'fee_amount'</span><span class="sf3b2">, $</span><span class="sf18b2">result),</span></code></td>
</tr>
<tr valign="top">
<td class="ln">909</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'net_amount'</span><span class="sf3b2"> =&gt; </span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'net_amount'</span><span class="sf3b2">, $</span><span class="sf18b2">result, $</span><span class="sf18b2">params[</span><span class="sf12b2">'amount'</span><span class="sf3b2">]),</span></code></td>
<td class="ln">1187</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'net_amount'</span><span class="sf3b2"> =&gt; </span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'net_amount'</span><span class="sf3b2">, $</span><span class="sf18b2">result, $</span><span class="sf18b2">params[</span><span class="sf12b2">'amount'</span><span class="sf3b2">]),</span></code></td>
</tr>
<tr valign="top">
<td class="ln">910</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'trxn_id'</span><span class="sf3b2"> =&gt; $</span><span class="sf18b2">result[</span><span class="sf12b2">'trxn_id'</span><span class="sf3b2">],</span></code></td>
<td class="ln">1188</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'trxn_id'</span><span class="sf3b2"> =&gt; $</span><span class="sf18b2">result[</span><span class="sf12b2">'trxn_id'</span><span class="sf3b2">],</span></code></td>
</tr>
<tr valign="top">
<td class="ln">911</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'receipt_date'</span><span class="sf3b2"> =&gt; $</span><span class="sf18b2">receiptDate,</span></code></td>
<td class="ln">1189</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'receipt_date'</span><span class="sf3b2"> =&gt; $</span><span class="sf18b2">receiptDate,</span></code></td>
</tr>
<tr valign="top">
<td class="ln">912</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;);</span></code></td>
<td class="ln">1190</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">913</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">1191</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">914</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1192</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">915</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">allStatuses = </span><span class="sf8b2">CRM_Contribute_PseudoConstant::contributionStatus</span><span class="sf3b2">(N<wbr>ULL, </span><span class="sf12b2">'name'</span><span class="sf3b2">);</span></code></td>
<td class="ln">1193</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">allStatuses = </span><span class="sf8b2">CRM_Contribute_PseudoConstant::contributionStatus</span><span class="sf3b2">(N<wbr>ULL, </span><span class="sf12b2">'name'</span><span class="sf3b2">);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">916</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">contribParams[</span><span class="sf12b2">'contribution_status_id'</span><span class="sf3b2">] = </span><span class="sf8b2">array_search</span><span class="sf3b2">(</span><span class="sf12b2">'Completed'</span><span class="sf3b2">, $</span><span class="sf18b2">allStatuses);</span></code></td>
<td class="ln">1194</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">contribParams[</span><span class="sf12b2">'contribution_status_id'</span><span class="sf3b2">] = </span><span class="sf8b2">array_search</span><span class="sf3b2">(</span><span class="sf12b2">'Completed'</span><span class="sf3b2">, $</span><span class="sf18b2">allStatuses);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">917</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">pending) {</span></code></td>
<td class="ln">1195</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">pending) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">918</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">contribParams[</span><span class="sf12b2">'contribution_status_id'</span><span class="sf3b2">] = </span><span class="sf8b2">array_search</span><span class="sf3b2">(</span><span class="sf12b2">'Pending'</span><span class="sf3b2">, $</span><span class="sf18b2">allStatuses);</span></code></td>
<td class="ln">1196</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">contribParams[</span><span class="sf12b2">'contribution_status_id'</span><span class="sf3b2">] = </span><span class="sf8b2">array_search</span><span class="sf3b2">(</span><span class="sf12b2">'Pending'</span><span class="sf3b2">, $</span><span class="sf18b2">allStatuses);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">919</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">1197</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">920</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1198</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">921</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">contribParams[</span><span class="sf12b2">'is_test'</span><span class="sf3b2">] = </span><span class="sf10b2">0</span><span class="sf3b2">;</span></code></td>
<td class="ln">1199</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">contribParams[</span><span class="sf12b2">'is_test'</span><span class="sf3b2">] = </span><span class="sf10b2">0</span><span class="sf3b2">;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">922</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">form-&gt;</span><span class="sf8b2">_action &amp; CRM_Core_Action::PREVIEW || CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'mode'</span><span class="sf3b2">, $</span><span class="sf18b2">params) == </span><span class="sf12b2">'test'</span><span class="sf3b2">) {</span></code></td>
<td class="ln">1200</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">form-&gt;</span><span class="sf8b2">_action &amp; CRM_Core_Action::PREVIEW || CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'mode'</span><span class="sf3b2">, $</span><span class="sf18b2">params) == </span><span class="sf12b2">'test'</span><span class="sf3b2">) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">923</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">contribParams[</span><span class="sf12b2">'is_test'</span><span class="sf3b2">] = </span><span class="sf10b2">1</span><span class="sf3b2">;</span></code></td>
<td class="ln">1201</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">contribParams[</span><span class="sf12b2">'is_test'</span><span class="sf3b2">] = </span><span class="sf10b2">1</span><span class="sf3b2">;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">924</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">1202</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">925</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1203</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">926</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">contribID = NULL;</span></code></td>
<td class="ln">1204</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">contribID = NULL;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">927</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'invoice_id'</span><span class="sf3b2">, $</span><span class="sf18b2">contribParams)) {</span></code></td>
<td class="ln">1205</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'invoice_id'</span><span class="sf3b2">, $</span><span class="sf18b2">contribParams)) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">928</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">contribID = </span><span class="sf8b2">CRM_Core_DAO::getFieldValue</span><span class="sf3b2">(</span><span class="sf12b2">'CRM_Contribute_DAO_Con<wbr>tribution'</span><span class="sf3b2">,</span></code></td>
<td class="ln">1206</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">contribID = </span><span class="sf8b2">CRM_Core_DAO::getFieldValue</span><span class="sf3b2">(</span><span class="sf12b2">'CRM_Contribute_DAO_Con<wbr>tribution'</span><span class="sf3b2">,</span></code></td>
</tr>
<tr valign="top">
<td class="ln">929</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">contribParams[</span><span class="sf12b2">'invoice_id'</span><span class="sf3b2">],</span></code></td>
<td class="ln">1207</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">contribParams[</span><span class="sf12b2">'invoice_id'</span><span class="sf3b2">],</span></code></td>
</tr>
<tr valign="top">
<td class="ln">930</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'id'</span><span class="sf3b2">,</span></code></td>
<td class="ln">1208</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'id'</span><span class="sf3b2">,</span></code></td>
</tr>
<tr valign="top">
<td class="ln">931</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'invoice_id'</span>&nbsp;</code></td>
<td class="ln">1209</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'invoice_id'</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">932</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;);</span></code></td>
<td class="ln">1210</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">933</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">1211</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">934</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1212</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">935</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">ids = </span><span class="sf7b2">array</span><span class="sf3b2">();</span></code></td>
<td class="ln">1213</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">ids = </span><span class="sf7b2">array</span><span class="sf3b2">();</span></code></td>
</tr>
<tr valign="top">
<td class="ln">936</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">contribID) {</span></code></td>
<td class="ln">1214</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">contribID) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">937</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">ids[</span><span class="sf12b2">'contribution'</span><span class="sf3b2">] = $</span><span class="sf18b2">contribID;</span></code></td>
<td class="ln">1215</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">ids[</span><span class="sf12b2">'contribution'</span><span class="sf3b2">] = $</span><span class="sf18b2">contribID;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">938</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">contribParams[</span><span class="sf12b2">'id'</span><span class="sf3b2">] = $</span><span class="sf18b2">contribID;</span></code></td>
<td class="ln">1216</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">contribParams[</span><span class="sf12b2">'id'</span><span class="sf3b2">] = $</span><span class="sf18b2">contribID;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">939</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">1217</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">940</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1218</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">941</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">//create an contribution address</span></code></td>
<td class="ln">1219</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">//create an contribution address</span></code></td>
</tr>
<tr valign="top">
<td class="ln">942</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">form-&gt;_contributeMode != </span><span class="sf12b2">'notify'</span><span class="sf3b2"> &amp;&amp; !CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'is_pay_later'</span><span class="sf3b2">, $</span><span class="sf18b2">params)) {</span></code></td>
<td class="ln">1220</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">form-&gt;_contributeMode != </span><span class="sf12b2">'notify'</span><span class="sf3b2"> &amp;&amp; !CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'is_pay_later'</span><span class="sf3b2">, $</span><span class="sf18b2">params)) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">943</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">contribParams[</span><span class="sf12b2">'address_id'</span><span class="sf3b2">] = </span><span class="sf8b2">CRM_Contribute_BAO_Contribution::createAddress</span><span class="sf3b2">($</span><span class="sf18b2">par<wbr>ams, $</span><span class="sf18b2">form-&gt;_bltID);</span></code></td>
<td class="ln">1221</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">contribParams[</span><span class="sf12b2">'address_id'</span><span class="sf3b2">] = </span><span class="sf8b2">CRM_Contribute_BAO_Contribution::createAddress</span><span class="sf3b2">($</span><span class="sf18b2">par<wbr>ams, $</span><span class="sf18b2">form-&gt;_bltID);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">944</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">1222</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">945</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1223</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">946</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// Prepare soft contribution due to pcp or Submit Credit / Debit Card Contribution by admin.</span></code></td>
<td class="ln">1224</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// Prepare soft contribution due to pcp or Submit Credit / Debit Card Contribution by admin.</span></code></td>
</tr>
<tr valign="top">
<td class="ln">947</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'pcp_made_through_id'</span><span class="sf3b2">, $</span><span class="sf18b2">params) ||</span></code></td>
<td class="ln">1225</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'pcp_made_through_id'</span><span class="sf3b2">, $</span><span class="sf18b2">params) ||</span></code></td>
</tr>
<tr valign="top">
<td class="ln">948</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'soft_credit_to'</span><span class="sf3b2">, $</span><span class="sf18b2">params)</span></code></td>
<td class="ln">1226</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'soft_credit_to'</span><span class="sf3b2">, $</span><span class="sf18b2">params)</span></code></td>
</tr>
<tr valign="top">
<td class="ln">949</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;) {</span></code></td>
<td class="ln">1227</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">950</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1228</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">951</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">// if its due to pcp</span></code></td>
<td class="ln">1229</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">// if its due to pcp</span></code></td>
</tr>
<tr valign="top">
<td class="ln">952</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'pcp_made_through_id'</span><span class="sf3b2">, $</span><span class="sf18b2">params)) {</span></code></td>
<td class="ln">1230</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'pcp_made_through_id'</span><span class="sf3b2">, $</span><span class="sf18b2">params)) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">953</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">contribSoftContactId = </span><span class="sf8b2">CRM_Core_DAO::getFieldValue</span><span class="sf3b2">(</span><span class="sf12b2">'CRM_PCP_DAO_PCP'</span><span class="sf3b2">,</span></code></td>
<td class="ln">1231</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">contribSoftContactId = </span><span class="sf8b2">CRM_Core_DAO::getFieldValue</span><span class="sf3b2">(</span><span class="sf12b2">'CRM_PCP_DAO_PCP'</span><span class="sf3b2">,</span></code></td>
</tr>
<tr valign="top">
<td class="ln">954</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">params[</span><span class="sf12b2">'pcp_made_through_id'</span><span class="sf3b2">],</span></code></td>
<td class="ln">1232</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">params[</span><span class="sf12b2">'pcp_made_through_id'</span><span class="sf3b2">],</span></code></td>
</tr>
<tr valign="top">
<td class="ln">955</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'contact_id'</span>&nbsp;</code></td>
<td class="ln">1233</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'contact_id'</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">956</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;);</span></code></td>
<td class="ln">1234</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">957</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">1235</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">958</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">else</span><span class="sf3b2"> {</span></code></td>
<td class="ln">1236</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">else</span><span class="sf3b2"> {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">959</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">contribSoftContactId = </span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'soft_credit_to'</span><span class="sf3b2">, $</span><span class="sf18b2">params);</span></code></td>
<td class="ln">1237</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">contribSoftContactId = </span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'soft_credit_to'</span><span class="sf3b2">, $</span><span class="sf18b2">params);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">960</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">1238</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">961</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1239</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">962</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">// Pass these details onto with the contribution to make them</span></code></td>
<td class="ln">1240</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">// Pass these details onto with the contribution to make them</span></code></td>
</tr>
<tr valign="top">
<td class="ln">963</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">// available at hook_post_process, CRM-8908</span></code></td>
<td class="ln">1241</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">// available at hook_post_process, CRM-8908</span></code></td>
</tr>
<tr valign="top">
<td class="ln">964</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">contribParams[</span><span class="sf12b2">'soft_credit_to'</span><span class="sf3b2">] = $</span><span class="sf18b2">params[</span><span class="sf12b2">'soft_credit_to'</span><span class="sf3b2">] = $</span><span class="sf18b2">contribSoftContactId;</span></code></td>
<td class="ln">1242</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">contribParams[</span><span class="sf12b2">'soft_credit_to'</span><span class="sf3b2">] = $</span><span class="sf18b2">params[</span><span class="sf12b2">'soft_credit_to'</span><span class="sf3b2">] = $</span><span class="sf18b2">contribSoftContactId;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">965</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">1243</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">966</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1244</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">967</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// create contribution record</span></code></td>
<td class="ln">1245</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// create contribution record</span></code></td>
</tr>
<tr valign="top">
<td class="ln">968</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">contribution = </span><span class="sf8b2">CRM_Contribute_BAO_Contribution::add</span><span class="sf3b2">($</span><span class="sf18b2">contribParams<wbr>, $</span><span class="sf18b2">ids);</span></code></td>
<td class="ln">1246</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">contribution = </span><span class="sf8b2">CRM_Contribute_BAO_Contribution::add</span><span class="sf3b2">($</span><span class="sf18b2">contribParams<wbr>, $</span><span class="sf18b2">ids);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">969</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1247</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">970</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// process soft credit / pcp pages</span></code></td>
<td class="ln">1248</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// process soft credit / pcp pages</span></code></td>
</tr>
<tr valign="top">
<td class="ln">971</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf8b2">CRM_Contribute_Form_Contribution_Confirm::processPc<wbr>pSoft</span><span class="sf3b2">($</span><span class="sf18b2">params, $</span><span class="sf18b2">contribution);</span></code></td>
<td class="ln">1249</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf8b2">CRM_Contribute_Form_Contribution_Confirm::processPc<wbr>pSoft</span><span class="sf3b2">($</span><span class="sf18b2">params, $</span><span class="sf18b2">contribution);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">972</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1250</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">973</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// return if pending</span></code></td>
<td class="ln">1251</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// return if pending</span></code></td>
</tr>
<tr valign="top">
<td class="ln">974</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">pending || ($</span><span class="sf18b2">contribution-&gt;total_amount == 0)) {</span></code></td>
<td class="ln">1252</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">pending || ($</span><span class="sf18b2">contribution-&gt;total_amount == 0)) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">975</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">transaction-&gt;</span><span class="sf8b2">commit</span><span class="sf3b2">();</span></code></td>
<td class="ln">1253</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">transaction-&gt;</span><span class="sf8b2">commit</span><span class="sf3b2">();</span></code></td>
</tr>
<tr valign="top">
<td class="ln">976</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">return</span><span class="sf3b2"> $</span><span class="sf18b2">contribution;</span></code></td>
<td class="ln">1254</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">return</span><span class="sf3b2"> $</span><span class="sf18b2">contribution;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">977</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">1255</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">978</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1256</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">979</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// next create the transaction record</span></code></td>
<td class="ln">1257</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// next create the transaction record</span></code></td>
</tr>
<tr valign="top">
<td class="ln">980</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">trxnParams = </span><span class="sf7b2">array</span><span class="sf3b2">(</span></code></td>
<td class="ln">1258</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">trxnParams = </span><span class="sf7b2">array</span><span class="sf3b2">(</span></code></td>
</tr>
<tr valign="top">
<td class="ln">981</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'contribution_id'</span><span class="sf3b2"> =&gt; $</span><span class="sf18b2">contribution-&gt;id,</span></code></td>
<td class="ln">1259</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'contribution_id'</span><span class="sf3b2"> =&gt; $</span><span class="sf18b2">contribution-&gt;id,</span></code></td>
</tr>
<tr valign="top">
<td class="ln">982</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'trxn_date'</span><span class="sf3b2"> =&gt; $</span><span class="sf18b2">now,</span></code></td>
<td class="ln">1260</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'trxn_date'</span><span class="sf3b2"> =&gt; $</span><span class="sf18b2">now,</span></code></td>
</tr>
<tr valign="top">
<td class="ln">983</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'trxn_type'</span><span class="sf3b2"> =&gt; </span><span class="sf12b2">'Debit'</span><span class="sf3b2">,</span></code></td>
<td class="ln">1261</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'trxn_type'</span><span class="sf3b2"> =&gt; </span><span class="sf12b2">'Debit'</span><span class="sf3b2">,</span></code></td>
</tr>
<tr valign="top">
<td class="ln">984</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'total_amount'</span><span class="sf3b2"> =&gt; $</span><span class="sf18b2">params[</span><span class="sf12b2">'amount'</span><span class="sf3b2">],</span></code></td>
<td class="ln">1262</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'total_amount'</span><span class="sf3b2"> =&gt; $</span><span class="sf18b2">params[</span><span class="sf12b2">'amount'</span><span class="sf3b2">],</span></code></td>
</tr>
<tr valign="top">
<td class="ln">985</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'fee_amount'</span><span class="sf3b2"> =&gt; </span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'fee_amount'</span><span class="sf3b2">, $</span><span class="sf18b2">result),</span></code></td>
<td class="ln">1263</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'fee_amount'</span><span class="sf3b2"> =&gt; </span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'fee_amount'</span><span class="sf3b2">, $</span><span class="sf18b2">result),</span></code></td>
</tr>
<tr valign="top">
<td class="ln">986</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'net_amount'</span><span class="sf3b2"> =&gt; </span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'net_amount'</span><span class="sf3b2">, $</span><span class="sf18b2">result, $</span><span class="sf18b2">params[</span><span class="sf12b2">'amount'</span><span class="sf3b2">]),</span></code></td>
<td class="ln">1264</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'net_amount'</span><span class="sf3b2"> =&gt; </span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'net_amount'</span><span class="sf3b2">, $</span><span class="sf18b2">result, $</span><span class="sf18b2">params[</span><span class="sf12b2">'amount'</span><span class="sf3b2">]),</span></code></td>
</tr>
<tr valign="top">
<td class="ln">987</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'currency'</span><span class="sf3b2"> =&gt; $</span><span class="sf18b2">params[</span><span class="sf12b2">'currencyID'</span><span class="sf3b2">],</span></code></td>
<td class="ln">1265</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'currency'</span><span class="sf3b2"> =&gt; $</span><span class="sf18b2">params[</span><span class="sf12b2">'currencyID'</span><span class="sf3b2">],</span></code></td>
</tr>
<tr valign="top">
<td class="ln">988</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'payment_processor'</span><span class="sf3b2"> =&gt; $</span><span class="sf18b2">form-&gt;_paymentProcessor[</span><span class="sf12b2">'payment_processor_type'</span><span class="sf3b2">],<wbr></span></code></td>
<td class="ln">1266</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'payment_processor'</span><span class="sf3b2"> =&gt; $</span><span class="sf18b2">form-&gt;_paymentProcessor[</span><span class="sf12b2">'payment_processor_type'</span><span class="sf3b2">],<wbr></span></code></td>
</tr>
<tr valign="top">
<td class="ln">989</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'trxn_id'</span><span class="sf3b2"> =&gt; $</span><span class="sf18b2">result[</span><span class="sf12b2">'trxn_id'</span><span class="sf3b2">],</span></code></td>
<td class="ln">1267</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'trxn_id'</span><span class="sf3b2"> =&gt; $</span><span class="sf18b2">result[</span><span class="sf12b2">'trxn_id'</span><span class="sf3b2">],</span></code></td>
</tr>
<tr valign="top">
<td class="ln">990</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;);</span></code></td>
<td class="ln">1268</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">991</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1269</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">992</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">trxn = </span><span class="sf8b2">CRM_Core_BAO_FinancialTrxn::create</span><span class="sf3b2">($</span><span class="sf18b2">trxnParams);</span></code></td>
<td class="ln">1270</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">trxn = </span><span class="sf8b2">CRM_Core_BAO_FinancialTrxn::create</span><span class="sf3b2">($</span><span class="sf18b2">trxnParams);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">993</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1271</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">994</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">transaction-&gt;</span><span class="sf8b2">commit</span><span class="sf3b2">();</span></code></td>
<td class="ln">1272</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">transaction-&gt;</span><span class="sf8b2">commit</span><span class="sf3b2">();</span></code></td>
</tr>
<tr valign="top">
<td class="ln">995</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1273</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">996</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">return</span><span class="sf3b2"> $</span><span class="sf18b2">contribution;</span></code></td>
<td class="ln">1274</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">return</span><span class="sf3b2"> $</span><span class="sf18b2">contribution;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">997</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;}</span></code></td>
<td class="ln">1275</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">998</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1276</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">999</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf9b2">/**</span></code></td>
<td class="ln">1277</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf9b2">/**</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1000</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * Fix the Location Fields</span></code></td>
<td class="ln">1278</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * Fix the Location Fields</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1001</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; *</span></code></td>
<td class="ln">1279</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; *</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1002</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @return void</span></code></td>
<td class="ln">1280</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @return void</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1003</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @access public</span></code></td>
<td class="ln">1281</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @access public</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1004</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; */</span>&nbsp;</code></td>
<td class="ln">1282</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; */</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">1005</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf8b2">public function fixLocationFields</span><span class="sf3b2">(&amp;$</span><span class="sf18b2">params, &amp;$</span><span class="sf18b2">fields) {</span></code></td>
<td class="ln">1283</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf8b2">public function fixLocationFields</span><span class="sf3b2">(&amp;$</span><span class="sf18b2">params, &amp;$</span><span class="sf18b2">fields) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1006</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!</span><span class="sf7b2">empty</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;_fields)) {</span></code></td>
<td class="ln">1284</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!</span><span class="sf7b2">empty</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;_fields)) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1007</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">foreach</span><span class="sf3b2"> ($</span><span class="sf18b2">this-&gt;_fields as $</span><span class="sf18b2">name =&gt; $</span><span class="sf18b2">dontCare) {</span></code></td>
<td class="ln">1285</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">foreach</span><span class="sf3b2"> ($</span><span class="sf18b2">this-&gt;_fields as $</span><span class="sf18b2">name =&gt; $</span><span class="sf18b2">dontCare) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1008</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">fields[$</span><span class="sf18b2">name] = </span><span class="sf10b2">1</span><span class="sf3b2">;</span></code></td>
<td class="ln">1286</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">fields[$</span><span class="sf18b2">name] = </span><span class="sf10b2">1</span><span class="sf3b2">;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1009</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">1287</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1010</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">1288</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1011</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1289</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">1012</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">is_array</span><span class="sf3b2">($</span><span class="sf18b2">fields)) {</span></code></td>
<td class="ln">1290</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">is_array</span><span class="sf3b2">($</span><span class="sf18b2">fields)) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1013</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!</span><span class="sf8b2">array_key_exists</span><span class="sf3b2">(</span><span class="sf12b2">'first_name'</span><span class="sf3b2">, $</span><span class="sf18b2">fields)) {</span></code></td>
<td class="ln">1291</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!</span><span class="sf8b2">array_key_exists</span><span class="sf3b2">(</span><span class="sf12b2">'first_name'</span><span class="sf3b2">, $</span><span class="sf18b2">fields)) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1014</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">nameFields = </span><span class="sf7b2">array</span><span class="sf3b2">(</span><span class="sf12b2">'first_name'</span><span class="sf3b2">, </span><span class="sf12b2">'middle_name'</span><span class="sf3b2">, </span><span class="sf12b2">'last_name'</span><span class="sf3b2">);</span></code></td>
<td class="ln">1292</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">nameFields = </span><span class="sf7b2">array</span><span class="sf3b2">(</span><span class="sf12b2">'first_name'</span><span class="sf3b2">, </span><span class="sf12b2">'middle_name'</span><span class="sf3b2">, </span><span class="sf12b2">'last_name'</span><span class="sf3b2">);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1015</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">foreach</span><span class="sf3b2"> ($</span><span class="sf18b2">nameFields </span><span class="sf7b2">as</span><span class="sf3b2"> $</span><span class="sf18b2">name) {</span></code></td>
<td class="ln">1293</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">foreach</span><span class="sf3b2"> ($</span><span class="sf18b2">nameFields </span><span class="sf7b2">as</span><span class="sf3b2"> $</span><span class="sf18b2">name) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1016</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">fields[$</span><span class="sf18b2">name] = </span><span class="sf10b2">1</span><span class="sf3b2">;</span></code></td>
<td class="ln">1294</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">fields[$</span><span class="sf18b2">name] = </span><span class="sf10b2">1</span><span class="sf3b2">;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1017</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">array_key_exists</span><span class="sf3b2">(</span><span class="sf12b2">"billing_$name"</span><span class="sf3b2">, $</span><span class="sf18b2">params)) {</span></code></td>
<td class="ln">1295</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">array_key_exists</span><span class="sf3b2">(</span><span class="sf12b2">"billing_$name"</span><span class="sf3b2">, $</span><span class="sf18b2">params)) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1018</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">params[$</span><span class="sf18b2">name] = $</span><span class="sf18b2">params[</span><span class="sf12b2">"billing_{$name}"</span><span class="sf3b2">];</span></code></td>
<td class="ln">1296</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">params[$</span><span class="sf18b2">name] = $</span><span class="sf18b2">params[</span><span class="sf12b2">"billing_{$name}"</span><span class="sf3b2">];</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1019</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">params[</span><span class="sf12b2">'preserveDBName'</span><span class="sf3b2">] = TRUE;</span></code></td>
<td class="ln">1297</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">params[</span><span class="sf12b2">'preserveDBName'</span><span class="sf3b2">] = TRUE;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1020</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">1298</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1021</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">1299</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1022</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">1300</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1023</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">1301</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1024</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1302</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">1025</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// also add location name to the array</span></code></td>
<td class="ln">1303</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// also add location name to the array</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1026</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">][</span><span class="sf12b2">'is_monetary'</span><span class="sf3b2">]) {</span></code></td>
<td class="ln">1304</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">][</span><span class="sf12b2">'is_monetary'</span><span class="sf3b2">]) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1027</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">params[</span><span class="sf12b2">"address_name-{$this-&gt;_bltID}"</span><span class="sf3b2">] = </span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'billing_first_name'</span><span class="sf3b2">, $</span><span class="sf18b2">params) . </span><span class="sf12b2">' '</span><span class="sf3b2"> . CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'billing_middle_name'</span><span class="sf3b2">, $</span><span class="sf18b2">params) . </span><span class="sf12b2">' '</span><span class="sf3b2"> . CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'billing_last_name'</span><span class="sf3b2">, $</span><span class="sf18b2">params);</span></code></td>
<td class="ln">1305</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">params[</span><span class="sf12b2">"address_name-{$this-&gt;_bltID}"</span><span class="sf3b2">] = </span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'billing_first_name'</span><span class="sf3b2">, $</span><span class="sf18b2">params) . </span><span class="sf12b2">' '</span><span class="sf3b2"> . CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'billing_middle_name'</span><span class="sf3b2">, $</span><span class="sf18b2">params) . </span><span class="sf12b2">' '</span><span class="sf3b2"> . CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'billing_last_name'</span><span class="sf3b2">, $</span><span class="sf18b2">params);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1028</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">fields[</span><span class="sf12b2">"address_name-{$this-&gt;_bltID}"</span><span class="sf3b2">] = </span><span class="sf10b2">1</span><span class="sf3b2">;</span></code></td>
<td class="ln">1306</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">fields[</span><span class="sf12b2">"address_name-{$this-&gt;_bltID}"</span><span class="sf3b2">] = </span><span class="sf10b2">1</span><span class="sf3b2">;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1029</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">1307</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1030</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">fields[</span><span class="sf12b2">"email-{$this-&gt;_bltID}"</span><span class="sf3b2">] = </span><span class="sf10b2">1</span><span class="sf3b2">;</span></code></td>
<td class="ln">1308</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">fields[</span><span class="sf12b2">"email-{$this-&gt;_bltID}"</span><span class="sf3b2">] = </span><span class="sf10b2">1</span><span class="sf3b2">;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1031</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">fields[</span><span class="sf12b2">'email-Primary'</span><span class="sf3b2">] = </span><span class="sf10b2">1</span><span class="sf3b2">;</span></code></td>
<td class="ln">1309</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">fields[</span><span class="sf12b2">'email-Primary'</span><span class="sf3b2">] = </span><span class="sf10b2">1</span><span class="sf3b2">;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1032</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1310</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">1033</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">//if its pay later or additional participant set email address as primary.</span></code></td>
<td class="ln">1311</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">//if its pay later or additional participant set email address as primary.</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1034</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ((</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'is_pay_later'</span><span class="sf3b2">, $</span><span class="sf18b2">params) ||</span></code></td>
<td class="ln">1312</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ((</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'is_pay_later'</span><span class="sf3b2">, $</span><span class="sf18b2">params) ||</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1035</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;!</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'is_primary'</span><span class="sf3b2">, $</span><span class="sf18b2">params) ||</span></code></td>
<td class="ln">1313</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;!</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'is_primary'</span><span class="sf3b2">, $</span><span class="sf18b2">params) ||</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1036</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;!$</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">][</span><span class="sf12b2">'is_monetary'</span><span class="sf3b2">] ||</span></code></td>
<td class="ln">1314</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;!$</span><span class="sf18b2">this-&gt;_values[</span><span class="sf12b2">'event'</span><span class="sf3b2">][</span><span class="sf12b2">'is_monetary'</span><span class="sf3b2">] ||</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1037</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_allowWaitlist ||</span></code></td>
<td class="ln">1315</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_allowWaitlist ||</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1038</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_requireApproval</span></code></td>
<td class="ln">1316</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;_requireApproval</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1039</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;) &amp;&amp;</span></code></td>
<td class="ln">1317</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;) &amp;&amp;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1040</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">"email-{$this-&gt;_bltID}"</span><span class="sf3b2">, $</span><span class="sf18b2">params)</span></code></td>
<td class="ln">1318</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">"email-{$this-&gt;_bltID}"</span><span class="sf3b2">, $</span><span class="sf18b2">params)</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1041</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;) {</span></code></td>
<td class="ln">1319</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1042</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">params[</span><span class="sf12b2">'email-Primary'</span><span class="sf3b2">] = $</span><span class="sf18b2">params[</span><span class="sf12b2">"email-{$this-&gt;_bltID}"</span><span class="sf3b2">];</span></code></td>
<td class="ln">1320</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">params[</span><span class="sf12b2">'email-Primary'</span><span class="sf3b2">] = $</span><span class="sf18b2">params[</span><span class="sf12b2">"email-{$this-&gt;_bltID}"</span><span class="sf3b2">];</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1043</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">1321</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1044</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;}</span></code></td>
<td class="ln">1322</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1045</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1323</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">1046</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf9b2">/**</span></code></td>
<td class="ln">1324</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf9b2">/**</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1047</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * function to update contact fields</span></code></td>
<td class="ln">1325</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * function to update contact fields</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1048</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; *</span></code></td>
<td class="ln">1326</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; *</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1049</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @return void</span></code></td>
<td class="ln">1327</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @return void</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1050</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @access public</span></code></td>
<td class="ln">1328</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * @access public</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1051</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; */</span>&nbsp;</code></td>
<td class="ln">1329</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; */</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">1052</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf8b2">public function updateContactFields</span><span class="sf3b2">($</span><span class="sf18b2">contactID, $</span><span class="sf18b2">params, $</span><span class="sf18b2">fields) {</span></code></td>
<td class="ln">1330</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;</span><span class="sf8b2">public function updateContactFields</span><span class="sf3b2">($</span><span class="sf18b2">contactID, $</span><span class="sf18b2">params, $</span><span class="sf18b2">fields) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1053</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">//add the contact to group, if add to group is selected for a</span></code></td>
<td class="ln">1331</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">//add the contact to group, if add to group is selected for a</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1054</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">//particular uf group</span></code></td>
<td class="ln">1332</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">//particular uf group</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1055</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1333</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">1056</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// get the add to groups</span></code></td>
<td class="ln">1334</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// get the add to groups</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1057</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">addToGroups = </span><span class="sf7b2">array</span><span class="sf3b2">();</span></code></td>
<td class="ln">1335</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">addToGroups = </span><span class="sf7b2">array</span><span class="sf3b2">();</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1058</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1336</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">1059</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!</span><span class="sf7b2">empty</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;_fields)) {</span></code></td>
<td class="ln">1337</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!</span><span class="sf7b2">empty</span><span class="sf3b2">($</span><span class="sf18b2">this-&gt;_fields)) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1060</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">foreach</span><span class="sf3b2"> ($</span><span class="sf18b2">this-&gt;_fields as $</span><span class="sf18b2">key =&gt; $</span><span class="sf18b2">value) {</span></code></td>
<td class="ln">1338</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">foreach</span><span class="sf3b2"> ($</span><span class="sf18b2">this-&gt;_fields as $</span><span class="sf18b2">key =&gt; $</span><span class="sf18b2">value) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1061</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'add_to_group_id'</span><span class="sf3b2">, $</span><span class="sf18b2">value)) {</span></code></td>
<td class="ln">1339</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'add_to_group_id'</span><span class="sf3b2">, $</span><span class="sf18b2">value)) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1062</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">addToGroups[$</span><span class="sf18b2">value[</span><span class="sf12b2">'add_to_group_id'</span><span class="sf3b2">]] = $</span><span class="sf18b2">value[</span><span class="sf12b2">'add_to_group_id'</span><span class="sf3b2">];</span></code></td>
<td class="ln">1340</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">addToGroups[$</span><span class="sf18b2">value[</span><span class="sf12b2">'add_to_group_id'</span><span class="sf3b2">]] = $</span><span class="sf18b2">value[</span><span class="sf12b2">'add_to_group_id'</span><span class="sf3b2">];</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1063</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">1341</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1064</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">1342</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1065</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">1343</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1066</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1344</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">1067</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// check for profile double opt-in and get groups to be subscribed</span></code></td>
<td class="ln">1345</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// check for profile double opt-in and get groups to be subscribed</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1068</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">subscribeGroupIds = </span><span class="sf8b2">CRM_Core_BAO_UFGroup::getDoubleOptInGroupIds</span><span class="sf3b2">($</span><span class="sf18b2">param<wbr>s, $</span><span class="sf18b2">contactID);</span></code></td>
<td class="ln">1346</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">subscribeGroupIds = </span><span class="sf8b2">CRM_Core_BAO_UFGroup::getDoubleOptInGroupIds</span><span class="sf3b2">($</span><span class="sf18b2">param<wbr>s, $</span><span class="sf18b2">contactID);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1069</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1347</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">1070</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">foreach</span><span class="sf3b2"> ($</span><span class="sf18b2">addToGroups </span><span class="sf7b2">as</span><span class="sf3b2"> $</span><span class="sf18b2">k) {</span></code></td>
<td class="ln">1348</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">foreach</span><span class="sf3b2"> ($</span><span class="sf18b2">addToGroups </span><span class="sf7b2">as</span><span class="sf3b2"> $</span><span class="sf18b2">k) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1071</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">array_key_exists</span><span class="sf3b2">($</span><span class="sf18b2">k, $</span><span class="sf18b2">subscribeGroupIds)) {</span></code></td>
<td class="ln">1349</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf8b2">array_key_exists</span><span class="sf3b2">($</span><span class="sf18b2">k, $</span><span class="sf18b2">subscribeGroupIds)) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1072</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">unset</span><span class="sf3b2">($</span><span class="sf18b2">addToGroups[$</span><span class="sf18b2">k]);</span></code></td>
<td class="ln">1350</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">unset</span><span class="sf3b2">($</span><span class="sf18b2">addToGroups[$</span><span class="sf18b2">k]);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1073</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">1351</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1074</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">1352</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1075</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1353</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">1076</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// since we are directly adding contact to group lets unset it from mailing</span></code></td>
<td class="ln">1354</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// since we are directly adding contact to group lets unset it from mailing</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1077</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!</span><span class="sf7b2">empty</span><span class="sf3b2">($</span><span class="sf18b2">addToGroups)) {</span></code></td>
<td class="ln">1355</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!</span><span class="sf7b2">empty</span><span class="sf3b2">($</span><span class="sf18b2">addToGroups)) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1078</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">foreach</span><span class="sf3b2"> ($</span><span class="sf18b2">addToGroups </span><span class="sf7b2">as</span><span class="sf3b2"> $</span><span class="sf18b2">groupId) {</span></code></td>
<td class="ln">1356</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">foreach</span><span class="sf3b2"> ($</span><span class="sf18b2">addToGroups </span><span class="sf7b2">as</span><span class="sf3b2"> $</span><span class="sf18b2">groupId) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1079</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf7b2">isset</span><span class="sf3b2">($</span><span class="sf18b2">subscribeGroupIds[$</span><span class="sf18b2">groupId])) {</span></code></td>
<td class="ln">1357</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (</span><span class="sf7b2">isset</span><span class="sf3b2">($</span><span class="sf18b2">subscribeGroupIds[$</span><span class="sf18b2">groupId])) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1080</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">unset</span><span class="sf3b2">($</span><span class="sf18b2">subscribeGroupIds[$</span><span class="sf18b2">groupId]);</span></code></td>
<td class="ln">1358</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">unset</span><span class="sf3b2">($</span><span class="sf18b2">subscribeGroupIds[$</span><span class="sf18b2">groupId]);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1081</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">1359</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1082</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">1360</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1083</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">1361</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1084</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">contactID) {</span></code></td>
<td class="ln">1362</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> ($</span><span class="sf18b2">contactID) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1085</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">ctype = </span><span class="sf8b2">CRM_Core_DAO::getFieldValue</span><span class="sf3b2">(</span><span class="sf12b2">'CRM_Contact_DAO_Contac<wbr>t'</span><span class="sf3b2">,</span></code></td>
<td class="ln">1363</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">ctype = </span><span class="sf8b2">CRM_Core_DAO::getFieldValue</span><span class="sf3b2">(</span><span class="sf12b2">'CRM_Contact_DAO_Contac<wbr>t'</span><span class="sf3b2">,</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1086</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">contactID,</span></code></td>
<td class="ln">1364</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">contactID,</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1087</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'contact_type'</span>&nbsp;</code></td>
<td class="ln">1365</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">'contact_type'</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">1088</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;);</span></code></td>
<td class="ln">1366</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1089</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">contactID = &amp;</span><span class="sf8b2">CRM_Contact_BAO_Contact::createProfileContact</span><span class="sf3b2">($</span><span class="sf18b2">par<wbr>ams,</span></code></td>
<td class="ln">1367</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">contactID = &amp;</span><span class="sf8b2">CRM_Contact_BAO_Contact::createProfileContact</span><span class="sf3b2">($</span><span class="sf18b2">par<wbr>ams,</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1090</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">fields,</span></code></td>
<td class="ln">1368</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">fields,</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1091</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">contactID,</span></code></td>
<td class="ln">1369</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">contactID,</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1092</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">addToGroups,</span></code></td>
<td class="ln">1370</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">addToGroups,</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1093</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;NULL,</span></code></td>
<td class="ln">1371</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;NULL,</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1094</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">ctype,</span></code></td>
<td class="ln">1372</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">ctype,</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1095</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;TRUE</span></code></td>
<td class="ln">1373</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;TRUE</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1096</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;);</span></code></td>
<td class="ln">1374</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1097</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">1375</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1098</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">else</span><span class="sf3b2"> {</span></code></td>
<td class="ln">1376</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">else</span><span class="sf3b2"> {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1099</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1377</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">1100</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">foreach</span><span class="sf3b2"> (CRM_Contact_BAO_Contact::$</span><span class="sf18b2">_greetingTypes </span><span class="sf7b2">as</span><span class="sf3b2"> $</span><span class="sf18b2">greeting) {</span></code></td>
<td class="ln">1378</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">foreach</span><span class="sf3b2"> (CRM_Contact_BAO_Contact::$</span><span class="sf18b2">_greetingTypes </span><span class="sf7b2">as</span><span class="sf3b2"> $</span><span class="sf18b2">greeting) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1101</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!</span><span class="sf7b2">isset</span><span class="sf3b2">($</span><span class="sf18b2">params[$</span><span class="sf18b2">greeting . </span><span class="sf12b2">'_id'</span><span class="sf3b2">])) {</span></code></td>
<td class="ln">1379</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!</span><span class="sf7b2">isset</span><span class="sf3b2">($</span><span class="sf18b2">params[$</span><span class="sf18b2">greeting . </span><span class="sf12b2">'_id'</span><span class="sf3b2">])) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1102</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">params[$</span><span class="sf18b2">greeting . </span><span class="sf12b2">'_id'</span><span class="sf3b2">] = CRM_Contact_BAO_Contact_Utils::defaultGreeting</span><span class="sf3b2">(</span><span class="sf12b2">'Ind<wbr>ividual'</span><span class="sf3b2">, $</span><span class="sf18b2">greeting);</span></code></td>
<td class="ln">1380</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">params[$</span><span class="sf18b2">greeting . </span><span class="sf12b2">'_id'</span><span class="sf3b2">] = CRM_Contact_BAO_Contact_Utils::defaultGreeting</span><span class="sf3b2">(</span><span class="sf12b2">'Ind<wbr>ividual'</span><span class="sf3b2">, $</span><span class="sf18b2">greeting);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1103</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">1381</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1104</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
<td class="ln">1382</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1105</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1383</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">1106</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">contactID = </span><span class="sf8b2">CRM_Contact_BAO_Contact::createProfileContact</span><span class="sf3b2">($</span><span class="sf18b2">para<wbr>ms,</span></code></td>
<td class="ln">1384</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">contactID = </span><span class="sf8b2">CRM_Contact_BAO_Contact::createProfileContact</span><span class="sf3b2">($</span><span class="sf18b2">para<wbr>ms,</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1107</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">fields,</span></code></td>
<td class="ln">1385</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">fields,</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1108</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;NULL,</span></code></td>
<td class="ln">1386</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;NULL,</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1109</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">addToGroups,</span></code></td>
<td class="ln">1387</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">addToGroups,</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1110</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;NULL,</span></code></td>
<td class="ln">1388</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;NULL,</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1111</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;NULL,</span></code></td>
<td class="ln">1389</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;NULL,</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1112</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;TRUE</span></code></td>
<td class="ln">1390</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp; &nbsp;TRUE</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1113</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;);</span></code></td>
<td class="ln">1391</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1114</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">set</span><span class="sf3b2">(</span><span class="sf12b2">'contactID'</span><span class="sf3b2">, $</span><span class="sf18b2">contactID);</span></code></td>
<td class="ln">1392</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">this-&gt;</span><span class="sf8b2">set</span><span class="sf3b2">(</span><span class="sf12b2">'contactID'</span><span class="sf3b2">, $</span><span class="sf18b2">contactID);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1115</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">1393</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1116</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1394</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">1117</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">//get email primary first if exist</span></code></td>
<td class="ln">1395</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">//get email primary first if exist</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1118</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">subscribtionEmail = </span><span class="sf7b2">array</span><span class="sf3b2">(</span><span class="sf12b2">'email'</span><span class="sf3b2"> =&gt; </span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'email-Primary'</span><span class="sf3b2">, $</span><span class="sf18b2">params));</span></code></td>
<td class="ln">1396</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;$</span><span class="sf18b2">subscribtionEmail = </span><span class="sf7b2">array</span><span class="sf3b2">(</span><span class="sf12b2">'email'</span><span class="sf3b2"> =&gt; </span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">'email-Primary'</span><span class="sf3b2">, $</span><span class="sf18b2">params));</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1119</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!$</span><span class="sf18b2">subscribtionEmail[</span><span class="sf12b2">'email'</span><span class="sf3b2">]) {</span></code></td>
<td class="ln">1397</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!$</span><span class="sf18b2">subscribtionEmail[</span><span class="sf12b2">'email'</span><span class="sf3b2">]) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1120</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">subscribtionEmail[</span><span class="sf12b2">'email'</span><span class="sf3b2">] = </span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">"email-{$this-&gt;_bltID}"</span><span class="sf3b2">, $</span><span class="sf18b2">params);</span></code></td>
<td class="ln">1398</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;$</span><span class="sf18b2">subscribtionEmail[</span><span class="sf12b2">'email'</span><span class="sf3b2">] = </span><span class="sf8b2">CRM_Utils_Array::value</span><span class="sf3b2">(</span><span class="sf12b2">"email-{$this-&gt;_bltID}"</span><span class="sf3b2">, $</span><span class="sf18b2">params);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1121</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">1399</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1122</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// subscribing contact to groups</span></code></td>
<td class="ln">1400</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf9b2">// subscribing contact to groups</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1123</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!</span><span class="sf7b2">empty</span><span class="sf3b2">($</span><span class="sf18b2">subscribeGroupIds) &amp;&amp; $</span><span class="sf18b2">subscribtionEmail[</span><span class="sf12b2">'email'</span><span class="sf3b2">]) {</span></code></td>
<td class="ln">1401</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf3b2"> (!</span><span class="sf7b2">empty</span><span class="sf3b2">($</span><span class="sf18b2">subscribeGroupIds) &amp;&amp; $</span><span class="sf18b2">subscribtionEmail[</span><span class="sf12b2">'email'</span><span class="sf3b2">]) {</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1124</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">CRM_Mailing_Event_BAO_Subscribe::commonSubscribe</span><span class="sf3b2">($</span><span class="sf18b2">s<wbr>ubscribeGroupIds, $</span><span class="sf18b2">subscribtionEmail, $</span><span class="sf18b2">contactID);</span></code></td>
<td class="ln">1402</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf8b2">CRM_Mailing_Event_BAO_Subscribe::commonSubscribe</span><span class="sf3b2">($</span><span class="sf18b2">s<wbr>ubscribeGroupIds, $</span><span class="sf18b2">subscribtionEmail, $</span><span class="sf18b2">contactID);</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1125</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">1403</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1126</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1404</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">1127</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">return</span><span class="sf3b2"> $</span><span class="sf18b2">contactID;</span></code></td>
<td class="ln">1405</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp; &nbsp;</span><span class="sf7b2">return</span><span class="sf3b2"> $</span><span class="sf18b2">contactID;</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1128</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;}</span></code></td>
<td class="ln">1406</td><td class="sf3b2"><code><span class="sf3b2"> &nbsp;}</span></code></td>
</tr>
<tr valign="top">
<td class="ln">1129</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; ">}</span><span class="sf17b16">
</span>&nbsp;</code></td>
<td class="ln">1407</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; ">}</span>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">1130</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16">
</span>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
</tr>
<tr valign="top">
<td class="ln">1131</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln"></td><td></td>
</tr>
</tbody>
</table>
</body>
</html>
